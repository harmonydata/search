(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2288],{83686:()=>{},32383:()=>{},65776:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(95155),i=a(64665),s=a(68998),r=a(9561),o=a(5565),n=a(3485),d=a(12115);function c(e){let{name:t,url:a,logo:c,inactive:u,compact:h}=e,[x,m]=(0,d.useState)(c),[p,v]=(0,d.useState)(!1);(0,d.useEffect)(()=>{console.log('Resolving logo for organization: "'.concat(t,'"'));try{let e=(0,n.sM)(t,c);console.log('Resolved logo for organization "'.concat(t,'":'),e),m(e),v(!1)}catch(e){console.error('Error resolving logo for organization "'.concat(t,'":'),e),m(void 0)}},[t,c]);let f=x&&x.length>0&&!p;return(0,l.jsxs)(i.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:h?"220px":"280px",height:h?"75px":"85px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:a?"pointer":"default",transition:"all 0.2s",opacity:u?.5:1,"&:hover":a?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{a&&window.open(a,"_blank","noopener,noreferrer")},children:[(0,l.jsx)(s.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,l.jsx)(r.A,{sx:{fontWeight:500,fontSize:h?"0.8rem":"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.9em",wordBreak:"break-word",paddingBottom:"1px"},children:t})}),f&&(0,l.jsx)(s.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,l.jsx)(o.default,{src:x,alt:t,width:h?40:50,height:h?40:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for organization "'.concat(t,'" from path: ').concat(x)),v(!0)},unoptimized:!0})})]})}},69011:(e,t,a)=>{"use strict";a.d(t,{A:()=>ed});var l=a(95155),i=a(68998),s=a(96854),r=a(9561),o=a(47821),n=a(35256),d=a(5565),c=a(90675),u=a(20687),h=a(52488),x=a(32645),m=a(12115),p=a(53452),v=a(64665),f=a(3485);function g(e){let{name:t,url:a,logo:s}=e,[o,n]=(0,m.useState)(s),[c,u]=(0,m.useState)(!1);(0,m.useEffect)(()=>{console.log('Resolving logo for data catalog: "'.concat(t,'"'));try{let e=(0,f.sM)(t,s);console.log('Resolved logo for data catalog "'.concat(t,'":'),e),n(e),u(!1)}catch(e){console.error('Error resolving logo for data catalog "'.concat(t,'":'),e),n(void 0)}},[t,s]);let h=o&&o.length>0&&!c;return(0,l.jsxs)(v.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:"280px",height:"80px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:a?"pointer":"default",transition:"all 0.2s","&:hover":a?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{a&&window.open(a,"_blank","noopener,noreferrer")},children:[(0,l.jsx)(i.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,l.jsx)(r.A,{sx:{fontWeight:500,fontSize:"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.7em",wordBreak:"break-word"},children:t})}),h&&(0,l.jsx)(i.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,l.jsx)(d.default,{src:o,alt:t,width:50,height:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for data catalog "'.concat(t,'" from path: ').concat(o)),u(!0)},unoptimized:!0})})]})}var b=a(65776),j=a(51857),y=a(67247),_=a(26536),A=a(50914),w=a(57165),C=a(53326),k=a(72926),S=a(66917),z=a(4918),D=a(41983),R=a(2091),I=a(60391),W=a(78416),E=a(36417),O=a(27753),L=a(10319),M=a(10358),U=a(64364),N=a(71569),T=a(689),F=a(48694),P=a(7660);function V(e){let{variables:t,studyName:a,downloadAnchorEl:s,onDownloadClick:r,onDownloadClose:n}=e,d=(0,m.useRef)(null),c=(0,m.useRef)(null),[u,h]=(0,m.useState)(!1);console.log("variables passed:",t),(0,m.useEffect)(()=>{if(customElements.get("harmony-export"))return;let e=document.createElement("script");return e.src="/app/js/harmony-export.js",e.async=!0,document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[]);let x=[{field:"description",headerName:"Description / Code",flex:2,valueGetter:(e,t)=>(t.description||t.name)+(t.description&&t.name?" ("+t.name+")":""),sortable:!0},{field:"options",headerName:"Response Options",flex:1,valueGetter:(e,t)=>t.options&&Array.isArray(t.options)?t.options.join(" / "):"",sortable:!0}],p=t.filter(e=>e.name||e.description).map((e,t)=>({id:e.uuid||e.name||t,...e})),v=(0,_.b)();(0,m.useEffect)(()=>{let e=setTimeout(()=>{v.current&&h(!0)},200);return()=>clearTimeout(e)},[v]);let f=()=>{let e=v.current;if(!e||!u)return[];try{let t=e.getSelectedRows();return t?Array.from(t.values()):[]}catch(e){return console.warn("Failed to get selected items:",e),[]}},g=()=>f().length,b=()=>{let e=v.current;if(!e||!u)return!1;try{let t=e.getSelectedRows();return t&&"number"==typeof t.size&&t.size>0}catch(e){return!1}},j=(0,m.useCallback)(()=>{if(!d.current||!u)return;let e=f();if(d.current.innerHTML="",0===e.length)return;console.log("selectedItems:",e);let t=e.map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name})),l=document.createElement("harmony-export");l.size="32px",l.instrument_name="".concat(a||"Selected Variables"," from harmonydata.ac.uk/discover"),l.questions=t,d.current.appendChild(l)},[u,a]);(0,m.useEffect)(()=>{if(!u||!v.current)return;let e=v.current.subscribeEvent("rowSelectionChange",()=>{j()});return()=>{e()}},[u,j]);let y=()=>{null==n||n()},W=()=>{let e;let t=v.current;if(!t||!u)return[];try{e=t.getSelectedRows()}catch(t){e=null}return(e&&"number"==typeof e.size&&e.size>0&&e?Array.from(e.values()):(()=>{let e;try{e=t.getRowModels()}catch(t){e=null}return e?Array.from(e.values()):[]})()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name,response_options:e.options&&Array.isArray(e.options)?e.options.join(" / "):""}))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{sx:{height:"100%",minHeight:400},children:p.length>0&&(0,l.jsx)(A.z,{apiRef:v,paginationMode:"server",rows:p,columns:x,checkboxSelection:!0,sortModel:[{field:"score",sort:"desc"}],getRowClassName:e=>e.row.matched?"matched-row":"",sx:{background:"white",borderRadius:2,fontSize:14,height:"100%","& .matched-row":{backgroundColor:"#fffae4","&:hover":{backgroundColor:"#fff8d1"}}},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:[(0,l.jsx)(w.e,{expanded:!0,style:{width:"100%"},children:(0,l.jsx)(C.X,{placeholder:"Search within variables",style:{background:"white",borderRadius:192,fontSize:14,margin:15,width:"calc(100% - 15px)",height:"auto"}})}),(0,l.jsx)(k.A,{title:"Harmonise selected items",children:(0,l.jsx)(o.A,{size:"small",sx:{width:40,height:40},children:(0,l.jsx)(i.default,{ref:d,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}})})}),(0,l.jsx)(k.A,{title:b()?"Download ".concat(g()," selected questions"):"Download all questions",children:(0,l.jsx)(o.A,{ref:c,size:"small",onClick:r,sx:{width:40,height:40},children:(0,l.jsx)(L.A,{size:30})})})]})}})}),(0,l.jsx)(S.Ay,{open:!!s,anchorEl:s,onClose:y,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,l.jsxs)(z.A,{sx:{width:200},children:[(0,l.jsxs)(D.Ay,{onClick:()=>{let e=new Blob([JSON.stringify(W(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="questions.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),y()},sx:{cursor:"pointer"},children:[(0,l.jsx)(R.A,{children:(0,l.jsx)(M.A,{size:20})}),(0,l.jsx)(I.A,{primary:"Download as JSON"})]}),(0,l.jsxs)(D.Ay,{onClick:()=>{let e=new Blob([[["Question Number","Question Text","Response Options"],...W().map(e=>[e.question_no,e.question_text,e.response_options])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="questions.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),y()},sx:{cursor:"pointer"},children:[(0,l.jsx)(R.A,{children:(0,l.jsx)(U.A,{size:20})}),(0,l.jsx)(I.A,{primary:"Download as CSV"})]}),(0,l.jsxs)(D.Ay,{onClick:()=>{let e=W(),t=P.Wp.json_to_sheet(e),a=P.Wp.book_new();P.Wp.book_append_sheet(a,t,"Questions");let l=new Blob([P.M9(a,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=URL.createObjectURL(l),s=document.createElement("a");s.href=i,s.download="questions.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),y()},sx:{cursor:"pointer"},children:[(0,l.jsx)(R.A,{children:(0,l.jsx)(N.A,{size:20})}),(0,l.jsx)(I.A,{primary:"Download as Excel"})]})]})})]})}function q(e){let{variables:t,studyName:a}=e,[s,n]=(0,m.useState)(!1),d=(0,m.useRef)(null),[c,u]=(0,m.useState)(null),h=()=>{u(null),n(!1)},x=(0,l.jsx)(V,{variables:t,studyName:a,downloadAnchorEl:c,onDownloadClick:e=>{console.log("handleDownloadClick",e.currentTarget),u(d.current)},onDownloadClose:()=>{u(null)}});return s?(0,l.jsxs)(W.A,{ref:d,open:!0,onClose:h,maxWidth:"xl",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh"}},children:[(0,l.jsxs)(E.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,l.jsxs)(r.A,{variant:"h6",children:["Variables - ",a||"Study"]}),(0,l.jsx)(o.A,{onClick:h,size:"small",sx:{color:"text.secondary"},children:(0,l.jsx)(T.A,{size:20})})]}),(0,l.jsx)(O.A,{sx:{p:0,overflow:"hidden"},children:(0,l.jsx)(i.default,{sx:{height:"100%","& .MuiDataGrid-root":{borderRadius:0,maxHeight:"none",height:"100%"}},children:x})})]}):(0,l.jsxs)(i.default,{ref:d,sx:{position:"relative"},children:[(0,l.jsx)(i.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:1},children:(0,l.jsx)(k.A,{title:"Open in large view",children:(0,l.jsx)(o.A,{size:"small",onClick:()=>{u(null),n(!0)},children:(0,l.jsx)(F.A,{size:20})})})}),(0,l.jsx)(i.default,{sx:{"& .MuiDataGrid-root":{height:450,borderRadius:2}},children:x})]})}a(67699);var B=a(22282),H=a(90662),G=a(28222),J=a(65330),X=a(26214),Q=a(2743),Y=a(6327),K=a(51644),Z=a(86453);function $(e){let{open:t,onClose:a,title:s,originalSearchResult:n,lookupData:d,finalProcessedData:c}=e,[u,h]=(0,m.useState)(!1),[x,p]=(0,m.useState)(null),[v,f]=(0,m.useState)(""),g=()=>{navigator.clipboard.writeText(JSON.stringify({originalSearchResult:n,lookupData:d,finalProcessedData:c},null,2))},b=(e,t)=>{p(e),f(t),h(!0)},j=e=>{let{data:t,label:a}=e;return t?(0,l.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,l.jsxs)(r.A,{variant:"body2",children:[(0,l.jsxs)("strong",{children:[a,":"]})," ",(e=>{var t,a;if(!e||"object"!=typeof e)return"Invalid data";let l=Object.keys(e).length,i=e.title||(null===(t=e.dataset_schema)||void 0===t?void 0:t.name)||(null===(a=e.extra_data)||void 0===a?void 0:a.name)||e.name||"Unnamed";return"".concat(i," (").concat(l," top-level properties)")})(t)]}),(0,l.jsx)(B.A,{size:"small",variant:"outlined",onClick:()=>b(t,"".concat(s," - ").concat(a)),sx:{ml:2},children:"View JSON"})]}):(0,l.jsxs)(r.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:["No ",a.toLowerCase()," data available"]})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(W.A,{open:t,onClose:a,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxHeight:"80vh"}},children:[(0,l.jsxs)(E.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,l.jsxs)(r.A,{variant:"h6",component:"div",children:["Debug Data: ",s]}),(0,l.jsxs)(i.default,{children:[(0,l.jsx)(o.A,{onClick:g,size:"small",sx:{mr:1},title:"Copy all data to clipboard",children:(0,l.jsx)(Q.A,{fontSize:"small"})}),(0,l.jsx)(o.A,{onClick:a,size:"small",children:(0,l.jsx)(Y.A,{fontSize:"small"})})]})]}),(0,l.jsx)(O.A,{dividers:!0,sx:{p:3},children:t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,sx:{mb:3},children:"Data Pipeline Overview"}),(0,l.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsxs)(H.A,{defaultExpanded:!1,children:[(0,l.jsx)(G.A,{expandIcon:(0,l.jsx)(K.A,{}),children:(0,l.jsx)(r.A,{variant:"subtitle2",sx:{fontWeight:600},children:"1. Original Search Result"})}),(0,l.jsxs)(J.A,{children:[(0,l.jsx)(r.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The raw data returned from the search API when this result was found."}),(0,l.jsx)(j,{data:n,label:"Original Search Result"})]})]}),(0,l.jsxs)(H.A,{defaultExpanded:!1,children:[(0,l.jsx)(G.A,{expandIcon:(0,l.jsx)(K.A,{}),children:(0,l.jsx)(r.A,{variant:"subtitle2",sx:{fontWeight:600},children:"2. Lookup Data"})}),(0,l.jsxs)(J.A,{children:[(0,l.jsx)(r.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The full data fetched from the lookup API using the UUID from the search result."}),(0,l.jsx)(j,{data:d,label:"Lookup Data"})]})]}),(0,l.jsxs)(H.A,{defaultExpanded:!1,children:[(0,l.jsx)(G.A,{expandIcon:(0,l.jsx)(K.A,{}),children:(0,l.jsx)(r.A,{variant:"subtitle2",sx:{fontWeight:600},children:"3. Final Processed Data"})}),(0,l.jsxs)(J.A,{children:[(0,l.jsx)(r.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The processed and formatted data that is displayed in the StudyDetail component."}),(0,l.jsx)(j,{data:c,label:"Final Processed Data"})]})]})]}),(0,l.jsx)(i.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,l.jsxs)(r.A,{variant:"caption",color:"text.secondary",children:[(0,l.jsx)("strong",{children:"Data Flow:"})," Original Search Result → Lookup API → Processing & Mapping → StudyDetail Component"]})})]})}),(0,l.jsxs)(X.A,{children:[(0,l.jsx)(B.A,{onClick:g,startIcon:(0,l.jsx)(Q.A,{}),children:"Copy All Data"}),(0,l.jsx)(B.A,{onClick:a,variant:"contained",children:"Close"})]})]}),(0,l.jsx)(Z.A,{open:u,onClose:()=>h(!1),data:x,title:v})]})}var ee=a(66656),et=a(48173),ea=a.n(et);function el(e){let{datasets:t}=e,a=[{field:"title",headerName:"Dataset Name",flex:1,minWidth:300,renderCell:e=>{let t=e.value||"Untitled Dataset",a=e.row.slug,i=e.row.uuid;return a?(0,l.jsx)(ee.A,{component:ea(),href:"/items/".concat(a),underline:"hover",sx:{fontWeight:600,color:"primary.main"},children:t}):i?(0,l.jsx)(ee.A,{component:ea(),href:"/items/".concat(i),underline:"hover",sx:{fontWeight:600,color:"primary.main"},children:t}):(0,l.jsx)(r.A,{variant:"body2",sx:{fontWeight:600},children:t})}},{field:"numVariables",headerName:"Variables",width:120,renderCell:e=>{let t=e.value;return(0,l.jsx)(r.A,{variant:"body2",color:"text.secondary",children:t||"-"})}},{field:"temporalCoverage",headerName:"Time Coverage",width:150,renderCell:e=>{let t=e.value;return(0,l.jsx)(r.A,{variant:"body2",color:"text.secondary",children:t||"-"})}}],s=(0,m.useMemo)(()=>t.map((e,t)=>{var a,l,i,s,r,o,n,d,c;return{id:(null===(a=e.extra_data)||void 0===a?void 0:a.uuid)||t,title:(null===(l=e.dataset_schema)||void 0===l?void 0:l.name)||(null===(i=e.extra_data)||void 0===i?void 0:i.name)||"Untitled Dataset",slug:null===(s=e.extra_data)||void 0===s?void 0:s.slug,uuid:null===(r=e.extra_data)||void 0===r?void 0:r.uuid,numVariables:(null===(o=e.dataset_schema)||void 0===o?void 0:o.number_of_variables)||(null===(n=e.extra_data)||void 0===n?void 0:n.num_variables)||(null===(d=e.extra_data)||void 0===d?void 0:d.number_of_variables),temporalCoverage:null===(c=e.dataset_schema)||void 0===c?void 0:c.temporalCoverage}}),[t]);return(0,l.jsx)(i.default,{sx:{height:"100%",minHeight:200},children:(0,l.jsx)(A.z,{rows:s,columns:a,disableRowSelectionOnClick:!0,sortModel:[{field:"title",sort:"asc"}],sx:{background:"white",borderRadius:2,fontSize:14,height:"100%"},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,l.jsx)(i.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:(0,l.jsx)(w.e,{expanded:!0,style:{width:"100%"},children:(0,l.jsx)(C.X,{})})})}})})}var ei=a(10683),es=a(63612),er=a(54615),eo=a(73179),en=a(42649);let ed=(0,m.memo)(e=>{var t,a,v,f,_,A,w,C,k,S,z,D,R,I,W,E,O,L,M,U,N,T,F,P,V,B,H,G,J,X,Q,Y,K,Z,ee,et,ea,ed,ec,eu,eh,ex,em,ep,ev;let{study:ef,isDrawerView:eg=!1,studyDataComplete:eb=!1,onTopicClick:ej,onInstrumentClick:ey,debugData:e_}=e,[eA,ew]=(0,m.useState)(!1),[eC,ek]=(0,m.useState)(!1),[eS,ez]=(0,m.useState)(!1),[eD,eR]=(0,m.useState)(!1),[eI,eW]=(0,m.useState)(!0),[eE,eO]=(0,m.useState)(!1),[eL,eM]=(0,m.useState)(!1),[eU,eN]=(0,m.useState)(null),[eT,eF]=(0,m.useState)(null),[eP,eV]=(0,m.useState)(!1),eq=(0,m.useRef)(null),{currentUser:eB}=(0,ei.A)(),{searchSettings:eH}=(0,es.S)(),eG=eT||ef,eJ=(null===(t=eG.dataset_schema)||void 0===t?void 0:t.name)||(null===(a=eG.extra_data)||void 0===a?void 0:a.name)||"Untitled Dataset",eX=(null===(v=eG.dataset_schema)||void 0===v?void 0:v.description)||(null===(f=eG.extra_data)||void 0===f?void 0:f.description)||"",eQ=(null===(_=eG.extra_data)||void 0===_?void 0:_.ai_summary)||null,eY=eQ&&eQ.trim().length>0,eK=eI&&eY?eQ:eX,eZ=(null===(A=eG.dataset_schema)||void 0===A?void 0:A.image)||eG.image||void 0;(0,m.useEffect)(()=>{eR(!1)},[eJ,eZ]),(0,m.useEffect)(()=>{ez(!1)},[eJ]),(0,m.useEffect)(()=>{eq.current&&eq.current.scrollTo({top:0,behavior:"smooth"})},[null===(w=ef.extra_data)||void 0===w?void 0:w.uuid]),(0,m.useEffect)(()=>{(async()=>{var e;if(eB&&(null===(e=ef.extra_data)||void 0===e?void 0:e.uuid))try{let e=(0,er.P)((0,er.rJ)(eo.db,"saved_resources"),(0,er._M)("uid","==",eB.uid),(0,er._M)("uuid","==",ef.extra_data.uuid)),t=await (0,er.GG)(e);if(t.empty)eO(!1),eN(null);else{let e=t.docs[0];eO(!0),eN(e.id)}}catch(e){console.error("Error checking if resource is saved:",e)}})()},[eB,null===(C=ef.extra_data)||void 0===C?void 0:C.uuid]);let e$=async()=>{var e,t,a,l,i,s,r,o;if(eB&&(null===(e=ef.extra_data)||void 0===e?void 0:e.uuid)&&!eL){eM(!0);try{if(eE&&eU)await (0,er.kd)((0,er.H9)(eo.db,"saved_resources",eU)),eO(!1),eN(null);else{let e={title:eJ,description:eQ||eX,image:eZ||null,uuid:ef.extra_data.uuid,slug:ef.extra_data.slug||null,resourceType:ef.extra_data.resource_type||null,keywords:(null===(t=ef.dataset_schema)||void 0===t?void 0:t.keywords)||[],variablesCount:(null===(l=ef.dataset_schema)||void 0===l?void 0:null===(a=l.variableMeasured)||void 0===a?void 0:a.length)||(null===(i=ef.dataset_schema)||void 0===i?void 0:i.number_of_variables)||0,datasetsCount:(null===(s=ef.child_datasets)||void 0===s?void 0:s.length)||0,hasDataAvailable:!!(null===(o=ef.dataset_schema)||void 0===o?void 0:null===(r=o.includedInDataCatalog)||void 0===r?void 0:r.length),hasFreeAccess:ef.hasFreeAccess||!1,hasCohortsAvailable:ef.hasCohortsAvailable||!1,uid:eB.uid,created:(0,er.O5)()};console.log("Saving resource:",e);let n=await (0,er.gS)((0,er.rJ)(eo.db,"saved_resources"),e);eO(!0),eN(n.id)}}catch(e){console.error("Error saving/unsaving resource:",e)}finally{eM(!1)}}};(0,m.useEffect)(()=>{eW(!!eY)},[eJ,eY]),(0,m.useEffect)(()=>{var e;let t=!1;if(eF(null),!eb&&(null==ef?void 0:null===(e=ef.extra_data)||void 0===e?void 0:e.uuid))return eV(!0),(async()=>{try{let e=await (0,en.w3)(ef.extra_data.uuid,eH.query,eH.hybridWeight,eH.maxDistance);t||(eF(e),eV(!1))}catch(e){console.error("Failed to load enhanced study data:",e),t||eV(!1)}})(),()=>{t=!0}},[null==ef?void 0:null===(k=ef.extra_data)||void 0===k?void 0:k.uuid,eb,eH.query,eH.hybridWeight,eH.maxDistance]);let[e0,e1]=(0,m.useState)(!1),[e2,e6]=(0,m.useState)(!1),[e5,e3]=(0,m.useState)({description:!0,details:!1,variables:!1,links:!1,childDatasets:!1}),e4=e=>{e3(t=>({...t,[e]:!t[e]}))},e8=((null===(S=eG.dataset_schema)||void 0===S?void 0:S.keywords)||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),e7=e8.length>0,e9=((null===(z=eG.extra_data)||void 0===z?void 0:z.instruments)||[]).length>0,te=(eG.variables_which_matched||[]).length>0||((null===(D=eG.dataset_schema)||void 0===D?void 0:D.variableMeasured)||[]).length>0||((null===(R=eG.dataset_schema)||void 0===R?void 0:R.number_of_variables)||0)>0,tt=[];if((null===(I=eG.dataset_schema)||void 0===I?void 0:I.identifier)&&Array.isArray(eG.dataset_schema.identifier)){let e=eG.dataset_schema.identifier.filter(e=>!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("10.")&&e.includes("/"))).map(e=>e.startsWith("10.")&&e.includes("/")?"https://doi.org/".concat(e):e);tt.push(...e)}(null===(W=eG.dataset_schema)||void 0===W?void 0:W.url)&&Array.isArray(eG.dataset_schema.url)&&tt.push(...eG.dataset_schema.url);let ta=tt.length>0;console.log("StudyDetail instruments debug:",{instruments:(null===(E=eG.extra_data)||void 0===E?void 0:E.instruments)||[],hasInstruments:e9,instrumentsLength:((null===(O=eG.extra_data)||void 0===O?void 0:O.instruments)||[]).length});let tl=(0,m.useMemo)(()=>{var e,t,a,l,i;console.log("study var deduping :",{matchedVariables:eG.variables_which_matched,allVariables:null===(e=eG.dataset_schema)||void 0===e?void 0:e.variableMeasured,matchedLength:null===(t=eG.variables_which_matched)||void 0===t?void 0:t.length,allLength:null===(l=eG.dataset_schema)||void 0===l?void 0:null===(a=l.variableMeasured)||void 0===a?void 0:a.length});let s=eG.variables_which_matched||[],r=(null===(i=eG.dataset_schema)||void 0===i?void 0:i.variableMeasured)||[],o=new Map;return s.forEach(e=>{let t=e.name;t&&o.set(t,{...e,matched:!0})}),r.forEach(e=>{let t=e.name;!t||o.has(t)||o.set(t,e)}),Array.from(o.values())},[eG.variables_which_matched,null===(L=eG.dataset_schema)||void 0===L?void 0:L.variableMeasured]);return(0,l.jsxs)(i.default,{ref:eq,sx:{p:3,width:"100%",height:"100%",overflowY:"auto",flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[eP&&(0,l.jsxs)(i.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,display:"flex",alignItems:"center",gap:.5,p:.5,bgcolor:"background.paper",borderRadius:1,boxShadow:1,border:"1px solid",borderColor:"divider"},children:[(0,l.jsx)(s.A,{size:12}),(0,l.jsx)(r.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Loading..."})]}),eg&&(0,l.jsx)(i.default,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,l.jsx)(o.A,{size:"small",onClick:()=>e1(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,l.jsx)(c.A,{size:18})})}),eg&&eB&&(0,l.jsx)(i.default,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,l.jsx)(o.A,{onClick:e$,disabled:eL,sx:{color:eE?"primary.main":"text.secondary","&:hover":{color:eE?"primary.dark":"primary.main"}},title:eE?"Remove from saved":"Save to my resources",children:eL?(0,l.jsx)(s.A,{size:20}):(0,l.jsx)(u.A,{size:20,fill:eE?"currentColor":"none"})})}),!eg&&(0,l.jsxs)(i.default,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:2,mb:4},children:[(0,l.jsx)(i.default,{sx:{flex:1},children:(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"h4",gutterBottom:!0,sx:{flex:1,mr:1},children:eJ}),eB&&(0,l.jsx)(o.A,{onClick:e$,disabled:eL,sx:{color:eE?"primary.main":"text.secondary","&:hover":{color:eE?"primary.dark":"primary.main"}},title:eE?"Remove from saved":"Save to my resources",children:eL?(0,l.jsx)(s.A,{size:20}):(0,l.jsx)(u.A,{size:20,fill:eE?"currentColor":"none"})}),(0,l.jsx)(o.A,{size:"small",onClick:()=>e1(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary",mt:.5},children:(0,l.jsx)(c.A,{size:18})})]})}),eZ&&!eD&&(0,l.jsx)(i.default,{sx:{width:100,height:100,position:"relative",borderRadius:"8px",overflow:"hidden",flexShrink:0},children:(0,l.jsx)(d.default,{src:eZ,alt:eJ,fill:!0,style:{objectFit:"contain"},onError:()=>eR(!0),unoptimized:!0},eJ)})]}),eK&&(0,l.jsxs)(i.default,{sx:{mb:4},children:[eS?(0,l.jsx)(j.A,{text:eK,paragraphProps:{variant:"body1",sx:{mb:2}},compact:!0}):(0,l.jsx)(r.A,{variant:"body1",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",mb:2},children:eK}),eY&&eS&&(0,l.jsx)(i.default,{sx:{mt:2,mb:1},children:(0,l.jsx)(r.A,{variant:"body2",color:"primary",sx:{cursor:"pointer",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>eW(!eI),children:eI?"Showing AI summary, click to see original":"Showing original, click to see AI summary"})}),eK.length>300&&(0,l.jsxs)(i.default,{onClick:()=>ez(!eS),sx:{display:"flex",alignItems:"center",color:"primary.main",cursor:"pointer",mt:1},children:[(0,l.jsx)(r.A,{variant:"body2",color:"primary",sx:{fontWeight:500,mr:1},children:eS?"Show Less":"Show More"}),eS?(0,l.jsx)(h.A,{size:16}):(0,l.jsx)(x.A,{size:16})]})]}),te&&(0,l.jsxs)(i.default,{sx:{mb:4},children:[(0,l.jsx)(p.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eA?(0,l.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>ew(!eA),children:(null===(M=eG.variables_which_matched)||void 0===M?void 0:M.length)?"Related Variables (".concat(eG.variables_which_matched.length," / ").concat((null===(P=eG.dataset_schema)||void 0===P?void 0:null===(F=P.variableMeasured)||void 0===F?void 0:F.length)||(null===(V=eG.dataset_schema)||void 0===V?void 0:V.number_of_variables)||0,")"):"Variables (".concat((null===(N=eG.dataset_schema)||void 0===N?void 0:null===(U=N.variableMeasured)||void 0===U?void 0:U.length)||(null===(T=eG.dataset_schema)||void 0===T?void 0:T.number_of_variables)||0,")")}),(0,l.jsx)(n.A,{in:eA,children:(0,l.jsx)(i.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsx)(q,{variables:tl,studyName:eJ})})})]}),(0,l.jsxs)(i.default,{sx:{mb:4},children:[(0,l.jsx)(p.A,{fullWidth:!0,chipVariant:"secondary",endIcon:e5.details?(0,l.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>e4("details"),children:"Details"}),(0,l.jsx)(n.A,{in:e5.details,children:(0,l.jsx)(i.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(null===(H=ef.dataset_schema)||void 0===H?void 0:null===(B=H.publisher)||void 0===B?void 0:B[0])&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Publisher:"}),(0,l.jsx)(b.A,{name:ef.dataset_schema.publisher[0].name||"Unknown Publisher",url:null===(G=ef.dataset_schema.publisher[0])||void 0===G?void 0:G.url,logo:null===(J=ef.dataset_schema.publisher[0])||void 0===J?void 0:J.logo})]}),((null===(X=ef.extra_data)||void 0===X?void 0:X.geographic_coverage)||(null===(Q=ef.extra_data)||void 0===Q?void 0:Q.country_codes))&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Geographic Coverage:"}),(0,l.jsx)(r.A,{children:ef.extra_data.geographic_coverage||(null===(Y=ef.extra_data.country_codes)||void 0===Y?void 0:Y.join(", "))})]}),((null===(K=ef.dataset_schema)||void 0===K?void 0:K.temporalCoverage)||(null===(Z=ef.extra_data)||void 0===Z?void 0:Z.start_year)&&(null===(ee=ef.extra_data)||void 0===ee?void 0:ee.end_year))&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Temporal Coverage:"}),(0,l.jsx)(r.A,{children:(e=>{if(!e)return"Not specified";if(e.includes("..")){let[t,a]=e.split("..");return a?"".concat(t," - ").concat(a):"".concat(t," - Present (Ongoing)")}return e})((null===(et=ef.dataset_schema)||void 0===et?void 0:et.temporalCoverage)||"".concat(ef.extra_data.start_year,"..").concat(ef.extra_data.end_year))})]}),(null===(ea=ef.extra_data)||void 0===ea?void 0:ea.sample_size)&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Sample Size:"}),(0,l.jsx)(r.A,{children:ef.extra_data.sample_size})]}),((null===(ed=ef.extra_data)||void 0===ed?void 0:ed.age_lower)||(null===(ec=ef.extra_data)||void 0===ec?void 0:ec.age_upper))&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Age Coverage:"}),(0,l.jsx)(r.A,{children:ef.extra_data.age_lower&&ef.extra_data.age_upper?"".concat(ef.extra_data.age_lower," - ").concat(ef.extra_data.age_upper," years"):ef.extra_data.age_lower?"".concat(ef.extra_data.age_lower,"+ years"):"0 - ".concat(ef.extra_data.age_upper," years")})]}),(null===(eu=ef.extra_data)||void 0===eu?void 0:eu.resource_type)&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Resource Type:"}),(0,l.jsx)(r.A,{children:ef.extra_data.resource_type})]}),(null===(eh=ef.extra_data)||void 0===eh?void 0:eh.study_design)&&ef.extra_data.study_design.length>0&&(0,l.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(r.A,{variant:"subtitle2",children:"Study Design:"}),(0,l.jsx)(r.A,{children:ef.extra_data.study_design.join(", ")})]})]})})})]}),(null===(ex=ef.dataset_schema)||void 0===ex?void 0:ex.funder)&&ef.dataset_schema.funder.length>0&&(0,l.jsxs)(i.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(r.A,{variant:"subtitle2",gutterBottom:!0,children:"Funders:"}),(0,l.jsx)(i.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:ef.dataset_schema.funder.map((e,t)=>(0,l.jsx)(b.A,{name:e.name||"Funding Organization",url:null==e?void 0:e.url,logo:null==e?void 0:e.logo},"".concat(e.name,"-").concat(t)))})]}),(null===(em=ef.dataset_schema)||void 0===em?void 0:em.includedInDataCatalog)&&ef.dataset_schema.includedInDataCatalog.length>0&&(0,l.jsxs)(i.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(r.A,{variant:"subtitle2",gutterBottom:!0,children:"Available in Data Catalogs:"}),(0,l.jsx)(i.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:ef.dataset_schema.includedInDataCatalog.map((e,t)=>(0,l.jsx)(g,{name:e.name||"Data Catalog",url:e.url,logo:e.image},"".concat(e.name,"-").concat(t)))})]}),e7&&(0,l.jsxs)(i.default,{sx:{mb:4},children:[(0,l.jsx)(r.A,{variant:"subtitle2",gutterBottom:!0,children:"Topics:"}),(0,l.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:e8.map((e,t)=>(0,l.jsx)(p.A,{onClick:t=>{t.stopPropagation(),ej&&ej(e)},sx:{cursor:"pointer"},children:e},"topic-".concat(t)))})]}),ta&&(0,l.jsxs)(i.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(p.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eC?(0,l.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>ek(!eC),children:"Related Links & Papers"}),(0,l.jsx)(n.A,{in:eC,children:eC&&(0,l.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,alignItems:"flex-start"},children:null==tt?void 0:tt.map((e,t)=>(0,l.jsx)(i.default,{sx:{flex:"1 1 350px",minWidth:300,maxWidth:500},children:(0,l.jsx)(y.A,{url:e})},"link-".concat(t)))})})]}),e9&&(0,l.jsxs)(i.default,{sx:{mb:2},children:[(0,l.jsxs)(p.A,{fullWidth:!0,chipVariant:"secondary",endIcon:e2?(0,l.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>e6(e=>!e),children:["Instruments (",((null===(ep=ef.extra_data)||void 0===ep?void 0:ep.instruments)||[]).length,")"]}),(0,l.jsx)(n.A,{in:e2,children:(0,l.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:((null===(ev=ef.extra_data)||void 0===ev?void 0:ev.instruments)||[]).map((e,t)=>(0,l.jsx)(p.A,{onClick:t=>{t.stopPropagation(),ey&&ey(e)},children:e},"instrument-".concat(t)))})})]}),Array.isArray(ef.child_datasets)&&(ef.child_datasets||[]).length>0&&(0,l.jsxs)(i.default,{sx:{mb:4},children:[(0,l.jsxs)(p.A,{fullWidth:!0,chipVariant:"secondary",endIcon:e5.childDatasets?(0,l.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>e4("childDatasets"),children:["Related Datasets (",(ef.child_datasets||[]).length,")"]}),(0,l.jsx)(n.A,{in:e5.childDatasets,children:(0,l.jsx)(i.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsx)(el,{datasets:ef.child_datasets})})})]}),(0,l.jsx)($,{open:e0,onClose:()=>e1(!1),title:eJ,originalSearchResult:null==e_?void 0:e_.originalSearchResult,lookupData:null==e_?void 0:e_.lookupData,finalProcessedData:ef})]})})},67699:()=>{}}]);