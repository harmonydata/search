"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{42649:(e,t,a)=>{a.d(t,{AV:()=>u,Dd:()=>s,Hu:()=>n,Pn:()=>c,Qf:()=>l,S6:()=>m,U4:()=>d,Y3:()=>h,_u:()=>p,dh:()=>g,v5:()=>i,w3:()=>r});let o="https://harmonydataweaviate.azureedge.net";async function s(){let e=await fetch("".concat(o,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let a=t.aggregations||{};return Object.keys(a).map(e=>{let t;let o=a[e];if(["num_sweeps","num_variables","sample_size","duration_years","age_lower","age_upper","start_year","end_year"].includes(e)&&"object"==typeof o&&!Array.isArray(o)&&void 0!==o.minimum&&void 0!==o.maximum){let e=Math.floor(o.minimum),a=Math.ceil(o.maximum),s=[],n=Math.min(100,a-e+1),r=(a-e)/(n-1);for(let t=0;t<n;t++)s.push(String(Math.round(e+t*r)));t=s}else t=Object.keys(o);return{id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:t,frequencies:"object"!=typeof o||Array.isArray(o)?void 0:o}})}async function n(e,t){var a,s;let n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,l=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0,p=t&&Object.keys(t).length>0;if(!e&&!p)return{results:[],aggregations:{},num_hits:0};let m=e&&""!==e.trim()?e.trim():"",w=h&&h.length>0&&!l,y=l?"search2":"search",_="".concat(o,"/discover/").concat(y);if(w){n=_;let e={query:[m],num_results:c},a=void 0!==u?u:(i-1)*c;e.offset=a,void 0!==d&&(e.alpha=d),e.top_level_ids_seen_so_far=h,t&&Object.entries(t).forEach(t=>{let[a,o]=t;o.length>0&&(a.endsWith("_min")||a.endsWith("_max")?e[a]=parseInt(o[0],10):e[a]=o)}),void 0!==g&&(e.return_variables_within_parent=g),void 0!==f&&(e.max_vector_distance=f),r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[m],topLevelIdsCount:h.length,offset:a,endpoint:y})}else{let e=new URLSearchParams;void 0!==d&&e.set("alpha",d.toString()),e.append("query",m);let a=void 0!==u?u:(i-1)*c;e.set("num_results",c.toString()),e.set("offset",a.toString());let o={};if(t)for(let a in t)if(a.endsWith("_min")||a.endsWith("_max")){let s=a.replace(/_(min|max)$/,"");o[s]||(o[s]={}),a.endsWith("_min")?o[s].min=t[a][0]:o[s].max=t[a][0],e.append(a,t[a][0])}else t[a].forEach(t=>{e.append(a,t)});void 0!==g&&e.set("return_variables_within_parent",g.toString()),void 0!==f&&e.set("max_vector_distance",f.toString()),n="".concat(_,"?").concat(e.toString()),r={method:"GET"},Object.keys(o).length>0&&console.log("Numeric range parameters:",o),console.log("Using GET request:",n)}let v=await fetch(n,r);if(!v.ok)throw console.error("Search API error:",v.status,await v.text()),Error("Search API request failed");let b=await v.json();return window.__lastSearchResponse=b,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:b.num_hits,resultCount:(null===(a=b.results)||void 0===a?void 0:a.length)||0,firstResult:null===(s=b.results)||void 0===s?void 0:s[0],aggregations:Object.keys(b.aggregations||{}),endpoint:y,method:w?"POST":"GET",hybridWeight:d}),{results:b.results||[],aggregations:b.aggregations||{},num_hits:b.num_hits,top_level_ids_seen_so_far:b.top_level_ids_seen_so_far||[],next_page_offset:b.next_page_offset}}async function r(e,t,a,s){let n=new URLSearchParams,r=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)||/^[0-9a-f]{32}$/i.test(e);r?n.set("uuid",e):n.set("slug",e),t&&t.trim()&&n.set("query",t.trim()),void 0!==a&&n.set("alpha",a.toString()),void 0!==s&&n.set("max_vector_distance",s.toString());let i="".concat(o,"/discover/lookup?").concat(n.toString()),c=await fetch(i);if(!c.ok&&r&&404===c.status){console.log("UUID lookup failed for ".concat(e,", trying as slug..."));let n=new URLSearchParams;n.set("slug",e),t&&t.trim()&&n.set("query",t.trim()),void 0!==a&&n.set("alpha",a.toString()),void 0!==s&&n.set("max_vector_distance",s.toString());let r="".concat(o,"/discover/lookup?").concat(n.toString()),i=await fetch(r);if(i.ok){let e=await i.json();return window.__lastLookupResponse=e,e.results[0]}}if(!c.ok)throw console.error("Failed to fetch result by UUID:",c.statusText),Error("Failed to fetch result by UUID: ".concat(c.statusText));let l=await c.json();return window.__lastLookupResponse=l,l.results[0]}async function i(e){let t=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,a=(e.match(/\)/g)||[]).length;if(a>t){let o=a-t,s=e;for(let e=0;e<o;e++)s.endsWith(")")&&(s=s.slice(0,-1));return s!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(s,'" (removed ').concat(o," extra closing brackets)")),s}}return e}(e),a=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(t)));if(!a.ok)throw Error("Failed to fetch OpenGraph data");return a.json()}async function c(){let e=await fetch("".concat(o,"/info/version"));if(!e.ok)throw console.error("Failed to fetch version info:",e.statusText),Error("Failed to fetch version info");let t=await e.json();return window.__lastVersionResponse=t,console.log("Version API response cached in window.__lastVersionResponse for debugging"),t}async function l(){let e=await fetch("".concat(o,"/info/get-keyword-search-terms"));if(!e.ok)throw console.error("Failed to fetch keyword phrases:",e.statusText),Error("Failed to fetch keyword phrases");let t=await e.json();return window.__lastKeywordPhrasesResponse=t,console.log("Keyword phrases API response cached in window.__lastKeywordPhrasesResponse for debugging"),t}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,o]=e;o.length>0&&o.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(o,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch aggregate data");return a.json()}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,o]=e;o.length>0&&o.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(o,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch numeric values");return a.json()}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,o]=e;o.length>0&&o.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(o,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch word cloud data");return a.json()}async function g(){let e=await fetch("".concat(o,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}let f={summarise_URL:"You are a helpful assistant that summarizes academic research datasets. You will receive a JSON object containing dataset schema information including metadata and other details. The dataset may include a variableCount field indicating the number of variables measured. Please provide a concise, informative summary that highlights the key aspects of the dataset, including its purpose, scope, the types of variables measured (based on the count and other metadata), and any other relevant information that would help researchers understand what this dataset contains.",summarise_text:"You are a helpful assistant that summarizes academic research datasets. You will receive a JSON object containing dataset schema information including metadata and other details. The dataset may include a variableCount field indicating the number of variables measured. Please provide a concise, informative summary that highlights the key aspects of the dataset, including its purpose, scope, the types of variables measured (based on the count and other metadata), and any other relevant information that would help researchers understand what this dataset contains."};async function p(e,t){let a=f[t],o=JSON.stringify(e,null,2),s=await fetch("https://harmonyplugincleanuptext.fastdatascience.com/api/cleanup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o,system:a})});if(!s.ok)throw Error("Cleanup API request failed: ".concat(s.statusText));let n=await s.json();return{result:n.result||n,type:t}}async function m(e){let t=new URL("https://harmonydatagpt.azureedge.net/api/cleanup");t.searchParams.set("text",e),t.searchParams.set("system","You are a helpful assistant that summarizes academic research studies and datasets based on your knowledge. You will receive the name/title of a study or dataset. Please provide a concise, informative summary based on what you know about this study, including its purpose, scope, methodology, key findings, and significance. IMPORTANT: Only provide a summary if you have specific knowledge about this exact study or dataset. If the name is too generic (like 'Next Steps', 'Study', 'Survey', etc.) or if you are not familiar with the specific study, return an empty response (no text at all). Do not provide general information or explanations about why you cannot help.");let a=await fetch(t.toString(),{method:"GET",headers:{Accept:"application/json"}});if(!a.ok)throw Error("Cleanup API request failed: ".concat(a.statusText));let o=await a.json();return{result:o.result||o,type:"summarise_text"}}}}]);