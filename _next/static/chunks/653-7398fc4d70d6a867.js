"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{2653:(e,t,s)=>{s.d(t,{A:()=>k});var l=s(95155),a=s(68998),i=s(47821),n=s(9561),r=s(35256),o=s(96854),d=s(5565),c=s(90675),u=s(52488),x=s(32645),h=s(12115),f=s(53452),p=s(16814),m=s(65776),g=s(51857),j=s(67247),b=s(57040),y=s(5274),v=s(8428),A=s(42649);let k=(0,h.memo)(e=>{var t,s;let{study:k,isDrawerView:C=!1,onTopicClick:w,onInstrumentClick:S,debugData:I,originalSearchResult:z}=e,[D,V]=(0,h.useState)(!1),[W,_]=(0,h.useState)(!1),[R,E]=(0,h.useState)(!1),[B,L]=(0,h.useState)(!1),[P,T]=(0,h.useState)(!1),[M,N]=(0,h.useState)(null),[F,O]=(0,h.useState)(!1),[q,G]=(0,h.useState)(null);(0,h.useEffect)(()=>{T(!1)},[k.image]),(0,h.useEffect)(()=>{L(!1)},[k.title]),(0,h.useEffect)(()=>{_(!1),N(null),G(null)},[k.title]);let X=async()=>{if(!M&&!F){O(!0),G(null);try{let s=await (0,A.S6)(k.title),l="";if(!(l=Array.isArray(s.result)?s.result.map(e=>e.question_text||e).join("\n\n"):s.result||"").trim()){var e,t;let a=(null==z?void 0:z.dataset_schema)||(null==I?void 0:null===(e=I.lookupData)||void 0===e?void 0:e.dataset_schema);if(!a)throw Error("No dataset schema available for AI summary");let i={...a,variableMeasured:void 0,variableCount:(null===(t=a.variableMeasured)||void 0===t?void 0:t.length)||0};s=await (0,A._u)(i,"summarise_text"),l=Array.isArray(s.result)?s.result.map(e=>e.question_text||e).join("\n\n"):s.result||""}N(l)}catch(e){G(e instanceof Error?e.message:"Failed to generate AI summary")}finally{O(!1)}}};(0,h.useEffect)(()=>{W&&X()},[W]);let[H,Y]=(0,h.useState)(!1),[$,J]=(0,h.useState)(!1),[K,Q]=(0,h.useState)({description:!0,details:!1,variables:!1,links:!1,childDatasets:!1}),U=e=>{Q(t=>({...t,[e]:!t[e]}))},Z=k.topics.filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),ee=Z.length>0,et=k.instruments&&k.instruments.length>0,es=k.matchedVariables&&k.matchedVariables.length>0||k.allVariables&&k.allVariables.length>0,el=k.additionalLinks&&k.additionalLinks.length>0;console.log("StudyDetail instruments debug:",{instruments:k.instruments,hasInstruments:et,instrumentsLength:null===(t=k.instruments)||void 0===t?void 0:t.length});let ea=(0,h.useMemo)(()=>{console.log("study var deduping :",k.matchedVariables,k);let e=k.matchedVariables||[],t=k.allVariables||[],s=new Map;return e.forEach(e=>{let t=e.uuid||e.name;t&&s.set(t,{...e,matched:!0})}),t.forEach(e=>{let t=e.uuid||e.name;!t||s.has(t)||s.set(t,e)}),Array.from(s.values())},[k.matchedVariables,k.allVariables]);return(0,l.jsxs)(a.default,{sx:{p:3,width:"100%",height:"100%",overflowY:"auto",flex:1,display:"flex",flexDirection:"column"},children:[C&&(0,l.jsx)(a.default,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,l.jsx)(i.A,{size:"small",onClick:()=>Y(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,l.jsx)(c.A,{size:18})})}),!C&&(0,l.jsxs)(a.default,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:2,mb:4},children:[(0,l.jsx)(a.default,{sx:{flex:1},children:(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"h4",gutterBottom:!0,sx:{flex:1,mr:1},children:k.title}),(0,l.jsx)(i.A,{size:"small",onClick:()=>Y(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary",mt:.5},children:(0,l.jsx)(c.A,{size:18})})]})}),k.image&&!P&&(0,l.jsx)(a.default,{sx:{width:100,height:100,position:"relative",borderRadius:"8px",overflow:"hidden",flexShrink:0},children:(0,l.jsx)(d.default,{src:k.image,alt:k.title,fill:!0,style:{objectFit:"contain"},onError:()=>T(!0),unoptimized:!0})})]}),k.description&&(0,l.jsxs)(a.default,{sx:{mb:4},children:[B?(0,l.jsx)(g.A,{text:k.description,paragraphProps:{variant:"body1",sx:{mb:2}},compact:!0}):(0,l.jsx)(n.default,{variant:"body1",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",mb:2},children:k.description}),k.description.length>300&&(0,l.jsxs)(a.default,{onClick:()=>L(!B),sx:{display:"flex",alignItems:"center",color:"primary.main",cursor:"pointer",mt:1},children:[(0,l.jsx)(n.default,{variant:"body2",color:"primary",sx:{fontWeight:500,mr:1},children:B?"Show Less":"Show More"}),B?(0,l.jsx)(u.A,{size:16}):(0,l.jsx)(x.A,{size:16})]})]}),es&&(0,l.jsxs)(a.default,{sx:{mb:4},children:[(0,l.jsx)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:D?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>V(!D),children:"Related Variables found within study"}),(0,l.jsx)(r.A,{in:D,children:(0,l.jsx)(a.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsx)(b.A,{variables:ea,studyName:k.title})})})]}),(0,l.jsxs)(a.default,{sx:{mb:4},children:[(0,l.jsx)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:K.details?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>U("details"),children:"Details"}),(0,l.jsx)(r.A,{in:K.details,children:(0,l.jsx)(a.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",gap:3},children:[k.publisher&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Publisher:"}),(0,l.jsx)(m.A,{name:k.publisher.name,url:k.publisher.url,logo:k.publisher.logo})]}),k.geographicCoverage&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Geographic Coverage:"}),(0,l.jsx)(n.default,{children:k.geographicCoverage})]}),k.temporalCoverage&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Temporal Coverage:"}),(0,l.jsx)(n.default,{children:(e=>{if(!e)return"Not specified";if(e.includes("..")){let[t,s]=e.split("..");return s?"".concat(t," - ").concat(s):"".concat(t," - Present (Ongoing)")}return e})(k.temporalCoverage)})]}),k.sampleSize&&"Not specified"!==k.sampleSize&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Sample Size:"}),(0,l.jsx)(n.default,{children:k.sampleSize})]}),k.ageCoverage&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Age Coverage:"}),(0,l.jsx)(n.default,{children:k.ageCoverage})]}),k.resourceType&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Resource Type:"}),(0,l.jsx)(n.default,{children:k.resourceType})]}),k.studyDesign&&k.studyDesign.length>0&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(n.default,{variant:"subtitle2",children:"Study Design:"}),(0,l.jsx)(n.default,{children:k.studyDesign.join(", ")})]})]})})})]}),k.funders&&k.funders.length>0&&(0,l.jsxs)(a.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(n.default,{variant:"subtitle2",gutterBottom:!0,children:"Funders:"}),(0,l.jsx)(a.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:k.funders.map((e,t)=>(0,l.jsx)(m.A,{name:e.name,url:e.url,logo:e.logo},"".concat(e.name,"-").concat(t)))})]}),k.dataCatalogs&&k.dataCatalogs.length>0&&(0,l.jsxs)(a.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(n.default,{variant:"subtitle2",gutterBottom:!0,children:"Available in Data Catalogs:"}),(0,l.jsx)(a.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:k.dataCatalogs.map((e,t)=>(0,l.jsx)(p.A,{name:e.name,url:e.url,logo:e.logo},"".concat(e.name,"-").concat(t)))})]}),ee&&(0,l.jsxs)(a.default,{sx:{mb:4},children:[(0,l.jsx)(n.default,{variant:"subtitle2",gutterBottom:!0,children:"Topics:"}),(0,l.jsx)(a.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Z.map((e,t)=>(0,l.jsx)(f.A,{onClick:t=>{t.stopPropagation(),w&&w(e)},sx:{cursor:"pointer"},children:e},"topic-".concat(t)))})]}),el&&(0,l.jsxs)(a.default,{sx:{mb:4,flexShrink:0},children:[(0,l.jsx)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:R?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>E(!R),children:"Related Links & Papers"}),(0,l.jsx)(r.A,{in:R,children:R&&(0,l.jsx)(a.default,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,alignItems:"flex-start"},children:null===(s=k.additionalLinks)||void 0===s?void 0:s.map((e,t)=>(0,l.jsx)(a.default,{sx:{flex:"1 1 350px",minWidth:300,maxWidth:500},children:(0,l.jsx)(j.A,{url:e})},"link-".concat(t)))})})]}),et&&(0,l.jsxs)(a.default,{sx:{mb:2},children:[(0,l.jsxs)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:$?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>J(e=>!e),children:["Instruments (",k.instruments.length,")"]}),(0,l.jsx)(r.A,{in:$,children:(0,l.jsx)(a.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:k.instruments.map((e,t)=>(0,l.jsx)(f.A,{onClick:t=>{t.stopPropagation(),S&&S(e)},children:e},"instrument-".concat(t)))})})]}),Array.isArray(k.child_datasets)&&k.child_datasets.length>0&&(0,l.jsxs)(a.default,{sx:{mb:4},children:[(0,l.jsxs)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:K.childDatasets?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>U("childDatasets"),children:["Related Datasets (",k.child_datasets.length,")"]}),(0,l.jsx)(r.A,{in:K.childDatasets,children:(0,l.jsx)(a.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,l.jsx)(v.A,{datasets:k.child_datasets})})})]}),"study"===k.resourceType&&(0,l.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsx)(f.A,{fullWidth:!0,chipVariant:"secondary",endIcon:W?(0,l.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,l.jsx)(x.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>_(!W),children:"AI Summary"}),(0,l.jsx)(r.A,{in:W,children:(0,l.jsxs)(a.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:[F&&(0,l.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,l.jsx)(o.A,{size:20}),(0,l.jsx)(n.default,{children:"Generating AI summary..."})]}),q&&(0,l.jsxs)(n.default,{color:"error",children:["Error: ",q]}),M&&!F&&(0,l.jsx)(a.default,{sx:{"& p":{marginBottom:2}},children:M.split("\n\n").map((e,t)=>(0,l.jsx)(n.default,{variant:"body1",sx:{whiteSpace:"pre-wrap",marginBottom:2,"&:last-child":{marginBottom:0},"& strong":{fontWeight:"bold"}},dangerouslySetInnerHTML:{__html:e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}},t))}),!M&&!F&&!q&&(0,l.jsx)(n.default,{children:"AI summary not available yet."})]})})]}),(0,l.jsx)(y.A,{open:H,onClose:()=>Y(!1),title:k.title,originalSearchResult:null==I?void 0:I.originalSearchResult,lookupData:null==I?void 0:I.lookupData,finalProcessedData:k})]})})}}]);