"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[690],{66690:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q});var l=a(95155),i=a(12115),n=a(35761),s=a(55295),o=a(68998),r=a(9552),d=a(9561),c=a(70152),u=a(22282),h=a(47821),m=a(19579),g=a(6327),v=a(72107),f=a(5565),x=a(10979),p=a(1234),y=a(64517),_=a(9450),b=a(64364),j=a(52604),w=a(90675),S=a(53452),C=a(86453),A=a(3485);function k(e){var t,a,n,s,r,c,u,m,g,v,x,k,D,I,R,z,F,L,E,P;let{result:W,isSelected:T,onClick:M,onFindSimilar:O}=e,U=!!(W.ancestors&&W.ancestors.length>0),B=null===(a=W.extra_data)||void 0===a?void 0:null===(t=a.resource_type)||void 0===t?void 0:t.includes("variable"),H=null===(s=W.extra_data)||void 0===s?void 0:null===(n=s.resource_type)||void 0===n?void 0:n.includes("dataset"),[N,V]=(0,i.useState)(!1),q=W,K=W;U&&(null===(r=W.ancestors)||void 0===r?void 0:r[0])&&(K=W.ancestors[0],q=W);let J=(null==K?void 0:null===(c=K.extra_data)||void 0===c?void 0:c.resource_type)||K.dataset_schema&&K.dataset_schema["@type"]||"Unknown Resource Type",Y=(null===(u=K.dataset_schema)||void 0===u?void 0:u.name)||(null===(m=K.extra_data)||void 0===m?void 0:m.name)||"Unnamed Resource",Q=U&&H?(null===(g=q.dataset_schema)||void 0===g?void 0:g.description)||(null===(v=q.extra_data)||void 0===v?void 0:v.description)||"":(null===(x=K.dataset_schema)||void 0===x?void 0:x.description)||(null===(k=K.extra_data)||void 0===k?void 0:k.description)||"",X=((null===(D=K.dataset_schema)||void 0===D?void 0:D.keywords)||K.topics||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),Z=(null===(I=q.dataset_schema)||void 0===I?void 0:I.number_of_variables)||0,$=(null===(R=q.variables_which_matched)||void 0===R?void 0:R.length)||0,G=(null===(z=q.dataset_schema)||void 0===z?void 0:z.includedInDataCatalog)&&q.dataset_schema.includedInDataCatalog.length>0,ee=Q.length>200?"".concat(Q.substring(0,200),"..."):Q,et=null,[ea,el]=(0,i.useState)(!1);return(null===(F=K.dataset_schema)||void 0===F?void 0:F.image)&&!ea?et=K.dataset_schema.image:K.thumbnail&&!ea&&(et=K.thumbnail),(0,l.jsxs)(o.default,{onClick:M,sx:{cursor:"pointer",display:"flex",width:"100%",bgcolor:T?"rgba(25, 118, 210, 0.08)":"transparent",borderLeft:T?"3px solid":"3px solid transparent",borderRight:T?"3px solid":"3px solid transparent",borderColor:T?"primary.main":"transparent","&:hover":{bgcolor:T?"rgba(25, 118, 210, 0.12)":"rgba(0, 0, 0, 0.02)"}},children:[(0,l.jsxs)(o.default,{sx:{width:120,minHeight:"100%",py:2,flexShrink:1,display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",color:"grey.500",background:"transparent",position:"relative"},children:[et&&!ea?(0,l.jsx)(f.default,{src:et,alt:Y,width:100,height:100,style:{objectFit:"contain"},onError:()=>el(!0),unoptimized:!0}):J.includes("dataset")?(0,l.jsx)(p.A,{size:48}):J.includes("variable")?(0,l.jsx)(y.A,{size:48}):J.includes("study")?(0,l.jsx)(_.A,{size:48}):(0,l.jsx)(b.A,{size:48}),U&&(0,l.jsxs)(l.Fragment,{children:[B&&(0,l.jsx)(o.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:"V"}),H&&(0,l.jsx)(o.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:(0,l.jsx)(p.A,{size:16})})]}),(0,l.jsx)(o.default,{sx:{mt:1,width:"100%",display:"flex",justifyContent:"center"},children:(0,l.jsxs)(S.A,{chipVariant:"secondary",size:"small",onClick:e=>{var t;e.stopPropagation(),(null===(t=q.extra_data)||void 0===t?void 0:t.uuid)&&window.open("".concat((0,A.xC)(),"discover?like=").concat(q.extra_data.uuid),"_blank")},sx:{cursor:"pointer",display:"flex",alignItems:"center",gap:.5},children:["Find Similar ",(0,l.jsx)(j.A,{size:14,style:{marginLeft:4}})]})})]}),(0,l.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",p:2,flex:1,background:"transparent"},children:[(0,l.jsxs)(o.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,l.jsx)(d.default,{variant:"h6",gutterBottom:!0,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2,flex:1,mr:1},children:Y}),(0,l.jsx)(h.A,{size:"small",onClick:e=>{e.stopPropagation(),V(!0)},sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,l.jsx)(w.A,{size:16})})]}),X.length>0&&(0,l.jsx)(d.default,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:X.slice(0,5).map((e,t)=>(0,l.jsxs)(o.default,{component:"span",children:[(0,l.jsx)(o.default,{component:"strong",sx:{fontSize:"0.85rem"},children:e}),t<Math.min(X.length,5)-1&&(0,l.jsx)(o.default,{component:"span",sx:{mx:.5},children:"â€¢"})]},"".concat(e,"-").concat(t)))}),(0,l.jsx)(d.default,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.4,mb:1.5},children:ee}),(0,l.jsx)(o.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:"auto"},children:U&&B?(0,l.jsx)(S.A,{chipVariant:"primary",size:"small",children:(null===(L=q.extra_data)||void 0===L?void 0:L.description)||(null===(E=q.extra_data)||void 0===E?void 0:E.name)},null===(P=q.extra_data)||void 0===P?void 0:P.uuid):(0,l.jsxs)(l.Fragment,{children:[Z>0&&(0,l.jsx)(S.A,{chipVariant:"primary",size:"small",children:$>0?"Matched by variable":"".concat(Z," Variables")}),G&&(0,l.jsx)(S.A,{chipVariant:"secondary",size:"small",children:"Data Available"}),q.hasFreeAccess&&(0,l.jsx)(S.A,{chipVariant:"secondary",size:"small",children:"Free Access"}),q.hasCohortsAvailable&&(0,l.jsx)(S.A,{chipVariant:"secondary",size:"small",children:"Cohorts Available"})]})})]}),(0,l.jsx)(C.A,{open:N,onClose:()=>V(!1),data:q,title:"Debug: ".concat(Y)})]})}function D(e){let{results:t,resourceTypeFilter:a,onSelectResult:i,selectedResultId:n,onFindSimilar:s,collapsed:r=!1}=e,c=a&&a.length>0?t.filter(e=>{var t,l;return(null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)&&a.map(e=>e.trim().toLowerCase()).includes(null===(l=e.extra_data)||void 0===l?void 0:l.resource_type.trim().toLowerCase())}):t;console.log("SearchResults debug:",{resourceTypeFilter:a,originalResults:t,filteredResults:c});let u=e=>{i&&i(e)};return c.length?(0,l.jsx)(o.default,{children:(0,l.jsx)(x.A,{spacing:1.5,sx:{mb:4},children:c.map((e,t)=>{var a,i;let o=n===(null===(a=e.extra_data)||void 0===a?void 0:a.uuid);return(0,l.jsx)(k,{result:e,isSelected:o,onClick:()=>u(e),onFindSimilar:s},(null===(i=e.extra_data)||void 0===i?void 0:i.uuid)||"result-".concat(t))})})}):(0,l.jsx)(o.default,{sx:{textAlign:"center",py:8},children:(0,l.jsx)(d.default,{color:"text.secondary",children:"No results found. Try adjusting your search criteria."})})}var I=a(14030),R=a(69011),z=a(42649),F=a(76046),L=a(22783),E=a(25012),P=a(15325),W=a(66917),T=a(79201),M=a(99489),O=a(15617),U=a(63219),B=a(89026);function H(e){let{useSearch2:t,onEndpointChange:a,hybridWeight:n,onHybridWeightChange:s,maxDistance:r,onMaxDistanceChange:c}=e,[h,m]=(0,i.useState)(null),g=(0,i.useRef)(null),[v,f]=(0,i.useState)(null),[x,p]=(0,i.useState)(!0),y=!!h;return(0,i.useEffect)(()=>{(async()=>{try{let e=await (0,z.Pn)();f(e)}catch(e){console.error("Failed to fetch version info:",e),f({harmony_discovery_version:"Unknown"})}finally{p(!1)}})()},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,l.jsx)(u.A,{ref:g,variant:"contained",color:"secondary",onClick:()=>{m(g.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:y?(0,l.jsx)(B.A,{}):(0,l.jsx)(U.A,{})}),(0,l.jsx)(d.default,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,l.jsx)(W.Ay,{open:y,anchorEl:h,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},children:(0,l.jsxs)(o.default,{sx:{p:3,minWidth:280},children:[(0,l.jsx)(d.default,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,l.jsx)(o.default,{sx:{mb:3},children:(0,l.jsx)(T.A,{control:(0,l.jsx)(M.A,{checked:t,onChange:e=>{a(e.target.checked)},color:"primary"}),label:(0,l.jsxs)(o.default,{children:[(0,l.jsx)(d.default,{variant:"body2",fontWeight:500,children:"Search Version"}),(0,l.jsx)(d.default,{variant:"caption",color:"text.secondary",children:t?"Previous Version":x?"Loading...":(null==v?void 0:v.harmony_discovery_version)||"Current Version"})]})})}),(0,l.jsxs)(o.default,{sx:{mb:2},children:[(0,l.jsxs)(d.default,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",n.toFixed(2)]}),(0,l.jsx)(d.default,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,l.jsx)(o.default,{sx:{px:2,mt:2},children:(0,l.jsx)(O.Ay,{value:n,onChange:(e,t)=>{s(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]}),(0,l.jsxs)(o.default,{sx:{mb:2},children:[(0,l.jsxs)(d.default,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Max Distance: ",r.toFixed(2)]}),(0,l.jsx)(d.default,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the maximum vector distance for semantic search results"}),(0,l.jsx)(o.default,{sx:{px:2,mt:2},children:(0,l.jsx)(O.Ay,{value:r,onChange:(e,t)=>{c(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"0"},{value:.4,label:"0.4"},{value:1,label:"1"}]})})]}),(0,l.jsx)(o.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,l.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:[(0,l.jsx)("strong",{children:"Tip:"})," Hybrid weight is automatically adjusted based on query length. Short queries favor keyword search (lower values), while longer queries favor semantic search (higher values)."]})})]})})]})}var N=a(71900);function V(){var e,t,a,x,j,w,S;let C=(0,n.A)(),k=(0,s.A)(C.breakpoints.down("lg")),[W,T]=(0,i.useState)(""),[M,O]=(0,i.useState)(""),[U,B]=(0,i.useState)([]),[V,q]=(0,i.useState)([]),[K,J]=(0,i.useState)({}),[Y,Q]=(0,i.useState)(null),[X,Z]=(0,i.useState)(!1),[$,G]=(0,i.useState)(!0),[ee,et]=(0,i.useState)(!1),[ea,el]=(0,i.useState)(0),[ei,en]=(0,i.useState)(1),[es,eo]=(0,i.useState)(!1),[er,ed]=(0,i.useState)(null),[ec,eu]=(0,i.useState)(!1),[eh,em]=(0,i.useState)(!1),[eg,ev]=(0,i.useState)(!1),[ef,ex]=(0,i.useState)(!1),[ep,ey]=(0,i.useState)(null),[e_,eb]=(0,i.useState)(!1),[ej,ew]=(0,i.useState)(.5),[eS,eC]=(0,i.useState)(.5),[eA,ek]=(0,i.useState)(.4),[eD,eI]=(0,i.useState)(.4),[eR,ez]=(0,i.useState)(null),[eF,eL]=(0,i.useState)(null),[eE,eP]=(0,i.useState)([]),[eW,eT]=(0,i.useState)(void 0),[eM,eO]=(0,i.useState)([]),[eU,eB]=(0,i.useState)(!1),eH=(0,F.useSearchParams)(),eN=eH.get("resource_type"),eV=eH.get("like"),eq=eH.get("query"),eK=eH.getAll("topics"),eJ=eH.getAll("instruments"),eY=eH.getAll("study_design"),eQ=(0,F.useRouter)();(0,i.useEffect)(()=>{let e=!1;if(eq&&(T(eq),O(eq),e=!0),eK&&eK.length>0&&(!K.keywords||K.keywords.join(",")!==eK.join(","))&&(J(e=>({...e,keywords:eK})),e=!0),eJ&&eJ.length>0&&(!K.instruments||K.instruments.join(",")!==eJ.join(","))&&(J(e=>({...e,instruments:eJ})),e=!0),eY&&eY.length>0&&(!K.study_design||K.study_design.join(",")!==eY.join(","))&&(J(e=>({...e,study_design:eY})),e=!0),e){let e=new URL(window.location.href);e.searchParams.delete("query"),e.searchParams.delete("topics"),e.searchParams.delete("instruments"),e.searchParams.delete("study_design");let t=e.pathname.replace("/search","");console.log("Navigating to:",t+e.search),eQ.replace(t+e.search)}},[eq,eK,eJ,eY]);let eX=(0,i.useMemo)(()=>eN?[eN]:[],[eN]),eZ=(0,i.useRef)(M),e$=(0,i.useRef)(JSON.stringify(K)),eG=(0,i.useRef)(e_),e0=(0,i.useRef)(eS),e1=(0,i.useRef)(eD),e2=(0,i.useRef)(eE);(0,i.useRef)(!1);let e5=(0,i.useRef)([]),e4=(0,i.useRef)(void 0),e6=(0,i.useCallback)(e=>{if(!e||""===e.trim()||"*"===e)return .5;let t=e.trim();return eM.some(e=>t.toLowerCase()===e.toLowerCase())?0:.5},[eM]),e3=(0,i.useCallback)(e=>{eb(e)},[]),e8=(0,i.useCallback)(e=>{ew(e)},[]),e9=(0,i.useCallback)(e=>{ek(e)},[]);(0,i.useEffect)(()=>{let e=e6(M);ew(e),eC(e)},[M,e6]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{O(W)},500);return()=>{clearTimeout(e)}},[W]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{eC(ej)},300);return()=>{clearTimeout(e)}},[ej]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{eI(eA)},300);return()=>{clearTimeout(e)}},[eA]),(0,i.useEffect)(()=>{(async()=>{if(!eU)try{let e=await (0,z.Qf)();eO(e),eB(!0)}catch(e){console.error("Failed to fetch keyword phrases:",e),eB(!0)}})()},[eU]);let e7=(0,i.useCallback)(()=>{var e,t;window.__debugState={currentPage:ei,totalHits:ea,resultsPerPage:50,searchQuery:W,debouncedSearchQuery:M,selectedFilters:K,filters:V,results:U,selectedResult:er,apiOffline:ef,topLevelIdsSeen:eE},console.log("Current state stored in window.__debugState"),console.log("Current state:",{pagination:{currentPage:ei,totalHits:ea},searchQuery:W,debouncedSearchQuery:M,selectedFilters:K,filterCount:V.length,resultCount:U.length,selectedResult:er?{id:null===(e=er.extra_data)||void 0===e?void 0:e.uuid,title:null===(t=er.dataset_schema)||void 0===t?void 0:t.name}:null,apiOffline:ef})},[ei,ea,50,W,M,K,V,U,er,ef,eE]),te=(0,i.useCallback)(e=>{ed(e),k&&eu(!0)},[k]),tt=(0,i.useCallback)(e=>{console.log("Selected result:",e),te(e)},[te]),ta=(0,i.useCallback)(()=>{eu(!1)},[]),tl=(0,i.useCallback)(()=>{!k&&er&&ev(!0)},[k,er]),ti=(0,i.useCallback)(()=>{k||ev(e=>!e)},[k]);(0,i.useCallback)(()=>{eo(e=>!e),e7()},[e7]),(0,i.useEffect)(()=>{{let e=e=>e.target!==window||(console.log("Preserving console log"),e.stopPropagation(),!1);return window.addEventListener("beforeunload",e,!0),()=>{window.removeEventListener("beforeunload",e,!0)}}},[]),(0,i.useEffect)(()=>{(async function(){try{console.log("Fetching initial aggregations..."),Z(!0),ex(!1);let e=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),t=await Promise.race([(0,z.Dd)(),e]),a=tv(t);q(a),console.log("Initial aggregations set:",a.length,"filters"),Z(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),ex(!0),Z(!1)}})()},[]),(0,i.useEffect)(()=>{U.length>0&&!er?ed(U[0]):U.length>0&&er?U.some(e=>{var t,a;return(null===(t=e.extra_data)||void 0===t?void 0:t.uuid)===(null===(a=er.extra_data)||void 0===a?void 0:a.uuid)})||ed(U[0]):0===U.length&&ed(null)},[U,er]),(0,i.useEffect)(()=>{em(!1)},[er]);let tn=(0,i.useCallback)(async e=>{var t,a,l,i,n,s,o,r,d,c,u,h,m,g,v,f,x,p,y,_,b,j,w,S,C,A,k,D,I,R,z,F,L,E,P,W,T,M,O,U,B;let H,N,V;let q=null===(a=e.extra_data)||void 0===a?void 0:null===(t=a.resource_type)||void 0===t?void 0:t.includes("variable"),K=Array.isArray(e.ancestors)&&e.ancestors.length>0,J=q&&K&&(null===(l=e.ancestors)||void 0===l?void 0:l[0])||e,Y=(null===(i=J.dataset_schema)||void 0===i?void 0:i.name)||"Untitled Dataset",Q=(null===(n=J.dataset_schema)||void 0===n?void 0:n.description)||"",X=(null===(s=J.dataset_schema)||void 0===s?void 0:s.image)||J.image||void 0;(null===(d=J.dataset_schema)||void 0===d?void 0:null===(r=d.publisher)||void 0===r?void 0:null===(o=r[0])||void 0===o?void 0:o.name)&&(N={name:J.dataset_schema.publisher[0].name,url:null===(P=J.dataset_schema.publisher[0])||void 0===P?void 0:P.url,logo:null===(W=J.dataset_schema.publisher[0])||void 0===W?void 0:W.logo});let Z=null===(u=J.dataset_schema)||void 0===u?void 0:null===(c=u.includedInDataCatalog)||void 0===c?void 0:c.some(e=>{var t,a;return(null===(t=e.name)||void 0===t?void 0:t.includes("Mental Health"))||(null===(a=e.name)||void 0===a?void 0:a.includes("CMHM"))}),$=null===(h=J.topics)||void 0===h?void 0:h.some(e=>e.toLowerCase().includes("mental health")||e.toLowerCase().includes("psychiatry")||e.toLowerCase().includes("psychology")),G=e=>{if(!e.includes(" ")||/[,.;]/.test(e))return!1;let t=e.split(" ").map(e=>e.trim()).filter(e=>e.length>0);return t.filter(e=>e.length<=8||e.toUpperCase()===e||/[A-Z]{2,}/.test(e)).length/t.length>.6};if((null===(m=J.dataset_schema)||void 0===m?void 0:m.funder)&&Array.isArray(J.dataset_schema.funder)&&J.dataset_schema.funder.length>0)V=J.dataset_schema.funder.map(e=>({name:e.name||"Funding Organization",url:null==e?void 0:e.url,logo:null==e?void 0:e.logo}));else if(J.funders||(null===(g=J.extra_data)||void 0===g?void 0:g.funders)){let e=J.funders||(null===(T=J.extra_data)||void 0===T?void 0:T.funders);Array.isArray(e)?V=e.map(e=>"string"==typeof e?{name:e}:"object"==typeof e&&null!==e?{name:e.name||"Funding Organization",url:e.url,logo:e.logo}:{name:String(e)}):"string"==typeof e&&e.trim()&&(V=(Z||$||G(e))&&e.includes(" ")?e.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})):e.includes(" ")&&!/[,.;]/.test(e)?e.split(" ").filter(e=>e.trim().length>0).map(e=>({name:e})):[{name:e}])}if(!V||0===V.length||Z||$){let e=[J.cmhm_funders,null===(M=J.extra_data)||void 0===M?void 0:M.cmhm_funders,J.funding_bodies,null===(O=J.extra_data)||void 0===O?void 0:O.funding_bodies,J.funding,null===(U=J.extra_data)||void 0===U?void 0:U.funding,J.funder,null===(B=J.extra_data)||void 0===B?void 0:B.funder].find(e=>null!=e);if(e){let t=[];if("string"==typeof e&&e.trim()?t=G(e)?e.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})):[{name:e}]:Array.isArray(e)&&(t=e.map(e=>"string"==typeof e?{name:e}:{name:e.name||String(e),url:e.url,logo:e.logo})),V&&V.length>0){let e=new Set(V.map(e=>e.name));V=[...V,...t.filter(t=>!e.has(t.name))]}else V=t}}(!V||1===V.length)&&(null==V?void 0:null===(v=V[0])||void 0===v?void 0:v.name)&&G(V[0].name)&&(V=V[0].name.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})));let ee=J.geographic_coverage||(null===(x=J.extra_data)||void 0===x?void 0:null===(f=x.country_codes)||void 0===f?void 0:f.join(", "))||(null===(p=J.country_codes)||void 0===p?void 0:p.join(", "))||void 0,et=(null===(y=J.dataset_schema)||void 0===y?void 0:y.temporalCoverage)||J.start_year&&"".concat(J.start_year).concat(J.end_year?"..".concat(J.end_year):""),ea=(null===(_=J.sample_size)||void 0===_?void 0:_.toString())||(null===(j=J.dataset_schema)||void 0===j?void 0:null===(b=j.size)||void 0===b?void 0:b.toString())||void 0,el=(null===(w=J.extra_data)||void 0===w?void 0:w.age_lower)||J.age_lower,ei=(null===(S=J.extra_data)||void 0===S?void 0:S.age_upper)||J.age_upper,en=void 0!==el&&void 0!==ei?"".concat(el," - ").concat(ei," years"):void 0!==el?"".concat(el,"+ years"):void 0!==ei?"0 - ".concat(ei," years"):void 0,es=(null===(C=J.extra_data)||void 0===C?void 0:C.study_design)||J.study_design||[],eo=(null===(A=J.extra_data)||void 0===A?void 0:A.resource_type)||(null===(k=J.dataset_schema)||void 0===k?void 0:k["@type"])||void 0,er=((null===(D=J.dataset_schema)||void 0===D?void 0:D.keywords)||J.topics||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),ed=(null===(I=J.extra_data)||void 0===I?void 0:I.instruments)||[],ec=J.variables_which_matched||[],eu=(null===(R=J.dataset_schema)||void 0===R?void 0:R.variableMeasured)||[],eh=new Set;if((null===(z=J.dataset_schema)||void 0===z?void 0:z.includedInDataCatalog)&&J.dataset_schema.includedInDataCatalog.length>0){let e=J.dataset_schema.url||[];H=J.dataset_schema.includedInDataCatalog.map(t=>{let a=t.url;if(Array.isArray(e)&&a)try{let t=new URL(a).hostname,l=e.find(e=>{try{return new URL(e).hostname===t}catch(e){return!1}});l&&(a=l)}catch(e){console.warn("Failed to parse catalog URL",e)}return a&&eh.add(a),{name:t.name||"Data Catalog",url:a||void 0,logo:t.image}})}let em=[];if((null===(F=J.dataset_schema)||void 0===F?void 0:F.identifier)&&Array.isArray(J.dataset_schema.identifier)){let e=J.dataset_schema.identifier.filter(e=>!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("10.")&&e.includes("/"))).map(e=>e.startsWith("10.")&&e.includes("/")?"https://doi.org/".concat(e):e);em=[...em,...e.filter(e=>!eh.has(e))]}if((null===(L=J.dataset_schema)||void 0===L?void 0:L.url)&&Array.isArray(J.dataset_schema.url)){let e=J.dataset_schema.url.filter(e=>!eh.has(e));em=[...em,...e]}return[J.url,J.original_source_url,(null===(E=J.doi)||void 0===E?void 0:E.startsWith("10."))?"https://doi.org/".concat(J.doi):null].filter(Boolean).forEach(e=>{!e||eh.has(e)||em.includes(e)||em.push(e)}),{title:Y,description:Q,image:X,publisher:N,funders:V,geographicCoverage:ee,temporalCoverage:et,sampleSize:ea,ageCoverage:en,studyDesign:es,resourceType:eo,topics:er,instruments:ed,dataCatalogs:H,matchedVariables:ec,allVariables:eu,additionalLinks:em=Array.from(new Set(em)),child_datasets:J.child_datasets||[]}},[]),[ts,to]=(0,i.useState)(null),[tr,td]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=!1;return async function(){var t;if(!er){to(null),td(null);return}let a=e6(W),l=await (0,z.w3)((null===(t=er.extra_data)||void 0===t?void 0:t.uuid)||"",W,a,eD);er.variables_which_matched&&(l.variables_which_matched=er.variables_which_matched),er.datasets_which_matched&&(l.child_datasets=er.datasets_which_matched);let i=await tn(l);e||(to(i),td({originalSearchResult:er,lookupData:l}))}(),()=>{e=!0}},[er,tn,W]),(0,i.useEffect)(()=>{(async function(){if(eV)try{var e,t;Z(!0);let a=await (0,z.w3)(eV,void 0,void 0,eD);ey(a);let l=(null===(e=a.dataset_schema)||void 0===e?void 0:e.description)||(null===(t=a.extra_data)||void 0===t?void 0:t.description);if(!l)throw Error("No description available for similar search");T(l),O(l);let i=e6(l),n=await (0,z.Hu)(l,{},1,50,e_,i,void 0,void 0,void 0,eD);B(n.results||[]),el(n.num_hits||0)}catch(e){console.error("Failed to load similar studies:",e),ex(!0)}finally{Z(!1)}})()},[eV,50,e_,eS]),(0,i.useEffect)(()=>{var e,t;let a=M!==eZ.current||JSON.stringify(K)!==e$.current||e_!==eG.current||eS!==e0.current||eD!==e1.current,l=eV&&((null==ep?void 0:null===(e=ep.dataset_schema)||void 0===e?void 0:e.description)||(null==ep?void 0:null===(t=ep.extra_data)||void 0===t?void 0:t.description))||M;a&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),B([]),eP([]),e5.current=[],eT(void 0),e4.current=void 0,1!==ei&&en(1),tu(l,1).finally(()=>{eZ.current=M,e$.current=JSON.stringify(K),eG.current=e_,e0.current=eS,e1.current=eD,e2.current=eE}))},[M,K,eV,ep,e_,eS,eD]),(0,i.useEffect)(()=>{if(ei>1){var e,t;console.log("\uD83D\uDCC4 Page changed to:",ei,"- loading more results"),tu(eV&&((null==ep?void 0:null===(e=ep.dataset_schema)||void 0===e?void 0:e.description)||(null==ep?void 0:null===(t=ep.extra_data)||void 0===t?void 0:t.description))||M,ei)}},[ei]);let tc=(0,i.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:ee,hasMoreResults:$,currentPage:ei,resultsLength:U.length}),ee||!$){console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:ee,hasMoreResults:$});return}let e=ei+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),en(e)},[ee,$,ei]);async function tu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,a=void 0!==t?t:ei;1===a?Z(!0):et(!0),ex(!1);let l=Date.now();1===a&&(G(!0),et(!1));try{var i,n;let t;let s={...K};eN&&(s.resource_type=[eN]),Object.keys(s).forEach(e=>{Array.isArray(s[e])&&0===s[e].length&&delete s[e]});let o="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(o)),console.log("Search query:",e||"(empty)"),console.log("Filters:",s),console.log("Page:",a),console.log("Results per page:",50),console.log("Use Search2:",e_),console.log("Similar UID (will be excluded):",eV||"None"),console.log("Top Level IDs Seen:",a>1?eE:"First page");let r=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),d=Date.now();a>1?t=e5.current:eV&&(t=[eV],console.log("Excluding original study from similar search:",eV)),console.log("Detailed pagination info:",{pageToUse:a,topLevelIdsSeenLength:eE.length,topLevelIdsSeenSample:eE.slice(0,5),currentTopLevelIdsRefLength:e5.current.length,currentTopLevelIdsRefSample:e5.current.slice(0,5),nextPageOffset:e4.current,idsToExclude:t||[],willPassIds:a>1&&!e_,willPassOffset:a>1&&void 0!==e4.current,willUsePost:a>1&&!e_&&((null==t?void 0:t.length)||0)>0,useSearch2:e_});let c=e6(e),u=await Promise.race([(0,z.Hu)(e,s,a,50,e_,c,t,a>1?e4.current:void 0,void 0,eD),r]),h=Date.now()-d;eL(h),console.log("Response received:",{requestId:o,numHits:u.num_hits,resultCount:(null===(i=u.results)||void 0===i?void 0:i.length)||0,apiTime:"".concat(h,"ms"),results:null===(n=u.results)||void 0===n?void 0:n.map(e=>{var t,a,l,i;return{id:null===(t=e.extra_data)||void 0===t?void 0:t.uuid,title:null===(a=e.dataset_schema)||void 0===a?void 0:a.name,type:(null===(l=e.extra_data)||void 0===l?void 0:l.resource_type)||(null===(i=e.dataset_schema)||void 0===i?void 0:i["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd();let m=u.results||[];if(u.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:u.top_level_ids_seen_so_far.length,sample:u.top_level_ids_seen_so_far.slice(0,5),previousCount:eE.length}),eP(u.top_level_ids_seen_so_far),e5.current=u.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response"),void 0!==u.next_page_offset?(console.log("Received next_page_offset:",{offset:u.next_page_offset,previousOffset:e4.current}),eT(u.next_page_offset),e4.current=u.next_page_offset):console.log("No next_page_offset in response (using calculated offset)"),1===a){if(B(m),el(u.num_hits||0),e_)G(50===m.length&&m.length<(u.num_hits||0));else{let e=m.length>0;G(e),(!e||m.length<50)&&el(Math.max(u.num_hits||0,m.length)),m.length>0&&m.length<50&&m.length<20&&(console.log("\uD83D\uDD04 Auto-loading next page from first page - insufficient results:",{gotResults:m.length,requestedResults:50,minThreshold:20,nextPage:2}),setTimeout(()=>{!ee&&$&&en(2)},100))}}else if(B(e=>{if(!e_&&m.length>0){let t;t=1===a?m.length:e.length+m.length,m.length<50&&t<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:m.length,requestedResults:50,currentTotal:t,minThreshold:20,nextPage:a+1}),setTimeout(()=>{!ee&&$&&en(a+1)},100))}return[...e,...m]}),e_)G(50===m.length);else{let e=m.length>0;G(e),e||el(Math.max(ea,U.length+m.filter(e=>!U.some(t=>{var a,l;return(null===(a=t.extra_data)||void 0===a?void 0:a.uuid)===(null===(l=e.extra_data)||void 0===l?void 0:l.uuid)})).length))}let g=Date.now();ez(g-l)}catch(e){console.error("Search failed:",e),ex(!0),ez(null),eL(null)}finally{Z(!1),et(!1)}}let th=(e,t)=>{J(a=>({...a,[e]:t}))},tm=e=>{let t=(null==K?void 0:K.keywords)||[];if(!t.includes(e)){let a=[...t,e];J(e=>({...e,keywords:a})),th("keywords",a)}},tg=e=>{let t=(null==K?void 0:K.instruments)||[];if(!t.includes(e)){let a=[...t,e];J(e=>({...e,instruments:a})),th("instruments",a)}},tv=e=>{let t=[],a=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_variables","num_sweeps"],l=1/0,i=-1/0;if(Object.entries(e).forEach(e=>{let[n,s]=e;if("age_lower"===n||"age_upper"===n||"age_min"===n||"age_max"===n){let e=s.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let a=e.maximum;"number"==typeof a&&isFinite(a)||(a=e.max),"number"==typeof t&&isFinite(t)&&(l=Math.min(l,t)),"number"==typeof a&&isFinite(a)&&(i=Math.max(i,a));return}if(a.includes(n)){let e,a;let l=s.statistics||{};"number"==typeof l.minimum&&isFinite(l.minimum)?e=l.minimum:"number"==typeof l.min&&isFinite(l.min)?e=l.min:(console.warn("Missing valid min value for ".concat(n,", using default")),e="sample_size"===n?0:"start_year"===n||"end_year"===n?1900:0),"number"==typeof l.maximum&&isFinite(l.maximum)?a=l.maximum:"number"==typeof l.max&&isFinite(l.max)?a=l.max:(console.warn("Missing valid max value for ".concat(n,", using default")),a="sample_size"===n?1e5:"start_year"===n||"end_year"===n?2024:"duration_years"===n?100:"num_variables"===n?1e4:"num_sweeps"===n?50:100),a<=e&&(a=e+1);let i=Array.from({length:101},(t,l)=>String(e+l/100*(a-e)));t.push({id:n,label:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:i})}else{let e=s.buckets||[];e.length>0&&t.push({id:n,label:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(l)&&isFinite(i)&&l<=i){i<=l&&(i=l+1);let e=Array.from({length:101},(e,t)=>String(l+t/100*(i-l)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},tf=(0,i.useCallback)(async e=>{var t,a,l,i,n,s,o;let r=null===(t=e.extra_data)||void 0===t?void 0:t.uuid;if(!r)return;let d=(null===(a=e.dataset_schema)||void 0===a?void 0:a.name)||(null===(l=e.extra_data)||void 0===l?void 0:l.name)||"Unnamed Study";T("LIKE:".concat(d," (").concat(r,")"));let c=(null===(i=e.dataset_schema)||void 0===i?void 0:i.description)||(null===(n=e.extra_data)||void 0===n?void 0:n.description);if(!c)try{let e=await (0,z.w3)(r,void 0,void 0,eD);c=(null===(s=e.dataset_schema)||void 0===s?void 0:s.description)||(null===(o=e.extra_data)||void 0===o?void 0:o.description)}catch(e){console.error("Failed to fetch description for LIKE search",e);return}c&&(O(c),tx(c))},[]),tx=async e=>{Z(!0),ex(!1);try{let t;let a={...K};eN&&(a.resource_type=[eN]),Object.keys(a).forEach(e=>{Array.isArray(a[e])&&0===a[e].length&&delete a[e]});let l=e,i=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);i&&(t=i[2],l="LIKE:".concat(t));let n=e6(l),s=await (0,z.Hu)(l,a,ei,50,e_,n,t?[t]:ei>1?e5.current:void 0,ei>1?e4.current:void 0,void 0,eD);B(s.results||[]),el(s.num_hits||0)}catch(e){ex(!0)}finally{Z(!1)}};return(0,l.jsx)(o.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,l.jsxs)(r.default,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,l.jsx)(o.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:eV?(0,l.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,l.jsx)(o.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==ep?void 0:null===(e=ep.dataset_schema)||void 0===e?void 0:e.image)?(0,l.jsx)(f.default,{src:(null==ep?void 0:ep.dataset_schema).image,alt:(null==ep?void 0:null===(t=ep.dataset_schema)||void 0===t?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,a;let i=(null==e?void 0:null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)||(null==e?void 0:null===(a=e.dataset_schema)||void 0===a?void 0:a["@type"]);return(null==i?void 0:i.includes("dataset"))?(0,l.jsx)(p.A,{size:48}):(null==i?void 0:i.includes("variable"))?(0,l.jsx)(y.A,{size:48}):(null==i?void 0:i.includes("study"))?(0,l.jsx)(_.A,{size:48}):(0,l.jsx)(b.A,{size:48})})(ep)}),(0,l.jsxs)(o.default,{children:[(0,l.jsx)(d.default,{variant:"h4",gutterBottom:!0,children:(null==ep?void 0:null===(a=ep.dataset_schema)||void 0===a?void 0:a.name)||(null==ep?void 0:null===(x=ep.extra_data)||void 0===x?void 0:x.name)||"Unnamed Study"}),(0,l.jsx)(d.default,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.A,{fullWidth:!0,placeholder:"What are you searching for?",value:W,onChange:e=>{T(e.target.value)},InputProps:{endAdornment:(0,l.jsxs)(o.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[W!==M&&(0,l.jsx)(d.default,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Typing..."}),(0,l.jsx)(f.default,{src:(0,A.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,l.jsx)(o.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,l.jsx)(H,{useSearch2:e_,onEndpointChange:e3,hybridWeight:ej,onHybridWeightChange:e8,maxDistance:eA,onMaxDistanceChange:e9})})]})}),(0,l.jsx)(I.A,{filtersData:V,onSelectionChange:th,selectedFilters:K}),!X&&!ef&&(U.length>0||ea>0)&&(0,l.jsx)(o.default,{sx:{mb:2,display:"flex",justifyContent:"flex-start"},children:(0,l.jsxs)(d.default,{variant:"body2",color:"text.secondary",children:[$?U.length>ea?"".concat(U.length," results loaded (").concat(ea,"+ estimated)"):ea>0?"".concat(U.length," of ~").concat(ea," results loaded"):"".concat(U.length," results loaded"):"".concat(U.length," results found"),eF&&" (API: ".concat(eF,"ms"),eR&&eF&&", Total: ".concat(eR,"ms)")]})}),(0,l.jsxs)(o.default,{sx:{display:k?"block":"flex",width:"100%",flex:1,minHeight:0,overflow:"visible",position:"relative"},children:[(0,l.jsx)(o.default,{sx:{width:k?"100%":"50%",minWidth:k?"100%":"300px",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:X?(0,l.jsx)(d.default,{children:"Loading search results..."}):ef?(0,l.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,l.jsx)(v.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,l.jsx)(d.default,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,l.jsx)(d.default,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,l.jsx)(u.A,{variant:"contained",sx:{mt:4},onClick:()=>{ex(!1),tu()},children:"Retry Connection"})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(o.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,l.jsx)(N.A,{dataLength:U.length,next:tc,hasMore:$,loader:!M&&(!K||Object.values(K).every(e=>0===e.length))?(0,l.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",py:6,textAlign:"center"},children:[(0,l.jsx)(d.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Enter a search term or select some filters to begin"}),(0,l.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"Use the search bar above or apply filters to discover studies"})]}):(0,l.jsx)(o.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,l.jsx)(L.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,l.jsx)(d.default,{children:"No more results to load."}),children:(0,l.jsx)(D,{results:U,resourceTypeFilter:eX,onSelectResult:tt,selectedResultId:null==er?void 0:null===(j=er.extra_data)||void 0===j?void 0:j.uuid,onFindSimilar:tf})})})})}),!k&&(U.length>0||ea>0)&&(0,l.jsxs)(o.default,{sx:{position:"absolute",top:0,right:0,width:eg?"calc(100% - 130px)":"50%",height:"100%",bgcolor:"background.paper",borderLeft:"1px solid",borderColor:"grey.200",display:"flex",flexDirection:"column",overflow:"visible",transition:"width 0.3s ease-in-out",cursor:er?"pointer":"default",zIndex:eg?2:1,boxShadow:eg?"-4px 0 8px rgba(0, 0, 0, 0.1)":"none"},onClick:tl,children:[(0,l.jsx)(o.default,{sx:{position:"absolute",top:-16,left:-16,zIndex:1e3},children:(0,l.jsx)(h.A,{onClick:e=>{e.stopPropagation(),ti()},sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2,width:30,height:30},children:eg?(0,l.jsx)(P.A,{size:20}):(0,l.jsx)(E.A,{size:20})})}),ef?(0,l.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,l.jsx)(v.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,l.jsx)(d.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,l.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):ts?(0,l.jsx)(o.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,l.jsx)(R.A,{study:ts,isDrawerView:!1,onTopicClick:tm,onInstrumentClick:tg,debugData:tr,originalSearchResult:null==tr?void 0:tr.lookupData})}):(0,l.jsx)(o.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,l.jsx)(d.default,{color:"text.secondary",children:"Select a dataset to view details"})})]})]}),(0,l.jsxs)(m.Ay,{anchor:"right",open:k&&ec,onClose:ta,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,l.jsxs)(o.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,l.jsx)(h.A,{onClick:ta,sx:{position:"absolute",top:8,right:8},children:(0,l.jsx)(g.A,{})}),(0,l.jsxs)(o.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,l.jsx)(d.default,{variant:"h6",sx:{flex:1},children:er&&(null===(w=er.dataset_schema)||void 0===w?void 0:w.name)||"Study Details"}),er&&(er.dataset_schema&&er.dataset_schema.image||er.image)&&!eh&&(0,l.jsx)(o.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,l.jsx)(f.default,{src:er.dataset_schema&&er.dataset_schema.image||er.image,alt:(null===(S=er.dataset_schema)||void 0===S?void 0:S.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>em(!0),unoptimized:!0})})]})]}),(0,l.jsx)(o.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:ts?(0,l.jsx)(R.A,{study:ts,isDrawerView:!0,onTopicClick:tm,onInstrumentClick:tg,debugData:tr,originalSearchResult:null==tr?void 0:tr.lookupData}):(0,l.jsx)(o.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,l.jsx)(d.default,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]})})}function q(){return(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)(o.default,{sx:{p:4},children:(0,l.jsx)(d.default,{children:"Loading..."})}),children:(0,l.jsx)(V,{})})}}}]);