"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7199],{57199:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var s=l(95155),n=l(12115),i=l(35761),a=l(55295),r=l(68998),o=l(9552),d=l(9561),c=l(70152),u=l(22282),h=l(47821),g=l(19579),x=l(6327),m=l(72107),f=l(5565),v=l(10979),p=l(44315);function y(e){let{results:t,resourceTypeFilter:l,onSelectResult:n,selectedResultId:i,onFindSimilar:a,collapsed:o=!1}=e,c=l&&l.length>0?t.filter(e=>{var t,s;return(null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)&&l.map(e=>e.trim().toLowerCase()).includes(null===(s=e.extra_data)||void 0===s?void 0:s.resource_type.trim().toLowerCase())}):t;console.log("SearchResults debug:",{resourceTypeFilter:l,originalResults:t,filteredResults:c});let u=e=>{n&&n(e)};return c.length?(0,s.jsx)(r.default,{children:(0,s.jsx)(v.A,{spacing:1.5,sx:{mb:4},children:c.map((e,t)=>{var l,n;let r=i===(null===(l=e.extra_data)||void 0===l?void 0:l.uuid);return(0,s.jsx)(p.A,{result:e,isSelected:r,onClick:()=>u(e),onFindSimilar:a},(null===(n=e.extra_data)||void 0===n?void 0:n.uuid)||"result-".concat(t))})})}):(0,s.jsx)(r.default,{sx:{textAlign:"center",py:8},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"No results found. Try adjusting your search criteria."})})}var _=l(14030),b=l(69011),j=l(42649),w=l(10683),S=l(63612),A=l(54615),C=l(73179),k=l(20687),I=l(76046),E=l(1234),D=l(64517),R=l(9450),F=l(64364),P=l(22783),T=l(25012),L=l(15325),z=l(66917),O=l(79201),q=l(99489),M=l(15617),W=l(63219),N=l(89026);function B(e){let{useSearch2:t,onEndpointChange:l,hybridWeight:i,onHybridWeightChange:a,maxDistance:o,onMaxDistanceChange:c}=e,[h,g]=(0,n.useState)(null),x=(0,n.useRef)(null),[m,f]=(0,n.useState)(null),[v,p]=(0,n.useState)(!0),y=!!h;return(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,j.Pn)();f(e)}catch(e){console.error("Failed to fetch version info:",e),f({harmony_discovery_version:"Unknown"})}finally{p(!1)}})()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(u.A,{ref:x,variant:"contained",color:"secondary",onClick:()=>{g(x.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:y?(0,s.jsx)(N.A,{}):(0,s.jsx)(W.A,{})}),(0,s.jsx)(d.A,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,s.jsx)(z.Ay,{open:y,anchorEl:h,onClose:()=>{g(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},children:(0,s.jsxs)(r.default,{sx:{p:3,minWidth:280},children:[(0,s.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,s.jsx)(r.default,{sx:{mb:3},children:(0,s.jsx)(O.A,{control:(0,s.jsx)(q.A,{checked:t,onChange:e=>{l(e.target.checked)},color:"primary"}),label:(0,s.jsxs)(r.default,{children:[(0,s.jsx)(d.A,{variant:"body2",fontWeight:500,children:"Search Version"}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",children:t?"Previous Version":v?"Loading...":(null==m?void 0:m.harmony_discovery_version)||"Current Version"})]})})}),(0,s.jsxs)(r.default,{sx:{mb:2},children:[(0,s.jsxs)(d.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",i.toFixed(2)]}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,s.jsx)(r.default,{sx:{px:2,mt:2},children:(0,s.jsx)(M.Ay,{value:i,onChange:(e,t)=>{a(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]}),(0,s.jsxs)(r.default,{sx:{mb:2},children:[(0,s.jsxs)(d.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Max Distance: ",o.toFixed(2)]}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the maximum vector distance for semantic search results"}),(0,s.jsx)(r.default,{sx:{px:2,mt:2},children:(0,s.jsx)(M.Ay,{value:o,onChange:(e,t)=>{c(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"0"},{value:.4,label:"0.4"},{value:1,label:"1"}]})})]}),(0,s.jsx)(r.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,s.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[(0,s.jsx)("strong",{children:"Tip:"})," Hybrid weight is automatically adjusted based on query length. Short queries favor keyword search (lower values), while longer queries favor semantic search (higher values)."]})})]})})]})}var U=l(3485),H=l(71900);function V(){var e,t,l,v,p,z,O;let q=(0,i.A)(),M=(0,a.A)(q.breakpoints.down("sm")),W=(0,a.A)(q.breakpoints.down("lg")),{searchSettings:N,updateSearchSettings:V}=(0,S.S)(),[J,K]=(0,n.useState)(N.query),[Y,Q]=(0,n.useState)(N.query),[X,$]=(0,n.useState)([]),[G,Z]=(0,n.useState)([]),[ee,et]=(0,n.useState)(N.selectedFilters),[el,es]=(0,n.useState)(N.selectedCategory),[en,ei]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!0),[eo,ed]=(0,n.useState)(!1),[ec,eu]=(0,n.useState)(0),[eh,eg]=(0,n.useState)(1),[ex,em]=(0,n.useState)(!1),[ef,ev]=(0,n.useState)(null),[ep,ey]=(0,n.useState)(!1),[e_,eb]=(0,n.useState)(!1),[ej,ew]=(0,n.useState)(!1),[eS,eA]=(0,n.useState)(!1),[eC,ek]=(0,n.useState)(null),[eI,eE]=(0,n.useState)(N.useSearch2),[eD,eR]=(0,n.useState)(N.hybridWeight),[eF,eP]=(0,n.useState)(N.hybridWeight),[eT,eL]=(0,n.useState)(N.maxDistance),[ez,eO]=(0,n.useState)(N.maxDistance),[eq,eM]=(0,n.useState)(null),[eW,eN]=(0,n.useState)(null),[eB,eU]=(0,n.useState)([]),[eH,eV]=(0,n.useState)(void 0),[eJ,eK]=(0,n.useState)([]),[eY,eQ]=(0,n.useState)(!1),[eX,e$]=(0,n.useState)(!1),[eG,eZ]=(0,n.useState)(!1),[e0,e1]=(0,n.useState)(!1),{currentUser:e2}=(0,w.A)();(0,n.useEffect)(()=>{V({query:J,selectedFilters:ee,selectedCategory:el,useSearch2:eI,hybridWeight:eD,maxDistance:eT})},[J,ee,el,eI,eD,eT,V]),(0,n.useEffect)(()=>{eZ(!1)},[J,ee,eI,eD,eT,el]),(0,n.useEffect)(()=>{let e=N.query&&""!==N.query.trim(),t=Object.keys(N.selectedFilters).length>0;!e0&&(e||t)&&(e1(!0),tA(N.query||"",1))},[N,e0,tA]),(0,n.useEffect)(()=>{e1(!1)},[]);let e5=(0,I.useSearchParams)(),e4=e5.get("resource_type"),e6=e5.get("like"),e3=e5.get("query"),e9=e5.getAll("topics"),e8=e5.getAll("instruments"),e7=e5.getAll("study_design");(0,n.useEffect)(()=>{if(e3||e9.length>0||e8.length>0||e7.length>0){let e={};e9.length>0&&(e.keywords=e9),e8.length>0&&(e.instruments=e8),e7.length>0&&(e.study_design=e7),e4&&(e.resource_type=[e4]),V({query:e3||"",selectedFilters:e,selectedCategory:null,resourceType:e4,similarUid:e6})}},[]);let te=(0,I.useRouter)();(0,n.useEffect)(()=>{let e=!1;if(e3&&(K(e3),Q(e3),e=!0),e9&&e9.length>0&&(!ee.keywords||ee.keywords.join(",")!==e9.join(","))&&(et(e=>({...e,keywords:e9})),e=!0),e8&&e8.length>0&&(!ee.instruments||ee.instruments.join(",")!==e8.join(","))&&(et(e=>({...e,instruments:e8})),e=!0),e7&&e7.length>0&&(!ee.study_design||ee.study_design.join(",")!==e7.join(","))&&(et(e=>({...e,study_design:e7})),e=!0),e){let e=new URL(window.location.href);e.searchParams.delete("query"),e.searchParams.delete("topics"),e.searchParams.delete("instruments"),e.searchParams.delete("study_design");let t=e.pathname.replace("/search","");console.log("Navigating to:",t+e.search),te.replace(t+e.search)}},[e3,e9,e8,e7]);let tt=(0,n.useMemo)(()=>e4?[e4]:[],[e4]),tl=(0,n.useRef)(Y),ts=(0,n.useRef)(JSON.stringify(ee)),tn=(0,n.useRef)(eI),ti=(0,n.useRef)(eF),ta=(0,n.useRef)(ez),tr=(0,n.useRef)(eB);(0,n.useRef)(!1);let to=(0,n.useRef)([]),td=(0,n.useRef)(void 0),tc=(0,n.useCallback)(e=>{if(!e||""===e.trim()||"*"===e)return .5;let t=e.trim();return eJ.some(e=>t.toLowerCase()===e.toLowerCase())?0:.5},[eJ]),tu=(0,n.useCallback)(e=>{eE(e)},[]),th=(0,n.useCallback)(e=>{eR(e)},[]),tg=(0,n.useCallback)(e=>{eL(e)},[]);(0,n.useEffect)(()=>{let e=tc(Y);eR(e),eP(e)},[Y,tc]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{Q(J)},500);return()=>{clearTimeout(e)}},[J]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{eP(eD)},300);return()=>{clearTimeout(e)}},[eD]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{eO(eT)},300);return()=>{clearTimeout(e)}},[eT]),(0,n.useEffect)(()=>{(async()=>{if(!eY)try{let e=await (0,j.Qf)();eK(e),eQ(!0)}catch(e){console.error("Failed to fetch keyword phrases:",e),eQ(!0)}})()},[eY]);let tx=(0,n.useCallback)(()=>{var e,t;window.__debugState={currentPage:eh,totalHits:ec,resultsPerPage:50,searchQuery:J,debouncedSearchQuery:Y,selectedFilters:ee,filters:G,results:X,selectedResult:ef,apiOffline:eS,topLevelIdsSeen:eB},console.log("Current state stored in window.__debugState"),console.log("Current state:",{pagination:{currentPage:eh,totalHits:ec},searchQuery:J,debouncedSearchQuery:Y,selectedFilters:ee,filterCount:G.length,resultCount:X.length,selectedResult:ef?{id:null===(e=ef.extra_data)||void 0===e?void 0:e.uuid,title:null===(t=ef.dataset_schema)||void 0===t?void 0:t.name}:null,apiOffline:eS})},[eh,ec,50,J,Y,ee,G,X,ef,eS,eB]),tm=(0,n.useCallback)(e=>{ev(e),M?ey(!0):ew(!0)},[M]),tf=(0,n.useCallback)(e=>{console.log("Selected result:",e),tm(e)},[tm]),tv=(0,n.useCallback)(()=>{ey(!1)},[]),tp=(0,n.useCallback)(()=>{!M&&ef&&ew(!0)},[M,ef]),ty=(0,n.useCallback)(()=>{M||ew(e=>!e)},[M]);(0,n.useCallback)(()=>{em(e=>!e),tx()},[tx]),(0,n.useEffect)(()=>{{let e=e=>e.target!==window||(console.log("Preserving console log"),e.stopPropagation(),!1);return window.addEventListener("beforeunload",e,!0),()=>{window.removeEventListener("beforeunload",e,!0)}}},[]),(0,n.useEffect)(()=>{(async function(){try{console.log("Fetching initial aggregations..."),ei(!0),eA(!1);let e=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),t=await Promise.race([(0,j.Dd)(),e]),l=tE(t);Z(l),console.log("Initial aggregations set:",l.length,"filters"),ei(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),eA(!0),ei(!1)}})()},[]),(0,n.useEffect)(()=>{X.length>0&&!ef?ev(X[0]):X.length>0&&ef?X.some(e=>{var t,l;return(null===(t=e.extra_data)||void 0===t?void 0:t.uuid)===(null===(l=ef.extra_data)||void 0===l?void 0:l.uuid)})||ev(X[0]):0===X.length&&ev(null)},[X,ef]),(0,n.useEffect)(()=>{eb(!1)},[ef]);let t_=(0,n.useCallback)(e=>{var t,l,s;let n=null===(l=e.extra_data)||void 0===l?void 0:null===(t=l.resource_type)||void 0===t?void 0:t.includes("variable"),i=Array.isArray(e.ancestors)&&e.ancestors.length>0;return n&&i&&(null===(s=e.ancestors)||void 0===s?void 0:s[0])||e},[]),tb=async()=>{if(e2&&J.trim()&&!eX){e$(!0),eZ(!1);try{let e={query:J,filters:ee,useSearch2:eI,hybridWeight:eD,maxDistance:eT,selectedCategory:el,resultCount:X.length,uid:e2.uid,created:(0,A.O5)()};console.log("Saving search:",e,C.db),await (0,A.gS)((0,A.rJ)(C.db,"saved_searches"),e),eZ(!0)}catch(e){console.error("Error saving search:",e)}finally{e$(!1)}}},[tj,tw]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!ef){tw(null);return}tw(t_(ef))},[ef,t_]),(0,n.useEffect)(()=>{(async function(){if(e6)try{var e,t;ei(!0);let l=await (0,j.w3)(e6,void 0,void 0,ez);ek(l);let s=(null===(e=l.dataset_schema)||void 0===e?void 0:e.description)||(null===(t=l.extra_data)||void 0===t?void 0:t.description);if(!s)throw Error("No description available for similar search");K(s),Q(s);let n=tc(s),i=await (0,j.Hu)(s,{},1,50,eI,n,void 0,void 0,void 0,ez);$(i.results||[]),eu(i.num_hits||0)}catch(e){console.error("Failed to load similar studies:",e),eA(!0)}finally{ei(!1)}})()},[e6,50,eI,eF]),(0,n.useEffect)(()=>{var e,t;let l=Y!==tl.current||JSON.stringify(ee)!==ts.current||eI!==tn.current||eF!==ti.current||ez!==ta.current,s=e6&&((null==eC?void 0:null===(e=eC.dataset_schema)||void 0===e?void 0:e.description)||(null==eC?void 0:null===(t=eC.extra_data)||void 0===t?void 0:t.description))||Y;l&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),$([]),eU([]),to.current=[],eV(void 0),td.current=void 0,1!==eh&&eg(1),tA(s,1).finally(()=>{tl.current=Y,ts.current=JSON.stringify(ee),tn.current=eI,ti.current=eF,ta.current=ez,tr.current=eB}))},[Y,ee,e6,eC,eI,eF,ez]),(0,n.useEffect)(()=>{if(eh>1){var e,t;console.log("\uD83D\uDCC4 Page changed to:",eh,"- loading more results"),tA(e6&&((null==eC?void 0:null===(e=eC.dataset_schema)||void 0===e?void 0:e.description)||(null==eC?void 0:null===(t=eC.extra_data)||void 0===t?void 0:t.description))||Y,eh)}},[eh]);let tS=(0,n.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:eo,hasMoreResults:ea,currentPage:eh,resultsLength:X.length}),eo||!ea){console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:eo,hasMoreResults:ea});return}let e=eh+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),eg(e)},[eo,ea,eh]);async function tA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0,l=void 0!==t?t:eh;1===l?ei(!0):ed(!0),eA(!1);let s=Date.now();1===l&&(er(!0),ed(!1));try{var n,i;let t;let a={...ee};e4&&(a.resource_type=[e4]),Object.keys(a).forEach(e=>{Array.isArray(a[e])&&0===a[e].length&&delete a[e]});let r="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(r)),console.log("Search query:",e||"(empty)"),console.log("Filters:",a),console.log("Page:",l),console.log("Results per page:",50),console.log("Use Search2:",eI),console.log("Similar UID (will be excluded):",e6||"None"),console.log("Top Level IDs Seen:",l>1?eB:"First page");let o=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),d=Date.now();l>1?t=to.current:e6&&(t=[e6],console.log("Excluding original study from similar search:",e6)),console.log("Detailed pagination info:",{pageToUse:l,topLevelIdsSeenLength:eB.length,topLevelIdsSeenSample:eB.slice(0,5),currentTopLevelIdsRefLength:to.current.length,currentTopLevelIdsRefSample:to.current.slice(0,5),nextPageOffset:td.current,idsToExclude:t||[],willPassIds:l>1&&!eI,willPassOffset:l>1&&void 0!==td.current,willUsePost:l>1&&!eI&&((null==t?void 0:t.length)||0)>0,useSearch2:eI});let c=tc(e),u=await Promise.race([(0,j.Hu)(e,a,l,50,eI,c,t,l>1?td.current:void 0,void 0,ez),o]),h=Date.now()-d;eN(h),console.log("Response received:",{requestId:r,numHits:u.num_hits,resultCount:(null===(n=u.results)||void 0===n?void 0:n.length)||0,apiTime:"".concat(h,"ms"),results:null===(i=u.results)||void 0===i?void 0:i.map(e=>{var t,l,s,n;return{id:null===(t=e.extra_data)||void 0===t?void 0:t.uuid,title:null===(l=e.dataset_schema)||void 0===l?void 0:l.name,type:(null===(s=e.extra_data)||void 0===s?void 0:s.resource_type)||(null===(n=e.dataset_schema)||void 0===n?void 0:n["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd();let g=u.results||[];if(u.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:u.top_level_ids_seen_so_far.length,sample:u.top_level_ids_seen_so_far.slice(0,5),previousCount:eB.length}),eU(u.top_level_ids_seen_so_far),to.current=u.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response"),void 0!==u.next_page_offset?(console.log("Received next_page_offset:",{offset:u.next_page_offset,previousOffset:td.current}),eV(u.next_page_offset),td.current=u.next_page_offset):console.log("No next_page_offset in response (using calculated offset)"),1===l){if($(g),eu(u.num_hits||0),eI)er(50===g.length&&g.length<(u.num_hits||0));else{let e=g.length>0;er(e),(!e||g.length<50)&&eu(Math.max(u.num_hits||0,g.length)),g.length>0&&g.length<50&&g.length<20&&(console.log("\uD83D\uDD04 Auto-loading next page from first page - insufficient results:",{gotResults:g.length,requestedResults:50,minThreshold:20,nextPage:2}),setTimeout(()=>{!eo&&ea&&eg(2)},100))}}else if($(e=>{if(!eI&&g.length>0){let t;t=1===l?g.length:e.length+g.length,g.length<50&&t<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:g.length,requestedResults:50,currentTotal:t,minThreshold:20,nextPage:l+1}),setTimeout(()=>{!eo&&ea&&eg(l+1)},100))}return[...e,...g]}),eI)er(50===g.length);else{let e=g.length>0;er(e),e||eu(Math.max(ec,X.length+g.filter(e=>!X.some(t=>{var l,s;return(null===(l=t.extra_data)||void 0===l?void 0:l.uuid)===(null===(s=e.extra_data)||void 0===s?void 0:s.uuid)})).length))}let x=Date.now();eM(x-s)}catch(e){console.error("Search failed:",e),eA(!0),eM(null),eN(null)}finally{ei(!1),ed(!1)}}let tC=(e,t)=>{et(l=>({...l,[e]:t}))},tk=e=>{let t=(null==ee?void 0:ee.keywords)||[];if(!t.includes(e)){let l=[...t,e];et(e=>({...e,keywords:l})),tC("keywords",l)}},tI=e=>{let t=(null==ee?void 0:ee.instruments)||[];if(!t.includes(e)){let l=[...t,e];et(e=>({...e,instruments:l})),tC("instruments",l)}},tE=e=>{let t=[],l=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_variables","num_sweeps"],s=1/0,n=-1/0;if(Object.entries(e).forEach(e=>{let[i,a]=e;if("age_lower"===i||"age_upper"===i||"age_min"===i||"age_max"===i){let e=a.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let l=e.maximum;"number"==typeof l&&isFinite(l)||(l=e.max),"number"==typeof t&&isFinite(t)&&(s=Math.min(s,t)),"number"==typeof l&&isFinite(l)&&(n=Math.max(n,l));return}if(l.includes(i)){let e,l;let s=a.statistics||{};"number"==typeof s.minimum&&isFinite(s.minimum)?e=s.minimum:"number"==typeof s.min&&isFinite(s.min)?e=s.min:(console.warn("Missing valid min value for ".concat(i,", using default")),e="sample_size"===i?0:"start_year"===i||"end_year"===i?1900:0),"number"==typeof s.maximum&&isFinite(s.maximum)?l=s.maximum:"number"==typeof s.max&&isFinite(s.max)?l=s.max:(console.warn("Missing valid max value for ".concat(i,", using default")),l="sample_size"===i?1e5:"start_year"===i||"end_year"===i?2024:"duration_years"===i?100:"num_variables"===i?1e4:"num_sweeps"===i?50:100),l<=e&&(l=e+1);let n=Array.from({length:101},(t,s)=>String(e+s/100*(l-e)));t.push({id:i,label:i.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:n})}else{let e=a.buckets||[];e.length>0&&t.push({id:i,label:i.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(s)&&isFinite(n)&&s<=n){n<=s&&(n=s+1);let e=Array.from({length:101},(e,t)=>String(s+t/100*(n-s)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},tD=(0,n.useCallback)(async e=>{var t,l,s,n,i;let a=null===(t=e.extra_data)||void 0===t?void 0:t.uuid;if(!a)return;let r=(null===(l=e.dataset_schema)||void 0===l?void 0:l.name)||(null===(s=e.extra_data)||void 0===s?void 0:s.name)||"Unnamed Study";K("LIKE:".concat(r," (").concat(a,")"));let o=(null===(n=e.dataset_schema)||void 0===n?void 0:n.description)||(null===(i=e.extra_data)||void 0===i?void 0:i.description);o?(Q(o),tR(o)):(console.warn("No description available for study ".concat(r,", using name for similar search")),Q(r),tR(r))},[]),tR=async e=>{ei(!0),eA(!1);try{let t;let l={...ee};e4&&(l.resource_type=[e4]),Object.keys(l).forEach(e=>{Array.isArray(l[e])&&0===l[e].length&&delete l[e]});let s=e,n=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);n&&(t=n[2],s="LIKE:".concat(t));let i=tc(s),a=await (0,j.Hu)(s,l,eh,50,eI,i,t?[t]:eh>1?to.current:void 0,eh>1?td.current:void 0,void 0,ez);$(a.results||[]),eu(a.num_hits||0)}catch(e){eA(!0)}finally{ei(!1)}};return(0,s.jsx)(r.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,s.jsxs)(o.A,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,s.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:e6?(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,s.jsx)(r.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==eC?void 0:null===(e=eC.dataset_schema)||void 0===e?void 0:e.image)?(0,s.jsx)(f.default,{src:(null==eC?void 0:eC.dataset_schema).image,alt:(null==eC?void 0:null===(t=eC.dataset_schema)||void 0===t?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,l;let n=(null==e?void 0:null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)||(null==e?void 0:null===(l=e.dataset_schema)||void 0===l?void 0:l["@type"]);return(null==n?void 0:n.includes("dataset"))?(0,s.jsx)(E.A,{size:48}):(null==n?void 0:n.includes("variable"))?(0,s.jsx)(D.A,{size:48}):(null==n?void 0:n.includes("study"))?(0,s.jsx)(R.A,{size:48}):(0,s.jsx)(F.A,{size:48})})(eC)}),(0,s.jsxs)(r.default,{children:[(0,s.jsx)(d.A,{variant:"h4",gutterBottom:!0,children:(null==eC?void 0:null===(l=eC.dataset_schema)||void 0===l?void 0:l.name)||(null==eC?void 0:null===(v=eC.extra_data)||void 0===v?void 0:v.name)||"Unnamed Study"}),(0,s.jsx)(d.A,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{fullWidth:!0,placeholder:"What are you searching for?",value:J,onChange:e=>{K(e.target.value)},InputProps:{endAdornment:(0,s.jsxs)(r.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[J!==Y&&(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Typing..."}),(0,s.jsx)(f.default,{src:(0,U.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,s.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,s.jsx)(B,{useSearch2:eI,onEndpointChange:tu,hybridWeight:eD,onHybridWeightChange:th,maxDistance:eT,onMaxDistanceChange:tg})})]})}),(0,s.jsx)(_.A,{filtersData:G,onSelectionChange:tC,selectedFilters:ee}),!en&&!eS&&(X.length>0||ec>0)&&(0,s.jsxs)(r.default,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:[ea?X.length>ec?"".concat(X.length," results loaded (").concat(ec,"+ estimated)"):ec>0?"".concat(X.length," of ~").concat(ec," results loaded"):"".concat(X.length," results loaded"):"".concat(X.length," results found"),eW&&" (API: ".concat(eW,"ms"),eq&&eW&&", Total: ".concat(eq,"ms)")]}),e2&&X.length>0&&(0,s.jsx)(u.A,{variant:"outlined",size:"small",startIcon:eG?(0,s.jsx)(k.A,{size:16,fill:"currentColor"}):(0,s.jsx)(k.A,{size:16}),onClick:tb,disabled:eX||!J.trim(),sx:{ml:2,color:eG?"success.main":"inherit",borderColor:eG?"success.main":"inherit"},title:"Save this search",children:eX?"Saving...":eG?"Saved!":"Save Search"})]}),(0,s.jsxs)(r.default,{sx:{display:M?"block":"flex",width:"100%",flex:1,minHeight:0,overflow:"visible",position:"relative"},children:[(0,s.jsx)(r.default,{sx:{width:W?"100%":"50%",minWidth:M?"100%":"300px",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:en?(0,s.jsx)(d.A,{children:"Loading search results..."}):eS?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,s.jsx)(m.A,{sx:{fontSize:{xs:48,sm:64},color:"text.secondary",mb:2}}),(0,s.jsx)(d.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,s.jsx)(d.A,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,s.jsx)(u.A,{variant:"contained",sx:{mt:4},onClick:()=>{eA(!1),tA()},children:"Retry Connection"})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,s.jsx)(H.A,{dataLength:X.length,next:tS,hasMore:ea,loader:!Y&&(!ee||Object.values(ee).every(e=>0===e.length))?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",py:6,textAlign:"center"},children:[(0,s.jsx)(d.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Enter a search term or select some filters to begin"}),(0,s.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"Use the search bar above or apply filters to discover studies"})]}):(0,s.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,s.jsx)(P.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,s.jsx)(d.A,{children:"No more results to load."}),children:(0,s.jsx)(y,{results:X,resourceTypeFilter:tt,onSelectResult:tf,selectedResultId:null==ef?void 0:null===(p=ef.extra_data)||void 0===p?void 0:p.uuid,onFindSimilar:tD})})})})}),!M&&(X.length>0||ec>0)&&(0,s.jsxs)(r.default,{sx:{position:"absolute",top:0,right:0,width:ej?"calc(100% - 130px)":W?"0%":"50%",height:"100%",bgcolor:"background.paper",borderLeft:W&&!ej?"none":"1px solid",borderColor:"grey.200",display:"flex",flexDirection:"column",overflow:"visible",transition:"width 0.3s ease-in-out",cursor:ef?"pointer":"default",zIndex:ej?2:1,boxShadow:ej?"-4px 0 8px rgba(0, 0, 0, 0.1)":"none"},onClick:tp,children:[(0,s.jsx)(r.default,{sx:{position:"absolute",top:-16,left:-16,zIndex:1e3},children:(0,s.jsx)(h.A,{onClick:e=>{e.stopPropagation(),ty()},sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2,width:30,height:30},children:ej?(0,s.jsx)(L.A,{size:20}):(0,s.jsx)(T.A,{size:20})})}),eS?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,s.jsx)(m.A,{sx:{fontSize:{xs:36,sm:48},color:"text.secondary",mb:2}}),(0,s.jsx)(d.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,s.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):tj?(0,s.jsx)(r.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,s.jsx)(b.A,{study:tj,isDrawerView:!1,onTopicClick:tk,onInstrumentClick:tI})}):(0,s.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"Select a dataset to view details"})})]})]}),(0,s.jsxs)(g.Ay,{anchor:"right",open:M&&ep,onClose:tv,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,s.jsxs)(r.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,s.jsx)(h.A,{onClick:tv,sx:{position:"absolute",top:8,right:8},children:(0,s.jsx)(x.A,{})}),(0,s.jsxs)(r.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(d.A,{variant:"h6",sx:{flex:1},children:ef&&(null===(z=ef.dataset_schema)||void 0===z?void 0:z.name)||"Study Details"}),ef&&(ef.dataset_schema&&ef.dataset_schema.image||ef.image)&&!e_&&(0,s.jsx)(r.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,s.jsx)(f.default,{src:ef.dataset_schema&&ef.dataset_schema.image||ef.image,alt:(null===(O=ef.dataset_schema)||void 0===O?void 0:O.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>eb(!0),unoptimized:!0})})]})]}),(0,s.jsx)(r.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:tj?(0,s.jsx)(b.A,{studyDataComplete:!1,study:tj,isDrawerView:!0,onTopicClick:tk,onInstrumentClick:tI}):(0,s.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]})})}function J(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)(r.default,{sx:{p:4},children:(0,s.jsx)(d.A,{children:"Loading..."})}),children:(0,s.jsx)(V,{})})}}}]);