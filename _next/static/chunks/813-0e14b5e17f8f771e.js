(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{83686:()=>{},32383:()=>{},61580:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>ek});var n=l(95155),a=l(12115),o=l(35761),i=l(55295),r=l(68998),s=l(9552),d=l(9561),c=l(70152),u=l(22282),h=l(19579),x=l(47821),g=l(6327),f=l(72107),p=l(5565),m=l(10979),v=l(1234),y=l(64517),b=l(9450),j=l(41983),w=l(52604),C=l(90675);let _=(0,l(89142).Ay)(u.A,{shouldForwardProp:e=>"chipVariant"!==e})(e=>{let{theme:t,chipVariant:l="primary",onClick:n=()=>{}}=e;return{onClick:n,borderRadius:8,textTransform:"none",padding:"0 16px",height:32,minHeight:32,fontSize:"0.875rem",fontWeight:500,whiteSpace:"nowrap",lineHeight:1,..."primary"===l&&{backgroundColor:t.palette.primary.main,color:t.palette.primary.contrastText,"&:hover":{backgroundColor:t.palette.primary.dark}},..."secondary"===l&&{backgroundColor:t.palette.secondary.main,color:t.palette.secondary.contrastText,"&:hover":{backgroundColor:t.palette.secondary.dark}},..."dark"===l&&{backgroundColor:"#444653",color:"#FFFFFF","&:hover":{backgroundColor:"#363742"}}}});var S=l(78416),A=l(36417),k=l(27753),R=l(26214),D=l(2743),I=l(2599);function z(e){let{open:t,onClose:l,data:a,title:o="Debug Data"}=e,i=()=>{navigator.clipboard.writeText(JSON.stringify(a,null,2))};return(0,n.jsxs)(S.A,{open:t,onClose:l,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxHeight:"90vh",height:"90vh"}},children:[(0,n.jsxs)(A.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,n.jsx)(d.default,{variant:"h6",component:"div",children:o}),(0,n.jsxs)(r.default,{children:[(0,n.jsx)(x.A,{onClick:i,size:"small",sx:{mr:1},title:"Copy JSON to clipboard",children:(0,n.jsx)(D.A,{fontSize:"small"})}),(0,n.jsx)(x.A,{onClick:l,size:"small",children:(0,n.jsx)(g.A,{fontSize:"small"})})]})]}),(0,n.jsx)(k.A,{dividers:!0,sx:{p:0,height:"100%"},children:t&&(0,n.jsx)(r.default,{sx:{height:"100%",overflow:"auto","& .w-json-view-container":{backgroundColor:"#fafafa",fontSize:"13px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace'}},children:(0,n.jsx)(I.Ay,{value:a,collapsed:2,displayObjectSize:!0,displayDataTypes:!0,enableClipboard:!0,style:{backgroundColor:"#fafafa",padding:"16px"}})})}),(0,n.jsxs)(R.A,{children:[(0,n.jsx)(u.A,{onClick:i,startIcon:(0,n.jsx)(D.A,{}),children:"Copy JSON"}),(0,n.jsx)(u.A,{onClick:l,variant:"contained",children:"Close"})]})]})}function E(e){var t,l,o,i,s,c,u,h,g,f,m,S,A,k,R,D,I,E,F,L;let{result:N,isSelected:O,onClick:H,onFindSimilar:W}=e,U=!!(N.ancestors&&N.ancestors.length>0),M=null===(l=N.extra_data)||void 0===l?void 0:null===(t=l.resource_type)||void 0===t?void 0:t.includes("variable"),T=null===(i=N.extra_data)||void 0===i?void 0:null===(o=i.resource_type)||void 0===o?void 0:o.includes("dataset"),[B,P]=(0,a.useState)(!1),V=N,K=N;U&&(null===(s=N.ancestors)||void 0===s?void 0:s[0])&&(K=N.ancestors[0],V=N);let q=(null==K?void 0:null===(c=K.extra_data)||void 0===c?void 0:c.resource_type)||K.dataset_schema&&K.dataset_schema["@type"]||"Unknown Resource Type",G=(null===(u=K.dataset_schema)||void 0===u?void 0:u.name)||(null===(h=K.extra_data)||void 0===h?void 0:h.name)||"Unnamed Resource",J=U&&T?(null===(g=V.dataset_schema)||void 0===g?void 0:g.description)||(null===(f=V.extra_data)||void 0===f?void 0:f.description)||"":(null===(m=K.dataset_schema)||void 0===m?void 0:m.description)||(null===(S=K.extra_data)||void 0===S?void 0:S.description)||"",X=((null===(A=K.dataset_schema)||void 0===A?void 0:A.keywords)||K.topics||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),Q=(null===(k=V.dataset_schema)||void 0===k?void 0:k.number_of_variables)||0,Y=(null===(R=V.variables_which_matched)||void 0===R?void 0:R.length)||0,Z=(null===(D=V.dataset_schema)||void 0===D?void 0:D.includedInDataCatalog)&&V.dataset_schema.includedInDataCatalog.length>0,$=J.length>200?"".concat(J.substring(0,200),"..."):J,ee=null,[et,el]=(0,a.useState)(!1);return(null===(I=K.dataset_schema)||void 0===I?void 0:I.image)&&!et?ee=K.dataset_schema.image:K.thumbnail&&!et&&(ee=K.thumbnail),(0,n.jsxs)(r.default,{onClick:H,sx:{cursor:"pointer",display:"flex",width:"100%",bgcolor:O?"rgba(25, 118, 210, 0.08)":"transparent",borderRight:O?"3px solid":"3px solid transparent",borderColor:O?"primary.main":"transparent","&:hover":{bgcolor:O?"rgba(25, 118, 210, 0.12)":"rgba(0, 0, 0, 0.02)"}},children:[(0,n.jsxs)(r.default,{sx:{width:120,minHeight:"100%",py:2,flexShrink:1,display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",color:"grey.500",background:"transparent",position:"relative"},children:[ee&&!et?(0,n.jsx)(p.default,{src:ee,alt:G,width:100,height:100,style:{objectFit:"contain"},onError:()=>el(!0),unoptimized:!0}):q.includes("dataset")?(0,n.jsx)(v.A,{size:48}):q.includes("variable")?(0,n.jsx)(y.A,{size:48}):q.includes("study")?(0,n.jsx)(b.A,{size:48}):(0,n.jsx)(j.A,{size:48}),U&&(0,n.jsxs)(n.Fragment,{children:[M&&(0,n.jsx)(r.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:"V"}),T&&(0,n.jsx)(r.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:(0,n.jsx)(v.A,{size:16})})]}),(0,n.jsx)(r.default,{sx:{mt:1,width:"100%",display:"flex",justifyContent:"center"},children:(0,n.jsxs)(_,{chipVariant:"secondary",size:"small",onClick:e=>{var t;e.stopPropagation(),(null===(t=V.extra_data)||void 0===t?void 0:t.uuid)&&window.open("/discover?like=".concat(V.extra_data.uuid),"_blank")},sx:{cursor:"pointer",display:"flex",alignItems:"center",gap:.5},children:["Find Similar ",(0,n.jsx)(w.A,{size:14,style:{marginLeft:4}})]})})]}),(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",p:2,flex:1,background:"transparent"},children:[(0,n.jsxs)(r.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,n.jsx)(d.default,{variant:"h6",gutterBottom:!0,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2,flex:1,mr:1},children:G}),(0,n.jsx)(x.A,{size:"small",onClick:e=>{e.stopPropagation(),P(!0)},sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,n.jsx)(C.A,{size:16})})]}),X.length>0&&(0,n.jsx)(d.default,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:X.slice(0,5).map((e,t)=>(0,n.jsxs)(r.default,{component:"span",children:[(0,n.jsx)(r.default,{component:"strong",sx:{fontSize:"0.85rem"},children:e}),t<Math.min(X.length,5)-1&&(0,n.jsx)(r.default,{component:"span",sx:{mx:.5},children:"•"})]},"".concat(e,"-").concat(t)))}),(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.4,mb:1.5},children:$}),(0,n.jsx)(r.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:"auto"},children:U&&M?(0,n.jsx)(_,{chipVariant:"primary",size:"small",children:(null===(E=V.extra_data)||void 0===E?void 0:E.description)||(null===(F=V.extra_data)||void 0===F?void 0:F.name)},null===(L=V.extra_data)||void 0===L?void 0:L.uuid):(0,n.jsxs)(n.Fragment,{children:[Q>0&&(0,n.jsx)(_,{chipVariant:"primary",size:"small",children:Y>0?"".concat(Y," Matched Variables"):"".concat(Q," Variables")}),Z&&(0,n.jsx)(_,{chipVariant:"secondary",size:"small",children:"Data Available"}),V.hasFreeAccess&&(0,n.jsx)(_,{chipVariant:"secondary",size:"small",children:"Free Access"}),V.hasCohortsAvailable&&(0,n.jsx)(_,{chipVariant:"secondary",size:"small",children:"Cohorts Available"})]})})]}),(0,n.jsx)(z,{open:B,onClose:()=>P(!1),data:V,title:"Debug: ".concat(G)})]})}function F(e){let{results:t,resourceTypeFilter:l,onSelectResult:a,selectedResultId:o,onFindSimilar:i}=e,s=l&&l.length>0?t.filter(e=>{var t,n;return(null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)&&l.map(e=>e.trim().toLowerCase()).includes(null===(n=e.extra_data)||void 0===n?void 0:n.resource_type.trim().toLowerCase())}):t;console.log("SearchResults debug:",{resourceTypeFilter:l,originalResults:t,filteredResults:s});let c=e=>{a&&a(e)};return s.length?(0,n.jsx)(r.default,{children:(0,n.jsx)(m.A,{spacing:1.5,sx:{mb:4},children:s.map((e,t)=>{var l,a;let r=o===(null===(l=e.extra_data)||void 0===l?void 0:l.uuid);return(0,n.jsx)(E,{result:e,isSelected:r,onClick:()=>c(e),onFindSimilar:i},(null===(a=e.extra_data)||void 0===a?void 0:a.uuid)||"result-".concat(t))})})}):(0,n.jsx)(r.default,{sx:{textAlign:"center",py:8},children:(0,n.jsx)(d.default,{color:"text.secondary",children:"No results found. Try adjusting your search criteria."})})}var L=l(14030),N=l(35256),O=l(52488),H=l(32645),W=l(64665);let U={"Office for National Statistics":"ONS","National Health Service":"NHS","Department for Education":"DfE","Department of Health":"DoH","Department of Health and Social Care":"DHSC","Medical Research Council":"MRC","National Institute for Health and Care Excellence":"NICE","National Institute for Health Research":"NIHR","Economic and Social Research Council":"ESRC","Arts and Humanities Research Council":"AHRC","Biotechnology and Biological Sciences Research Council":"BBSRC","Engineering and Physical Sciences Research Council":"EPSRC","Natural Environment Research Council":"NERC","Science and Technology Facilities Council":"STFC","UK Research and Innovation":"UKRI","University College London":"UCL","University of Oxford":"Oxford","University of Cambridge":"Cambridge","Imperial College London":"Imperial","King's College London":"KCL","London School of Economics":"LSE","Edinburgh University":"Edin","University of Manchester":"Manchester","University of Bristol":"Bristol","University of Warwick":"Warwick","World Health Organization":"WHO","United Nations":"UN","European Union":"EU_flag","Organisation for Economic Co-operation and Development":"OECD","Wellcome Trust":"Wellcome","Nuffield Foundation":"Nuffield","British Heart Foundation":"BHF","Cancer Research UK":"CRUK","Alzheimer's Society":"Alzheimer","Diabetes UK":"Diabetes","National Institute of Mental Health":"NIMH","National Institutes of Health":"NIH","Centers for Disease Control and Prevention":"CDC","Social Care Institute for Excellence":"SCIE"},M={MRC:"/logos/MRC.png",ESRC:"/logos/ESRC.png",UKRI:"/logos/UKRI.png",NERC:"/logos/NERC.png",STFC:"/logos/STFC.png",AHRC:"/logos/AHRC.png",BBSRC:"/logos/BBSRC.png",EPSRC:"/logos/EPSRC.png",NIHR:"/logos/NIHR.png",BHF:"/logos/BHF.png",CRUK:"/logos/CRUK.png",Wellcome:"/logos/Wellcome.png",Nuffield:"/logos/Nuffield.png",ONS:"/logos/ONS.png",NHS:"/logos/NHS.png",DfE:"/logos/DfE.png",DHSC:"/logos/DHSC.png",DoHSC:"/logos/DHSC.png",NICE:"/logos/NICE.png",SCIE:"/logos/SCIE.png",HOUK:"/logos/HOUK.png",UCL:"/logos/UCL.png",Oxford:"/logos/Oxford.png",Cambridge:"/logos/Cambridge.png",Imperial:"/logos/Imperial.png",KCL:"/logos/KCL.png",LSE:"/logos/LSE.png",Edin:"/logos/Edin.png",NIH:"/logos/NIH.png",NIMH:"/logos/NIMH.png",NIDA:"/logos/NIDA.png",NIAAA:"/logos/NIAAA.png",NSF:"/logos/NSF.png",CDC:"/logos/CDC.png",FDA:"/logos/FDA.png",EU_flag:"/logos/EU_flag.png",EUCom:"/logos/EUCom.png",ERC:"/logos/ERC.png",H2020:"/logos/H2020.png",HorizonEU:"/logos/HorizonEU.png",WHO:"/logos/WHO.png",VR:"/logos/VR.png",BMBF:"/logos/BMBF.png",DFG:"/logos/DFG.png",CNRS:"/logos/CNRS.png",INSERM:"/logos/INSERM.png",ARC:"/logos/ARC.png",NHMRC:"/logos/NHMRC.png",CIHR:"/logos/CIHR.png",Uni:"/logos/university.png",Hosp:"/logos/hospital.png",Gov:"/logos/government.png",NGO:"/logos/ngo.png",Charity:"/logos/charity.png",Rayne:"/logos/Rayne.png",SRFound:"/logos/SRFound.png",BCTrust:"/logos/BCTrust.png",UKHF:"/logos/UKHF.png",RCN:"/logos/RCN.png",KingsFund:"/logos/KingsFund.png",MHRN:"/logos/MHRN.png",McPF:"/logos/McPF.png",BLF:"/logos/BLF.png",CLAHRC:"/logos/CLAHRC.png",TNA:"/logos/TNA.png",NAO:"/logos/NAO.png",RCP:"/logos/RCP.png",SU:"/logos/SU.png",SLaM:"/logos/SLaM.png"};function T(e,t){if(t&&t.trim().length>0)return console.log("Using provided logo for ".concat(e||"Unknown",": ").concat(t)),t;if(!e||0===e.trim().length){console.log("No organization name provided to findOrganizationLogo");return}if(e.includes(" ")&&e.split(" ").every(e=>e.length<=6)){for(let t of(console.log('Organization name "'.concat(e,'" appears to be a space-delimited list of abbreviations')),e.split(" ").map(e=>e.trim()).filter(e=>e.length>0))){if(M[t])return console.log('Found direct logo match for abbreviation "'.concat(t,'": ').concat(M[t])),M[t];for(let[e,l]of Object.entries(U))if(e.toLowerCase().includes(t.toLowerCase())||l.toLowerCase()===t.toLowerCase()){let n="/logos/".concat(l,".png");return console.log('Found partial match for "'.concat(t,'" with known organization "').concat(e,'" (').concat(l,"): ").concat(n)),n}}console.log('No logo match found for any part of "'.concat(e,'"'));return}let l=U[e];if(l){let t="/logos/".concat(l,".png");return console.log('Found direct organization match for "'.concat(e,'": ').concat(t)),t}if(M[e])return console.log('Found direct logo match for organization abbreviation "'.concat(e,'": ').concat(M[e])),M[e];for(let[t,l]of Object.entries(U))if(e.toLowerCase().includes(t.toLowerCase())||e.toLowerCase().includes(l.toLowerCase())){let n="/logos/".concat(l,".png");return console.log('Found partial match for "'.concat(e,'" with known organization "').concat(t,'": ').concat(n)),n}console.log('No logo match found for "'.concat(e,'"'))}function B(e){let{name:t,url:l,logo:o}=e,[i,s]=(0,a.useState)(o),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{console.log('Resolving logo for data catalog: "'.concat(t,'"'));try{let e=T(t,o);console.log('Resolved logo for data catalog "'.concat(t,'":'),e),s(e),u(!1)}catch(e){console.error('Error resolving logo for data catalog "'.concat(t,'":'),e),s(void 0)}},[t,o]);let h=i&&i.length>0&&!c;return(0,n.jsxs)(W.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:"280px",height:"80px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:l?"pointer":"default",transition:"all 0.2s","&:hover":l?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{l&&window.open(l,"_blank","noopener,noreferrer")},children:[(0,n.jsx)(r.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,n.jsx)(d.default,{sx:{fontWeight:500,fontSize:"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.7em",wordBreak:"break-word"},children:t})}),h&&(0,n.jsx)(r.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,n.jsx)(p.default,{src:i,alt:t,width:50,height:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for data catalog "'.concat(t,'" from path: ').concat(i)),u(!0)},unoptimized:!0})})]})}function P(e){let{name:t,url:l,logo:o,inactive:i,compact:s}=e,[c,u]=(0,a.useState)(o),[h,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{console.log('Resolving logo for organization: "'.concat(t,'"'));try{let e=T(t,o);console.log('Resolved logo for organization "'.concat(t,'":'),e),u(e),x(!1)}catch(e){console.error('Error resolving logo for organization "'.concat(t,'":'),e),u(void 0)}},[t,o]);let g=c&&c.length>0&&!h;return(0,n.jsxs)(W.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:s?"220px":"280px",height:s?"75px":"85px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:l?"pointer":"default",transition:"all 0.2s",opacity:i?.5:1,"&:hover":l?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{l&&window.open(l,"_blank","noopener,noreferrer")},children:[(0,n.jsx)(r.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,n.jsx)(d.default,{sx:{fontWeight:500,fontSize:s?"0.8rem":"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.9em",wordBreak:"break-word",paddingBottom:"1px"},children:t})}),g&&(0,n.jsx)(r.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,n.jsx)(p.default,{src:c,alt:t,width:s?40:50,height:s?40:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for organization "'.concat(t,'" from path: ').concat(c)),x(!0)},unoptimized:!0})})]})}var V=l(51857),K=l(67247),q=l(26536),G=l(30997),J=l(57165),X=l(53326),Q=l(72926),Y=l(66917),Z=l(4918),$=l(64364),ee=l(2091),et=l(60391),el=l(10319),en=l(10358),ea=l(71569),eo=l(689),ei=l(48694),er=l(7660);function es(e){let{variables:t,studyName:l,downloadAnchorEl:o,onDownloadClick:i,onDownloadClose:s}=e,d=(0,a.useRef)(null),c=(0,a.useRef)(null),[u,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1);console.log("variables passed:",t),(0,a.useEffect)(()=>{if(customElements.get("harmony-export"))return;let e=document.createElement("script");return e.src="/app/js/harmony-export.js",e.async=!0,document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[]);let p=[{field:"description",headerName:"Description / Code",flex:2,valueGetter:(e,t)=>(t.score?"[MATCHING] ":"")+(t.description||t.name)+(t.description&&t.name?" ("+t.name+")":""),sortable:!1},{field:"options",headerName:"Response Options",flex:1,valueGetter:(e,t)=>t.options&&Array.isArray(t.options)?t.options.join(" / "):"",sortable:!1}],m=t.filter(e=>e.name||e.description).map((e,t)=>({id:e.uuid||e.name||t,...e})),v=(0,q.b)();(0,a.useEffect)(()=>{let e=setTimeout(()=>{v.current&&h(!0)},200);return()=>clearTimeout(e)},[v]);let y=()=>{let e=v.current;if(e&&u)try{let t=e.getSelectedRows(),l=t&&"number"==typeof t.size&&t.size>0;f(l)}catch(e){f(!1)}},b=()=>{let e=v.current;if(!e||!u)return 0;try{let t=e.getSelectedRows();return t&&"number"==typeof t.size?t.size:0}catch(e){return 0}};(0,a.useEffect)(()=>{if(!u)return;let e=setInterval(()=>{y()},500);return()=>{clearInterval(e)}},[u]);let w=()=>{null==s||s()},C=()=>{let e;let t=v.current;if(!t||!u)return[];try{e=t.getSelectedRows()}catch(t){e=null}return(e&&"number"==typeof e.size&&e.size>0&&e?Array.from(e.values()):(()=>{let e;try{e=t.getRowModels()}catch(t){e=null}return e?Array.from(e.values()):[]})()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name,response_options:e.options&&Array.isArray(e.options)?e.options.join(" / "):""}))},_=()=>{let e;let t=v.current;if(!t||!d.current||!u)return;try{e=t.getSelectedRows()}catch(t){e=null}if(!e||"number"!=typeof e.size)return;console.log("selectedIds:",e);let n=Array.from(e.values()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name})),a=document.createElement("harmony-export");a.size="32px",a.instrument_name="".concat(l||"Selected Variables"," from harmonydata.ac.uk/discover"),a.questions=n,d.current.innerHTML="",d.current.appendChild(a)};return(0,a.useEffect)(()=>{if(!u)return;let e=setTimeout(()=>{_()},100);return()=>clearTimeout(e)},[u,g]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.default,{sx:{height:"100%",minHeight:400},children:m.length>0&&(0,n.jsx)(G.z,{autoPageSize:!0,apiRef:v,rows:m,columns:p,checkboxSelection:!0,disableRowSelectionOnClick:!0,sortModel:[{field:"score",sort:"desc"}],sx:{background:"white",borderRadius:2,fontSize:14,height:"100%"},hideFooterSelectedRowCount:!0,pageSizeOptions:[10,25,50],showToolbar:!0,slots:{toolbar:()=>(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:[(0,n.jsx)(J.e,{expanded:!0,style:{width:"100%"},children:(0,n.jsx)(X.X,{placeholder:"Search within variables",style:{background:"white",borderRadius:192,fontSize:14,margin:15,width:"calc(100% - 15px)",height:"auto"}})}),g&&(0,n.jsx)(Q.A,{title:"Harmonise selected items",children:(0,n.jsx)(x.A,{size:"small",sx:{width:40,height:40},children:(0,n.jsx)(r.default,{ref:d,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}})})}),(0,n.jsx)(Q.A,{title:g?"Download ".concat(b()," selected questions"):"Download all questions",children:(0,n.jsx)(x.A,{ref:c,size:"small",onClick:i,sx:{width:40,height:40},children:(0,n.jsx)(el.A,{size:30})})})]})}})}),(0,n.jsx)(Y.Ay,{open:!!o,anchorEl:o,onClose:w,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,n.jsxs)(Z.A,{sx:{width:200},children:[(0,n.jsxs)($.Ay,{onClick:()=>{let e=new Blob([JSON.stringify(C(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download="questions.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t),w()},sx:{cursor:"pointer"},children:[(0,n.jsx)(ee.A,{children:(0,n.jsx)(en.A,{size:20})}),(0,n.jsx)(et.A,{primary:"Download as JSON"})]}),(0,n.jsxs)($.Ay,{onClick:()=>{let e=new Blob([[["Question Number","Question Text","Response Options"],...C().map(e=>[e.question_no,e.question_text,e.response_options])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download="questions.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t),w()},sx:{cursor:"pointer"},children:[(0,n.jsx)(ee.A,{children:(0,n.jsx)(j.A,{size:20})}),(0,n.jsx)(et.A,{primary:"Download as CSV"})]}),(0,n.jsxs)($.Ay,{onClick:()=>{let e=C(),t=er.Wp.json_to_sheet(e),l=er.Wp.book_new();er.Wp.book_append_sheet(l,t,"Questions");let n=new Blob([er.M9(l,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download="questions.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),w()},sx:{cursor:"pointer"},children:[(0,n.jsx)(ee.A,{children:(0,n.jsx)(ea.A,{size:20})}),(0,n.jsx)(et.A,{primary:"Download as Excel"})]})]})})]})}function ed(e){let{variables:t,studyName:l}=e,[o,i]=(0,a.useState)(!1),s=(0,a.useRef)(null),[c,u]=(0,a.useState)(null),h=()=>{u(null),i(!1)},g=(0,n.jsx)(es,{variables:t,studyName:l,downloadAnchorEl:c,onDownloadClick:e=>{console.log("handleDownloadClick",e.currentTarget),u(s.current)},onDownloadClose:()=>{u(null)}});return o?(0,n.jsxs)(S.A,{ref:s,open:!0,onClose:h,maxWidth:"xl",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh"}},children:[(0,n.jsxs)(A.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,n.jsxs)(d.default,{variant:"h6",children:["Variables - ",l||"Study"]}),(0,n.jsx)(x.A,{onClick:h,size:"small",sx:{color:"text.secondary"},children:(0,n.jsx)(eo.A,{size:20})})]}),(0,n.jsx)(k.A,{sx:{p:0,overflow:"hidden"},children:(0,n.jsx)(r.default,{sx:{height:"100%","& .MuiDataGrid-root":{borderRadius:0,maxHeight:"none",height:"100%"}},children:g})})]}):(0,n.jsxs)(r.default,{ref:s,sx:{position:"relative"},children:[(0,n.jsx)(r.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:1},children:(0,n.jsx)(Q.A,{title:"Open in large view",children:(0,n.jsx)(x.A,{size:"small",onClick:()=>{u(null),i(!0)},children:(0,n.jsx)(ei.A,{size:20})})})}),(0,n.jsx)(r.default,{sx:{"& .MuiDataGrid-root":{height:450,borderRadius:2}},children:g})]})}l(67699);var ec=l(90662),eu=l(28222),eh=l(65330),ex=l(51644);function eg(e){let{open:t,onClose:l,title:o,originalSearchResult:i,lookupData:s,finalProcessedData:c}=e,[h,f]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),[v,y]=(0,a.useState)(""),b=()=>{navigator.clipboard.writeText(JSON.stringify({originalSearchResult:i,lookupData:s,finalProcessedData:c},null,2))},j=(e,t)=>{m(e),y(t),f(!0)},w=e=>{let{data:t,label:l}=e;return t?(0,n.jsxs)(r.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,n.jsxs)(d.default,{variant:"body2",children:[(0,n.jsxs)("strong",{children:[l,":"]})," ",(e=>{var t,l;if(!e||"object"!=typeof e)return"Invalid data";let n=Object.keys(e).length,a=e.title||(null===(t=e.dataset_schema)||void 0===t?void 0:t.name)||(null===(l=e.extra_data)||void 0===l?void 0:l.name)||e.name||"Unnamed";return"".concat(a," (").concat(n," top-level properties)")})(t)]}),(0,n.jsx)(u.A,{size:"small",variant:"outlined",onClick:()=>j(t,"".concat(o," - ").concat(l)),sx:{ml:2},children:"View JSON"})]}):(0,n.jsxs)(d.default,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:["No ",l.toLowerCase()," data available"]})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(S.A,{open:t,onClose:l,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxHeight:"80vh"}},children:[(0,n.jsxs)(A.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,n.jsxs)(d.default,{variant:"h6",component:"div",children:["Debug Data: ",o]}),(0,n.jsxs)(r.default,{children:[(0,n.jsx)(x.A,{onClick:b,size:"small",sx:{mr:1},title:"Copy all data to clipboard",children:(0,n.jsx)(D.A,{fontSize:"small"})}),(0,n.jsx)(x.A,{onClick:l,size:"small",children:(0,n.jsx)(g.A,{fontSize:"small"})})]})]}),(0,n.jsx)(k.A,{dividers:!0,sx:{p:3},children:t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.default,{variant:"subtitle1",gutterBottom:!0,sx:{mb:3},children:"Data Pipeline Overview"}),(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsxs)(ec.A,{defaultExpanded:!1,children:[(0,n.jsx)(eu.A,{expandIcon:(0,n.jsx)(ex.A,{}),children:(0,n.jsx)(d.default,{variant:"subtitle2",sx:{fontWeight:600},children:"1. Original Search Result"})}),(0,n.jsxs)(eh.A,{children:[(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The raw data returned from the search API when this result was found."}),(0,n.jsx)(w,{data:i,label:"Original Search Result"})]})]}),(0,n.jsxs)(ec.A,{defaultExpanded:!1,children:[(0,n.jsx)(eu.A,{expandIcon:(0,n.jsx)(ex.A,{}),children:(0,n.jsx)(d.default,{variant:"subtitle2",sx:{fontWeight:600},children:"2. Lookup Data"})}),(0,n.jsxs)(eh.A,{children:[(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The full data fetched from the lookup API using the UUID from the search result."}),(0,n.jsx)(w,{data:s,label:"Lookup Data"})]})]}),(0,n.jsxs)(ec.A,{defaultExpanded:!1,children:[(0,n.jsx)(eu.A,{expandIcon:(0,n.jsx)(ex.A,{}),children:(0,n.jsx)(d.default,{variant:"subtitle2",sx:{fontWeight:600},children:"3. Final Processed Data"})}),(0,n.jsxs)(eh.A,{children:[(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The processed and formatted data that is displayed in the StudyDetail component."}),(0,n.jsx)(w,{data:c,label:"Final Processed Data"})]})]})]}),(0,n.jsx)(r.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,n.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:[(0,n.jsx)("strong",{children:"Data Flow:"})," Original Search Result → Lookup API → Processing & Mapping → StudyDetail Component"]})})]})}),(0,n.jsxs)(R.A,{children:[(0,n.jsx)(u.A,{onClick:b,startIcon:(0,n.jsx)(D.A,{}),children:"Copy All Data"}),(0,n.jsx)(u.A,{onClick:l,variant:"contained",children:"Close"})]})]}),(0,n.jsx)(z,{open:h,onClose:()=>f(!1),data:p,title:v})]})}let ef=(0,a.memo)(e=>{var t;let{study:l,isDrawerView:o=!1,onTopicClick:i,debugData:s}=e,[c,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[f,m]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{j(!1)},[l.image]);let[w,S]=(0,a.useState)(!1),A=l.topics.filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),k=A.length>0,R=l.instruments&&l.instruments.length>0,D=l.matchedVariables&&l.matchedVariables.length>0||l.allVariables&&l.allVariables.length>0,I=l.additionalLinks&&l.additionalLinks.length>0,z=(0,a.useMemo)(()=>{console.log("study var deduping :",l.matchedVariables,l);let e=l.matchedVariables||[],t=l.allVariables||[],n=new Map;return e.forEach(e=>{let t=e.uuid||e.name;t&&n.set(t,e)}),t.forEach(e=>{let t=e.uuid||e.name;!t||n.has(t)||n.set(t,e)}),Array.from(n.values())},[l.matchedVariables,l.allVariables]);return(0,n.jsxs)(r.default,{sx:{p:3,width:"100%",height:"100%",overflowY:"auto",flex:1,display:"flex",flexDirection:"column"},children:[o&&(0,n.jsx)(r.default,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,n.jsx)(x.A,{size:"small",onClick:()=>S(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,n.jsx)(C.A,{size:18})})}),!o&&(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:2,mb:4},children:[(0,n.jsx)(r.default,{sx:{flex:1},children:(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"h4",gutterBottom:!0,sx:{flex:1,mr:1},children:l.title}),(0,n.jsx)(x.A,{size:"small",onClick:()=>S(!0),sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary",mt:.5},children:(0,n.jsx)(C.A,{size:18})})]})}),l.image&&!b&&(0,n.jsx)(r.default,{sx:{width:100,height:100,position:"relative",borderRadius:"8px",overflow:"hidden",flexShrink:0},children:(0,n.jsx)(p.default,{src:l.image,alt:l.title,fill:!0,style:{objectFit:"contain"},onError:()=>j(!0),unoptimized:!0})})]}),l.description&&(0,n.jsxs)(r.default,{sx:{mb:4},children:[(0,n.jsxs)(N.A,{in:v,collapsedSize:"130px",children:[" ",(0,n.jsx)(V.A,{text:l.description,paragraphProps:{variant:"body1",sx:{mb:2}},compact:!0})]}),l.description.length>300&&(0,n.jsxs)(r.default,{onClick:()=>y(!v),sx:{display:"flex",alignItems:"center",color:"primary.main",cursor:"pointer",mt:1},children:[(0,n.jsx)(d.default,{variant:"body2",color:"primary",sx:{fontWeight:500,mr:1},children:v?"Show Less":"Show More"}),v?(0,n.jsx)(O.A,{size:16}):(0,n.jsx)(H.A,{size:16})]})]}),(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",gap:3,mb:4},children:[l.publisher&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Publisher:"}),(0,n.jsx)(P,{name:l.publisher.name,url:l.publisher.url,logo:l.publisher.logo})]}),l.geographicCoverage&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Geographic Coverage:"}),(0,n.jsx)(d.default,{children:l.geographicCoverage})]}),l.temporalCoverage&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Temporal Coverage:"}),(0,n.jsx)(d.default,{children:(e=>{if(!e)return"Not specified";if(e.includes("..")){let[t,l]=e.split("..");return l?"".concat(t," - ").concat(l):"".concat(t," - Present (Ongoing)")}return e})(l.temporalCoverage)})]}),l.sampleSize&&"Not specified"!==l.sampleSize&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Sample Size:"}),(0,n.jsx)(d.default,{children:l.sampleSize})]}),l.ageCoverage&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Age Coverage:"}),(0,n.jsx)(d.default,{children:l.ageCoverage})]}),l.resourceType&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Resource Type:"}),(0,n.jsx)(d.default,{children:l.resourceType})]}),l.studyDesign&&l.studyDesign.length>0&&(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(d.default,{variant:"subtitle2",children:"Study Design:"}),(0,n.jsx)(d.default,{children:l.studyDesign.join(", ")})]})]}),l.funders&&l.funders.length>0&&(0,n.jsxs)(r.default,{sx:{mb:4,flexShrink:0},children:[(0,n.jsx)(d.default,{variant:"subtitle2",gutterBottom:!0,children:"Funders:"}),(0,n.jsx)(r.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:l.funders.map((e,t)=>(0,n.jsx)(P,{name:e.name,url:e.url,logo:e.logo},"".concat(e.name,"-").concat(t)))})]}),l.dataCatalogs&&l.dataCatalogs.length>0&&(0,n.jsxs)(r.default,{sx:{mb:4,flexShrink:0},children:[(0,n.jsx)(d.default,{variant:"subtitle2",gutterBottom:!0,children:"Available in Data Catalogs:"}),(0,n.jsx)(r.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:l.dataCatalogs.map((e,t)=>(0,n.jsx)(B,{name:e.name,url:e.url,logo:e.logo},"".concat(e.name,"-").concat(t)))})]}),I&&(0,n.jsxs)(r.default,{sx:{mb:4,flexShrink:0},children:[(0,n.jsx)(_,{fullWidth:!0,chipVariant:"secondary",endIcon:f?(0,n.jsx)(O.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,n.jsx)(H.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>m(!f),children:"Related Links & Papers"}),(0,n.jsx)(N.A,{in:f,children:f&&(0,n.jsx)(r.default,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:null===(t=l.additionalLinks)||void 0===t?void 0:t.map((e,t)=>(0,n.jsx)(K.A,{url:e},"link-".concat(t)))})})]}),k&&(0,n.jsxs)(r.default,{sx:{mb:4},children:[(0,n.jsx)(d.default,{variant:"subtitle2",gutterBottom:!0,children:"Keywords:"}),(0,n.jsx)(r.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:A.map((e,t)=>(0,n.jsx)(_,{onClick:t=>{t.stopPropagation(),i&&i(e)},sx:{cursor:"pointer"},children:e},"topic-".concat(t)))})]}),R&&(0,n.jsxs)(r.default,{sx:{mb:4},children:[(0,n.jsx)(d.default,{variant:"subtitle2",gutterBottom:!0,children:"Instruments:"}),(0,n.jsx)(r.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:l.instruments.map((e,t)=>(0,n.jsx)(_,{chipVariant:"secondary",children:e},"instrument-".concat(t)))})]}),(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsx)(_,{fullWidth:!0,chipVariant:"secondary",endIcon:h?(0,n.jsx)(O.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,n.jsx)(H.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>g(!h),children:"AI Summary"}),(0,n.jsx)(N.A,{in:h,children:(0,n.jsx)(r.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,n.jsx)(d.default,{children:"AI summary not available yet."})})}),D&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_,{fullWidth:!0,chipVariant:"secondary",endIcon:c?(0,n.jsx)(O.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,n.jsx)(H.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>u(!c),children:"Related Variables found within study"}),(0,n.jsx)(N.A,{in:c,children:(0,n.jsx)(r.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,n.jsx)(ed,{variables:z,studyName:l.title})})})]})]}),(0,n.jsx)(eg,{open:w,onClose:()=>S(!1),title:l.title,originalSearchResult:null==s?void 0:s.originalSearchResult,lookupData:null==s?void 0:s.lookupData,finalProcessedData:l})]})});var ep=l(42649),em=l(76046),ev=l(22783),ey=l(79201),eb=l(99489),ej=l(15617),ew=l(63219),eC=l(89026);function e_(e){let{useSearch2:t,onEndpointChange:l,hybridWeight:o,onHybridWeightChange:i}=e,[s,c]=(0,a.useState)(null),h=(0,a.useRef)(null),[x,g]=(0,a.useState)(null),[f,p]=(0,a.useState)(!0),m=!!s;return(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,ep.Pn)();g(e)}catch(e){console.error("Failed to fetch version info:",e),g({harmony_discovery_version:"Unknown"})}finally{p(!1)}})()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,n.jsx)(u.A,{ref:h,variant:"contained",color:"secondary",onClick:()=>{c(h.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:m?(0,n.jsx)(eC.A,{}):(0,n.jsx)(ew.A,{})}),(0,n.jsx)(d.default,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,n.jsx)(Y.Ay,{open:m,anchorEl:s,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},children:(0,n.jsxs)(r.default,{sx:{p:3,minWidth:280},children:[(0,n.jsx)(d.default,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,n.jsx)(r.default,{sx:{mb:3},children:(0,n.jsx)(ey.A,{control:(0,n.jsx)(eb.A,{checked:t,onChange:e=>{l(e.target.checked)},color:"primary"}),label:(0,n.jsxs)(r.default,{children:[(0,n.jsx)(d.default,{variant:"body2",fontWeight:500,children:"Search Version"}),(0,n.jsx)(d.default,{variant:"caption",color:"text.secondary",children:t?"Previous Version":f?"Loading...":(null==x?void 0:x.harmony_discovery_version)||"Current Version"})]})})}),(0,n.jsxs)(r.default,{sx:{mb:2},children:[(0,n.jsxs)(d.default,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",o.toFixed(2)]}),(0,n.jsx)(d.default,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,n.jsx)(r.default,{sx:{px:2,mt:2},children:(0,n.jsx)(ej.Ay,{value:o,onChange:(e,t)=>{i(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]}),(0,n.jsx)(r.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,n.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:[(0,n.jsx)("strong",{children:"Tip:"})," Hybrid weight is automatically adjusted based on query length. Short queries favor keyword search (lower values), while longer queries favor semantic search (higher values)."]})})]})})]})}var eS=l(71900);function eA(){var e,t,l,m,w,C,_;let S=(0,o.A)(),A=(0,i.A)(S.breakpoints.down("lg")),[k,R]=(0,a.useState)(""),[D,I]=(0,a.useState)(""),[z,E]=(0,a.useState)([]),[N,O]=(0,a.useState)([]),[H,W]=(0,a.useState)({}),[U,M]=(0,a.useState)(null),[T,B]=(0,a.useState)(!1),[P,V]=(0,a.useState)(!0),[K,q]=(0,a.useState)(!1),[G,J]=(0,a.useState)(0),[X,Q]=(0,a.useState)(1),[Y,Z]=(0,a.useState)(!1),[$,ee]=(0,a.useState)(null),[et,el]=(0,a.useState)(!1),[en,ea]=(0,a.useState)(!1),[eo,ei]=(0,a.useState)(!1),[er,es]=(0,a.useState)(null),[ed,ec]=(0,a.useState)(!1),[eu,eh]=(0,a.useState)(.5),[ex,eg]=(0,a.useState)(.5),[ey,eb]=(0,a.useState)(null),[ej,ew]=(0,a.useState)(null),[eC,eA]=(0,a.useState)([]),[ek,eR]=(0,a.useState)(void 0),eD=(0,em.useSearchParams)(),eI=eD.get("resource_type"),ez=eD.get("like"),eE=(0,a.useMemo)(()=>eI?[eI]:[],[eI]),eF=(0,a.useRef)(D),eL=(0,a.useRef)(JSON.stringify(H)),eN=(0,a.useRef)(ed),eO=(0,a.useRef)(ex),eH=(0,a.useRef)(eC);(0,a.useRef)(!1);let eW=(0,a.useRef)([]),eU=(0,a.useRef)(void 0),eM=(0,a.useCallback)(e=>{if(!e||""===e.trim()||"*"===e)return .5;let t=e.trim().split(/\s+/).length;return t<=2?.1+(t-1)*.2:.01*(10+Math.round((Math.min(t,10)-2)/8*80))},[]),eT=(0,a.useCallback)(e=>{ec(e)},[]),eB=(0,a.useCallback)(e=>{eh(e)},[]);(0,a.useEffect)(()=>{let e=eM(D);eh(e),eg(e)},[D,eM]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{I(k)},500);return()=>{clearTimeout(e)}},[k]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{eg(eu)},300);return()=>{clearTimeout(e)}},[eu]);let eP=(0,a.useCallback)(()=>{var e,t;window.__debugState={currentPage:X,totalHits:G,resultsPerPage:50,searchQuery:k,debouncedSearchQuery:D,selectedFilters:H,filters:N,results:z,selectedResult:$,apiOffline:eo,topLevelIdsSeen:eC},console.log("Current state stored in window.__debugState"),console.log("Current state:",{pagination:{currentPage:X,totalHits:G},searchQuery:k,debouncedSearchQuery:D,selectedFilters:H,filterCount:N.length,resultCount:z.length,selectedResult:$?{id:null===(e=$.extra_data)||void 0===e?void 0:e.uuid,title:null===(t=$.dataset_schema)||void 0===t?void 0:t.name}:null,apiOffline:eo})},[X,G,50,k,D,H,N,z,$,eo,eC]),eV=(0,a.useCallback)(e=>{console.log("Selected result:",e),ee(e),A&&el(!0)},[A]),eK=(0,a.useCallback)(()=>{el(!1)},[]),eq=(0,a.useCallback)(()=>{Z(e=>!e),eP()},[eP]);(0,a.useEffect)(()=>{{let e=e=>e.target!==window||(console.log("Preserving console log"),e.stopPropagation(),!1);return window.addEventListener("beforeunload",e,!0),()=>{window.removeEventListener("beforeunload",e,!0)}}},[]),(0,a.useEffect)(()=>{(async function(){try{console.log("Fetching initial aggregations..."),B(!0),ei(!1);let e=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),t=await Promise.race([(0,ep.Dd)(),e]),l=e2(t);O(l),console.log("Initial aggregations set:",l.length,"filters"),B(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),ei(!0),B(!1)}})()},[]),(0,a.useEffect)(()=>{z.length>0&&!$?ee(z[0]):z.length>0&&$?z.some(e=>{var t,l;return(null===(t=e.extra_data)||void 0===t?void 0:t.uuid)===(null===(l=$.extra_data)||void 0===l?void 0:l.uuid)})||ee(z[0]):0===z.length&&ee(null)},[z,$]),(0,a.useEffect)(()=>{ea(!1)},[$]);let eG=(0,a.useCallback)(async e=>{var t,l,n,a,o,i,r,s,d,c,u,h,x,g,f,p,m,v,y,b,j,w,C,_,S,A,k,R,D,I,z,E,F,L,N,O,H,W,U,M,T,B,P,V,K,q,G,J;let X,Q,Y;let Z=null===(l=e.extra_data)||void 0===l?void 0:null===(t=l.resource_type)||void 0===t?void 0:t.includes("variable"),$=Array.isArray(e.ancestors)&&e.ancestors.length>0,ee=Z&&$&&(null===(n=e.ancestors)||void 0===n?void 0:n[0])||e;if((null===(a=ee.dataset_schema)||void 0===a?void 0:a.number_of_variables)&&!(null===(i=ee.dataset_schema)||void 0===i?void 0:null===(o=i.variableMeasured)||void 0===o?void 0:o.length)&&!(null===(r=ee.variables_which_matched)||void 0===r?void 0:r.length)){let t=await (0,ep.w3)((null===(W=ee.extra_data)||void 0===W?void 0:W.uuid)||"");if(Z){let l={uuid:null===(U=e.extra_data)||void 0===U?void 0:U.uuid,name:(null===(M=e.extra_data)||void 0===M?void 0:M.name)||"Unnamed Variable",description:null===(T=e.extra_data)||void 0===T?void 0:T.description,score:e.score||0};t.variables_which_matched=[l]}return eG(t)}let et=(null===(s=ee.dataset_schema)||void 0===s?void 0:s.name)||"Untitled Dataset",el=(null===(d=ee.dataset_schema)||void 0===d?void 0:d.description)||"",en=(null===(c=ee.dataset_schema)||void 0===c?void 0:c.image)||ee.image||void 0;(null===(x=ee.dataset_schema)||void 0===x?void 0:null===(h=x.publisher)||void 0===h?void 0:null===(u=h[0])||void 0===u?void 0:u.name)&&(Q={name:ee.dataset_schema.publisher[0].name,url:null===(B=ee.dataset_schema.publisher[0])||void 0===B?void 0:B.url,logo:null===(P=ee.dataset_schema.publisher[0])||void 0===P?void 0:P.logo});let ea=null===(f=ee.dataset_schema)||void 0===f?void 0:null===(g=f.includedInDataCatalog)||void 0===g?void 0:g.some(e=>{var t,l;return(null===(t=e.name)||void 0===t?void 0:t.includes("Mental Health"))||(null===(l=e.name)||void 0===l?void 0:l.includes("CMHM"))}),eo=null===(p=ee.topics)||void 0===p?void 0:p.some(e=>e.toLowerCase().includes("mental health")||e.toLowerCase().includes("psychiatry")||e.toLowerCase().includes("psychology")),ei=e=>{if(!e.includes(" ")||/[,.;]/.test(e))return!1;let t=e.split(" ").map(e=>e.trim()).filter(e=>e.length>0);return t.filter(e=>e.length<=8||e.toUpperCase()===e||/[A-Z]{2,}/.test(e)).length/t.length>.6};if((null===(m=ee.dataset_schema)||void 0===m?void 0:m.funder)&&Array.isArray(ee.dataset_schema.funder)&&ee.dataset_schema.funder.length>0)Y=ee.dataset_schema.funder.map(e=>({name:e.name||"Funding Organization",url:null==e?void 0:e.url,logo:null==e?void 0:e.logo}));else if(ee.funders||(null===(v=ee.extra_data)||void 0===v?void 0:v.funders)){let e=ee.funders||(null===(V=ee.extra_data)||void 0===V?void 0:V.funders);Array.isArray(e)?Y=e.map(e=>"string"==typeof e?{name:e}:"object"==typeof e&&null!==e?{name:e.name||"Funding Organization",url:e.url,logo:e.logo}:{name:String(e)}):"string"==typeof e&&e.trim()&&(Y=(ea||eo||ei(e))&&e.includes(" ")?e.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})):e.includes(" ")&&!/[,.;]/.test(e)?e.split(" ").filter(e=>e.trim().length>0).map(e=>({name:e})):[{name:e}])}if(!Y||0===Y.length||ea||eo){let e=[ee.cmhm_funders,null===(K=ee.extra_data)||void 0===K?void 0:K.cmhm_funders,ee.funding_bodies,null===(q=ee.extra_data)||void 0===q?void 0:q.funding_bodies,ee.funding,null===(G=ee.extra_data)||void 0===G?void 0:G.funding,ee.funder,null===(J=ee.extra_data)||void 0===J?void 0:J.funder].find(e=>null!=e);if(e){let t=[];if("string"==typeof e&&e.trim()?t=ei(e)?e.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})):[{name:e}]:Array.isArray(e)&&(t=e.map(e=>"string"==typeof e?{name:e}:{name:e.name||String(e),url:e.url,logo:e.logo})),Y&&Y.length>0){let e=new Set(Y.map(e=>e.name));Y=[...Y,...t.filter(t=>!e.has(t.name))]}else Y=t}}(!Y||1===Y.length)&&(null==Y?void 0:null===(y=Y[0])||void 0===y?void 0:y.name)&&ei(Y[0].name)&&(Y=Y[0].name.split(" ").map(e=>e.trim()).filter(e=>e.length>0).map(e=>({name:e})));let er=ee.geographic_coverage||(null===(j=ee.extra_data)||void 0===j?void 0:null===(b=j.country_codes)||void 0===b?void 0:b.join(", "))||(null===(w=ee.country_codes)||void 0===w?void 0:w.join(", "))||void 0,es=(null===(C=ee.dataset_schema)||void 0===C?void 0:C.temporalCoverage)||ee.start_year&&"".concat(ee.start_year).concat(ee.end_year?"..".concat(ee.end_year):""),ed=(null===(_=ee.sample_size)||void 0===_?void 0:_.toString())||(null===(A=ee.dataset_schema)||void 0===A?void 0:null===(S=A.size)||void 0===S?void 0:S.toString())||void 0,ec=(null===(k=ee.extra_data)||void 0===k?void 0:k.age_lower)||ee.age_lower,eu=(null===(R=ee.extra_data)||void 0===R?void 0:R.age_upper)||ee.age_upper,eh=void 0!==ec&&void 0!==eu?"".concat(ec," - ").concat(eu," years"):void 0!==ec?"".concat(ec,"+ years"):void 0!==eu?"0 - ".concat(eu," years"):void 0,ex=(null===(D=ee.extra_data)||void 0===D?void 0:D.study_design)||ee.study_design||[],eg=(null===(I=ee.extra_data)||void 0===I?void 0:I.resource_type)||(null===(z=ee.dataset_schema)||void 0===z?void 0:z["@type"])||void 0,ef=((null===(E=ee.dataset_schema)||void 0===E?void 0:E.keywords)||ee.topics||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),em=ee.instruments||[],ev=ee.variables_which_matched||[],ey=(null===(F=ee.dataset_schema)||void 0===F?void 0:F.variableMeasured)||[],eb=new Set;if((null===(L=ee.dataset_schema)||void 0===L?void 0:L.includedInDataCatalog)&&ee.dataset_schema.includedInDataCatalog.length>0){let e=ee.dataset_schema.url||[];X=ee.dataset_schema.includedInDataCatalog.map(t=>{let l=t.url;if(Array.isArray(e)&&l)try{let t=new URL(l).hostname,n=e.find(e=>{try{return new URL(e).hostname===t}catch(e){return!1}});n&&(l=n)}catch(e){console.warn("Failed to parse catalog URL",e)}return l&&eb.add(l),{name:t.name||"Data Catalog",url:l||void 0,logo:t.image}})}let ej=[];if((null===(N=ee.dataset_schema)||void 0===N?void 0:N.identifier)&&Array.isArray(ee.dataset_schema.identifier)){let e=ee.dataset_schema.identifier.filter(e=>!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("10.")&&e.includes("/"))).map(e=>e.startsWith("10.")&&e.includes("/")?"https://doi.org/".concat(e):e);ej=[...ej,...e.filter(e=>!eb.has(e))]}if((null===(O=ee.dataset_schema)||void 0===O?void 0:O.url)&&Array.isArray(ee.dataset_schema.url)){let e=ee.dataset_schema.url.filter(e=>!eb.has(e));ej=[...ej,...e]}return[ee.url,ee.original_source_url,(null===(H=ee.doi)||void 0===H?void 0:H.startsWith("10."))?"https://doi.org/".concat(ee.doi):null].filter(Boolean).forEach(e=>{!e||eb.has(e)||ej.includes(e)||ej.push(e)}),{title:et,description:el,image:en,publisher:Q,funders:Y,geographicCoverage:er,temporalCoverage:es,sampleSize:ed,ageCoverage:eh,studyDesign:ex,resourceType:eg,topics:ef,instruments:em,dataCatalogs:X,matchedVariables:ev,allVariables:ey,additionalLinks:ej=Array.from(new Set(ej))}},[]),[eJ,eX]=(0,a.useState)(null),[eQ,eY]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!1;return async function(){var t;if(!$){eX(null),eY(null);return}let l=await (0,ep.w3)((null===(t=$.extra_data)||void 0===t?void 0:t.uuid)||"");l.variables_which_matched=$.variables_which_matched;let n=await eG(l);e||(eX(n),eY({originalSearchResult:$,lookupData:l}))}(),()=>{e=!0}},[$,eG]),(0,a.useEffect)(()=>{(async function(){if(ez)try{var e,t;B(!0);let l=await (0,ep.w3)(ez);es(l);let n=(null===(e=l.dataset_schema)||void 0===e?void 0:e.description)||(null===(t=l.extra_data)||void 0===t?void 0:t.description);if(!n)throw Error("No description available for similar search");R(n),I(n);let a=await (0,ep.Hu)(n,{},1,50,ed,ex,void 0);E(a.results||[]),J(a.num_hits||0)}catch(e){console.error("Failed to load similar studies:",e),ei(!0)}finally{B(!1)}})()},[ez,50,ed,ex]),(0,a.useEffect)(()=>{var e,t;let l=D!==eF.current||JSON.stringify(H)!==eL.current||ed!==eN.current||ex!==eO.current,n=ez&&((null==er?void 0:null===(e=er.dataset_schema)||void 0===e?void 0:e.description)||(null==er?void 0:null===(t=er.extra_data)||void 0===t?void 0:t.description))||D;l&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),E([]),eA([]),eW.current=[],eR(void 0),eU.current=void 0,1!==X&&Q(1),e$(n,1).finally(()=>{eF.current=D,eL.current=JSON.stringify(H),eN.current=ed,eO.current=ex,eH.current=eC}))},[D,H,ez,er,ed,ex]),(0,a.useEffect)(()=>{if(X>1){var e,t;console.log("\uD83D\uDCC4 Page changed to:",X,"- loading more results"),e$(ez&&((null==er?void 0:null===(e=er.dataset_schema)||void 0===e?void 0:e.description)||(null==er?void 0:null===(t=er.extra_data)||void 0===t?void 0:t.description))||D,X)}},[X]);let eZ=(0,a.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:K,hasMoreResults:P,currentPage:X,resultsLength:z.length}),K||!P){console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:K,hasMoreResults:P});return}let e=X+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),Q(e)},[K,P,X]);async function e$(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0,l=void 0!==t?t:X;1===l?B(!0):q(!0),ei(!1);let n=Date.now();1===l&&(V(!0),q(!1));try{var a,o;let t;let i={...H};eI&&(i.resource_type=[eI]),Object.keys(i).forEach(e=>{Array.isArray(i[e])&&0===i[e].length&&delete i[e]});let r="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(r)),console.log("Search query:",e||"(empty)"),console.log("Filters:",i),console.log("Page:",l),console.log("Results per page:",50),console.log("Use Search2:",ed),console.log("Similar UID (will be excluded):",ez||"None"),console.log("Top Level IDs Seen:",l>1?eC:"First page");let s=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),d=Date.now();l>1?t=eW.current:ez&&(t=[ez],console.log("Excluding original study from similar search:",ez)),console.log("Detailed pagination info:",{pageToUse:l,topLevelIdsSeenLength:eC.length,topLevelIdsSeenSample:eC.slice(0,5),currentTopLevelIdsRefLength:eW.current.length,currentTopLevelIdsRefSample:eW.current.slice(0,5),nextPageOffset:eU.current,idsToExclude:t||[],willPassIds:l>1&&!ed,willPassOffset:l>1&&void 0!==eU.current,willUsePost:l>1&&!ed&&((null==t?void 0:t.length)||0)>0,useSearch2:ed});let c=await Promise.race([(0,ep.Hu)(e,i,l,50,ed,ex,t,l>1?eU.current:void 0),s]),u=Date.now()-d;ew(u),console.log("Response received:",{requestId:r,numHits:c.num_hits,resultCount:(null===(a=c.results)||void 0===a?void 0:a.length)||0,apiTime:"".concat(u,"ms"),results:null===(o=c.results)||void 0===o?void 0:o.map(e=>{var t,l,n,a;return{id:null===(t=e.extra_data)||void 0===t?void 0:t.uuid,title:null===(l=e.dataset_schema)||void 0===l?void 0:l.name,type:(null===(n=e.extra_data)||void 0===n?void 0:n.resource_type)||(null===(a=e.dataset_schema)||void 0===a?void 0:a["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd();let h=c.results||[];if(c.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:c.top_level_ids_seen_so_far.length,sample:c.top_level_ids_seen_so_far.slice(0,5),previousCount:eC.length}),eA(c.top_level_ids_seen_so_far),eW.current=c.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response"),void 0!==c.next_page_offset?(console.log("Received next_page_offset:",{offset:c.next_page_offset,previousOffset:eU.current}),eR(c.next_page_offset),eU.current=c.next_page_offset):console.log("No next_page_offset in response (using calculated offset)"),1===l){if(E(h),J(c.num_hits||0),ed)V(50===h.length&&h.length<(c.num_hits||0));else{let e=h.length>0;V(e),(!e||h.length<50)&&J(Math.max(c.num_hits||0,h.length))}}else if(E(e=>{let t=new Set(e.map(e=>{var t;return null===(t=e.extra_data)||void 0===t?void 0:t.uuid}).filter(Boolean)),l=h.filter(e=>{var l;return!t.has(null===(l=e.extra_data)||void 0===l?void 0:l.uuid)});return[...e,...l]}),ed)V(50===h.length);else{let e=h.length>0;V(e),e||J(Math.max(G,z.length+h.filter(e=>!z.some(t=>{var l,n;return(null===(l=t.extra_data)||void 0===l?void 0:l.uuid)===(null===(n=e.extra_data)||void 0===n?void 0:n.uuid)})).length))}let x=Date.now();if(eb(x-n),!ed&&h.length>0){let e=1===l?h.length:z.length+h.length;h.length<50&&e<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:h.length,requestedResults:50,currentTotal:e,minThreshold:20,nextPage:l+1}),setTimeout(()=>{!K&&P&&Q(l+1)},100))}}catch(e){console.error("Search failed:",e),ei(!0),eb(null),ew(null)}finally{B(!1),q(!1)}}let e0=(e,t)=>{W(l=>({...l,[e]:t}))},e1=e=>{let t=(null==H?void 0:H.keywords)||[];if(!t.includes(e)){let l=[...t,e];W(e=>({...e,keywords:l})),e0("keywords",l)}},e2=e=>{let t=[],l=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_variables","num_sweeps"],n=1/0,a=-1/0;if(Object.entries(e).forEach(e=>{let[o,i]=e;if("age_lower"===o||"age_upper"===o||"age_min"===o||"age_max"===o){let e=i.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let l=e.maximum;"number"==typeof l&&isFinite(l)||(l=e.max),"number"==typeof t&&isFinite(t)&&(n=Math.min(n,t)),"number"==typeof l&&isFinite(l)&&(a=Math.max(a,l));return}if(l.includes(o)){let e,l;let n=i.statistics||{};"number"==typeof n.minimum&&isFinite(n.minimum)?e=n.minimum:"number"==typeof n.min&&isFinite(n.min)?e=n.min:(console.warn("Missing valid min value for ".concat(o,", using default")),e="sample_size"===o?0:"start_year"===o||"end_year"===o?1900:0),"number"==typeof n.maximum&&isFinite(n.maximum)?l=n.maximum:"number"==typeof n.max&&isFinite(n.max)?l=n.max:(console.warn("Missing valid max value for ".concat(o,", using default")),l="sample_size"===o?1e5:"start_year"===o||"end_year"===o?2024:"duration_years"===o?100:"num_variables"===o?1e4:"num_sweeps"===o?50:100),l<=e&&(l=e+1);let a=Array.from({length:101},(t,n)=>String(e+n/100*(l-e)));t.push({id:o,label:o.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:a})}else{let e=i.buckets||[];e.length>0&&t.push({id:o,label:o.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(n)&&isFinite(a)&&n<=a){a<=n&&(a=n+1);let e=Array.from({length:101},(e,t)=>String(n+t/100*(a-n)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},e5=(0,a.useCallback)(async e=>{var t,l,n,a,o,i,r;let s=null===(t=e.extra_data)||void 0===t?void 0:t.uuid;if(!s)return;let d=(null===(l=e.dataset_schema)||void 0===l?void 0:l.name)||(null===(n=e.extra_data)||void 0===n?void 0:n.name)||"Unnamed Study";R("LIKE:".concat(d," (").concat(s,")"));let c=(null===(a=e.dataset_schema)||void 0===a?void 0:a.description)||(null===(o=e.extra_data)||void 0===o?void 0:o.description);if(!c)try{let e=await (0,ep.w3)(s);c=(null===(i=e.dataset_schema)||void 0===i?void 0:i.description)||(null===(r=e.extra_data)||void 0===r?void 0:r.description)}catch(e){console.error("Failed to fetch description for LIKE search",e);return}c&&(I(c),e6(c))},[]),e6=async e=>{B(!0),ei(!1);try{let t;let l={...H};eI&&(l.resource_type=[eI]),Object.keys(l).forEach(e=>{Array.isArray(l[e])&&0===l[e].length&&delete l[e]});let n=e,a=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);a&&(t=a[2],n="LIKE:".concat(t));let o=await (0,ep.Hu)(n,l,X,50,ed,ex,t?[t]:X>1?eW.current:void 0,X>1?eU.current:void 0);E(o.results||[]),J(o.num_hits||0)}catch(e){ei(!0)}finally{B(!1)}};return(0,n.jsx)(r.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,n.jsxs)(s.default,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,n.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:ez?(0,n.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,n.jsx)(r.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==er?void 0:null===(e=er.dataset_schema)||void 0===e?void 0:e.image)?(0,n.jsx)(p.default,{src:(null==er?void 0:er.dataset_schema).image,alt:(null==er?void 0:null===(t=er.dataset_schema)||void 0===t?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,l;let a=(null==e?void 0:null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)||(null==e?void 0:null===(l=e.dataset_schema)||void 0===l?void 0:l["@type"]);return(null==a?void 0:a.includes("dataset"))?(0,n.jsx)(v.A,{size:48}):(null==a?void 0:a.includes("variable"))?(0,n.jsx)(y.A,{size:48}):(null==a?void 0:a.includes("study"))?(0,n.jsx)(b.A,{size:48}):(0,n.jsx)(j.A,{size:48})})(er)}),(0,n.jsxs)(r.default,{children:[(0,n.jsx)(d.default,{variant:"h4",gutterBottom:!0,children:(null==er?void 0:null===(l=er.dataset_schema)||void 0===l?void 0:l.name)||(null==er?void 0:null===(m=er.extra_data)||void 0===m?void 0:m.name)||"Unnamed Study"}),(0,n.jsx)(d.default,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{fullWidth:!0,placeholder:"What are you searching for?",value:k,onChange:e=>{R(e.target.value)},InputProps:{endAdornment:(0,n.jsxs)(r.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[k!==D&&(0,n.jsx)(d.default,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Typing..."}),(0,n.jsx)(p.default,{src:"/search/icons/discover.svg",alt:"Search",width:20,height:20})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,n.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,n.jsx)(e_,{useSearch2:ed,onEndpointChange:eT,hybridWeight:eu,onHybridWeightChange:eB})})]})}),(0,n.jsx)(L.A,{filtersData:N,onSelectionChange:e0,selectedFilters:H}),!T&&!eo&&(z.length>0||G>0)&&(0,n.jsx)(r.default,{sx:{mb:2,display:"flex",justifyContent:"flex-start"},children:(0,n.jsxs)(d.default,{variant:"body2",color:"text.secondary",children:[P?z.length>G?"".concat(z.length," results loaded (").concat(G,"+ estimated)"):G>0?"".concat(z.length," of ~").concat(G," results loaded"):"".concat(z.length," results loaded"):"".concat(z.length," results found"),ej&&" (API: ".concat(ej,"ms"),ey&&ej&&", Total: ".concat(ey,"ms)")]})}),(0,n.jsx)(r.default,{sx:{mb:2,display:"flex",justifyContent:"flex-start"},children:(0,n.jsx)(u.A,{variant:"outlined",size:"small",onClick:eq,sx:{fontSize:"0.7rem",textTransform:"none",py:.5},children:Y?"Hide Debug Info":"Debug API Responses"})}),Y&&(0,n.jsxs)(r.default,{sx:{mb:4,p:2,border:"1px dashed",borderColor:"grey.300",borderRadius:1},children:[(0,n.jsx)(d.default,{variant:"h6",gutterBottom:!0,children:"Debug Information"}),(0,n.jsxs)(d.default,{variant:"body2",children:["API responses are saved to:",(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"window.__lastSearchResponse"})," - Latest search response"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"window.__lastAggregateResponse"})," - Latest aggregations response"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"window.__debugState"})," - Current component state"]})]}),(0,n.jsx)("strong",{children:"Current Search:"})," ",D||"(empty)",(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"Total hits:"})," ",G,(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"Selected Filters:"})," ",Object.keys(H).length>0?Object.keys(H).map(e=>"".concat(e," (").concat(H[e].length,")")).join(", "):"None"]}),(0,n.jsx)(u.A,{variant:"outlined",size:"small",onClick:()=>{eP();let e=JSON.stringify({search:D,totalHits:G,selectedFilters:H},null,2);navigator.clipboard.writeText(e),alert("Debug info copied to clipboard")},sx:{mt:1,mr:1},children:"Copy Debug Info"}),(0,n.jsx)(u.A,{variant:"outlined",color:"error",size:"small",onClick:()=>{console.clear(),e$()},sx:{mt:1},children:"Clear & Reload"})]}),(0,n.jsxs)(r.default,{sx:{display:A?"block":"grid",gridTemplateColumns:"1fr 1fr",gap:4,width:"100%",flex:1,minHeight:0,overflow:"hidden"},children:[(0,n.jsx)(r.default,{sx:{width:"100%",minWidth:0,overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%"},children:T?(0,n.jsx)(d.default,{children:"Loading search results..."}):eo?(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,n.jsx)(f.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(d.default,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,n.jsx)(d.default,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,n.jsx)(u.A,{variant:"contained",sx:{mt:4},onClick:()=>{ei(!1),e$()},children:"Retry Connection"})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,n.jsx)(eS.A,{dataLength:z.length,next:eZ,hasMore:P,loader:!D&&(!H||Object.values(H).every(e=>0===e.length))?(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",py:6,textAlign:"center"},children:[(0,n.jsx)(d.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Enter a search term or select some filters to begin"}),(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"Use the search bar above or apply filters to discover studies"})]}):(0,n.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,n.jsx)(ev.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,n.jsx)(d.default,{children:"No more results to load."}),children:(0,n.jsx)(F,{results:z,resourceTypeFilter:eE,onSelectResult:eV,selectedResultId:null==$?void 0:null===(w=$.extra_data)||void 0===w?void 0:w.uuid,onFindSimilar:e5})})})})}),!A&&(0,n.jsx)(r.default,{sx:{width:"100%",bgcolor:"background.paper",borderLeft:"1px solid",borderColor:"grey.200",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:eo?(0,n.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,n.jsx)(f.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,n.jsx)(d.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,n.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):eJ?(0,n.jsx)(r.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,n.jsx)(ef,{study:eJ,isDrawerView:!1,onTopicClick:e1,debugData:eQ})}):(0,n.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,n.jsx)(d.default,{color:"text.secondary",children:"Select a dataset to view details"})})})]}),(0,n.jsxs)(h.Ay,{anchor:"right",open:A&&et,onClose:eK,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,n.jsxs)(r.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,n.jsx)(x.A,{onClick:eK,sx:{position:"absolute",top:8,right:8},children:(0,n.jsx)(g.A,{})}),(0,n.jsxs)(r.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,n.jsx)(d.default,{variant:"h6",sx:{flex:1},children:$&&(null===(C=$.dataset_schema)||void 0===C?void 0:C.name)||"Study Details"}),$&&($.dataset_schema&&$.dataset_schema.image||$.image)&&!en&&(0,n.jsx)(r.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,n.jsx)(p.default,{src:$.dataset_schema&&$.dataset_schema.image||$.image,alt:(null===(_=$.dataset_schema)||void 0===_?void 0:_.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>ea(!0),unoptimized:!0})})]})]}),(0,n.jsx)(r.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:eJ?(0,n.jsx)(ef,{study:eJ,isDrawerView:!0,onTopicClick:e1,debugData:eQ}):(0,n.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,n.jsx)(d.default,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]})})}function ek(){return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)(r.default,{sx:{p:4},children:(0,n.jsx)(d.default,{children:"Loading..."})}),children:(0,n.jsx)(eA,{})})}},67247:(e,t,l)=>{"use strict";l.d(t,{A:()=>g});var n=l(95155),a=l(12115),o=l(68998),i=l(9561),r=l(64665),s=l(45704),d=l(5565),c=l(52604),u=l(42649);let h=new Map,x=new Map;function g(e){let{url:t,compact:l=!1,maxHeight:g=250}=e,[f,p]=(0,a.useState)(null),[m,v]=(0,a.useState)(!0),[y,b]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{!async function(){if(t){v(!0),b(null),w(!1);try{let e=t.toLowerCase(),l=Date.now(),n=x.get(e);if(n&&l-n.timestamp<864e5){console.log("Client cache hit for ".concat(t)),p(n.data),v(!1);return}let a=h.get(e);a?console.log("Reusing in-flight request for ".concat(t)):(console.log("Fetching OpenGraph data for ".concat(t)),a=(0,u.v5)(t).then(t=>(x.set(e,{data:t,timestamp:Date.now()}),t)).finally(()=>{h.delete(e)}),h.set(e,a));let o=await a;p(o)}catch(e){console.error("Error fetching Open Graph data:",e),b(e instanceof Error?e.message:"Failed to fetch link preview")}finally{v(!1)}}}()},[t]);let C=()=>{w(!0)};return y?(0,n.jsxs)(o.default,{component:"a",href:t,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none",color:"primary.main",display:"flex",alignItems:"center",gap:.5,"&:hover":{textDecoration:"underline"}},children:[(0,n.jsx)(i.default,{variant:"body2",sx:{wordBreak:"break-word"},children:t}),(0,n.jsx)(c.A,{size:16})]}):m?(0,n.jsxs)(r.A,{elevation:0,sx:{display:"flex",flexDirection:l?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:l?"100%":500,height:l?100:"auto",maxHeight:g,border:"1px solid",borderColor:"grey.200",transition:"all 0.2s"},children:[!l&&(0,n.jsx)(s.A,{variant:"rectangular",width:"100%",height:140}),(0,n.jsxs)(o.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,n.jsx)(s.A,{variant:"text",width:"80%",height:24}),!l&&(0,n.jsx)(s.A,{variant:"text",width:"90%",height:18,sx:{mt:1}}),(0,n.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,n.jsx)(s.A,{variant:"circular",width:16,height:16}),(0,n.jsx)(s.A,{variant:"text",width:120,height:16})]})]}),l&&(0,n.jsx)(s.A,{variant:"rectangular",width:80,height:"100%"})]}):f?(0,n.jsxs)(r.A,{elevation:0,sx:{display:"flex",flexDirection:l?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:l?"100%":500,height:l?100:"auto",maxHeight:g,border:"1px solid",borderColor:"grey.200",cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:2,borderColor:"primary.main"}},onClick:()=>{window.open(t,"_blank","noopener,noreferrer")},children:[f.image&&!j&&!l&&(0,n.jsx)(o.default,{sx:{position:"relative",width:"100%",height:140,overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,n.jsx)(d.default,{src:f.image,alt:f.title||"Link preview",fill:!0,style:{objectFit:"cover"},onError:C,unoptimized:!0})}),(0,n.jsxs)(o.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between",bgcolor:"rgba(0,0,0,0.01)"},children:[(0,n.jsxs)(o.default,{children:[(0,n.jsx)(i.default,{variant:"subtitle1",component:"h3",sx:{fontWeight:500,fontSize:l?"0.9rem":"1rem",lineHeight:1.2,mb:.5,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:f.title}),!l&&f.description&&(0,n.jsx)(i.default,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:1,height:"2.4em"},children:f.description})]}),(0,n.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[f.favicon&&(0,n.jsx)(o.default,{sx:{width:16,height:16,position:"relative",overflow:"hidden",borderRadius:"2px",flexShrink:0},children:(0,n.jsx)(d.default,{src:f.favicon,alt:f.siteName||"Site icon",width:16,height:16,style:{objectFit:"contain"},unoptimized:!0})}),(0,n.jsx)(i.default,{variant:"caption",sx:{color:"text.secondary",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",fontSize:"0.7rem"},children:f.siteName||new URL(f.finalUrl||f.url).hostname}),(0,n.jsx)(c.A,{size:12,color:"#666",style:{marginLeft:"auto"}})]})]}),f.image&&!j&&l&&(0,n.jsx)(o.default,{sx:{position:"relative",width:80,minWidth:80,height:"100%",overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,n.jsx)(d.default,{src:f.image,alt:f.title||"Link preview",fill:!0,style:{objectFit:"cover"},onError:C,unoptimized:!0})})]}):null}},51857:(e,t,l)=>{"use strict";l.d(t,{A:()=>d});var n=l(95155),a=l(12115),o=l(68998),i=l(9561),r=l(67247);let s=/(https?:\/\/[^\s]+)/g;function d(e){let{text:t,compact:l=!1,paragraphProps:d={}}=e,c=(0,a.useRef)(null),[u,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[l]=t;l.isIntersecting&&(h(!0),c.current&&e.unobserve(c.current))},{rootMargin:"100px",threshold:.1});return c.current&&e.observe(c.current),()=>{c.current&&e.unobserve(c.current)}},[]);let x=(0,a.useMemo)(()=>{if(!t)return[{type:"text",content:""}];let e=t.split(s),l=t.match(s)||[],n=[];for(let t=0;t<e.length;t++)if(e[t]&&n.push({type:"text",content:e[t]}),t<l.length){let e=l[t];(e.endsWith(".")||e.endsWith(",")||e.endsWith(";")||e.endsWith(":")||e.endsWith(")"))&&(e=e.slice(0,-1)),n.push({type:"url",content:e})}return n},[t]);return(0,n.jsx)(o.default,{ref:c,sx:{display:"flex",flexDirection:"column",gap:2},children:x.map((e,t)=>"text"===e.type?(0,n.jsx)(i.default,{variant:"body1",...d,sx:{...d.sx,whiteSpace:"pre-wrap"},children:e.content},"text-".concat(t)):u?(0,n.jsx)(r.A,{url:e.content,compact:l},"url-".concat(t)):(0,n.jsx)(o.default,{component:"a",href:e.content,target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:e.content},"url-placeholder-".concat(t)))})}},67699:()=>{}}]);