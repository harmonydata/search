"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{67247:(e,t,n)=>{n.d(t,{A:()=>u});var o=n(95155),r=n(12115),a=n(68998),i=n(9561),s=n(64665),l=n(45704),c=n(5565),d=n(52604),h=n(42649);let g=new Map,f=new Map;function u(e){let{url:t,compact:n=!1,maxHeight:u=250}=e,[p,x]=(0,r.useState)(null),[w,m]=(0,r.useState)(!0),[v,b]=(0,r.useState)(null),[y,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!async function(){if(t){m(!0),b(null),j(!1);try{let e=t.toLowerCase(),n=Date.now(),o=f.get(e);if(o&&n-o.timestamp<864e5){console.log("Client cache hit for ".concat(t)),x(o.data),m(!1);return}let r=g.get(e);r?console.log("Reusing in-flight request for ".concat(t)):(console.log("Fetching OpenGraph data for ".concat(t)),r=(0,h.v5)(t).catch(async e=>{let n=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,n=(e.match(/\)/g)||[]).length;if(n>t){let o=n-t,r=e;for(let e=0;e<o;e++)r.endsWith(")")&&(r=r.slice(0,-1));return r!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(r,'" (removed ').concat(o," extra closing brackets)")),r}}return e}(t);if(n!==t)return console.log("First attempt failed, retrying with cleaned URL: ".concat(n)),(0,h.v5)(n);throw e}).then(t=>(f.set(e,{data:t,timestamp:Date.now()}),t)).finally(()=>{g.delete(e)}),g.set(e,r));let a=await r;x(a)}catch(e){console.error("Error fetching Open Graph data:",e),b(e instanceof Error?e.message:"Failed to fetch link preview")}finally{m(!1)}}}()},[t]);let _=()=>{j(!0)};return v?(0,o.jsxs)(a.default,{component:"a",href:t,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none",color:"primary.main",display:"flex",alignItems:"center",gap:.5,"&:hover":{textDecoration:"underline"}},children:[(0,o.jsx)(i.default,{variant:"body2",sx:{wordBreak:"break-word"},children:t}),(0,o.jsx)(d.A,{size:16})]}):w?(0,o.jsxs)(s.A,{elevation:0,sx:{display:"flex",flexDirection:n?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:n?"100%":500,height:n?100:"auto",maxHeight:u,border:"1px solid",borderColor:"grey.200",transition:"all 0.2s"},children:[!n&&(0,o.jsx)(l.A,{variant:"rectangular",width:"100%",height:140}),(0,o.jsxs)(a.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,o.jsx)(l.A,{variant:"text",width:"80%",height:24}),!n&&(0,o.jsx)(l.A,{variant:"text",width:"90%",height:18,sx:{mt:1}}),(0,o.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,o.jsx)(l.A,{variant:"circular",width:16,height:16}),(0,o.jsx)(l.A,{variant:"text",width:120,height:16})]})]}),n&&(0,o.jsx)(l.A,{variant:"rectangular",width:80,height:"100%"})]}):p?(0,o.jsxs)(s.A,{elevation:0,sx:{display:"flex",flexDirection:n?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:n?"100%":500,height:n?100:"auto",maxHeight:u,border:"1px solid",borderColor:p.isFallback?"grey.300":"grey.200",cursor:"pointer",transition:"all 0.2s",opacity:p.isFallback?.8:1,"&:hover":{boxShadow:2,borderColor:p.isFallback?"grey.400":"primary.main"}},onClick:()=>{window.open(t,"_blank","noopener,noreferrer")},children:[p.image&&!y&&!n&&(0,o.jsx)(a.default,{sx:{position:"relative",width:"100%",height:140,overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,o.jsx)(c.default,{src:p.image,alt:p.title||"Link preview",fill:!0,style:{objectFit:"cover"},onError:_,unoptimized:!0})}),(0,o.jsxs)(a.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between",bgcolor:"rgba(0,0,0,0.01)"},children:[(0,o.jsxs)(a.default,{children:[(0,o.jsx)(i.default,{variant:"subtitle1",component:"h3",sx:{fontWeight:500,fontSize:n?"0.9rem":"1rem",lineHeight:1.2,mb:.5,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:p.title}),!n&&p.description&&(0,o.jsx)(i.default,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:1,height:"2.4em"},children:p.description})]}),(0,o.jsxs)(a.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[p.favicon&&(0,o.jsx)(a.default,{sx:{width:16,height:16,position:"relative",overflow:"hidden",borderRadius:"2px",flexShrink:0},children:(0,o.jsx)(c.default,{src:p.favicon,alt:p.siteName||"Site icon",width:16,height:16,style:{objectFit:"contain"},unoptimized:!0})}),(0,o.jsxs)(i.default,{variant:"caption",sx:{color:"text.secondary",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",fontSize:"0.7rem"},children:[p.isFallback&&t.includes("doi.org")?p.publisher||"DOI":p.siteName||new URL(p.finalUrl||p.url).hostname,p.isFallback&&" (preview unavailable)"]}),(0,o.jsx)(d.A,{size:12,color:"#666",style:{marginLeft:"auto"}})]})]}),p.image&&!y&&n&&(0,o.jsx)(a.default,{sx:{position:"relative",width:80,minWidth:80,height:"100%",overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,o.jsx)(c.default,{src:p.image,alt:p.title||"Link preview",fill:!0,style:{objectFit:"cover"},onError:_,unoptimized:!0})})]}):null}},51857:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(95155),r=n(12115),a=n(68998),i=n(9561),s=n(67247);let l=/(https?:\/\/[^\s]+)/g;function c(e){let{text:t,compact:n=!1,paragraphProps:c={}}=e,d=(0,r.useRef)(null),[h,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[n]=t;n.isIntersecting&&(g(!0),d.current&&e.unobserve(d.current))},{rootMargin:"100px",threshold:.1});return d.current&&e.observe(d.current),()=>{d.current&&e.unobserve(d.current)}},[]);let f=(0,r.useMemo)(()=>{if(!t)return[{type:"text",content:""}];let e=t.split(l),n=t.match(l)||[],o=[];for(let t=0;t<e.length;t++)if(e[t]&&o.push({type:"text",content:e[t]}),t<n.length){let e=n[t];(e.endsWith(".")||e.endsWith(",")||e.endsWith(";")||e.endsWith(":")||e.endsWith(")"))&&(e=e.slice(0,-1)),o.push({type:"url",content:e})}return o},[t]);return(0,o.jsx)(a.default,{ref:d,sx:{display:"flex",flexDirection:"column",gap:2},children:f.map((e,t)=>"text"===e.type?(0,o.jsx)(i.default,{variant:"body1",...c,sx:{...c.sx,whiteSpace:"pre-wrap"},children:e.content},"text-".concat(t)):h?(0,o.jsx)(s.A,{url:e.content,compact:n},"url-".concat(t)):(0,o.jsx)(a.default,{component:"a",href:e.content,target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:e.content},"url-placeholder-".concat(t)))})}},42649:(e,t,n)=>{n.d(t,{AV:()=>h,Dd:()=>r,Hu:()=>a,Pn:()=>l,U4:()=>c,Y3:()=>d,dh:()=>g,v5:()=>s,w3:()=>i});let o="https://harmonydataweaviate.azureedge.net";async function r(){let e=await fetch("".concat(o,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let n=t.aggregations||{};return Object.keys(n).map(e=>({id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:Object.keys(n[e])}))}async function a(e,t){var n,r;let a,i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,c=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,g=arguments.length>7?arguments[7]:void 0,f=t&&Object.keys(t).length>0;if(!e&&!f)return{results:[],aggregations:{},num_hits:0};let u=e&&""!==e.trim()?e.trim():"",p=h&&h.length>0&&!c,x=c?"search2":"search",w="".concat(o,"/discover/").concat(x);if(p){a=w;let e={query:[u],num_results:l},n=void 0!==g?g:(s-1)*l;e.offset=n,void 0!==d&&(e.alpha=d),e.top_level_ids_seen_so_far=h,t&&Object.entries(t).forEach(t=>{let[n,o]=t;o.length>0&&(e[n]=o)}),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[u],topLevelIdsCount:h.length,offset:n,endpoint:x})}else{let e=new URLSearchParams;void 0!==d&&e.set("alpha",d.toString()),e.append("query",u);let n=void 0!==g?g:(s-1)*l;e.set("num_results",l.toString()),e.set("offset",n.toString());let o={};if(t)for(let n in t)if(n.endsWith("_min")||n.endsWith("_max")){let r=n.replace(/_(min|max)$/,"");o[r]||(o[r]={}),n.endsWith("_min")?o[r].min=t[n][0]:o[r].max=t[n][0],e.append(n,t[n][0])}else t[n].forEach(t=>{e.append(n,t)});a="".concat(w,"?").concat(e.toString()),i={method:"GET"},Object.keys(o).length>0&&console.log("Numeric range parameters:",o),console.log("Using GET request:",a)}let m=await fetch(a,i);if(!m.ok)throw console.error("Search API error:",m.status,await m.text()),Error("Search API request failed");let v=await m.json();return window.__lastSearchResponse=v,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:v.num_hits,resultCount:(null===(n=v.results)||void 0===n?void 0:n.length)||0,firstResult:null===(r=v.results)||void 0===r?void 0:r[0],aggregations:Object.keys(v.aggregations||{}),endpoint:x,method:p?"POST":"GET",hybridWeight:d}),{results:v.results||[],aggregations:v.aggregations||{},num_hits:v.num_hits,top_level_ids_seen_so_far:v.top_level_ids_seen_so_far||[],next_page_offset:v.next_page_offset}}async function i(e,t){let n=new URLSearchParams;n.set("uuid",e),t&&t.trim()&&n.set("query",t.trim());let r="".concat(o,"/discover/lookup?").concat(n.toString()),a=await fetch(r);if(!a.ok)throw console.error("Failed to fetch result by UUID:",a.statusText),Error("Failed to fetch result by UUID: ".concat(a.statusText));let i=await a.json();return window.__lastLookupResponse=i,i.results[0]}async function s(e){let t=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,n=(e.match(/\)/g)||[]).length;if(n>t){let o=n-t,r=e;for(let e=0;e<o;e++)r.endsWith(")")&&(r=r.slice(0,-1));return r!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(r,'" (removed ').concat(o," extra closing brackets)")),r}}return e}(e),n=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(t)));if(!n.ok)throw Error("Failed to fetch OpenGraph data");return n.json()}async function l(){let e=await fetch("".concat(o,"/info/version"));if(!e.ok)throw console.error("Failed to fetch version info:",e.statusText),Error("Failed to fetch version info");let t=await e.json();return window.__lastVersionResponse=t,console.log("Version API response cached in window.__lastVersionResponse for debugging"),t}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[n,o]=e;o.length>0&&o.forEach(e=>{t.append(n,e)})});let n=await fetch("".concat(o,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!n.ok)throw Error("Failed to fetch aggregate data");return n.json()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[n,o]=e;o.length>0&&o.forEach(e=>{t.append(n,e)})});let n=await fetch("".concat(o,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!n.ok)throw Error("Failed to fetch numeric values");return n.json()}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[n,o]=e;o.length>0&&o.forEach(e=>{t.append(n,e)})});let n=await fetch("".concat(o,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!n.ok)throw Error("Failed to fetch word cloud data");return n.json()}async function g(){let e=await fetch("".concat(o,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}}}]);