(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[314],{41234:()=>{},29755:(e,t,a)=>{Promise.resolve().then(a.bind(a,91640))},91640:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var n=a(95155),o=a(12115),r=a(64665),s=a(42479),i=a(68998),l=a(9561),c=a(96854),d=a(9552),h=a(10897),u=a(35417),g=a(72926),f=a(78562),p=a(41728),x=a(58581),m=a(24817),j=a(15255),y=a(12800),v=a(66963),w=a(27112),_=a(16161),b=a(90518),A=a(42649),k=a(14030),S=a(53452),E=a(65776),C=a(3485);let O={rotations:2,rotationAngles:[-90,0],fontSizes:[12,60],padding:1},P=(e,t)=>{let a="sample_size"===t,n=[...e].filter(e=>null!=e&&!isNaN(e));if(0===n.length)return{values:[],frequencies:[],labels:[]};if(a){let e=[1e3,1e4,1e5,1e6,1e7],t=["<1k","<10k","<100k","<1m","<10m"],a=Array(t.length).fill(0);return n.forEach(t=>{for(let n=0;n<e.length;n++)if(t>(0==n?0:e[n-1])&&t<=e[n]){a[n]++;break}}),{values:e,frequencies:a,labels:t}}let o=Math.min(...n),r=Math.max(...n),s=[],i=[];if(t.includes("year")){let e=5*Math.floor(o/5),t=(5*Math.ceil(r/5)-e)/5,a=Array(t).fill(0),l=Array(t).fill(0).map((t,a)=>e+5*a);n.forEach(n=>{let o=Math.floor((n-e)/5);o>=0&&o<t&&a[o]++}),s=l,i=a}else{let e=10;t.includes("age")?e=6:t.includes("duration")&&(e=5);let a=(r-o)/e,l=Array(e).fill(0),c=Array(e+1).fill(0).map((e,t)=>o+t*a);n.forEach(t=>{let n=Math.min(Math.floor((t-o)/a),e-1);l[n]++}),s=c.slice(0,-1).map((e,t)=>e+a/2),i=l}return{values:s,frequencies:i,labels:[]}},U=(e,t)=>"string"==typeof e?e:t.includes("year")?e.toString():(t.includes("num_")||t.includes("age")||t.includes("duration"),Math.round(e).toString()),R=e=>Object.entries(e).map(e=>{let[t,a]=e;return{text:t,value:100*a}}),q=e=>{let{title:t,value:a,icon:o}=e;return(0,n.jsx)(r.A,{elevation:1,sx:{height:"100%"},children:(0,n.jsxs)(s.A,{sx:{p:3,textAlign:"center"},children:[o&&(0,n.jsx)(i.default,{sx:{mb:2,display:"flex",justifyContent:"center"},children:o}),(0,n.jsx)(l.default,{variant:"h3",component:"div",sx:{mb:1,fontWeight:"bold",color:"primary.main"},children:a.toLocaleString()}),(0,n.jsx)(l.default,{variant:"body2",color:"text.secondary",children:t})]})})},F=e=>{let{filters:t}=e,[a,k]=(0,o.useState)(!0),[F,I]=(0,o.useState)(null),[T,D]=(0,o.useState)(null),[W,N]=(0,o.useState)({}),[M,z]=(0,o.useState)([]),[L,B]=(0,o.useState)(null);if((0,o.useEffect)(()=>{(async()=>{try{k(!0);let[e,a,n]=await Promise.all([(0,A.U4)(t),(0,A.Y3)(t),(0,A.dh)()]),o={};a.aggregations&&Object.entries(a.aggregations).forEach(e=>{let[t,a]=e;if(Array.isArray(a)){let{values:e,frequencies:n,labels:r}=P(a,t);o[t]={values:e,frequencies:n,labels:r,formatXAxis:e=>U(e,t)}}}),D(e),N(o),B(n);try{let e=await (0,A.AV)(t);z(R(e.aggregations))}catch(e){console.warn("Word cloud data fetch failed:",e),z([])}}catch(e){console.error("Error fetching data:",e),I(e instanceof Error?e.message:"Failed to fetch data")}finally{k(!1)}})()},[t]),a)return(0,n.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,n.jsx)(c.A,{})});if(F)return(0,n.jsx)(d.default,{maxWidth:"lg",sx:{mt:4},children:(0,n.jsx)(h.A,{severity:"error",children:F})});let G=(null==T?void 0:T.aggregations)||{},V=G.resource_type||{},K=(V.study||0)+(V.dataset||0),H=G.source||{},X=Object.keys(H).length,Y=G.keywords||{},J=Object.keys(Y).length,$=V.variable||0,Q=Object.entries(Y).map(e=>{let[t,a]=e;return{key:t,doc_count:a}}).sort((e,t)=>t.doc_count-e.doc_count).slice(0,20),Z=Object.entries(H).map(e=>{let[t,a]=e;return{key:t,doc_count:a,sourceInfo:(null==L?void 0:L[t])||null}}).sort((e,t)=>t.doc_count-e.doc_count).slice(0,4);return(0,n.jsxs)(i.default,{sx:{width:"100%"},children:[(0,n.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,n.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(q,{title:"Studies / Datasets",value:K})}),(0,n.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(q,{title:"Data Sources",value:X})}),(0,n.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(q,{title:"Topics",value:J})}),(0,n.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(q,{title:"Variables",value:$})})]}),M.length>0&&(0,n.jsx)(r.A,{elevation:1,sx:{mb:4},children:(0,n.jsxs)(s.A,{sx:{p:3},children:[(0,n.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Phrases"}),(0,n.jsx)(i.default,{sx:{height:300,width:"100%"},children:(0,n.jsx)(i.default,{sx:{width:"100%",height:"100%",position:"relative"},onClick:e=>{let t=e.target;if("text"===t.tagName||t.closest("text")){let e="text"===t.tagName?t:t.closest("text");if(e){let t=e.textContent;if(t){let e="".concat((0,C.xC)(),"/discover?query=").concat(encodeURIComponent(t));window.open(e,"_blank")}}}},onMouseOver:e=>{let t=e.target;if("text"===t.tagName||t.closest("text")){let e="text"===t.tagName?t:t.closest("text");if(e){let t=e.textContent;t&&(e.title='Click to search for "'.concat(t,'"'))}}},children:(0,n.jsx)(p.Ay,{words:M,options:O,minSize:[300,300],callbacks:{onWordClick:e=>{let t="".concat((0,C.xC)(),"/discover?query=").concat(encodeURIComponent(e.text));window.open(t,"_blank")},getWordTooltip:e=>'Click to search for "'.concat(e.text,'"')}})})})]})}),(0,n.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[Q.length>0&&(0,n.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,n.jsx)(r.A,{elevation:1,sx:{height:"100%"},children:(0,n.jsxs)(s.A,{sx:{p:3},children:[(0,n.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Topics"}),(0,n.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Q.map((e,t)=>(0,n.jsx)(g.A,{title:'Click to search for "'.concat(e.key,'"'),children:(0,n.jsx)("span",{children:(0,n.jsx)(S.A,{sx:{cursor:"pointer"},onClick:()=>{let t="".concat((0,C.xC)(),"/discover?topics=").concat(encodeURIComponent(e.key));window.open(t,"_blank")},children:e.key})})},"keyword-tooltip-".concat(t)))})]})})}),Z.length>0&&(0,n.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,n.jsx)(r.A,{elevation:1,sx:{height:"100%"},children:(0,n.jsxs)(s.A,{sx:{p:3},children:[(0,n.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Data Sources"}),(0,n.jsx)(u.Ay,{container:!0,spacing:2,children:Z.map((e,t)=>{var a,o,r;return(0,n.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(E.A,{name:(null===(a=e.sourceInfo)||void 0===a?void 0:a.name)||e.key,url:null===(o=e.sourceInfo)||void 0===o?void 0:o.url,logo:null===(r=e.sourceInfo)||void 0===r?void 0:r.logo,compact:!1})},"source-".concat(t))})})]})})})]}),W&&Object.entries(W).length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.default,{variant:"h5",component:"h2",gutterBottom:!0,sx:{mb:3,fontWeight:"bold"},children:"Distribution Analysis"}),(0,n.jsx)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:Object.entries(W).filter(e=>{let[t,a]=e;return a.values.length>0}).map(e=>{let[t,a]=e,o=a.values.map((e,t)=>({value:e,frequency:a.frequencies[t],name:a.labels&&a.labels.length?a.labels[t]:a.formatXAxis?a.formatXAxis(e):e.toString()}));return console.log("Chart data for ",t,":",o),(0,n.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,n.jsxs)(f.A,{sx:{p:3,width:"100%"},children:[(0,n.jsxs)(l.default,{variant:"h6",gutterBottom:!0,children:[t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())," ","Distribution (",o.reduce((e,t)=>e+t.frequency,0)," ","datasets)"]}),(0,n.jsx)(i.default,{sx:{width:"100%",minHeight:250},children:(0,n.jsx)(x.u,{width:"100%",aspect:2,children:(0,n.jsxs)(m.b,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[(0,n.jsx)(j.d,{strokeDasharray:"3 3"}),(0,n.jsx)(y.W,{dataKey:"value",tick:{fontSize:12},interval:"preserveStartEnd",type:"number",domain:[o[0].value,o[o.length-1].value],allowDecimals:!1,scale:"sample_size"!==t?"linear":"log",tickFormatter:e=>{let t=o.find(t=>t.value===e);return t?t.name:e.toString()}}),(0,n.jsx)(v.h,{tick:{fontSize:12},label:{value:"Frequency",angle:-90,position:"insideLeft",style:{fontSize:12}}}),(0,n.jsx)(w.m,{}),(0,n.jsx)(_.N,{type:"monotone",dataKey:"frequency",stroke:"#8884d8",strokeWidth:2,dot:!1,activeDot:{r:8}}),(0,n.jsx)(b.G,{type:"monotone",dataKey:"frequency",fill:"#8884d8",fillOpacity:.1})]})})})]})},t)})})]})]})};function I(){let[e,t]=(0,o.useState)({}),[a,r]=(0,o.useState)([]),s=function(e,t){let[a,n]=(0,o.useState)(e);return(0,o.useEffect)(()=>{let t=setTimeout(()=>{n(e)},500);return()=>{clearTimeout(t)}},[e,500]),a}(e,0);(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,A.Dd)();r(e)}catch(e){console.error("Error fetching filters:",e)}})()},[]);let c=(0,o.useCallback)((e,a)=>{t(t=>({...t,[e]:a}))},[]);return(0,n.jsxs)(d.default,{maxWidth:!1,sx:{mt:4,width:"100%",px:{xs:0,sm:2}},children:[(0,n.jsx)(i.default,{sx:{mb:4},children:(0,n.jsx)(k.A,{filtersData:a,onSelectionChange:c,selectedFilters:e})}),(0,n.jsx)(l.default,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mb:4,fontWeight:"bold"},children:"Meta Data Explorer"}),(0,n.jsx)(F,{filters:s})]})}},42649:(e,t,a)=>{"use strict";a.d(t,{AV:()=>h,Dd:()=>o,Hu:()=>r,Pn:()=>l,U4:()=>c,Y3:()=>d,dh:()=>u,v5:()=>i,w3:()=>s});let n="https://harmonydataweaviate.azureedge.net";async function o(){let e=await fetch("".concat(n,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let a=t.aggregations||{};return Object.keys(a).map(e=>({id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:Object.keys(a[e])}))}async function r(e,t){var a,o;let r,s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,c=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,g=t&&Object.keys(t).length>0;if(!e&&!g)return{results:[],aggregations:{},num_hits:0};let f=e&&""!==e.trim()?e.trim():"",p=h&&h.length>0&&!c,x=c?"search2":"search",m="".concat(n,"/discover/").concat(x);if(p){r=m;let e={query:[f],num_results:l},a=void 0!==u?u:(i-1)*l;e.offset=a,void 0!==d&&(e.alpha=d),e.top_level_ids_seen_so_far=h,t&&Object.entries(t).forEach(t=>{let[a,n]=t;n.length>0&&(e[a]=n)}),s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[f],topLevelIdsCount:h.length,offset:a,endpoint:x})}else{let e=new URLSearchParams;void 0!==d&&e.set("alpha",d.toString()),e.append("query",f);let a=void 0!==u?u:(i-1)*l;e.set("num_results",l.toString()),e.set("offset",a.toString());let n={};if(t)for(let a in t)if(a.endsWith("_min")||a.endsWith("_max")){let o=a.replace(/_(min|max)$/,"");n[o]||(n[o]={}),a.endsWith("_min")?n[o].min=t[a][0]:n[o].max=t[a][0],e.append(a,t[a][0])}else t[a].forEach(t=>{e.append(a,t)});r="".concat(m,"?").concat(e.toString()),s={method:"GET"},Object.keys(n).length>0&&console.log("Numeric range parameters:",n),console.log("Using GET request:",r)}let j=await fetch(r,s);if(!j.ok)throw console.error("Search API error:",j.status,await j.text()),Error("Search API request failed");let y=await j.json();return window.__lastSearchResponse=y,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:y.num_hits,resultCount:(null===(a=y.results)||void 0===a?void 0:a.length)||0,firstResult:null===(o=y.results)||void 0===o?void 0:o[0],aggregations:Object.keys(y.aggregations||{}),endpoint:x,method:p?"POST":"GET",hybridWeight:d}),{results:y.results||[],aggregations:y.aggregations||{},num_hits:y.num_hits,top_level_ids_seen_so_far:y.top_level_ids_seen_so_far||[],next_page_offset:y.next_page_offset}}async function s(e){let t="".concat(n,"/discover/lookup?uuid=").concat(e),a=await fetch(t);if(!a.ok)throw console.error("Failed to fetch result by UUID:",a.statusText),Error("Failed to fetch result by UUID: ".concat(a.statusText));let o=await a.json();return window.__lastLookupResponse=o,o.results[0]}async function i(e){let t=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(e)));if(!t.ok)throw Error("Failed to fetch OpenGraph data");return t.json()}async function l(){let e=await fetch("".concat(n,"/info/version"));if(!e.ok)throw console.error("Failed to fetch version info:",e.statusText),Error("Failed to fetch version info");let t=await e.json();return window.__lastVersionResponse=t,console.log("Version API response cached in window.__lastVersionResponse for debugging"),t}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,n]=e;n.length>0&&n.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(n,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch aggregate data");return a.json()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,n]=e;n.length>0&&n.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(n,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch numeric values");return a.json()}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,n]=e;n.length>0&&n.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(n,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch word cloud data");return a.json()}async function u(){let e=await fetch("".concat(n,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}}},e=>{var t=t=>e(e.s=t);e.O(0,[380,679,565,282,26,152,234,476,891,779,267,616,441,517,358],()=>t(29755)),_N_E=e.O()}]);