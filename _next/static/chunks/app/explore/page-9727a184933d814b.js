(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[314],{41234:()=>{},29755:(e,t,a)=>{Promise.resolve().then(a.bind(a,43829))},43829:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var s=a(95155),r=a(12115),i=a(68998),l=a(96854),n=a(9552),o=a(10897),d=a(35417),c=a(9561),u=a(78562),h=a(41728),f=a(58581),x=a(24817),m=a(15255),g=a(12800),y=a(66963),j=a(27112),p=a(16161),A=a(90518),w=a(42649),v=a(14030);let S={rotations:2,rotationAngles:[-90,0],fontSizes:[12,60],padding:1},b=["start_year","end_year","sample_size"],E=(e,t)=>{b.includes(t);let a=[...e].filter(e=>null!=e&&!isNaN(e));if(0===a.length)return{values:[],frequencies:[]};let s=Math.min(...a),r=Math.max(...a),i=[],l=[];if(t.includes("year")){let e=5*Math.floor(s/5),t=(5*Math.ceil(r/5)-e)/5,n=Array(t).fill(0),o=Array(t).fill(0).map((t,a)=>e+5*a);a.forEach(a=>{let s=Math.floor((a-e)/5);s>=0&&s<t&&n[s]++}),i=o,l=n}else{let e=10;t.includes("age")?e=6:t.includes("sample_size")?e=8:t.includes("duration")&&(e=5);let n=(r-s)/e,o=Array(e).fill(0),d=Array(e+1).fill(0).map((e,t)=>s+t*n);a.forEach(t=>{let a=Math.min(Math.floor((t-s)/n),e-1);o[a]++}),i=d.slice(0,-1).map((e,t)=>e+n/2),l=o}return{values:i,frequencies:l}},_=(e,t)=>t.includes("year")?e.toString():t.includes("sample_size")?"".concat(Math.round(e/1e3),"k"):(t.includes("num_")||t.includes("age")||t.includes("duration"),Math.round(e).toString());function k(){let[e,t]=(0,r.useState)(!0),[a,k]=(0,r.useState)(null),[M,C]=(0,r.useState)(null),[z,q]=(0,r.useState)({}),[O,D]=(0,r.useState)([]),[N,W]=(0,r.useState)({}),[P,X]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,w.Dd)();X(e)}catch(e){console.error("Error fetching filters:",e),k(e instanceof Error?e.message:"Failed to fetch filters")}})()},[]);let F=e=>{console.log("Raw word cloud data:",e);let t=Object.entries(e).map(e=>{let[t,a]=e;return{text:t,value:100*a}});return console.log("Transformed word cloud data:",t),t};return((0,r.useEffect)(()=>{(async()=>{try{t(!0);let[e,a,s]=await Promise.all([(0,w.U4)(N),(0,w.Y3)(N),(0,w.AV)(N)]);console.log("Word cloud API response:",s),console.log("Raw numeric data from API:",a);let r={};a.aggregations&&Object.entries(a.aggregations).forEach(e=>{let[t,a]=e;if(Array.isArray(a)){let{values:e,frequencies:s}=E(a,t);r[t]={values:e,frequencies:s,formatXAxis:e=>_(e,t)}}else console.warn("Skipping invalid numeric data for ".concat(t,":"),a)}),console.log("Processed numeric data:",r),C(e),q(r),D(F(s.aggregations))}catch(e){console.error("Error fetching data:",e),k(e instanceof Error?e.message:"Failed to fetch data")}finally{t(!1)}})()},[N]),e)?(0,s.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,s.jsx)(l.A,{})}):a?(0,s.jsx)(n.default,{maxWidth:"lg",sx:{mt:4},children:(0,s.jsx)(o.A,{severity:"error",children:a})}):(0,s.jsxs)(n.default,{maxWidth:!1,sx:{mt:4,width:"100%",px:{xs:0,sm:2}},children:[(0,s.jsx)(i.default,{sx:{mb:4},children:(0,s.jsx)(v.A,{filtersData:P,onSelectionChange:(e,t)=>{W(a=>({...a,[e]:t}))},selectedFilters:N})}),(0,s.jsxs)(d.Ay,{container:!0,spacing:4,sx:{width:"100%",margin:0},children:[(0,s.jsxs)(d.Ay,{item:!0,xs:12,sx:{width:"100%"},children:[(0,s.jsx)(c.default,{variant:"h6",gutterBottom:!0,children:"Word Cloud"}),(0,s.jsx)(i.default,{sx:{height:300,width:"100%"},children:e?(0,s.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,s.jsx)(l.A,{})}):O.length>0?(0,s.jsx)(i.default,{sx:{width:"100%",height:"100%",position:"relative"},children:(0,s.jsx)(h.Ay,{words:O,options:S,minSize:[300,300]})}):null})]}),(0,s.jsx)(d.Ay,{item:!0,xs:12,sx:{width:"100%"},children:e?(0,s.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:(0,s.jsx)(l.A,{})}):z&&Object.entries(z).length>0?(0,s.jsx)(d.Ay,{container:!0,spacing:3,sx:{width:"100%",margin:0},children:Object.entries(z).map(e=>{let[t,a]=e,r=a.values.map((e,t)=>({value:e,frequency:a.frequencies[t],name:a.formatXAxis?a.formatXAxis(e):e.toString()}));return b.includes(t)||a.values.some(e=>0===e)||(r=[{value:0,frequency:0,name:a.formatXAxis?a.formatXAxis(0):"0"},...r]),console.log("Chart data for ",t,":",r),(0,s.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,s.jsxs)(u.A,{sx:{p:3,width:"100%"},children:[(0,s.jsxs)(c.default,{variant:"h6",gutterBottom:!0,children:[t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())," ","Distribution"]}),(0,s.jsx)(i.default,{sx:{width:"100%",minHeight:250},children:(0,s.jsx)(f.u,{width:"100%",aspect:2,children:(0,s.jsxs)(x.b,{data:r,margin:{top:20,right:30,left:20,bottom:5},children:[(0,s.jsx)(m.d,{strokeDasharray:"3 3"}),(0,s.jsx)(g.W,{dataKey:"name",tick:{fontSize:12},interval:"preserveStartEnd",domain:[b.includes(t)?"dataMin":0,"dataMax"],type:"number",allowDecimals:!1,scale:"linear"}),(0,s.jsx)(y.h,{tick:{fontSize:12},label:{value:"Frequency",angle:-90,position:"insideLeft",style:{fontSize:12}}}),(0,s.jsx)(j.m,{}),(0,s.jsx)(p.N,{type:"monotone",dataKey:"frequency",stroke:"#8884d8",strokeWidth:2,dot:!1,activeDot:{r:8}}),(0,s.jsx)(A.G,{type:"monotone",dataKey:"frequency",fill:"#8884d8",fillOpacity:.1})]})})})]})},t)})}):null})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[380,679,282,65,557,155,30,441,517,358],()=>t(29755)),_N_E=e.O()}]);