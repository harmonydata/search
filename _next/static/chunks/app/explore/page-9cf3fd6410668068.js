(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[314],{41234:()=>{},29755:(e,t,a)=>{Promise.resolve().then(a.bind(a,91640))},91640:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var r=a(95155),s=a(12115),n=a(64665),o=a(42479),i=a(68998),l=a(9561),c=a(96854),d=a(9552),h=a(10897),u=a(35417),g=a(78562),f=a(41728),p=a(58581),m=a(24817),x=a(15255),j=a(12800),y=a(66963),v=a(27112),w=a(16161),_=a(90518),b=a(42649),A=a(14030),S=a(53452),k=a(65776);let E={rotations:2,rotationAngles:[-90,0],fontSizes:[12,60],padding:1},O=(e,t)=>{let a="sample_size"===t,r=[...e].filter(e=>null!=e&&!isNaN(e));if(0===r.length)return{values:[],frequencies:[],labels:[]};if(a){let e=[1e3,1e4,1e5,1e6,1e7],t=["<1k","<10k","<100k","<1m","<10m"],a=Array(t.length).fill(0);return r.forEach(t=>{for(let r=0;r<e.length;r++)if(t>(0==r?0:e[r-1])&&t<=e[r]){a[r]++;break}}),{values:e,frequencies:a,labels:t}}let s=Math.min(...r),n=Math.max(...r),o=[],i=[];if(t.includes("year")){let e=5*Math.floor(s/5),t=(5*Math.ceil(n/5)-e)/5,a=Array(t).fill(0),l=Array(t).fill(0).map((t,a)=>e+5*a);r.forEach(r=>{let s=Math.floor((r-e)/5);s>=0&&s<t&&a[s]++}),o=l,i=a}else{let e=10;t.includes("age")?e=6:t.includes("duration")&&(e=5);let a=(n-s)/e,l=Array(e).fill(0),c=Array(e+1).fill(0).map((e,t)=>s+t*a);r.forEach(t=>{let r=Math.min(Math.floor((t-s)/a),e-1);l[r]++}),o=c.slice(0,-1).map((e,t)=>e+a/2),i=l}return{values:o,frequencies:i,labels:[]}},P=(e,t)=>"string"==typeof e?e:t.includes("year")?e.toString():(t.includes("num_")||t.includes("age")||t.includes("duration"),Math.round(e).toString()),F=e=>Object.entries(e).map(e=>{let[t,a]=e;return{text:t,value:100*a}}),D=e=>{let{title:t,value:a,icon:s}=e;return(0,r.jsx)(n.A,{elevation:1,sx:{height:"100%"},children:(0,r.jsxs)(o.A,{sx:{p:3,textAlign:"center"},children:[s&&(0,r.jsx)(i.default,{sx:{mb:2,display:"flex",justifyContent:"center"},children:s}),(0,r.jsx)(l.default,{variant:"h3",component:"div",sx:{mb:1,fontWeight:"bold",color:"primary.main"},children:a.toLocaleString()}),(0,r.jsx)(l.default,{variant:"body2",color:"text.secondary",children:t})]})})},T=e=>{let{filters:t}=e,[a,A]=(0,s.useState)(!0),[T,U]=(0,s.useState)(null),[q,C]=(0,s.useState)(null),[R,I]=(0,s.useState)({}),[W,z]=(0,s.useState)([]),[L,M]=(0,s.useState)(null);if((0,s.useEffect)(()=>{(async()=>{try{A(!0);let[e,a,r]=await Promise.all([(0,b.U4)(t),(0,b.Y3)(t),(0,b.dh)()]),s={};a.aggregations&&Object.entries(a.aggregations).forEach(e=>{let[t,a]=e;if(Array.isArray(a)){let{values:e,frequencies:r,labels:n}=O(a,t);s[t]={values:e,frequencies:r,labels:n,formatXAxis:e=>P(e,t)}}}),C(e),I(s),M(r);try{let e=await (0,b.AV)(t);z(F(e.aggregations))}catch(e){console.warn("Word cloud data fetch failed:",e),z([])}}catch(e){console.error("Error fetching data:",e),U(e instanceof Error?e.message:"Failed to fetch data")}finally{A(!1)}})()},[t]),a)return(0,r.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,r.jsx)(c.A,{})});if(T)return(0,r.jsx)(d.default,{maxWidth:"lg",sx:{mt:4},children:(0,r.jsx)(h.A,{severity:"error",children:T})});let N=(null==q?void 0:q.aggregations)||{},B=N.resource_type||{},G=(B.study||0)+(B.dataset||0),V=N.source||{},K=Object.keys(V).length,H=N.keywords||{},X=Object.keys(H).length,Y=B.variable||0,J=Object.entries(H).map(e=>{let[t,a]=e;return{key:t,doc_count:a}}).sort((e,t)=>t.doc_count-e.doc_count).slice(0,20),$=Object.entries(V).map(e=>{let[t,a]=e;return{key:t,doc_count:a,sourceInfo:(null==L?void 0:L[t])||null}}).sort((e,t)=>t.doc_count-e.doc_count).slice(0,4);return(0,r.jsxs)(i.default,{sx:{width:"100%"},children:[(0,r.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,r.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(D,{title:"Studies / Datasets",value:G})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(D,{title:"Data Sources",value:K})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(D,{title:"Topics",value:X})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(D,{title:"Variables",value:Y})})]}),W.length>0&&(0,r.jsx)(n.A,{elevation:1,sx:{mb:4},children:(0,r.jsxs)(o.A,{sx:{p:3},children:[(0,r.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Phrases"}),(0,r.jsx)(i.default,{sx:{height:300,width:"100%"},children:(0,r.jsx)(i.default,{sx:{width:"100%",height:"100%",position:"relative"},children:(0,r.jsx)(f.Ay,{words:W,options:E,minSize:[300,300]})})})]})}),(0,r.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[J.length>0&&(0,r.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(n.A,{elevation:1,sx:{height:"100%"},children:(0,r.jsxs)(o.A,{sx:{p:3},children:[(0,r.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Topics"}),(0,r.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:J.map((e,t)=>(0,r.jsx)(S.A,{sx:{cursor:"default"},children:e.key},"keyword-".concat(t)))})]})})}),$.length>0&&(0,r.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(n.A,{elevation:1,sx:{height:"100%"},children:(0,r.jsxs)(o.A,{sx:{p:3},children:[(0,r.jsx)(l.default,{variant:"h6",gutterBottom:!0,children:"Popular Data Sources"}),(0,r.jsx)(u.Ay,{container:!0,spacing:2,children:$.map((e,t)=>{var a,s,n;return(0,r.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,r.jsx)(k.A,{name:(null===(a=e.sourceInfo)||void 0===a?void 0:a.name)||e.key,url:null===(s=e.sourceInfo)||void 0===s?void 0:s.url,logo:null===(n=e.sourceInfo)||void 0===n?void 0:n.logo,compact:!1})},"source-".concat(t))})})]})})})]}),R&&Object.entries(R).length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{variant:"h5",component:"h2",gutterBottom:!0,sx:{mb:3,fontWeight:"bold"},children:"Distribution Analysis"}),(0,r.jsx)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:Object.entries(R).filter(e=>{let[t,a]=e;return a.values.length>0}).map(e=>{let[t,a]=e,s=a.values.map((e,t)=>({value:e,frequency:a.frequencies[t],name:a.labels&&a.labels.length?a.labels[t]:a.formatXAxis?a.formatXAxis(e):e.toString()}));return console.log("Chart data for ",t,":",s),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,r.jsxs)(g.A,{sx:{p:3,width:"100%"},children:[(0,r.jsxs)(l.default,{variant:"h6",gutterBottom:!0,children:[t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())," ","Distribution (",s.reduce((e,t)=>e+t.frequency,0)," ","datasets)"]}),(0,r.jsx)(i.default,{sx:{width:"100%",minHeight:250},children:(0,r.jsx)(p.u,{width:"100%",aspect:2,children:(0,r.jsxs)(m.b,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[(0,r.jsx)(x.d,{strokeDasharray:"3 3"}),(0,r.jsx)(j.W,{dataKey:"value",tick:{fontSize:12},interval:"preserveStartEnd",type:"number",domain:[s[0].value,s[s.length-1].value],allowDecimals:!1,scale:"sample_size"!==t?"linear":"log",tickFormatter:e=>{let t=s.find(t=>t.value===e);return t?t.name:e.toString()}}),(0,r.jsx)(y.h,{tick:{fontSize:12},label:{value:"Frequency",angle:-90,position:"insideLeft",style:{fontSize:12}}}),(0,r.jsx)(v.m,{}),(0,r.jsx)(w.N,{type:"monotone",dataKey:"frequency",stroke:"#8884d8",strokeWidth:2,dot:!1,activeDot:{r:8}}),(0,r.jsx)(_.G,{type:"monotone",dataKey:"frequency",fill:"#8884d8",fillOpacity:.1})]})})})]})},t)})})]})]})};function U(){let[e,t]=(0,s.useState)({}),[a,n]=(0,s.useState)([]),o=function(e,t){let[a,r]=(0,s.useState)(e);return(0,s.useEffect)(()=>{let t=setTimeout(()=>{r(e)},500);return()=>{clearTimeout(t)}},[e,500]),a}(e,0);(0,s.useEffect)(()=>{(async()=>{try{let e=await (0,b.Dd)();n(e)}catch(e){console.error("Error fetching filters:",e)}})()},[]);let c=(0,s.useCallback)((e,a)=>{t(t=>({...t,[e]:a}))},[]);return(0,r.jsxs)(d.default,{maxWidth:!1,sx:{mt:4,width:"100%",px:{xs:0,sm:2}},children:[(0,r.jsx)(i.default,{sx:{mb:4},children:(0,r.jsx)(A.A,{filtersData:a,onSelectionChange:c,selectedFilters:e})}),(0,r.jsx)(l.default,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mb:4,fontWeight:"bold"},children:"Meta Data Explorer"}),(0,r.jsx)(T,{filters:o})]})}},42649:(e,t,a)=>{"use strict";a.d(t,{AV:()=>h,Dd:()=>s,Hu:()=>n,Pn:()=>l,U4:()=>c,Y3:()=>d,dh:()=>u,v5:()=>i,w3:()=>o});let r="https://harmonydataweaviate.azureedge.net";async function s(){let e=await fetch("".concat(r,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let a=t.aggregations||{};return Object.keys(a).map(e=>({id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:Object.keys(a[e])}))}async function n(e,t){var a,s;let n,o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,c=!(arguments.length>4)||void 0===arguments[4]||arguments[4],d=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,g=t&&Object.keys(t).length>0;if(!e&&!g)return{results:[],aggregations:{},num_hits:0};let f=e&&""!==e.trim()?e.trim():"",p=h&&h.length>0&&!c,m=c?"search2":"search",x="".concat(r,"/discover/").concat(m);if(p){n=x;let e={query:[f],num_results:l},a=void 0!==u?u:(i-1)*l;e.offset=a,void 0!==d&&(e.alpha=d),e.top_level_ids_seen_so_far=h,t&&Object.entries(t).forEach(t=>{let[a,r]=t;r.length>0&&(e[a]=r)}),o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[f],topLevelIdsCount:h.length,offset:a,endpoint:m})}else{let e=new URLSearchParams;void 0!==d&&e.set("alpha",d.toString()),e.append("query",f);let a=void 0!==u?u:(i-1)*l;e.set("num_results",l.toString()),e.set("offset",a.toString());let r={};if(t)for(let a in t)if(a.endsWith("_min")||a.endsWith("_max")){let s=a.replace(/_(min|max)$/,"");r[s]||(r[s]={}),a.endsWith("_min")?r[s].min=t[a][0]:r[s].max=t[a][0],e.append(a,t[a][0])}else t[a].forEach(t=>{e.append(a,t)});n="".concat(x,"?").concat(e.toString()),o={method:"GET"},Object.keys(r).length>0&&console.log("Numeric range parameters:",r),console.log("Using GET request:",n)}let j=await fetch(n,o);if(!j.ok)throw console.error("Search API error:",j.status,await j.text()),Error("Search API request failed");let y=await j.json();return window.__lastSearchResponse=y,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:y.num_hits,resultCount:(null===(a=y.results)||void 0===a?void 0:a.length)||0,firstResult:null===(s=y.results)||void 0===s?void 0:s[0],aggregations:Object.keys(y.aggregations||{}),endpoint:m,method:p?"POST":"GET",hybridWeight:d}),{results:y.results||[],aggregations:y.aggregations||{},num_hits:y.num_hits,top_level_ids_seen_so_far:y.top_level_ids_seen_so_far||[],next_page_offset:y.next_page_offset}}async function o(e){let t="".concat(r,"/discover/lookup?uuid=").concat(e),a=await fetch(t);if(!a.ok)throw console.error("Failed to fetch result by UUID:",a.statusText),Error("Failed to fetch result by UUID: ".concat(a.statusText));let s=await a.json();return window.__lastLookupResponse=s,s.results[0]}async function i(e){let t=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(e)));if(!t.ok)throw Error("Failed to fetch OpenGraph data");return t.json()}async function l(){let e=await fetch("".concat(r,"/info/version"));if(!e.ok)throw console.error("Failed to fetch version info:",e.statusText),Error("Failed to fetch version info");let t=await e.json();return window.__lastVersionResponse=t,console.log("Version API response cached in window.__lastVersionResponse for debugging"),t}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,r]=e;r.length>0&&r.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(r,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch aggregate data");return a.json()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,r]=e;r.length>0&&r.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(r,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch numeric values");return a.json()}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,r]=e;r.length>0&&r.forEach(e=>{t.append(a,e)})});let a=await fetch("".concat(r,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!a.ok)throw Error("Failed to fetch word cloud data");return a.json()}async function u(){let e=await fetch("".concat(r,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}}},e=>{var t=t=>e(e.s=t);e.O(0,[380,679,565,282,26,152,234,476,891,779,267,616,441,517,358],()=>t(29755)),_N_E=e.O()}]);