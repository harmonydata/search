(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9079],{70460:(e,r,o)=>{Promise.resolve().then(o.bind(o,56232))},56232:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>q});var a=o(95155),s=o(12115),t=o(35761),i=o(55295),l=o(68998),n=o(9561),c=o(64665),d=o(96854),h=o(10897),u=o(35417),x=o(70152),v=o(70503),m=o(22678),p=o(90507),j=o(90847),g=o(91888),y=o(90662),A=o(28222),b=o(49234),f=o(65330),w=o(72926),C=o(22282),z=o(42479),k=o(32645),S=o(20687),D=o(35524),I=o(26848),_=o(7893),E=o(96152),M=o(10683),L=o(63612),H=o(76046),P=o(44315),B=o(54615),N=o(73179),U=o(44766),F=o(3485),G=o(5565);let O=e=>{let r=e.variablesCount||0,o=r>0?Array(r).fill({name:"Variable"}):[];return{extra_data:{uuid:e.uuid,slug:e.slug,resource_type:e.resourceType,name:e.title,description:e.description,keywords:e.keywords||[],number_of_variables:r},dataset_schema:{name:e.title,description:e.description,keywords:e.keywords||[],number_of_variables:r,variableMeasured:o,includedInDataCatalog:e.hasDataAvailable?[{}]:[]},child_datasets:Array(e.datasetsCount||0).fill({}),hasFreeAccess:e.hasFreeAccess||!1,hasCohortsAvailable:e.hasCohortsAvailable||!1,thumbnail:e.image}};function q(){let{currentUser:e}=(0,M.A)(),{loadSearchFromSaved:r,updateSearchSettings:o}=(0,L.S)(),q=(0,H.useRouter)(),T=(0,t.A)(),W=(0,i.A)(T.breakpoints.down("sm")),[R,J]=(0,s.useState)([]),[V,Y]=(0,s.useState)([]),[K,Q]=(0,s.useState)([]),[X,Z]=(0,s.useState)([]),[$,ee]=(0,s.useState)(!0),[er,eo]=(0,s.useState)(null),[ea,es]=(0,s.useState)(""),[et,ei]=(0,s.useState)("all"),el=async()=>{if(e)try{let r=(0,B.P)((0,B.rJ)(N.db,"harmonisations"),(0,B._M)("uid","==",e.uid),(0,B.My)("created","desc"),(0,B.AB)(50)),o=await (0,B.GG)(r),a=[];o.forEach(e=>{a.push({id:e.id,...e.data()})}),J(a)}catch(e){console.error("Error loading harmonizations:",e),eo("Failed to load harmonizations")}},en=async()=>{try{let e=(0,B.P)((0,B.rJ)(N.db,"harmonisations"),(0,B._M)("public","==",!0),(0,B.My)("lastAccessed","desc"),(0,B.AB)(10)),r=await (0,B.GG)(e),o=[];r.forEach(e=>{o.push({id:e.id,...e.data()})}),Y(o)}catch(e){console.error("Error loading recent public harmonizations:",e)}},ec=async()=>{if(e)try{let r=(0,B.P)((0,B.rJ)(N.db,"saved_searches"),(0,B._M)("uid","==",e.uid),(0,B.My)("created","desc"),(0,B.AB)(50)),o=await (0,B.GG)(r),a=[];o.forEach(e=>{a.push({id:e.id,...e.data()})}),Q(a)}catch(e){console.error("Error loading saved searches:",e)}},ed=async()=>{if(e)try{let r=(0,B.P)((0,B.rJ)(N.db,"saved_resources"),(0,B._M)("uid","==",e.uid),(0,B.My)("created","desc"),(0,B.AB)(50)),o=await (0,B.GG)(r),a=[];o.forEach(e=>{a.push({id:e.id,...e.data()})}),Z(a)}catch(e){console.error("Error loading saved resources:",e)}};(0,s.useEffect)(()=>{let r=async()=>{ee(!0),eo(null),await Promise.all([el(),en(),ec(),ed()]),ee(!1)};e?r():ee(!1)},[e]);let eh=async e=>{try{await (0,B.kd)((0,B.H9)(N.db,"saved_searches",e)),Q(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Error deleting saved search:",e)}},eu=async e=>{try{await (0,B.kd)((0,B.H9)(N.db,"saved_resources",e)),Z(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Error deleting saved resource:",e)}},ex=async e=>{try{await (0,B.kd)((0,B.H9)(N.db,"harmonisations",e)),J(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Error deleting harmonization:",e)}},ev=e=>{o({query:e.query,selectedFilters:e.filters||{},useSearch2:e.useSearch2||!1,hybridWeight:e.hybridWeight||.5,maxDistance:e.maxDistance||.4,selectedCategory:e.selectedCategory||null}),q.push("/discover")},em=e=>e.filter(e=>{var r,o;let a=(null===(o=e.apiData)||void 0===o?void 0:null===(r=o.instruments)||void 0===r?void 0:r.map(e=>e.name).filter(Boolean))||[],s=(a.length>0?a.join(" with "):"Untitled Harmonization").toLowerCase().includes(ea.toLowerCase()),t="all"===et||"harmonisation"===et;return s&&t}),ep=e=>e.filter(e=>{var r,o;let a=(null===(o=e.apiData)||void 0===o?void 0:null===(r=o.instruments)||void 0===r?void 0:r.map(e=>e.name).filter(Boolean))||[],s=(a.length>0?a.join(" with "):"Untitled Harmonization").toLowerCase().includes(ea.toLowerCase()),t="all"===et||"harmonisation"===et;return s&&t}),ej=e=>e.filter(e=>{let r=e.query.toLowerCase().includes(ea.toLowerCase()),o="all"===et||"search"===et;return r&&o}),eg=e=>e.filter(e=>{let r=e.title.toLowerCase().includes(ea.toLowerCase()),o="all"===et||"resource"===et;return r&&o});return e?$?(0,a.jsx)(l.default,{sx:{p:3,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:(0,a.jsx)(d.A,{})}):(0,a.jsxs)(l.default,{sx:{p:3},children:[(0,a.jsx)(n.A,{variant:"h4",gutterBottom:!0,children:"My Saves"}),(0,a.jsx)(n.A,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Manage your saved harmonizations, searches, and resources."}),er&&(0,a.jsx)(h.A,{severity:"error",sx:{mb:3},children:er}),(0,a.jsx)(l.default,{sx:{mb:3},children:(0,a.jsxs)(u.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,a.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,a.jsx)(x.A,{fullWidth:!0,placeholder:"Search saved items...",value:ea,onChange:e=>es(e.target.value),InputProps:{endAdornment:(0,a.jsx)(v.A,{position:"end",children:(0,a.jsx)(G.default,{src:(0,F.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20})}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}})}),(0,a.jsx)(u.Ay,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(m.A,{fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"Type"}),(0,a.jsxs)(j.A,{value:et,onChange:e=>ei(e.target.value),label:"Type",children:[(0,a.jsx)(g.A,{value:"all",children:"All Types"}),(0,a.jsx)(g.A,{value:"harmonisation",children:"Harmonizations"}),(0,a.jsx)(g.A,{value:"search",children:"Searches"}),(0,a.jsx)(g.A,{value:"resource",children:"Resources"})]})]})})]})}),(0,a.jsxs)(y.A,{defaultExpanded:!0,sx:{mb:2},children:[(0,a.jsx)(A.A,{expandIcon:(0,a.jsx)(k.A,{size:20}),sx:{bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(S.A,{size:20}),(0,a.jsx)(n.A,{variant:"h6",children:"Saved Resources"}),(0,a.jsx)(b.A,{label:eg(X).length,size:"small"})]})}),(0,a.jsx)(f.A,{children:(()=>{let e=eg(X);return 0===X.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No resources saved yet. Save studies and datasets from the discovery page to see them here."}):0===e.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No resources match your search criteria."}):(0,a.jsx)(l.default,{children:e.map(e=>{let r=O(e);return(0,a.jsxs)(l.default,{sx:{position:"relative",mb:2},children:[(0,a.jsx)(P.A,{result:r,onClick:()=>{let r;let o="study"===e.resourceType?"studies":"items";"studies"===o?r=e.slug:(r=e.slug||e.uuid,e.slug&&e.slug.length>220&&(r=e.uuid));let a="".concat((0,F.xC)()).concat(o,"/").concat(r);window.location.href=a}}),(0,a.jsx)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:1},children:(0,a.jsx)(w.A,{title:"Delete",children:(0,a.jsx)(C.A,{variant:"outlined",size:"small",onClick:r=>{r.stopPropagation(),eu(e.id)},startIcon:(0,a.jsx)(D.A,{size:16}),sx:{backgroundColor:"rgba(255, 255, 255, 0.9)",color:"error.main",borderColor:"error.main","&:hover":{backgroundColor:"error.main",color:"white"}},children:!W&&"Delete"})})})]},e.id)})})})()})]}),(0,a.jsxs)(y.A,{sx:{mb:2},children:[(0,a.jsx)(A.A,{expandIcon:(0,a.jsx)(k.A,{size:20}),sx:{bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(I.A,{size:20}),(0,a.jsx)(n.A,{variant:"h6",children:"Recent Public Harmonizations"}),(0,a.jsx)(b.A,{label:em(V).length,size:"small"})]})}),(0,a.jsx)(f.A,{children:(()=>{let e=em(V);return 0===e.length?(0,a.jsx)(n.A,{color:"text.secondary",children:0===V.length?"No recent public harmonizations found.":"No harmonizations match your search criteria."}):(0,a.jsx)(l.default,{children:e.map(e=>{var r,o,s,t,i,d,h,u;let x=(null===(o=e.apiData)||void 0===o?void 0:null===(r=o.instruments)||void 0===r?void 0:r.map(e=>e.name).filter(Boolean))||[],v=x.length>0?x.join(" with "):"Untitled Harmonization";return(0,a.jsxs)(l.default,{sx:{position:"relative",mb:2},children:[(0,a.jsx)(w.A,{title:"Click to view in Harmony",children:(0,a.jsx)(c.A,{sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},p:2},onClick:()=>{window.location.href=(0,U.F_)(e.id)},children:(0,a.jsxs)(z.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,a.jsx)(I.A,{size:16,color:"#4caf50"}),(0,a.jsx)(n.A,{variant:"h6",sx:{flex:1},children:v})]}),(0,a.jsxs)(n.A,{variant:"body2",color:"text.secondary",children:["Last accessed:"," ",(null===(i=e.lastAccessed)||void 0===i?void 0:null===(t=i.toDate)||void 0===t?void 0:null===(s=t.call(i))||void 0===s?void 0:s.toLocaleDateString())||"Unknown"," • Created: ",(null===(u=e.created)||void 0===u?void 0:null===(h=u.toDate)||void 0===h?void 0:null===(d=h.call(u))||void 0===d?void 0:d.toLocaleDateString())||"Unknown"]})]})})}),(0,a.jsx)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:1},children:(0,a.jsx)(w.A,{title:"Delete",children:(0,a.jsx)(C.A,{variant:"outlined",size:"small",onClick:r=>{r.stopPropagation(),ex(e.id)},startIcon:(0,a.jsx)(D.A,{size:16}),sx:{backgroundColor:"rgba(255, 255, 255, 0.9)",color:"error.main",borderColor:"error.main","&:hover":{backgroundColor:"error.main",color:"white"}},children:!W&&"Delete"})})})]},e.id)})})})()})]}),(0,a.jsxs)(y.A,{sx:{mb:2},children:[(0,a.jsx)(A.A,{expandIcon:(0,a.jsx)(k.A,{size:20}),sx:{bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(_.A,{size:20}),(0,a.jsx)(n.A,{variant:"h6",children:"My Harmonizations"}),(0,a.jsx)(b.A,{label:ep(R).length,size:"small"})]})}),(0,a.jsx)(f.A,{children:(()=>{let e=ep(R);return 0===R.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No harmonizations saved yet. Create some harmonizations in the Harmony app to see them here."}):0===e.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No harmonizations match your search criteria."}):(0,a.jsx)(l.default,{children:e.map(e=>{var r,o,s,t,i,d,h,u,x,v;let m=(null===(o=e.apiData)||void 0===o?void 0:null===(r=o.instruments)||void 0===r?void 0:r.map(e=>e.name).filter(Boolean))||[],p=m.length>0?m.join(" with "):"Untitled Harmonization",j=(null===(t=e.apiData)||void 0===t?void 0:null===(s=t.instruments)||void 0===s?void 0:s.reduce((e,r)=>{var o;return e+((null===(o=r.questions)||void 0===o?void 0:o.length)||0)},0))||0;return(0,a.jsxs)(l.default,{sx:{position:"relative",mb:2},children:[(0,a.jsx)(w.A,{title:"Click to view in Harmony",children:(0,a.jsx)(c.A,{sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},p:2},onClick:()=>{window.location.href=(0,U.F_)(e.id)},children:(0,a.jsxs)(z.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.public?(0,a.jsx)(I.A,{size:16,color:"#4caf50"}):(0,a.jsx)(E.A,{size:16,color:"#666"}),(0,a.jsx)(n.A,{variant:"h6",sx:{flex:1},children:p})]}),(0,a.jsxs)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Created:"," ",(null===(h=e.created)||void 0===h?void 0:null===(d=h.toDate)||void 0===d?void 0:null===(i=d.call(h))||void 0===i?void 0:i.toLocaleDateString())||"Unknown",e.lastAccessed&&(0,a.jsxs)(a.Fragment,{children:[" • Last accessed: ",(null===(v=e.lastAccessed)||void 0===v?void 0:null===(x=v.toDate)||void 0===x?void 0:null===(u=x.call(v))||void 0===u?void 0:u.toLocaleDateString())||"Unknown"]})]}),j>0&&(0,a.jsxs)(n.A,{variant:"body2",color:"text.secondary",children:[j," questions harmonized"]})]})})}),(0,a.jsx)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:1},children:(0,a.jsx)(w.A,{title:"Delete",children:(0,a.jsx)(C.A,{variant:"outlined",size:"small",onClick:r=>{r.stopPropagation(),ex(e.id)},startIcon:(0,a.jsx)(D.A,{size:16}),sx:{backgroundColor:"rgba(255, 255, 255, 0.9)",color:"error.main",borderColor:"error.main","&:hover":{backgroundColor:"error.main",color:"white"}},children:!W&&"Delete"})})})]},e.id)})})})()})]}),(0,a.jsxs)(y.A,{sx:{mb:2},children:[(0,a.jsx)(A.A,{expandIcon:(0,a.jsx)(k.A,{size:20}),sx:{bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(G.default,{src:(0,F.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20}),(0,a.jsx)(n.A,{variant:"h6",children:"Saved Searches"}),(0,a.jsx)(b.A,{label:ej(K).length,size:"small"})]})}),(0,a.jsx)(f.A,{children:(()=>{let e=ej(K);return 0===K.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No searches saved yet. Save searches from the discovery page to see them here."}):0===e.length?(0,a.jsx)(n.A,{color:"text.secondary",children:"No searches match your search criteria."}):(0,a.jsx)(l.default,{children:e.map(e=>{var r,o,s;let t=e.filters?Object.entries(e.filters):[],i=t.slice(0,5);return(0,a.jsxs)(l.default,{sx:{position:"relative",mb:2},children:[(0,a.jsx)(w.A,{title:"Click to re-run search",children:(0,a.jsx)(c.A,{sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},p:2},onClick:()=>ev(e),children:(0,a.jsxs)(z.A,{sx:{p:2,"&:last-child":{pb:2}},children:[(0,a.jsx)(n.A,{variant:"h6",sx:{mb:1},children:e.query}),(0,a.jsxs)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.resultCount," results • Saved:"," ",(null===(s=e.created)||void 0===s?void 0:null===(o=s.toDate)||void 0===o?void 0:null===(r=o.call(s))||void 0===r?void 0:r.toLocaleDateString())||"Unknown"]}),i.length>0&&(0,a.jsxs)(l.default,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:[i.map(e=>{let[r,o]=e;return(0,a.jsx)(b.A,{label:"".concat(r,": ").concat(Array.isArray(o)?o.join(", "):o),size:"small",variant:"outlined",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"}}},r)}),t.length>5&&(0,a.jsx)(b.A,{label:"+".concat(t.length-5," more"),size:"small",variant:"outlined",sx:{fontSize:"0.75rem",color:"text.secondary"}})]})]})})}),(0,a.jsx)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:1},children:(0,a.jsx)(w.A,{title:"Delete",children:(0,a.jsx)(C.A,{variant:"outlined",size:"small",onClick:r=>{r.stopPropagation(),eh(e.id)},startIcon:(0,a.jsx)(D.A,{size:16}),sx:{backgroundColor:"rgba(255, 255, 255, 0.9)",color:"error.main",borderColor:"error.main","&:hover":{backgroundColor:"error.main",color:"white"}},children:!W&&"Delete"})})})]},e.id)})})})()})]})]}):(0,a.jsxs)(l.default,{sx:{p:3},children:[(0,a.jsx)(n.A,{variant:"h4",gutterBottom:!0,children:"My Saves"}),(0,a.jsx)(n.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This feature allows you to manage your saved harmonizations, searches, and resources from your research."}),(0,a.jsxs)(c.A,{sx:{maxWidth:600,mx:"auto",p:3},children:[(0,a.jsx)(n.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Sign in to Access Your Saves"}),(0,a.jsx)(n.A,{variant:"body1",sx:{mb:2},children:"This feature only works if you login. It only takes a moment to create an account and allows you to save your research results for future access."}),(0,a.jsx)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"By signing in, you can:"}),(0,a.jsxs)(l.default,{component:"ul",sx:{textAlign:"left",mb:3},children:[(0,a.jsx)(n.A,{component:"li",variant:"body2",sx:{mb:1},children:"Save research studies and harmonisations"}),(0,a.jsx)(n.A,{component:"li",variant:"body2",sx:{mb:1},children:"Save your search queries and results"}),(0,a.jsx)(n.A,{component:"li",variant:"body2",sx:{mb:1},children:"Access your saved items across sessions"}),(0,a.jsx)(n.A,{component:"li",variant:"body2",sx:{mb:1},children:"Organize and manage your research collection"})]}),(0,a.jsxs)(n.A,{variant:"body2",color:"text.secondary",children:["We respect your privacy. Please review our"," ",(0,a.jsx)("a",{href:"https://harmonydata.ac.uk/privacy-policy",target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:"privacy policy"})," ","to understand how we handle your data."]})]})]})}},44766:(e,r,o)=>{"use strict";o.d(r,{C4:()=>a,F_:()=>t,ud:()=>s});let a=()=>"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000":window.location.origin,s=()=>("localhost"===window.location.hostname||window.location.hostname,"/app/"),t=e=>"".concat(a()).concat(s(),"#/model/").concat(e)}},e=>{var r=r=>e(e.s=r);e.O(0,[2992,9895,2154,6586,4889,1057,2282,9234,9141,2926,5733,5779,3340,511,4315,8441,1517,7358],()=>r(70460)),_N_E=e.O()}]);