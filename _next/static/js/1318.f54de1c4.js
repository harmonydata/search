"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1318],{91318:(e,t,i)=>{i.r(t),i.d(t,{default:()=>es});var r=i(95155),a=i(12115),l=i(35761),n=i(55295),s=i(68998),o=i(9552),c=i(9561),d=i(70152),u=i(22282),h=i(47821),x=i(19579),m=i(6327),g=i(72107),f=i(5565),y=i(10979),p=i(98245);function v(e){let{results:t,resourceTypeFilter:i,onSelectResult:a,selectedResultId:l,onFindSimilar:n,collapsed:o=!1,hasActiveSearch:d=!1}=e,u=i&&i.length>0?t.filter(e=>{var t,r;return(null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)&&i.map(e=>e.trim().toLowerCase()).includes(null===(r=e.extra_data)||void 0===r?void 0:r.resource_type.trim().toLowerCase())}):t,h=e=>{a&&a(e)};return u.length?(0,r.jsx)(s.default,{children:(0,r.jsx)(y.A,{spacing:1.5,sx:{mb:4},children:u.map((e,t)=>{var i,a;let s=l===(null===(i=e.extra_data)||void 0===i?void 0:i.uuid);return(0,r.jsx)(p.A,{result:e,isSelected:s,onClick:()=>h(e),onFindSimilar:n},(null===(a=e.extra_data)||void 0===a?void 0:a.uuid)||"result-".concat(t))})})}):(0,r.jsx)(s.default,{sx:{textAlign:"center",py:8,maxWidth:600,mx:"auto"},children:d?(0,r.jsxs)(s.default,{children:[(0,r.jsx)(c.A,{variant:"h5",color:"text.primary",gutterBottom:!0,children:"No results found"}),(0,r.jsx)(c.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"We couldn't find any studies matching your search criteria."}),(0,r.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Try adjusting your search terms, removing some filters, or broadening your criteria to find more results."})]}):(0,r.jsxs)(s.default,{sx:{textAlign:"center",py:8,maxWidth:600,mx:"auto"},children:[(0,r.jsx)(c.A,{variant:"h5",color:"text.primary",gutterBottom:!0,children:"No Results"}),(0,r.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Enter a search term or apply filters to find studies."})]})})}var b=i(14030),j=i(77626),_=i(72926),A=i(70424),S=i(66917),w=i(48139),C=i(30762);function k(e){let{onSubmitFeedback:t}=e,[i,l]=(0,a.useState)(null),[n,o]=(0,a.useState)(null),[x,g]=(0,a.useState)(""),[f,p]=(0,a.useState)(!1),v=()=>{l(null),o(null),g("")},b=async()=>{if(n){p(!0);try{await (null==t?void 0:t(n,x)),v()}catch(e){console.error("Error submitting feedback:",e)}finally{p(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.A,{title:"Give feedback",placement:"left",children:(0,r.jsx)(A.A,{color:"primary",size:"small",onClick:e=>{l(e.currentTarget)},sx:{position:"fixed",bottom:0,right:0,zIndex:1e3,boxShadow:3,borderRadius:"4px 0 0 0"},children:(0,r.jsx)(C.A,{})})}),(0,r.jsx)(S.Ay,{open:!!i,anchorEl:i,onClose:v,anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"center",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:2,boxShadow:3}},children:(0,r.jsxs)(s.default,{sx:{p:3,minWidth:300},children:[(0,r.jsxs)(s.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,r.jsx)(c.A,{variant:"h6",component:"h2",children:"Share your feedback"}),(0,r.jsx)(h.A,{size:"small",onClick:v,children:(0,r.jsx)(m.A,{})})]}),(0,r.jsxs)(y.A,{spacing:2,children:[(0,r.jsxs)(s.default,{children:[(0,r.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"How would you rate your experience?"}),(0,r.jsx)(w.A,{name:"feedback-rating",value:n,onChange:(e,t)=>{o(t)},size:"large"})]}),(0,r.jsx)(d.A,{multiline:!0,rows:3,placeholder:"Tell us what you think... (optional)",value:x,onChange:e=>g(e.target.value),variant:"outlined",size:"small",fullWidth:!0}),(0,r.jsxs)(s.default,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,r.jsx)(u.A,{size:"small",onClick:v,children:"Cancel"}),(0,r.jsx)(u.A,{variant:"contained",size:"small",onClick:b,disabled:!n||f,children:f?"Submitting...":"Submit"})]})]})]})})]})}var D=i(66656);let W=["Why are more children obese now?","What factors influence mental health in teenagers?","How does income affect educational outcomes?"];function F(e){let{title:t="Discover Research Studies",subtitle:i="Search or filter to begin",onExampleClick:a}=e;return(0,r.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",minHeight:200,p:4,borderRadius:4,background:"linear-gradient(135deg, #27EDB9 0%, #2E5FFF 100%)",boxShadow:"0 8px 32px rgba(46, 95, 255, 0.15)",mb:4},children:[(0,r.jsx)(c.A,{variant:"h4",sx:{color:"white",fontWeight:600,textAlign:"center",mb:2,textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:t}),(0,r.jsx)(c.A,{variant:"h6",sx:{color:"white",fontWeight:400,textAlign:"center",opacity:.9,textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",mb:3},children:i}),(0,r.jsxs)(s.default,{sx:{mt:2,textAlign:"center",maxWidth:600},children:[(0,r.jsx)(c.A,{variant:"body1",sx:{color:"white",fontWeight:400,textAlign:"center",opacity:.95,textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)",mb:2},children:"Harmony understands the meaning of your query so you can search for things like:"}),(0,r.jsx)(s.default,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"center"},children:W.map((e,t)=>(0,r.jsx)(D.A,{onClick:t=>{t.preventDefault(),a&&a(e)},sx:{color:"white",textDecoration:"underline",textDecorationColor:"rgba(255, 255, 255, 0.6)",textUnderlineOffset:4,cursor:"pointer",fontWeight:500,"&:hover":{textDecorationColor:"white",opacity:1},transition:"all 0.2s ease"},children:e},t))})]})]})}var R=i(42649);let I=null,E=async()=>{if(I)return I;console.log("\uD83D\uDD0D Loading Firebase modules dynamically for feedback");let[{collection:e,addDoc:t,serverTimestamp:r},{db:a}]=await Promise.all([Promise.resolve().then(i.bind(i,54615)),Promise.resolve().then(i.bind(i,73179))]);return I={collection:e,addDoc:t,serverTimestamp:r,db:a}},z=async(e,t)=>{try{let{db:i,collection:r,addDoc:a,serverTimestamp:l}=await E(),n={uid:"anon",rating:e,comment:t||"",created:l(),source:"discoverynext"},s=await a(r(i,"ratings"),n);return console.log("Feedback submitted with ID: ",s.id),s}catch(e){throw console.error("Error submitting feedback:",e),e}};var M=i(17146),T=i(63612),P=i(54615),O=i(73179),U=i(20687),L=i(76046),B=i(1234),q=i(64517),N=i(9450),H=i(41983),Q=i(22783),V=i(25012),K=i(15325),J=i(63219),Y=i(89026),G=i(79201),X=i(99489);function $(){let{searchSettings:e,updateSearchSettings:t}=(0,T.S)(),[i,l]=(0,a.useState)(null),[n,o]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,R.Pn)();l(e)}catch(e){console.error("Failed to fetch version info:",e),l({harmony_discovery_version:"Unknown"})}finally{o(!1)}})()},[]),(0,r.jsx)(s.default,{sx:{mb:3},children:(0,r.jsx)(G.A,{control:(0,r.jsx)(X.A,{checked:e.useSearch2,onChange:e=>{t({useSearch2:e.target.checked})},color:"primary"}),label:(0,r.jsxs)(s.default,{children:[(0,r.jsx)(c.A,{variant:"body2",fontWeight:500,children:"Search Version"}),(0,r.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.useSearch2?"Previous Version":n?"Loading...":(null==i?void 0:i.harmony_discovery_version)||"Current Version"})]})})})}var Z=i(96588);function ee(){let{searchSettings:e,updateSearchSettings:t}=(0,T.S)(),[i,l]=(0,a.useState)(e.hybridWeight),n=(0,a.useRef)(null);return(0,a.useEffect)(()=>{l(e.hybridWeight)},[e.hybridWeight]),(0,a.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),(0,r.jsxs)(s.default,{sx:{mb:2},children:[(0,r.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",i.toFixed(2)]}),(0,r.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,r.jsx)(s.default,{sx:{px:2,mt:2},children:(0,r.jsx)(Z.Ay,{value:i,onChange:(e,i)=>{l(i),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{t({hybridWeight:i})},300)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]})}function et(){let{searchSettings:e,updateSearchSettings:t}=(0,T.S)(),[i,l]=(0,a.useState)(e.maxDistance),n=(0,a.useRef)(null);return(0,a.useEffect)(()=>{l(e.maxDistance)},[e.maxDistance]),(0,a.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),(0,r.jsxs)(s.default,{sx:{mb:2},children:[(0,r.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Max Distance: ",i.toFixed(2)]}),(0,r.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the maximum vector distance for semantic search results"}),(0,r.jsx)(s.default,{sx:{px:2,mt:2},children:(0,r.jsx)(Z.Ay,{value:i,onChange:(e,i)=>{l(i),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{t({maxDistance:i})},300)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"0"},{value:.4,label:"0.4"},{value:1,label:"1"}]})})]})}function ei(){let{searchSettings:e,updateSearchSettings:t}=(0,T.S)(),[i,l]=(0,a.useState)(e.directMatchWeight),n=(0,a.useRef)(null);(0,a.useEffect)(()=>{l(e.directMatchWeight)},[e.directMatchWeight]),(0,a.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]);let o=i<=.5?4*i:16*i-6;return(0,r.jsxs)(s.default,{sx:{mb:2},children:[(0,r.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Direct Match Weight: ",i.toFixed(2)," (API: ",o.toFixed(1),")"]}),(0,r.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls preference between direct match and variable match results"}),(0,r.jsx)(s.default,{sx:{px:2,mt:2},children:(0,r.jsx)(Z.Ay,{value:i,onChange:(e,i)=>{l(i),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{t({directMatchWeight:i})},300)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Variable"},{value:.5,label:"0.5"},{value:1,label:"Direct"}]})})]})}function er(){let[e,t]=(0,a.useState)(null),i=(0,a.useRef)(null),l=!!e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(u.A,{ref:i,variant:"contained",color:"secondary",onClick:()=>{t(i.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:l?(0,r.jsx)(Y.A,{}):(0,r.jsx)(J.A,{})}),(0,r.jsx)(c.A,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,r.jsx)(S.Ay,{open:l,anchorEl:e,onClose:()=>{t(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},children:(0,r.jsxs)(s.default,{sx:{p:3,minWidth:280},children:[(0,r.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,r.jsx)($,{}),(0,r.jsx)(ee,{}),(0,r.jsx)(et,{}),(0,r.jsx)(ei,{}),(0,r.jsx)(s.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,r.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[(0,r.jsx)("strong",{children:"Tip:"})," Adjust the hybrid weight to balance between keyword search (lower values) and semantic search (higher values). The default value of 0.5 provides a balanced approach."]})})]})})]})}var ea=i(3485),el=i(71900);function en(){var e,t,i,y,p,_,A;let S=(0,l.A)(),w=(0,n.A)(S.breakpoints.down("sm")),C=(0,n.A)(S.breakpoints.down("lg")),{searchSettings:D,updateQuery:W,updateSearchSettings:I}=(0,T.S)(),[E,J]=(0,a.useState)([]),[Y,G]=(0,a.useState)([]),[X,$]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(!0),[et,ei]=(0,a.useState)(!1),[en,es]=(0,a.useState)(0),[eo,ec]=(0,a.useState)(1),[ed,eu]=(0,a.useState)(null),[eh,ex]=(0,a.useState)(!1),[em,eg]=(0,a.useState)(!1),[ef,ey]=(0,a.useState)(!1),[ep,ev]=(0,a.useState)(!1),[eb,ej]=(0,a.useState)(null),[e_,eA]=(0,a.useState)(null),[eS,ew]=(0,a.useState)(null),[eC,ek]=(0,a.useState)([]),[eD,eW]=(0,a.useState)(void 0),[eF,eR]=(0,a.useState)(!1),[eI,eE]=(0,a.useState)(!1),{currentUser:ez}=(0,M.A)(),eM=(0,L.useSearchParams)(),eT=eM.get("resource_type"),eP=eM.get("like");(0,L.useRouter)();let eO=(0,a.useRef)(eM.get("query")),eU=(0,a.useRef)(eM.getAll("topics")),eL=(0,a.useRef)(eM.getAll("instruments")),eB=(0,a.useRef)(eM.getAll("study_design")),eq=eO.current,eN=eU.current,eH=eL.current,eQ=eB.current,eV=(0,a.useMemo)(()=>eT?[eT]:[],[eT]),eK=(0,a.useRef)(D.debouncedQuery),eJ=(0,a.useRef)(JSON.stringify(D.selectedFilters)),eY=(0,a.useRef)(D.useSearch2),eG=(0,a.useRef)(D.hybridWeight),eX=(0,a.useRef)(D.maxDistance),e$=(0,a.useRef)(D.directMatchWeight),eZ=(0,a.useRef)(eC);(0,a.useRef)(!1);let e0=(0,a.useRef)([]),e1=(0,a.useRef)(void 0),e2=(0,a.useCallback)(e=>{eu(e),w?ex(!0):ey(!0)},[w]),e5=(0,a.useCallback)(e=>{console.log("Selected result:",e),e2(e)},[e2]),e4=(0,a.useCallback)(()=>{ex(!1)},[]),e6=(0,a.useCallback)(()=>{!w&&ed&&ey(!0)},[w,ed]),e3=(0,a.useCallback)(()=>{w||ey(e=>!e)},[w]);(0,a.useEffect)(()=>{(async function(){try{console.log("Fetching initial aggregations..."),$(!0),ev(!1);let e=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),t=await Promise.race([(0,R.Dd)(),e]),i=tl(t);G(i),console.log("Initial aggregations set:",i.length,"filters"),$(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),ev(!0),$(!1)}})()},[]),(0,a.useEffect)(()=>{E.length>0&&!ed?eu(E[0]):E.length>0&&ed?E.some(e=>{var t,i;return(null===(t=e.extra_data)||void 0===t?void 0:t.uuid)===(null===(i=ed.extra_data)||void 0===i?void 0:i.uuid)})||eu(E[0]):0===E.length&&eu(null)},[E,ed]),(0,a.useEffect)(()=>{eg(!1)},[ed]);let e9=(0,a.useCallback)(e=>{var t,i,r;let a=null===(i=e.extra_data)||void 0===i?void 0:null===(t=i.resource_type)||void 0===t?void 0:t.includes("variable"),l=Array.isArray(e.ancestors)&&e.ancestors.length>0;return a&&l&&(null===(r=e.ancestors)||void 0===r?void 0:r[0])||e},[]),e8=async()=>{if(ez&&D.query.trim()&&!eF){eR(!0),eE(!1);try{let e={query:D.query,filters:D.selectedFilters,useSearch2:D.useSearch2,hybridWeight:D.hybridWeight,maxDistance:D.maxDistance,selectedCategory:D.selectedCategory,resultCount:E.length,uid:ez.uid,created:(0,P.serverTimestamp)()};console.log("Saving search:",e,O.db),await (0,P.addDoc)((0,P.collection)(O.db,"saved_searches"),e),eE(!0)}catch(e){console.error("Error saving search:",e)}finally{eR(!1)}}},[e7,te]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!ed){te(null);return}te(e9(ed))},[ed,e9]),(0,a.useEffect)(()=>{(async function(){if(D.similarUid)try{var e,t;$(!0);let i=await (0,R.w3)(D.similarUid,void 0,void 0,D.maxDistance);ej(i);let r=(null===(e=i.dataset_schema)||void 0===e?void 0:e.description)||(null===(t=i.extra_data)||void 0===t?void 0:t.description);if(!r)throw Error("No description available for similar search");W(r);let a=ti(D.maxDistance,1),l=await (0,R.Hu)(r,{},1,50,D.useSearch2,D.hybridWeight,void 0,void 0,void 0,a,D.directMatchWeight);J(l.results||[]),es(l.num_hits||0)}catch(e){console.error("Failed to load similar studies:",e),ev(!0)}finally{$(!1)}})()},[D.similarUid,50,D.useSearch2,D.hybridWeight,W]),(0,a.useEffect)(()=>{var e,t;let i=D.debouncedQuery!==eK.current||JSON.stringify(D.selectedFilters)!==eJ.current||D.useSearch2!==eY.current||D.hybridWeight!==eG.current||D.maxDistance!==eX.current||D.directMatchWeight!==e$.current,r=D.similarUid&&((null==eb?void 0:null===(e=eb.dataset_schema)||void 0===e?void 0:e.description)||(null==eb?void 0:null===(t=eb.extra_data)||void 0===t?void 0:t.description))||D.debouncedQuery;i&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),J([]),ek([]),e0.current=[],eW(void 0),e1.current=void 0,1!==eo&&ec(1),tr(r,1,{query:r,filters:D.selectedFilters,useSearch2:D.useSearch2,hybridWeight:D.hybridWeight,maxDistance:D.maxDistance,selectedCategory:D.selectedCategory,resourceType:D.resourceType,similarUid:D.similarUid}).finally(()=>{eK.current=D.debouncedQuery,eJ.current=JSON.stringify(D.selectedFilters),eY.current=D.useSearch2,eG.current=D.hybridWeight,eX.current=D.maxDistance,e$.current=D.directMatchWeight,eZ.current=eC}))},[D.debouncedQuery,D.selectedFilters,D.similarUid,eb,D.useSearch2,D.hybridWeight,D.maxDistance,D.directMatchWeight]),(0,a.useEffect)(()=>{if(eo>1){var e,t;console.log("\uD83D\uDCC4 Page changed to:",eo,"- loading more results"),tr(D.similarUid&&((null==eb?void 0:null===(e=eb.dataset_schema)||void 0===e?void 0:e.description)||(null==eb?void 0:null===(t=eb.extra_data)||void 0===t?void 0:t.description))||D.debouncedQuery,eo)}},[eo]);let tt=(0,a.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:et,hasMoreResults:Z,currentPage:eo,resultsLength:E.length}),et||!Z){console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:et,hasMoreResults:Z});return}let e=eo+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),ec(e)},[et,Z,eo]),ti=(e,t)=>t<=1?e:Math.max(e*(1-(t-1)*.1),.1);async function tr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.debouncedQuery,t=arguments.length>1?arguments[1]:void 0;arguments.length>2&&arguments[2];let i=void 0!==t?t:eo;1===i?$(!0):ei(!0),ev(!1);let r=Date.now();1===i&&(ee(!0),ei(!1));try{var a,l;let t;let n={...D.selectedFilters};eT&&(n.resource_type=[eT]),Object.keys(n).forEach(e=>{Array.isArray(n[e])&&0===n[e].length&&delete n[e]});let s="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(s)),console.log("Search query:",e||"(empty)"),console.log("Filters:",n),console.log("Page:",i),console.log("Results per page:",50),console.log("Use Search2:",D.useSearch2),console.log("Similar UID (will be excluded):",D.similarUid||"None"),console.log("Top Level IDs Seen:",i>1?eC:"First page");let o=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),c=Date.now();i>1?t=e0.current:D.similarUid&&(t=[D.similarUid],console.log("Excluding original study from similar search:",D.similarUid));let d=ti(D.maxDistance,i),u=await Promise.race([(0,R.Hu)(e,n,i,50,D.useSearch2,D.hybridWeight,t,i>1?e1.current:void 0,void 0,d,D.directMatchWeight),o]),h=Date.now()-c;ew(h),console.log("Response received:",{requestId:s,numHits:u.num_hits,resultCount:(null===(a=u.results)||void 0===a?void 0:a.length)||0,apiTime:"".concat(h,"ms"),results:null===(l=u.results)||void 0===l?void 0:l.map(e=>{var t,i,r,a;return{id:null===(t=e.extra_data)||void 0===t?void 0:t.uuid,title:null===(i=e.dataset_schema)||void 0===i?void 0:i.name,type:(null===(r=e.extra_data)||void 0===r?void 0:r.resource_type)||(null===(a=e.dataset_schema)||void 0===a?void 0:a["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd();let x=u.results||[];if(u.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:u.top_level_ids_seen_so_far.length,sample:u.top_level_ids_seen_so_far.slice(0,5),previousCount:eC.length}),ek(u.top_level_ids_seen_so_far),e0.current=u.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response"),void 0!==u.next_page_offset?(console.log("Received next_page_offset:",{offset:u.next_page_offset,previousOffset:e1.current}),eW(u.next_page_offset),e1.current=u.next_page_offset):console.log("No next_page_offset in response (using calculated offset)"),1===i){if(J(x),es(u.num_hits||0),D.useSearch2)ee(50===x.length&&x.length<(u.num_hits||0));else{let e=x.length>0;ee(e),(!e||x.length<50)&&es(Math.max(u.num_hits||0,x.length)),x.length>0&&x.length<50&&x.length<20&&(console.log("\uD83D\uDD04 Auto-loading next page from first page - insufficient results:",{gotResults:x.length,requestedResults:50,minThreshold:20,nextPage:2}),setTimeout(()=>{!et&&Z&&ec(2)},100))}}else{J(e=>{if(x.length>0){let t;t=1===i?x.length:e.length+x.length,x.length<50&&t<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:x.length,requestedResults:50,currentTotal:t,minThreshold:20,nextPage:i+1}),setTimeout(()=>{!et&&Z&&ec(i+1)},100))}return[...e,...x]});let e=x.length>0;ee(e),e||es(Math.max(en,E.length+x.filter(e=>!E.some(t=>{var i,r;return(null===(i=t.extra_data)||void 0===i?void 0:i.uuid)===(null===(r=e.extra_data)||void 0===r?void 0:r.uuid)})).length))}let m=Date.now();eA(m-r)}catch(e){console.error("Search failed:",e),ev(!0),eA(null),ew(null)}finally{$(!1),ei(!1)}}let ta=async(e,t)=>{if(e)try{await z(e,t),console.log("Feedback submitted successfully")}catch(e){console.error("Failed to submit feedback:",e)}},tl=e=>{let t=[],i=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_sweeps"],r=1/0,a=-1/0;if(Object.entries(e).forEach(e=>{let[l,n]=e;if("age_lower"===l||"age_upper"===l||"age_min"===l||"age_max"===l){let e=n.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let i=e.maximum;"number"==typeof i&&isFinite(i)||(i=e.max),"number"==typeof t&&isFinite(t)&&(r=Math.min(r,t)),"number"==typeof i&&isFinite(i)&&(a=Math.max(a,i));return}if(i.includes(l)){let e,i;let r=n.statistics||{};"number"==typeof r.minimum&&isFinite(r.minimum)?e=r.minimum:"number"==typeof r.min&&isFinite(r.min)?e=r.min:(console.warn("Missing valid min value for ".concat(l,", using default")),e="sample_size"===l?0:"start_year"===l||"end_year"===l?1900:0),"number"==typeof r.maximum&&isFinite(r.maximum)?i=r.maximum:"number"==typeof r.max&&isFinite(r.max)?i=r.max:(console.warn("Missing valid max value for ".concat(l,", using default")),i="sample_size"===l?1e5:"start_year"===l||"end_year"===l?2024:"duration_years"===l?100:"num_sweeps"===l?50:100),i<=e&&(i=e+1);let a=Array.from({length:101},(t,r)=>String(e+r/100*(i-e)));t.push({id:l,label:l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:a})}else{let e=n.buckets||[];e.length>0&&t.push({id:l,label:l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(r)&&isFinite(a)&&r<=a){a<=r&&(a=r+1);let e=Array.from({length:101},(e,t)=>String(r+t/100*(a-r)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},tn=(0,a.useCallback)(async e=>{var t,i,r,a,l;let n=null===(t=e.extra_data)||void 0===t?void 0:t.uuid;if(!n)return;let s=(null===(i=e.dataset_schema)||void 0===i?void 0:i.name)||(null===(r=e.extra_data)||void 0===r?void 0:r.name)||"Unnamed Study";W("LIKE:".concat(s," (").concat(n,")"));let o=(null===(a=e.dataset_schema)||void 0===a?void 0:a.description)||(null===(l=e.extra_data)||void 0===l?void 0:l.description);o?(W(o),ts(o)):(console.warn("No description available for study ".concat(s,", using name for similar search")),W(s),ts(s))},[]),ts=async e=>{$(!0),ev(!1);try{let t;let i={...D.selectedFilters};eT&&(i.resource_type=[eT]),Object.keys(i).forEach(e=>{Array.isArray(i[e])&&0===i[e].length&&delete i[e]});let r=e,a=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);a&&(t=a[2],r="LIKE:".concat(t));let l=ti(D.maxDistance,eo),n=await (0,R.Hu)(r,i,eo,50,D.useSearch2,D.hybridWeight,t?[t]:eo>1?e0.current:void 0,eo>1?e1.current:void 0,void 0,l,D.directMatchWeight);J(n.results||[]),es(n.num_hits||0)}catch(e){ev(!0)}finally{$(!1)}};return(0,r.jsxs)(s.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(o.A,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,r.jsx)(s.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:eP?(0,r.jsxs)(s.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,r.jsx)(s.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==eb?void 0:null===(e=eb.dataset_schema)||void 0===e?void 0:e.image)?(0,r.jsx)(f.default,{src:(null==eb?void 0:eb.dataset_schema).image,alt:(null==eb?void 0:null===(t=eb.dataset_schema)||void 0===t?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,i;let a=(null==e?void 0:null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)||(null==e?void 0:null===(i=e.dataset_schema)||void 0===i?void 0:i["@type"]);return(null==a?void 0:a.includes("dataset"))?(0,r.jsx)(B.A,{size:48}):(null==a?void 0:a.includes("variable"))?(0,r.jsx)(q.A,{size:48}):(null==a?void 0:a.includes("study"))?(0,r.jsx)(N.A,{size:48}):(0,r.jsx)(H.A,{size:48})})(eb)}),(0,r.jsxs)(s.default,{children:[(0,r.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:(null==eb?void 0:null===(i=eb.dataset_schema)||void 0===i?void 0:i.name)||(null==eb?void 0:null===(y=eb.extra_data)||void 0===y?void 0:y.name)||"Unnamed Study"}),(0,r.jsx)(c.A,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.A,{fullWidth:!0,placeholder:"What are you searching for?",value:D.query,onChange:e=>{W(e.target.value)},InputProps:{endAdornment:(0,r.jsxs)(s.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[D.query!==D.debouncedQuery&&(0,r.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Typing..."}),(0,r.jsx)(f.default,{src:(0,ea.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,r.jsx)(s.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,r.jsx)(er,{})})]})}),(0,r.jsx)(b.A,{filtersData:Y}),!ep&&(0,r.jsxs)(s.default,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[X?"Searching...":Z?E.length>en?"".concat(E.length," results loaded (").concat(en,"+ estimated)"):en>0?"".concat(E.length," of ~").concat(en," results loaded"):"".concat(E.length," results loaded"):"".concat(E.length," results found"),!X&&eS&&" (API: ".concat(eS,"ms"),!X&&e_&&eS&&", Total: ".concat(e_,"ms)")]}),ez&&(0,r.jsx)(u.A,{variant:"outlined",size:"small",startIcon:eI?(0,r.jsx)(U.A,{size:16,fill:"currentColor"}):(0,r.jsx)(U.A,{size:16}),onClick:e8,disabled:eF||!D.query.trim()||X,sx:{ml:2,color:eI?"success.main":"inherit",borderColor:eI?"success.main":"inherit"},title:"Save this search",children:eF?"Saving...":eI?"Saved!":"Save Search"})]}),E.length||X||""!==D.query.trim()||0!==Object.keys(D.selectedFilters).length||0!==eV.length||eq||0!==eN.length||0!==eH.length||0!==eQ.length?(0,r.jsxs)(s.default,{sx:{display:w?"block":"flex",width:"100%",flex:1,minHeight:0,overflow:"visible",position:"relative"},children:[(0,r.jsx)(s.default,{sx:{width:C?"100%":"50%",minWidth:w?"100%":"300px",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:X?(0,r.jsx)(c.A,{children:"Loading search results..."}):ep?(0,r.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,r.jsx)(g.A,{sx:{fontSize:{xs:48,sm:64},color:"text.secondary",mb:2}}),(0,r.jsx)(c.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,r.jsx)(c.A,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,r.jsx)(u.A,{variant:"contained",sx:{mt:4},onClick:()=>{ev(!1),tr()},children:"Retry Connection"})]}):(0,r.jsx)(s.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,r.jsx)(el.A,{dataLength:E.length,next:tt,hasMore:Z,loader:(0,r.jsx)(s.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,r.jsx)(Q.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,r.jsx)(c.A,{children:"No more results to load."}),children:(0,r.jsx)(v,{results:E,resourceTypeFilter:eV,onSelectResult:e5,selectedResultId:null==ed?void 0:null===(p=ed.extra_data)||void 0===p?void 0:p.uuid,onFindSimilar:tn,hasActiveSearch:""!==D.query.trim()||Object.keys(D.selectedFilters).length>0||eV.length>0})})})}),!w&&(E.length>0||en>0)&&(0,r.jsxs)(s.default,{sx:{position:"absolute",top:0,right:0,width:ef?"calc(100% - 130px)":C?"0%":"50%",height:"100%",bgcolor:"background.paper",borderLeft:C&&!ef?"none":"1px solid",borderColor:"grey.200",display:"flex",flexDirection:"column",overflow:"visible",transition:"width 0.3s ease-in-out",cursor:ed?"pointer":"default",zIndex:ef?2:1,boxShadow:ef?"-4px 0 8px rgba(0, 0, 0, 0.1)":"none"},onClick:e6,children:[(0,r.jsx)(s.default,{sx:{position:"absolute",top:-16,left:-16,zIndex:1e3},children:(0,r.jsx)(h.A,{onClick:e=>{e.stopPropagation(),e3()},sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2,width:30,height:30},children:ef?(0,r.jsx)(K.A,{size:20}):(0,r.jsx)(V.A,{size:20})})}),ep?(0,r.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,r.jsx)(g.A,{sx:{fontSize:{xs:36,sm:48},color:"text.secondary",mb:2}}),(0,r.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,r.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):e7?(0,r.jsx)(s.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,r.jsx)(j.default,{study:e7,isDrawerView:!1})}):(0,r.jsx)(s.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,r.jsx)(c.A,{color:"text.secondary",children:"Select a dataset to view details"})})]})]}):(0,r.jsx)(s.default,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,r.jsx)(s.default,{sx:{width:"80%",maxWidth:1200},children:(0,r.jsx)(F,{onExampleClick:e=>{W(e)}})})}),(0,r.jsxs)(x.Ay,{anchor:"right",open:w&&eh,onClose:e4,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,r.jsxs)(s.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,r.jsx)(h.A,{onClick:e4,sx:{position:"absolute",top:8,right:8},children:(0,r.jsx)(m.A,{})}),(0,r.jsxs)(s.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(c.A,{variant:"h6",sx:{flex:1},children:ed&&(null===(_=ed.dataset_schema)||void 0===_?void 0:_.name)||"Study Details"}),ed&&(ed.dataset_schema&&ed.dataset_schema.image||ed.image)&&!em&&(0,r.jsx)(s.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,r.jsx)(f.default,{src:ed.dataset_schema&&ed.dataset_schema.image||ed.image,alt:(null===(A=ed.dataset_schema)||void 0===A?void 0:A.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>eg(!0),unoptimized:!0})})]})]}),(0,r.jsx)(s.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:e7?(0,r.jsx)(j.default,{studyDataComplete:!1,study:e7,isDrawerView:!0}):(0,r.jsx)(s.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,r.jsx)(c.A,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]}),(0,r.jsx)(k,{onSubmitFeedback:ta})]})}function es(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)(s.default,{sx:{p:4},children:(0,r.jsx)(c.A,{children:"Loading..."})}),children:(0,r.jsx)(en,{})})}}}]);