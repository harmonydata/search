"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3055],{30249:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(95155),r=i(12115),o=i(94049),l=i(25635),a=i(29767),c=i(20699),s=i(15239),f=i(92925),h=i(75183);let d=new Map,u=new Map;function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;try{let i=new URL(e).hostname.replace(/^www\./,"");return"https://www.google.com/s2/favicons?domain=".concat(i,"&sz=").concat(t)}catch(e){return null}}function g(e){let{url:t,compact:i=!1,maxHeight:g=250}=e,[p,m]=(0,r.useState)(null),[v,w]=(0,r.useState)(!0),[b,y]=(0,r.useState)(null),[j,k]=(0,r.useState)(!1),[A,S]=(0,r.useState)(!1),[W,L]=(0,r.useState)(!1),R=(0,r.useRef)(null);if(!t||""===t.trim())return null;(0,r.useEffect)(()=>{let e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(L(!0),e.disconnect())})},{rootMargin:"200px",threshold:.01});return R.current&&e.observe(R.current),()=>{e.disconnect()}},[]),(0,r.useEffect)(()=>{W&&e();async function e(){if(t&&""!==t.trim()){w(!0),y(null),k(!1),S(!1);try{let e=t.toLowerCase(),i=Date.now(),n=u.get(e);if(n&&i-n.timestamp<864e5){console.log("Client cache hit for ".concat(t)),m(n.data),w(!1);return}let r=d.get(e);r?console.log("Reusing in-flight request for ".concat(t)):(console.log("Fetching OpenGraph data for ".concat(t)),r=(0,h.v5)(t).catch(async e=>{let i=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,i=(e.match(/\)/g)||[]).length;if(i>t){let n=i-t,r=e;for(let e=0;e<n;e++)r.endsWith(")")&&(r=r.slice(0,-1));return r!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(r,'" (removed ').concat(n," extra closing brackets)")),r}}return e}(t);if(i!==t)return console.log("First attempt failed, retrying with cleaned URL: ".concat(i)),(0,h.v5)(i);throw e}).then(t=>(u.set(e,{data:t,timestamp:Date.now()}),t)).finally(()=>{d.delete(e)}),d.set(e,r));let o=await r;if(!o.favicon||"/favicon.ico"===o.favicon||""===o.favicon.trim()){let e=o.finalUrl||o.url||t,i=x(e,32);if(i)o.favicon=i;else try{let t=new URL(e);o.favicon="".concat(t.origin,"/favicon.ico")}catch(e){}}if(!o.image||""===o.image.trim())if(o.favicon&&""!==o.favicon.trim())o.image=o.favicon;else{let e=o.finalUrl||o.url||t,i=x(e,128);if(i)o.image=i;else try{let t=new URL(e);o.image="".concat(t.origin,"/favicon.ico")}catch(e){}}m(o)}catch(e){console.error("Error fetching Open Graph data:",e),y(e instanceof Error?e.message:"Failed to fetch link preview")}finally{w(!1)}}}},[t,W]);let C=()=>{if(p&&p.image&&!j)try{let e=p.finalUrl||p.url||t,i=x(e,128);if(i&&p.image!==i)return void m({...p,image:i});let n=new URL(e),r="".concat(n.origin,"/favicon.ico");p.image!==r?m({...p,image:r}):k(!0)}catch(e){k(!0)}else k(!0)};return b?(0,n.jsxs)(o.default,{component:"a",href:t,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none",color:"primary.main",display:"flex",alignItems:"center",gap:.5,"&:hover":{textDecoration:"underline"}},children:[(0,n.jsx)(l.A,{variant:"body2",sx:{wordBreak:"break-word"},children:t}),(0,n.jsx)(f.A,{size:16})]}):v||!W?(0,n.jsxs)(a.A,{ref:R,elevation:0,sx:{display:"flex",flexDirection:i?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:i?"100%":500,height:i?100:"auto",maxHeight:g,border:"1px solid",borderColor:"grey.200",transition:"all 0.2s"},children:[!i&&(0,n.jsx)(c.A,{variant:"rectangular",width:"100%",height:140}),(0,n.jsxs)(o.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,n.jsx)(c.A,{variant:"text",width:"80%",height:24}),!i&&(0,n.jsx)(c.A,{variant:"text",width:"90%",height:18,sx:{mt:1}}),(0,n.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[(0,n.jsx)(c.A,{variant:"circular",width:16,height:16}),(0,n.jsx)(c.A,{variant:"text",width:120,height:16})]})]}),i&&(0,n.jsx)(c.A,{variant:"rectangular",width:80,height:"100%"})]}):p?(0,n.jsxs)(a.A,{ref:R,elevation:0,sx:{display:"flex",flexDirection:i?"row":"column",borderRadius:"8px",overflow:"hidden",width:"100%",maxWidth:i?"100%":500,height:i?100:"auto",maxHeight:g,border:"1px solid",borderColor:p.isFallback?"grey.300":"grey.200",cursor:"pointer",transition:"all 0.2s",opacity:p.isFallback?.8:1,flex:1,"&:hover":{boxShadow:2,borderColor:p.isFallback?"grey.400":"primary.main"}},onClick:()=>{window.open(t,"_blank","noopener,noreferrer")},children:[p.image&&!j&&!i&&(0,n.jsx)(o.default,{sx:{position:"relative",width:"100%",height:140,overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,n.jsx)(s.default,{src:p.image,alt:p.title||"Link preview",fill:!0,style:{objectFit:"contain"},onError:C,unoptimized:!0})}),(0,n.jsxs)(o.default,{sx:{flex:1,p:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between",bgcolor:"rgba(0,0,0,0.01)",minHeight:0},children:[(0,n.jsxs)(o.default,{children:[(0,n.jsx)(l.A,{variant:"subtitle1",component:"h3",sx:{fontWeight:500,fontSize:i?"0.9rem":"1rem",lineHeight:1.2,mb:.5,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:p.title}),!i&&p.description&&(0,n.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:1,height:"2.4em"},children:p.description})]}),(0,n.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[p.favicon&&(0,n.jsx)(o.default,{sx:{width:16,height:16,position:"relative",overflow:"hidden",borderRadius:"2px",flexShrink:0},children:(0,n.jsx)(s.default,{src:p.favicon,alt:p.siteName||"Site icon",width:16,height:16,style:{objectFit:"contain"},unoptimized:!0,onError:()=>{if(p&&!A)try{let e=p.finalUrl||p.url||t,i=x(e,32);if(i&&p.favicon!==i){m({...p,favicon:i}),S(!0);return}let n=new URL(e),r="".concat(n.origin,"/favicon.ico");p.favicon!==r&&m({...p,favicon:r}),S(!0)}catch(e){S(!0)}}})}),(0,n.jsxs)(l.A,{variant:"caption",sx:{color:"text.secondary",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",fontSize:"0.7rem"},children:[p.isFallback&&t.includes("doi.org")?p.publisher||"DOI":p.siteName||new URL(p.finalUrl||p.url).hostname,p.isFallback&&" (preview unavailable)"]}),(0,n.jsx)(f.A,{size:12,color:"#666",style:{marginLeft:"auto"}})]})]}),p.image&&!j&&i&&(0,n.jsx)(o.default,{sx:{position:"relative",width:80,minWidth:80,height:"100%",overflow:"hidden",bgcolor:"rgba(0,0,0,0.03)"},children:(0,n.jsx)(s.default,{src:p.image,alt:p.title||"Link preview",fill:!0,style:{objectFit:"contain"},onError:C,unoptimized:!0})})]}):null}},43055:(e,t,i)=>{i.d(t,{A:()=>s});var n=i(95155),r=i(12115),o=i(94049),l=i(25635),a=i(30249);let c=/(https?:\/\/[^\s]+)/g;function s(e){let{text:t,compact:i=!1,paragraphProps:s={}}=e,f=(0,r.useRef)(null),[h,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[i]=t;i.isIntersecting&&(d(!0),f.current&&e.unobserve(f.current))},{rootMargin:"100px",threshold:.1});return f.current&&e.observe(f.current),()=>{f.current&&e.unobserve(f.current)}},[]);let u=(0,r.useMemo)(()=>{if(!t)return[{type:"text",content:""}];let e=t.split(c),i=t.match(c)||[],n=[];for(let t=0;t<e.length;t++)if(e[t]&&n.push({type:"text",content:e[t]}),t<i.length){let e=i[t];(e.endsWith(".")||e.endsWith(",")||e.endsWith(";")||e.endsWith(":")||e.endsWith(")"))&&(e=e.slice(0,-1)),n.push({type:"url",content:e})}return n},[t]);return(0,n.jsx)(o.default,{ref:f,sx:{display:"flex",flexDirection:"column",gap:2},children:u.map((e,t)=>"text"===e.type?(0,n.jsx)(l.A,{variant:"body1",...s,sx:{...s.sx,whiteSpace:"pre-wrap"},children:e.content},"text-".concat(t)):h?(0,n.jsx)(a.A,{url:e.content,compact:i},"url-".concat(t)):(0,n.jsx)(o.default,{component:"a",href:e.content,target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:e.content},"url-placeholder-".concat(t)))})}}}]);