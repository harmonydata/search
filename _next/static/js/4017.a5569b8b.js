(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4017],{79201:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var o=r(12115),l=r(43463),n=r(7123),a=r(2620),s=r(89142),i=r(98330),c=r(12567),d=r(9561),u=r(37410),p=r(19611),h=r(99714),m=r(48827),x=r(95155);let y=e=>{let{classes:t,disabled:r,labelPlacement:o,error:l,required:a}=e,s={root:["root",r&&"disabled","labelPlacement".concat((0,u.A)(o)),l&&"error",a&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",l&&"error"]};return(0,n.A)(s,p.u,t)},b=(0,s.Ay)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[{["& .".concat(p.A.label)]:t.label},t.root,t["labelPlacement".concat((0,u.A)(r.labelPlacement))]]}})((0,i.A)(e=>{let{theme:t}=e;return{display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,["&.".concat(p.A.disabled)]:{cursor:"default"},["& .".concat(p.A.label)]:{["&.".concat(p.A.disabled)]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:e=>{let{labelPlacement:t}=e;return"start"===t||"top"===t||"bottom"===t},style:{marginLeft:16}}]}})),f=(0,s.Ay)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((0,i.A)(e=>{let{theme:t}=e;return{["&.".concat(p.A.error)]:{color:(t.vars||t).palette.error.main}}})),g=o.forwardRef(function(e,t){var r;let n=(0,c.b)({props:e,name:"MuiFormControlLabel"}),{checked:s,className:i,componentsProps:u={},control:p,disabled:g,disableTypography:v,inputRef:j,label:A,labelPlacement:k="end",name:w,onChange:C,required:R,slots:z={},slotProps:M={},value:q,...L}=n,S=(0,a.A)(),_=null!==(r=null!=g?g:p.props.disabled)&&void 0!==r?r:null==S?void 0:S.disabled,E=null!=R?R:p.props.required,D={disabled:_,required:E};["checked","name","onChange","value","inputRef"].forEach(e=>{void 0===p.props[e]&&void 0!==n[e]&&(D[e]=n[e])});let H=(0,h.A)({props:n,muiFormControl:S,states:["error"]}),N={...n,disabled:_,labelPlacement:k,required:E,error:H.error},O=y(N),F={slots:z,slotProps:{...u,...M}},[P,T]=(0,m.A)("typography",{elementType:d.A,externalForwardedProps:F,ownerState:N}),U=A;return null==U||U.type===d.A||v||(U=(0,x.jsx)(P,{component:"span",...T,className:(0,l.A)(O.label,null==T?void 0:T.className),children:U})),(0,x.jsxs)(b,{className:(0,l.A)(O.root,i),ownerState:N,ref:t,...L,children:[o.cloneElement(p,D),E?(0,x.jsxs)("div",{children:[U,(0,x.jsxs)(f,{ownerState:N,"aria-hidden":!0,className:O.asterisk,children:[" ","*"]})]}):U]})})},19611:(e,t,r)=>{"use strict";r.d(t,{A:()=>a,u:()=>n});var o=r(81045),l=r(37157);function n(e){return(0,l.Ay)("MuiFormControlLabel",e)}let a=(0,o.A)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"])},72529:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_});var o=r(95155),l=r(12115);let n=()=>l.useRef(null);var a=r(50914),s=r(57165),i=r(53326),c=r(68998),d=r(72926),u=r(47821),p=r(66917),h=r(4918),m=r(64364),x=r(2091),y=r(60391),b=r(78416),f=r(36417),g=r(9561),v=r(27753),j=r(14057);let A=(0,j.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),k=(0,j.A)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);var w=r(41983);let C=(0,j.A)("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),R=(0,j.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),z=(0,j.A)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),M=!1,q=null,L=async()=>M?void 0:q||(q=new Promise((e,t)=>{if(customElements.get("harmony-export")){console.log("\uD83D\uDD0D Harmony export component already registered"),M=!0,q=null,e();return}console.log("\uD83D\uDD0D Loading harmony-export web component");let r=document.createElement("script");r.src="/app/js/harmony-export.js",r.async=!0,r.onload=()=>{console.log("✅ Harmony export component loaded successfully"),M=!0,q=null,e()},r.onerror=e=>{console.error("❌ Failed to load harmony-export component:",e),q=null,t(e)},document.head.appendChild(r)}));function S(e){let{variables:t,studyName:b,downloadAnchorEl:f,onDownloadClick:g,onDownloadClose:v}=e,j=(0,l.useRef)(null),R=(0,l.useRef)(null),[z,M]=(0,l.useState)(!1);(0,l.useEffect)(()=>{L().catch(e=>{console.error("Failed to load harmony-export component:",e)})},[]);let q=[{field:"description",headerName:"Description / Code",flex:2,valueGetter:(e,t)=>{let r=t.displayName||t.name;return(t.description||r)+(t.description&&r?" ("+r+")":"")},sortable:!0},{field:"options",headerName:"Response Options",flex:1,valueGetter:(e,t)=>t.options&&Array.isArray(t.options)?t.options.join(" / "):"",sortable:!0}],S=t.filter(e=>e.name||e.description).map((e,t)=>({id:e.uuid||e.name||t,...e})),_=n();(0,l.useEffect)(()=>{let e=setTimeout(()=>{_.current&&M(!0)},200);return()=>clearTimeout(e)},[_]);let E=()=>{let e=_.current;if(!e||!z)return[];try{let t=e.getSelectedRows();return t?Array.from(t.values()):[]}catch(e){return console.warn("Failed to get selected items:",e),[]}},D=()=>E().length,H=()=>{let e=_.current;if(!e||!z)return!1;try{let t=e.getSelectedRows();return t&&"number"==typeof t.size&&t.size>0}catch(e){return!1}},N=(0,l.useCallback)(()=>{if(!j.current||!z)return;let e=E();if(j.current.innerHTML="",0===e.length)return;console.log("selectedItems:",e);let t=e.map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name})),r=document.createElement("harmony-export");r.size="32px",r.instrument_name="".concat(b||"Selected Variables"," from harmonydata.ac.uk/discover"),r.questions=t,j.current.appendChild(r)},[z,b]);(0,l.useEffect)(()=>{if(!z||!_.current)return;let e=_.current.subscribeEvent("rowSelectionChange",()=>{N()});return()=>{e()}},[z,N]);let O=()=>{null==v||v()},F=()=>{let e;let t=_.current;if(!t||!z)return[];try{e=t.getSelectedRows()}catch(t){e=null}return(e&&"number"==typeof e.size&&e.size>0&&e?Array.from(e.values()):(()=>{let e;try{e=t.getRowModels()}catch(t){e=null}return e?Array.from(e.values()):[]})()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name,response_options:e.options&&Array.isArray(e.options)?e.options.join(" / "):""}))},P=async()=>{let e=F(),{utils:t,write:o}=await Promise.all([r.e(3524),r.e(8436)]).then(r.bind(r,7660)),l=t.json_to_sheet(e),n=t.book_new();t.book_append_sheet(n,l,"Questions");let a=new Blob([o(n,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="questions.xlsx",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),O()};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.default,{sx:{height:"100%",minHeight:400},children:S.length>0&&(0,o.jsx)(a.z,{apiRef:_,paginationMode:"server",rowCount:S.length,rows:S,columns:q,checkboxSelection:!0,sortModel:[{field:"score",sort:"desc"}],getRowClassName:e=>e.row.matched?"matched-row":"",sx:{background:"white",borderRadius:2,fontSize:14,height:"100%","& .matched-row":{backgroundColor:"#fffae4","&:hover":{backgroundColor:"#fff8d1"}}},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,o.jsxs)(c.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:[(0,o.jsx)(s.e,{expanded:!0,style:{width:"100%"},children:(0,o.jsx)(i.X,{placeholder:"Search within variables",style:{background:"white",borderRadius:192,fontSize:14,margin:15,width:"calc(100% - 15px)",height:"auto"}})}),(0,o.jsx)(d.A,{title:"Harmonise selected items",children:(0,o.jsx)(u.A,{size:"small",sx:{width:40,height:40},children:(0,o.jsx)(c.default,{ref:j,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}})})}),(0,o.jsx)(d.A,{title:H()?"Download ".concat(D()," selected questions"):"Download all questions",children:(0,o.jsx)(u.A,{ref:R,size:"small",onClick:g,sx:{width:40,height:40},children:(0,o.jsx)(A,{size:30})})})]})}})}),(0,o.jsx)(p.Ay,{open:!!f,anchorEl:f,onClose:O,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,o.jsxs)(h.A,{sx:{width:200},children:[(0,o.jsxs)(m.Ay,{onClick:()=>{let e=new Blob([JSON.stringify(F(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="questions.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),O()},sx:{cursor:"pointer"},children:[(0,o.jsx)(x.A,{children:(0,o.jsx)(k,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as JSON"})]}),(0,o.jsxs)(m.Ay,{onClick:()=>{let e=new Blob([[["Question Number","Question Text","Response Options"],...F().map(e=>[e.question_no,e.question_text,e.response_options])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="questions.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),O()},sx:{cursor:"pointer"},children:[(0,o.jsx)(x.A,{children:(0,o.jsx)(w.A,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as CSV"})]}),(0,o.jsxs)(m.Ay,{onClick:P,sx:{cursor:"pointer"},children:[(0,o.jsx)(x.A,{children:(0,o.jsx)(C,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as Excel"})]})]})})]})}function _(e){let{variables:t,studyName:r}=e,[n,a]=(0,l.useState)(!1),s=(0,l.useRef)(null),[i,p]=(0,l.useState)(null),h=()=>{p(null),a(!1)},m=(0,o.jsx)(S,{variables:t,studyName:r,downloadAnchorEl:i,onDownloadClick:e=>{console.log("handleDownloadClick",e.currentTarget),p(s.current)},onDownloadClose:()=>{p(null)}});return n?(0,o.jsxs)(b.A,{ref:s,open:!0,onClose:h,maxWidth:"xl",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh"}},children:[(0,o.jsxs)(f.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,o.jsxs)(g.A,{variant:"h6",children:["Variables - ",r||"Study"]}),(0,o.jsx)(u.A,{onClick:h,size:"small",sx:{color:"text.secondary"},children:(0,o.jsx)(R,{size:20})})]}),(0,o.jsx)(v.A,{sx:{p:0,overflow:"hidden"},children:(0,o.jsx)(c.default,{sx:{height:"100%","& .MuiDataGrid-root":{borderRadius:0,maxHeight:"none",height:"100%"}},children:m})})]}):(0,o.jsxs)(c.default,{ref:s,sx:{position:"relative"},children:[(0,o.jsx)(c.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:1},children:(0,o.jsx)(d.A,{title:"Open in large view",children:(0,o.jsx)(u.A,{size:"small",onClick:()=>{p(null),a(!0)},children:(0,o.jsx)(z,{size:20})})})}),(0,o.jsx)(c.default,{sx:{"& .MuiDataGrid-root":{height:450,borderRadius:2}},children:m})]})}r(67699)},67699:()=>{},41983:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(14057).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])}}]);