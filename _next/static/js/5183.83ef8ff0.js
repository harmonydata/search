"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5183],{75183:(e,t,o)=>{o.d(t,{AV:()=>u,CO:()=>g,Dd:()=>s,GF:()=>n,Hu:()=>a,U4:()=>l,Y3:()=>d,dh:()=>h,v5:()=>c,w3:()=>i});let r="https://harmonydataweaviate.azureedge.net";async function s(){let e=await fetch("".concat(r,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let o=t.aggregations||{},s=Object.keys(o).filter(e=>"top_level_ancestor"!==e).reduce((e,t)=>(e[t]=o[t],e),{});return Object.keys(s).map(e=>{let t,o=s[e];if(["num_sweeps","sample_size","duration_years","age_lower","age_upper","start_year","end_year"].includes(e)&&"object"==typeof o&&!Array.isArray(o)&&void 0!==o.minimum&&void 0!==o.maximum){let e=Math.floor(o.minimum),r=Math.ceil(o.maximum),s=[],a=Math.min(100,r-e+1),n=(r-e)/(a-1);for(let t=0;t<a;t++)s.push(String(Math.round(e+t*n)));t=s}else t=Object.keys(o);return{id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:t,frequencies:"object"!=typeof o||Array.isArray(o)?void 0:o}})}async function a(e,t){var o,s,a,n;let i,c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,u=!(arguments.length>4)||void 0===arguments[4]||arguments[4],h=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0,_=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,p=arguments.length>9?arguments[9]:void 0,m=arguments.length>10?arguments[10]:void 0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"min_score",w=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"filter",y=t&&Object.keys(t).length>0;if(!e&&!y)return{results:[],aggregations:{},num_hits:0};let b=e&&""!==e.trim()?e.trim():"",S="offset"===w?void 0!==_?_:(l-1)*d:0,x=S>0||("filter"===w||"trust_estimate"===w)&&g&&g.length>0&&!u,k=u?"search2":"search",U="".concat(r,"/discover/").concat(k);if(x){i=U;let e={query:[b],num_results:d,offset:S};void 0!==h&&(e.alpha=h),("filter"===w||"trust_estimate"===w)&&g&&g.length>0&&(e.top_level_ids_seen_so_far=g),t&&Object.entries(t).forEach(t=>{let[o,r]=t;r.length>0&&(o.endsWith("_min")||o.endsWith("_max")?e[o]=parseInt(r[0],10):e[o]=r)}),void 0!==f&&(e.return_variables_within_parent=f);let o=void 0!==p?p:.4;("max_distance"===v||"both"===v)&&(e.max_vector_distance=o),("min_score"===v||"both"===v)&&(e.min_original_vector_score=1-o),void 0!==m&&(e.direct_match_weight=m<=.5?4*m:16*m-6),c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[b],topLevelIdsCount:(null==g?void 0:g.length)||0,offset:S,endpoint:k})}else{let e=new URLSearchParams;void 0!==h&&e.set("alpha",h.toString()),e.append("query",b),e.set("num_results",d.toString()),e.set("offset",S.toString());let o={};if(t)for(let r in t){let s=r;if(r.endsWith("_min")||r.endsWith("_max")){let a=r.replace(/_(min|max)$/,"");o[a]||(o[a]={}),r.endsWith("_min")?o[a].min=t[r][0]:o[a].max=t[r][0],e.append(s,t[r][0])}else t[r].forEach(t=>{e.append(s,t)})}void 0!==f&&e.set("return_variables_within_parent",f.toString());let r=void 0!==p?p:.4;("max_distance"===v||"both"===v)&&e.set("max_vector_distance",r.toString()),("min_score"===v||"both"===v)&&e.set("min_original_vector_score",(1-r).toString()),void 0!==m&&e.set("direct_match_weight",(m<=.5?4*m:16*m-6).toString()),i="".concat(U,"?").concat(e.toString()),c={method:"GET"},Object.keys(o).length>0&&console.log("Numeric range parameters:",o),console.log("Using GET request:",i)}let j=await fetch(i,c);if(!j.ok)throw console.error("Search API error:",j.status,await j.text()),Error("Search API request failed");let E=await j.json();console.log("\uD83D\uDD0D Raw API response keys:",Object.keys(E)),E.top_level_uuids?console.log("✅ Found top_level_uuids in response:",E.top_level_uuids.length,"UUIDs"):console.log("❌ No top_level_uuids in response");let A=new Set(g||[]),D=[];return E.results&&Array.isArray(E.results)&&E.results.forEach(e=>{var t,o,r;let s=(null==(t=e.extra_data)?void 0:t.uuid)||(null==(r=e.dataset_schema)||null==(o=r.identifier)?void 0:o[0]);s&&(A.has(s)?D.push(s):A.add(s))}),D.length>0&&(alert("⚠️ Duplicate results detected!\n\n"+"Found ".concat(D.length," duplicate result(s) that were already seen.\n")+"This shouldn't happen with offset-based pagination.\n\n"+"Duplicate IDs: ".concat(D.slice(0,5).join(", ")).concat(D.length>5?"...":"","\n\n")+"Please check the console for more details."),console.error("Duplicate results detected:",{count:D.length,ids:D,currentOffset:S,resultsReturned:(null==(o=E.results)?void 0:o.length)||0})),window.__lastSearchResponse=E,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:E.num_hits,resultCount:(null==(s=E.results)?void 0:s.length)||0,firstResult:null==(a=E.results)?void 0:a[0],aggregations:Object.keys(E.aggregations||{}),endpoint:k,method:x?"POST":"GET",hybridWeight:h,offset:S,duplicatesDetected:D.length,topLevelUuids:(null==(n=E.top_level_uuids)?void 0:n.length)||0,hasTopLevelUuids:!!E.top_level_uuids,responseKeys:Object.keys(E)}),{results:E.results||[],aggregations:E.aggregations||{},num_hits:E.num_hits,top_level_ids_seen_so_far:Array.from(A),next_page_offset:E.next_page_offset,top_level_uuids:E.top_level_uuids}}async function n(e,t,o,s){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"min_score";console.log("\uD83D\uDD17 API CALL: fetchResultsByUuids(".concat(e.length," UUIDs)"));let n=new URLSearchParams;for(let t of e)n.append("uuid",t);t&&t.trim()&&n.set("query",t.trim()),void 0!==o&&n.set("alpha",o.toString());let i=void 0!==s?s:.4;("max_distance"===a||"both"===a)&&n.set("max_vector_distance",i.toString()),("min_score"===a||"both"===a)&&n.set("min_original_vector_score",(1-i).toString());let c="".concat(r,"/discover/lookup?").concat(n.toString()),l=await fetch(c);if(!l.ok)throw console.error("Failed to fetch results by UUIDs:",l.statusText),Error("Failed to fetch results by UUIDs: ".concat(l.statusText));try{return(await l.json()).results||[]}catch(e){console.error("Failed to parse JSON response from fetchResultsByUuids:",e);try{var d,u;let t=await l.clone().text(),o=t.length,r=null==(u=e.message)||null==(d=u.match(/position (\d+)/))?void 0:d[1];if(r){let e=parseInt(r),s=Math.max(0,e-100),a=Math.min(o,e+100),n=t.substring(s,a);console.error("JSON parse error at position ".concat(e,":"),{snippet:n,textLength:o,responseSize:l.headers.get("content-length")})}}catch(e){console.error("Could not read response text:",e)}throw Error("Failed to parse JSON response: ".concat(e.message))}}async function i(e,t,o,s){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"min_score";console.log("\uD83D\uDD17 API CALL: fetchResultByUuid(".concat(e,")"));let n=new URLSearchParams,i=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)||/^[0-9a-f]{32}$/i.test(e);i?n.set("uuid",e):n.set("slug",e),t&&t.trim()&&n.set("query",t.trim()),void 0!==o&&n.set("alpha",o.toString());let c=void 0!==s?s:.4;("max_distance"===a||"both"===a)&&n.set("max_vector_distance",c.toString()),("min_score"===a||"both"===a)&&n.set("min_original_vector_score",(1-c).toString());let l="".concat(r,"/discover/lookup?").concat(n.toString()),d=await fetch(l);if(!d.ok&&i&&404===d.status){console.log("UUID lookup failed for ".concat(e,", trying as slug..."));let n=new URLSearchParams;n.set("slug",e),t&&t.trim()&&n.set("query",t.trim()),void 0!==o&&n.set("alpha",o.toString());let i=void 0!==s?s:.4;("max_distance"===a||"both"===a)&&n.set("max_vector_distance",i.toString()),("min_score"===a||"both"===a)&&n.set("min_original_vector_score",(1-i).toString());let c="".concat(r,"/discover/lookup?").concat(n.toString()),l=await fetch(c);if(l.ok){let e=await l.json();return window.__lastLookupResponse=e,e.results[0]}}if(!d.ok)throw console.error("Failed to fetch result by UUID:",d.statusText),Error("Failed to fetch result by UUID: ".concat(d.statusText));let u=await d.json();return window.__lastLookupResponse=u,u.results[0]}async function c(e){let t=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,o=(e.match(/\)/g)||[]).length;if(o>t){let r=o-t,s=e;for(let e=0;e<r;e++)s.endsWith(")")&&(s=s.slice(0,-1));return s!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(s,'" (removed ').concat(r," extra closing brackets)")),s}}return e}(e),o=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(t)));if(!o.ok){if(403===o.status||429===o.status||451===o.status)try{let e=new URL(t),o=e.hostname,r=e.origin;return{title:o,description:"Link to ".concat(o),image:"".concat(r,"/favicon.ico"),url:t,siteName:o,type:"website",favicon:"".concat(r,"/favicon.ico"),originalUrl:t,finalUrl:t,isFallback:!0}}catch(e){return{title:t,description:"",image:"",url:t,siteName:"",type:"website",favicon:"",originalUrl:t,finalUrl:t,isFallback:!0}}throw Error("Failed to fetch OpenGraph data")}return o.json()}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,r]=e;r.length>0&&r.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(r,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch aggregate data");return o.json()}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,r]=e;r.length>0&&r.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(r,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch numeric values");return o.json()}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,r]=e;r.length>0&&r.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(r,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch word cloud data");return o.json()}async function h(){let e=await fetch("".concat(r,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}async function g(e){let t=new URLSearchParams;e.ancestor_uuid&&t.set("ancestor_uuid",e.ancestor_uuid),e.query&&e.query.trim()&&t.set("query",e.query.trim()),void 0!==e.num_results&&t.set("num_results",e.num_results.toString()),void 0!==e.offset&&t.set("offset",e.offset.toString());let o=void 0!==e.alpha?e.alpha:.5;t.set("alpha",o.toString());let s=e.max_distance_mode||"min_score",a=void 0!==e.max_vector_distance?e.max_vector_distance:.4;if(("max_distance"===s||"both"===s)&&t.set("max_vector_distance",a.toString()),("min_score"===s||"both"===s)&&t.set("min_original_vector_score",(1-a).toString()),void 0!==e.direct_match_weight){let o=e.direct_match_weight<=.5?4*e.direct_match_weight:16*e.direct_match_weight-6;t.set("direct_match_weight",o.toString())}e.sort_order&&t.set("sort_order",e.sort_order);let n="".concat(r,"/discover/get-variables?").concat(t.toString());console.log("\uD83D\uDD17 API CALL: fetchVariables(".concat(n,")"));let i=await fetch(n);if(!i.ok)throw console.error("Failed to fetch variables:",i.statusText),Error("Failed to fetch variables: ".concat(i.statusText));let c=await i.json();return window.__lastVariablesResponse=c,console.log("Variables API response cached in window.__lastVariablesResponse for debugging"),{results:c.results||[],num_hits:c.num_hits,next_page_offset:c.next_page_offset}}}}]);