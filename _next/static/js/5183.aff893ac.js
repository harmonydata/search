"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5183],{75183:(e,t,o)=>{o.d(t,{AV:()=>h,CO:()=>u,Dd:()=>n,Hu:()=>r,Pn:()=>c,U4:()=>l,Y3:()=>g,dh:()=>d,v5:()=>i,w3:()=>s});let a="https://harmonydataweaviate.azureedge.net";async function n(){let e=await fetch("".concat(a,"/discover/aggregate"),{method:"GET"});if(!e.ok){let t=await e.text();throw console.error("fetchAggregateFilters error. Status:",e.status,"Response:",t),Error("Failed to fetch aggregate filters")}let t=await e.json();window.__lastAggregateResponse=t,console.log("Aggregate API response cached in window.__lastAggregateResponse for debugging"),console.log("Aggregate response:",{aggregationKeys:Object.keys(t.aggregations||{}),sampleKeys:Object.keys(t.aggregations||{}).slice(0,3).map(e=>({key:e,value:t.aggregations[e]}))});let o=t.aggregations||{};return Object.keys(o).map(e=>{let t,a=o[e];if(["num_sweeps","sample_size","duration_years","age_lower","age_upper","start_year","end_year"].includes(e)&&"object"==typeof a&&!Array.isArray(a)&&void 0!==a.minimum&&void 0!==a.maximum){let e=Math.floor(a.minimum),o=Math.ceil(a.maximum),n=[],r=Math.min(100,o-e+1),s=(o-e)/(r-1);for(let t=0;t<r;t++)n.push(String(Math.round(e+t*s)));t=n}else t=Object.keys(a);return{id:e,label:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),options:t,frequencies:"object"!=typeof a||Array.isArray(a)?void 0:a}})}async function r(e,t){var o,n,r;arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s,i,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,l=!(arguments.length>4)||void 0===arguments[4]||arguments[4],g=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,d=(arguments.length>7&&arguments[7],arguments.length>8?arguments[8]:void 0),u=arguments.length>9?arguments[9]:void 0,_=arguments.length>10?arguments[10]:void 0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"min_score",m=t&&Object.keys(t).length>0;if(!e&&!m)return{results:[],aggregations:{},num_hits:0};let p=e&&""!==e.trim()?e.trim():"",v=h&&h.length>0&&!l,w=l?"search2":"search",y="".concat(a,"/discover/").concat(w);if(v){s=y;let e={query:[p],num_results:c,offset:0};void 0!==g&&(e.alpha=g),h&&h.length>0&&(e.top_level_ids_seen_so_far=h),t&&Object.entries(t).forEach(t=>{let[o,a]=t;a.length>0&&(o.endsWith("_min")||o.endsWith("_max")?e[o]=parseInt(a[0],10):e[o]=a)}),void 0!==d&&(e.return_variables_within_parent=d);let o=void 0!==u?u:.4;("max_distance"===f||"both"===f)&&(e.max_vector_distance=o),("min_score"===f||"both"===f)&&(e.min_original_vector_score=1-o),void 0!==_&&(e.direct_match_weight=_<=.5?4*_:16*_-6),i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},console.log("Using POST request for pagination with body:",{query:[p],topLevelIdsCount:(null==h?void 0:h.length)||0,offset:0,endpoint:w})}else{let e=new URLSearchParams;void 0!==g&&e.set("alpha",g.toString()),e.append("query",p),e.set("num_results",c.toString()),e.set("offset","0");let o={};if(t)for(let a in t){let n=a;if(a.endsWith("_min")||a.endsWith("_max")){let r=a.replace(/_(min|max)$/,"");o[r]||(o[r]={}),a.endsWith("_min")?o[r].min=t[a][0]:o[r].max=t[a][0],e.append(n,t[a][0])}else t[a].forEach(t=>{e.append(n,t)})}void 0!==d&&e.set("return_variables_within_parent",d.toString());let a=void 0!==u?u:.4;("max_distance"===f||"both"===f)&&e.set("max_vector_distance",a.toString()),("min_score"===f||"both"===f)&&e.set("min_original_vector_score",(1-a).toString()),void 0!==_&&e.set("direct_match_weight",(_<=.5?4*_:16*_-6).toString()),s="".concat(y,"?").concat(e.toString()),i={method:"GET"},Object.keys(o).length>0&&console.log("Numeric range parameters:",o),console.log("Using GET request:",s)}let b=await fetch(s,i);if(!b.ok)throw console.error("Search API error:",b.status,await b.text()),Error("Search API request failed");let S=await b.json(),k=new Set(h||[]),x=[];return S.results&&Array.isArray(S.results)&&S.results.forEach(e=>{var t,o,a;let n=(null==(t=e.extra_data)?void 0:t.uuid)||(null==(a=e.dataset_schema)||null==(o=a.identifier)?void 0:o[0]);n&&(k.has(n)?x.push(n):k.add(n))}),x.length>0&&(alert("⚠️ Duplicate results detected!\n\n"+"Found ".concat(x.length," duplicate result(s) that were already seen.\n")+"This shouldn't happen with offset-based pagination.\n\n"+"Duplicate IDs: ".concat(x.slice(0,5).join(", ")).concat(x.length>5?"...":"","\n\n")+"Please check the console for more details."),console.error("Duplicate results detected:",{count:x.length,ids:x,currentOffset:0,resultsReturned:(null==(o=S.results)?void 0:o.length)||0})),window.__lastSearchResponse=S,console.log("Search API response cached in window.__lastSearchResponse for debugging"),console.log("Search results:",{totalHits:S.num_hits,resultCount:(null==(n=S.results)?void 0:n.length)||0,firstResult:null==(r=S.results)?void 0:r[0],aggregations:Object.keys(S.aggregations||{}),endpoint:w,method:v?"POST":"GET",hybridWeight:g,offset:0,duplicatesDetected:x.length}),{results:S.results||[],aggregations:S.aggregations||{},num_hits:S.num_hits,top_level_ids_seen_so_far:Array.from(k),next_page_offset:S.next_page_offset}}async function s(e,t,o,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"min_score";console.log("\uD83D\uDD17 API CALL: fetchResultByUuid(".concat(e,")"));let s=new URLSearchParams,i=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)||/^[0-9a-f]{32}$/i.test(e);i?s.set("uuid",e):s.set("slug",e),t&&t.trim()&&s.set("query",t.trim()),void 0!==o&&s.set("alpha",o.toString());let c=void 0!==n?n:.4;("max_distance"===r||"both"===r)&&s.set("max_vector_distance",c.toString()),("min_score"===r||"both"===r)&&s.set("min_original_vector_score",(1-c).toString());let l="".concat(a,"/discover/lookup?").concat(s.toString()),g=await fetch(l);if(!g.ok&&i&&404===g.status){console.log("UUID lookup failed for ".concat(e,", trying as slug..."));let s=new URLSearchParams;s.set("slug",e),t&&t.trim()&&s.set("query",t.trim()),void 0!==o&&s.set("alpha",o.toString());let i=void 0!==n?n:.4;("max_distance"===r||"both"===r)&&s.set("max_vector_distance",i.toString()),("min_score"===r||"both"===r)&&s.set("min_original_vector_score",(1-i).toString());let c="".concat(a,"/discover/lookup?").concat(s.toString()),l=await fetch(c);if(l.ok){let e=await l.json();return window.__lastLookupResponse=e,e.results[0]}}if(!g.ok)throw console.error("Failed to fetch result by UUID:",g.statusText),Error("Failed to fetch result by UUID: ".concat(g.statusText));let h=await g.json();return window.__lastLookupResponse=h,h.results[0]}async function i(e){let t=function(e){if(!e||"string"!=typeof e)return e;if(e.endsWith(")")){let t=(e.match(/\(/g)||[]).length,o=(e.match(/\)/g)||[]).length;if(o>t){let a=o-t,n=e;for(let e=0;e<a;e++)n.endsWith(")")&&(n=n.slice(0,-1));return n!==e&&console.log('Cleaned URL: "'.concat(e,'" -> "').concat(n,'" (removed ').concat(a," extra closing brackets)")),n}}return e}(e),o=await fetch("https://harmonydata.azureedge.net/api/ogData?url=".concat(encodeURIComponent(t)));if(!o.ok){if(403===o.status||429===o.status||451===o.status)try{let e=new URL(t),o=e.hostname,a=e.origin;return{title:o,description:"Link to ".concat(o),image:"".concat(a,"/favicon.ico"),url:t,siteName:o,type:"website",favicon:"".concat(a,"/favicon.ico"),originalUrl:t,finalUrl:t,isFallback:!0}}catch(e){return{title:t,description:"",image:"",url:t,siteName:"",type:"website",favicon:"",originalUrl:t,finalUrl:t,isFallback:!0}}throw Error("Failed to fetch OpenGraph data")}return o.json()}async function c(){let e=await fetch("".concat(a,"/info/version"));if(!e.ok)throw console.error("Failed to fetch version info:",e.statusText),Error("Failed to fetch version info");let t=await e.json();return window.__lastVersionResponse=t,console.log("Version API response cached in window.__lastVersionResponse for debugging"),t}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,a]=e;a.length>0&&a.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(a,"/discover/aggregate?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch aggregate data");return o.json()}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,a]=e;a.length>0&&a.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(a,"/discover/get_numeric_values?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch numeric values");return o.json()}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[o,a]=e;a.length>0&&a.forEach(e=>{t.append(o,e)})});let o=await fetch("".concat(a,"/discover/get_word_cloud?").concat(t.toString()),{headers:{accept:"application/json"}});if(!o.ok)throw Error("Failed to fetch word cloud data");return o.json()}async function d(){let e=await fetch("".concat(a,"/discover/sources"),{headers:{accept:"application/json"}});if(!e.ok)throw Error("Failed to fetch sources data");return e.json()}async function u(e){let t=new URLSearchParams;e.ancestor_uuid&&t.set("ancestor_uuid",e.ancestor_uuid),e.query&&e.query.trim()&&t.set("query",e.query.trim()),void 0!==e.num_results&&t.set("num_results",e.num_results.toString()),void 0!==e.offset&&t.set("offset",e.offset.toString()),void 0!==e.alpha&&t.set("alpha",e.alpha.toString());let o=e.max_distance_mode||"min_score",n=void 0!==e.max_vector_distance?e.max_vector_distance:.4;if(("max_distance"===o||"both"===o)&&t.set("max_vector_distance",n.toString()),("min_score"===o||"both"===o)&&t.set("min_original_vector_score",(1-n).toString()),void 0!==e.direct_match_weight){let o=e.direct_match_weight<=.5?4*e.direct_match_weight:16*e.direct_match_weight-6;t.set("direct_match_weight",o.toString())}let r="".concat(a,"/discover/get-variables?").concat(t.toString());console.log("\uD83D\uDD17 API CALL: fetchVariables(".concat(r,")"));let s=await fetch(r);if(!s.ok)throw console.error("Failed to fetch variables:",s.statusText),Error("Failed to fetch variables: ".concat(s.statusText));let i=await s.json();return window.__lastVariablesResponse=i,console.log("Variables API response cached in window.__lastVariablesResponse for debugging"),{results:i.results||[],num_hits:i.num_hits,next_page_offset:i.next_page_offset}}}}]);