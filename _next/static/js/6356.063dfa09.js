(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6356],{66356:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>M});var o=n(95155),r=n(12115);let s=()=>r.useRef(null);var i=n(50914),l=n(57165),a=n(53326),d=n(68998),c=n(72926),h=n(47821),u=n(66917),p=n(4918),x=n(64364),m=n(2091),y=n(60391),f=n(78416),j=n(36417),b=n(9561),g=n(27753),k=n(14057);let w=(0,k.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),v=(0,k.A)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);var A=n(41983);let C=(0,k.A)("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),R=(0,k.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),z=(0,k.A)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);function _(e){let{variables:t,studyName:f,downloadAnchorEl:j,onDownloadClick:b,onDownloadClose:g}=e,k=(0,r.useRef)(null),R=(0,r.useRef)(null),[z,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(customElements.get("harmony-export"))return;let e=document.createElement("script");return e.src="/app/js/harmony-export.js",e.async=!0,document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[]);let M=[{field:"description",headerName:"Description / Code",flex:2,valueGetter:(e,t)=>(t.description||t.name)+(t.description&&t.name?" ("+t.name+")":""),sortable:!0},{field:"options",headerName:"Response Options",flex:1,valueGetter:(e,t)=>t.options&&Array.isArray(t.options)?t.options.join(" / "):"",sortable:!0}],S=t.filter(e=>e.name||e.description).map((e,t)=>({id:e.uuid||e.name||t,...e})),q=s();(0,r.useEffect)(()=>{let e=setTimeout(()=>{q.current&&_(!0)},200);return()=>clearTimeout(e)},[q]);let E=()=>{let e=q.current;if(!e||!z)return[];try{let t=e.getSelectedRows();return t?Array.from(t.values()):[]}catch(e){return console.warn("Failed to get selected items:",e),[]}},O=()=>E().length,D=()=>{let e=q.current;if(!e||!z)return!1;try{let t=e.getSelectedRows();return t&&"number"==typeof t.size&&t.size>0}catch(e){return!1}},L=(0,r.useCallback)(()=>{if(!k.current||!z)return;let e=E();if(k.current.innerHTML="",0===e.length)return;console.log("selectedItems:",e);let t=e.map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name})),n=document.createElement("harmony-export");n.size="32px",n.instrument_name="".concat(f||"Selected Variables"," from harmonydata.ac.uk/discover"),n.questions=t,k.current.appendChild(n)},[z,f]);(0,r.useEffect)(()=>{if(!z||!q.current)return;let e=q.current.subscribeEvent("rowSelectionChange",()=>{L()});return()=>{e()}},[z,L]);let U=()=>{null==g||g()},N=()=>{let e;let t=q.current;if(!t||!z)return[];try{e=t.getSelectedRows()}catch(t){e=null}return(e&&"number"==typeof e.size&&e.size>0&&e?Array.from(e.values()):(()=>{let e;try{e=t.getRowModels()}catch(t){e=null}return e?Array.from(e.values()):[]})()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name,response_options:e.options&&Array.isArray(e.options)?e.options.join(" / "):""}))},T=async()=>{let e=N(),{utils:t,write:o}=await Promise.all([n.e(3524),n.e(8436)]).then(n.bind(n,7660)),r=t.json_to_sheet(e),s=t.book_new();t.book_append_sheet(s,r,"Questions");let i=new Blob([o(s,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(i),a=document.createElement("a");a.href=l,a.download="questions.xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l),U()};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.default,{sx:{height:"100%",minHeight:400},children:S.length>0&&(0,o.jsx)(i.z,{apiRef:q,paginationMode:"server",rowCount:S.length,rows:S,columns:M,checkboxSelection:!0,sortModel:[{field:"score",sort:"desc"}],getRowClassName:e=>e.row.matched?"matched-row":"",sx:{background:"white",borderRadius:2,fontSize:14,height:"100%","& .matched-row":{backgroundColor:"#fffae4","&:hover":{backgroundColor:"#fff8d1"}}},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,o.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:[(0,o.jsx)(l.e,{expanded:!0,style:{width:"100%"},children:(0,o.jsx)(a.X,{placeholder:"Search within variables",style:{background:"white",borderRadius:192,fontSize:14,margin:15,width:"calc(100% - 15px)",height:"auto"}})}),(0,o.jsx)(c.A,{title:"Harmonise selected items",children:(0,o.jsx)(h.A,{size:"small",sx:{width:40,height:40},children:(0,o.jsx)(d.default,{ref:k,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}})})}),(0,o.jsx)(c.A,{title:D()?"Download ".concat(O()," selected questions"):"Download all questions",children:(0,o.jsx)(h.A,{ref:R,size:"small",onClick:b,sx:{width:40,height:40},children:(0,o.jsx)(w,{size:30})})})]})}})}),(0,o.jsx)(u.Ay,{open:!!j,anchorEl:j,onClose:U,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,o.jsxs)(p.A,{sx:{width:200},children:[(0,o.jsxs)(x.Ay,{onClick:()=>{let e=new Blob([JSON.stringify(N(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="questions.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),U()},sx:{cursor:"pointer"},children:[(0,o.jsx)(m.A,{children:(0,o.jsx)(v,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as JSON"})]}),(0,o.jsxs)(x.Ay,{onClick:()=>{let e=new Blob([[["Question Number","Question Text","Response Options"],...N().map(e=>[e.question_no,e.question_text,e.response_options])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="questions.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),U()},sx:{cursor:"pointer"},children:[(0,o.jsx)(m.A,{children:(0,o.jsx)(A.A,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as CSV"})]}),(0,o.jsxs)(x.Ay,{onClick:T,sx:{cursor:"pointer"},children:[(0,o.jsx)(m.A,{children:(0,o.jsx)(C,{size:20})}),(0,o.jsx)(y.A,{primary:"Download as Excel"})]})]})})]})}function M(e){let{variables:t,studyName:n}=e,[s,i]=(0,r.useState)(!1),l=(0,r.useRef)(null),[a,u]=(0,r.useState)(null),p=()=>{u(null),i(!1)},x=(0,o.jsx)(_,{variables:t,studyName:n,downloadAnchorEl:a,onDownloadClick:e=>{console.log("handleDownloadClick",e.currentTarget),u(l.current)},onDownloadClose:()=>{u(null)}});return s?(0,o.jsxs)(f.A,{ref:l,open:!0,onClose:p,maxWidth:"xl",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh"}},children:[(0,o.jsxs)(j.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,o.jsxs)(b.A,{variant:"h6",children:["Variables - ",n||"Study"]}),(0,o.jsx)(h.A,{onClick:p,size:"small",sx:{color:"text.secondary"},children:(0,o.jsx)(R,{size:20})})]}),(0,o.jsx)(g.A,{sx:{p:0,overflow:"hidden"},children:(0,o.jsx)(d.default,{sx:{height:"100%","& .MuiDataGrid-root":{borderRadius:0,maxHeight:"none",height:"100%"}},children:x})})]}):(0,o.jsxs)(d.default,{ref:l,sx:{position:"relative"},children:[(0,o.jsx)(d.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:1},children:(0,o.jsx)(c.A,{title:"Open in large view",children:(0,o.jsx)(h.A,{size:"small",onClick:()=>{u(null),i(!0)},children:(0,o.jsx)(z,{size:20})})})}),(0,o.jsx)(d.default,{sx:{"& .MuiDataGrid-root":{height:450,borderRadius:2}},children:x})]})}n(67699)},67699:()=>{}}]);