"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7167,7199],{57199:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var s=l(95155),i=l(12115),a=l(35761),n=l(55295),r=l(68998),o=l(9552),d=l(9561),c=l(70152),u=l(22282),h=l(47821),x=l(19579),m=l(6327),g=l(72107),f=l(5565),p=l(10979),v=l(98245);function y(e){let{results:t,resourceTypeFilter:l,onSelectResult:i,selectedResultId:a,onFindSimilar:n,collapsed:o=!1}=e,c=l&&l.length>0?t.filter(e=>{var t,s;return(null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)&&l.map(e=>e.trim().toLowerCase()).includes(null===(s=e.extra_data)||void 0===s?void 0:s.resource_type.trim().toLowerCase())}):t;console.log("SearchResults debug:",{resourceTypeFilter:l,originalResults:t,filteredResults:c});let u=e=>{i&&i(e)};return c.length?(0,s.jsx)(r.default,{children:(0,s.jsx)(p.A,{spacing:1.5,sx:{mb:4},children:c.map((e,t)=>{var l,i;let r=a===(null===(l=e.extra_data)||void 0===l?void 0:l.uuid);return(0,s.jsx)(v.A,{result:e,isSelected:r,onClick:()=>u(e),onFindSimilar:n},(null===(i=e.extra_data)||void 0===i?void 0:i.uuid)||"result-".concat(t))})})}):(0,s.jsx)(r.default,{sx:{textAlign:"center",py:8},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"No results found. Try adjusting your search criteria."})})}var b=l(14030),j=l(76596),_=l(42649),A=l(17146),w=l(63612),S=l(54615),C=l(73179),k=l(20687),F=l(76046),D=l(1234),z=l(64517),I=l(9450),R=l(64364),E=l(22783),T=l(25012),W=l(15325),M=l(66917),P=l(79201),O=l(99489),L=l(15617),q=l(63219),B=l(89026);function N(e){let{useSearch2:t,onEndpointChange:l,hybridWeight:a,onHybridWeightChange:n,maxDistance:o,onMaxDistanceChange:c}=e,[h,x]=(0,i.useState)(null),m=(0,i.useRef)(null),[g,f]=(0,i.useState)(null),[p,v]=(0,i.useState)(!0),y=!!h;return(0,i.useEffect)(()=>{(async()=>{try{let e=await (0,_.Pn)();f(e)}catch(e){console.error("Failed to fetch version info:",e),f({harmony_discovery_version:"Unknown"})}finally{v(!1)}})()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(u.A,{ref:m,variant:"contained",color:"secondary",onClick:()=>{x(m.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:y?(0,s.jsx)(B.A,{}):(0,s.jsx)(q.A,{})}),(0,s.jsx)(d.A,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,s.jsx)(M.Ay,{open:y,anchorEl:h,onClose:()=>{x(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},children:(0,s.jsxs)(r.default,{sx:{p:3,minWidth:280},children:[(0,s.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,s.jsx)(r.default,{sx:{mb:3},children:(0,s.jsx)(P.A,{control:(0,s.jsx)(O.A,{checked:t,onChange:e=>{l(e.target.checked)},color:"primary"}),label:(0,s.jsxs)(r.default,{children:[(0,s.jsx)(d.A,{variant:"body2",fontWeight:500,children:"Search Version"}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",children:t?"Previous Version":p?"Loading...":(null==g?void 0:g.harmony_discovery_version)||"Current Version"})]})})}),(0,s.jsxs)(r.default,{sx:{mb:2},children:[(0,s.jsxs)(d.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",a.toFixed(2)]}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,s.jsx)(r.default,{sx:{px:2,mt:2},children:(0,s.jsx)(L.Ay,{value:a,onChange:(e,t)=>{n(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]}),(0,s.jsxs)(r.default,{sx:{mb:2},children:[(0,s.jsxs)(d.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Max Distance: ",o.toFixed(2)]}),(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the maximum vector distance for semantic search results"}),(0,s.jsx)(r.default,{sx:{px:2,mt:2},children:(0,s.jsx)(L.Ay,{value:o,onChange:(e,t)=>{c(t)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"0"},{value:.4,label:"0.4"},{value:1,label:"1"}]})})]}),(0,s.jsx)(r.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,s.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:[(0,s.jsx)("strong",{children:"Tip:"})," Hybrid weight is automatically adjusted based on query length. Short queries favor keyword search (lower values), while longer queries favor semantic search (higher values)."]})})]})})]})}var V=l(3485),H=l(71900);function U(){var e,t,l,p,v,M,P;let O=(0,a.A)(),L=(0,n.A)(O.breakpoints.down("sm")),q=(0,n.A)(O.breakpoints.down("lg")),{searchSettings:B,updateSearchSettings:U}=(0,w.S)(),[J,K]=(0,i.useState)(B.query),[Q,X]=(0,i.useState)(B.query),[G,Y]=(0,i.useState)([]),[Z,$]=(0,i.useState)([]),[ee,et]=(0,i.useState)(B.selectedCategory),[el,es]=(0,i.useState)(!1),[ei,ea]=(0,i.useState)(!0),[en,er]=(0,i.useState)(!1),[eo,ed]=(0,i.useState)(0),[ec,eu]=(0,i.useState)(1),[eh,ex]=(0,i.useState)(null),[em,eg]=(0,i.useState)(!1),[ef,ep]=(0,i.useState)(!1),[ev,ey]=(0,i.useState)(!1),[eb,ej]=(0,i.useState)(!1),[e_,eA]=(0,i.useState)(null),[ew,eS]=(0,i.useState)(B.useSearch2),[eC,ek]=(0,i.useState)(B.hybridWeight),[eF,eD]=(0,i.useState)(B.hybridWeight),[ez,eI]=(0,i.useState)(B.maxDistance),[eR,eE]=(0,i.useState)(B.maxDistance),[eT,eW]=(0,i.useState)(null),[eM,eP]=(0,i.useState)(null),[eO,eL]=(0,i.useState)([]),[eq,eB]=(0,i.useState)(void 0),[eN,eV]=(0,i.useState)([]),[eH,eU]=(0,i.useState)(!1),[eJ,eK]=(0,i.useState)(!1),[eQ,eX]=(0,i.useState)(!1),[eG,eY]=(0,i.useState)(!1),{currentUser:eZ}=(0,A.A)();(0,i.useEffect)(()=>{U({query:J,selectedFilters:B.selectedFilters,selectedCategory:ee,useSearch2:ew,hybridWeight:eC,maxDistance:ez})},[J,B.selectedFilters,ee,ew,eC,ez,U]),(0,i.useEffect)(()=>{eX(!1)},[J,B.selectedFilters,ew,eC,ez,ee]),(0,i.useEffect)(()=>{let e=B.query&&""!==B.query.trim(),t=Object.keys(B.selectedFilters).length>0;!eG&&(e||t)&&(eY(!0),tb(B.query||"",1))},[B,eG,tb]),(0,i.useEffect)(()=>{eY(!1)},[]);let e$=(0,F.useSearchParams)(),e0=e$.get("resource_type"),e1=e$.get("like"),e2=e$.get("query"),e5=e$.getAll("topics"),e4=e$.getAll("instruments"),e6=e$.getAll("study_design");(0,i.useEffect)(()=>{if(e2||e5.length>0||e4.length>0||e6.length>0){let e={};e5.length>0&&(e.keywords=e5),e4.length>0&&(e.instruments=e4),e6.length>0&&(e.study_design=e6),e0&&(e.resource_type=[e0]),U({query:e2||"",selectedFilters:e,selectedCategory:null,resourceType:e0,similarUid:e1})}},[]);let e3=(0,F.useRouter)();(0,i.useEffect)(()=>{let e=!1;if(e2&&(K(e2),X(e2),e=!0),e5&&e5.length>0&&(!B.selectedFilters.keywords||B.selectedFilters.keywords.join(",")!==e5.join(","))&&(U({...B,selectedFilters:{...B.selectedFilters,keywords:e5}}),e=!0),e4&&e4.length>0&&(!B.selectedFilters.instruments||B.selectedFilters.instruments.join(",")!==e4.join(","))&&(U({...B,selectedFilters:{...B.selectedFilters,instruments:e4}}),e=!0),e6&&e6.length>0&&(!B.selectedFilters.study_design||B.selectedFilters.study_design.join(",")!==e6.join(","))&&(U({...B,selectedFilters:{...B.selectedFilters,study_design:e6}}),e=!0),e){let e=new URL(window.location.href);e.searchParams.delete("query"),e.searchParams.delete("topics"),e.searchParams.delete("instruments"),e.searchParams.delete("study_design");let t=e.pathname.replace("/search","");console.log("Navigating to:",t+e.search),e3.replace(t+e.search)}},[e2,e5,e4,e6]);let e9=(0,i.useMemo)(()=>e0?[e0]:[],[e0]),e7=(0,i.useRef)(Q),e8=(0,i.useRef)(JSON.stringify(B.selectedFilters)),te=(0,i.useRef)(ew),tt=(0,i.useRef)(eF),tl=(0,i.useRef)(eR),ts=(0,i.useRef)(eO);(0,i.useRef)(!1);let ti=(0,i.useRef)([]),ta=(0,i.useRef)(void 0),tn=(0,i.useCallback)(e=>{if(!e||""===e.trim()||"*"===e)return .5;let t=e.trim();return eN.some(e=>t.toLowerCase()===e.toLowerCase())?0:.5},[eN]),tr=(0,i.useCallback)(e=>{eS(e)},[]),to=(0,i.useCallback)(e=>{ek(e)},[]),td=(0,i.useCallback)(e=>{eI(e)},[]);(0,i.useEffect)(()=>{let e=tn(Q);ek(e),eD(e)},[Q,tn]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{X(J)},500);return()=>{clearTimeout(e)}},[J]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{eD(eC)},300);return()=>{clearTimeout(e)}},[eC]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{eE(ez)},300);return()=>{clearTimeout(e)}},[ez]),(0,i.useEffect)(()=>{(async()=>{if(!eH)try{let e=await (0,_.Qf)();eV(e),eU(!0)}catch(e){console.error("Failed to fetch keyword phrases:",e),eU(!0)}})()},[eH]);let tc=(0,i.useCallback)(e=>{ex(e),L?eg(!0):ey(!0)},[L]),tu=(0,i.useCallback)(e=>{console.log("Selected result:",e),tc(e)},[tc]),th=(0,i.useCallback)(()=>{eg(!1)},[]),tx=(0,i.useCallback)(()=>{!L&&eh&&ey(!0)},[L,eh]),tm=(0,i.useCallback)(()=>{L||ey(e=>!e)},[L]);(0,i.useEffect)(()=>{(async function(){try{console.log("Fetching initial aggregations..."),es(!0),ej(!1);let e=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),t=await Promise.race([(0,_.Dd)(),e]),l=tj(t);$(l),console.log("Initial aggregations set:",l.length,"filters"),es(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),ej(!0),es(!1)}})()},[]),(0,i.useEffect)(()=>{G.length>0&&!eh?ex(G[0]):G.length>0&&eh?G.some(e=>{var t,l;return(null===(t=e.extra_data)||void 0===t?void 0:t.uuid)===(null===(l=eh.extra_data)||void 0===l?void 0:l.uuid)})||ex(G[0]):0===G.length&&ex(null)},[G,eh]),(0,i.useEffect)(()=>{ep(!1)},[eh]);let tg=(0,i.useCallback)(e=>{var t,l,s;let i=null===(l=e.extra_data)||void 0===l?void 0:null===(t=l.resource_type)||void 0===t?void 0:t.includes("variable"),a=Array.isArray(e.ancestors)&&e.ancestors.length>0;return i&&a&&(null===(s=e.ancestors)||void 0===s?void 0:s[0])||e},[]),tf=async()=>{if(eZ&&J.trim()&&!eJ){eK(!0),eX(!1);try{let e={query:J,filters:B.selectedFilters,useSearch2:ew,hybridWeight:eC,maxDistance:ez,selectedCategory:ee,resultCount:G.length,uid:eZ.uid,created:(0,S.serverTimestamp)()};console.log("Saving search:",e,C.db),await (0,S.addDoc)((0,S.collection)(C.db,"saved_searches"),e),eX(!0)}catch(e){console.error("Error saving search:",e)}finally{eK(!1)}}},[tp,tv]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(!eh){tv(null);return}tv(tg(eh))},[eh,tg]),(0,i.useEffect)(()=>{(async function(){if(e1)try{var e,t;es(!0);let l=await (0,_.w3)(e1,void 0,void 0,eR);eA(l);let s=(null===(e=l.dataset_schema)||void 0===e?void 0:e.description)||(null===(t=l.extra_data)||void 0===t?void 0:t.description);if(!s)throw Error("No description available for similar search");K(s),X(s);let i=tn(s),a=await (0,_.Hu)(s,{},1,50,ew,i,void 0,void 0,void 0,eR);Y(a.results||[]),ed(a.num_hits||0)}catch(e){console.error("Failed to load similar studies:",e),ej(!0)}finally{es(!1)}})()},[e1,50,ew,eF]),(0,i.useEffect)(()=>{var e,t;let l=Q!==e7.current||JSON.stringify(B.selectedFilters)!==e8.current||ew!==te.current||eF!==tt.current||eR!==tl.current,s=e1&&((null==e_?void 0:null===(e=e_.dataset_schema)||void 0===e?void 0:e.description)||(null==e_?void 0:null===(t=e_.extra_data)||void 0===t?void 0:t.description))||Q;l&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),Y([]),eL([]),ti.current=[],eB(void 0),ta.current=void 0,1!==ec&&eu(1),tb(s,1).finally(()=>{e7.current=Q,e8.current=JSON.stringify(B.selectedFilters),te.current=ew,tt.current=eF,tl.current=eR,ts.current=eO}))},[Q,B.selectedFilters,e1,e_,ew,eF,eR]),(0,i.useEffect)(()=>{if(ec>1){var e,t;console.log("\uD83D\uDCC4 Page changed to:",ec,"- loading more results"),tb(e1&&((null==e_?void 0:null===(e=e_.dataset_schema)||void 0===e?void 0:e.description)||(null==e_?void 0:null===(t=e_.extra_data)||void 0===t?void 0:t.description))||Q,ec)}},[ec]);let ty=(0,i.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:en,hasMoreResults:ei,currentPage:ec,resultsLength:G.length}),en||!ei){console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:en,hasMoreResults:ei});return}let e=ec+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),eu(e)},[en,ei,ec]);async function tb(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0,l=void 0!==t?t:ec;1===l?es(!0):er(!0),ej(!1);let s=Date.now();1===l&&(ea(!0),er(!1));try{var i,a;let t;let n={...B.selectedFilters};e0&&(n.resource_type=[e0]),Object.keys(n).forEach(e=>{Array.isArray(n[e])&&0===n[e].length&&delete n[e]});let r="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(r)),console.log("Search query:",e||"(empty)"),console.log("Filters:",n),console.log("Page:",l),console.log("Results per page:",50),console.log("Use Search2:",ew),console.log("Similar UID (will be excluded):",e1||"None"),console.log("Top Level IDs Seen:",l>1?eO:"First page");let o=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),d=Date.now();l>1?t=ti.current:e1&&(t=[e1],console.log("Excluding original study from similar search:",e1));let c=tn(e),u=await Promise.race([(0,_.Hu)(e,n,l,50,ew,c,t,l>1?ta.current:void 0,void 0,eR),o]),h=Date.now()-d;eP(h),console.log("Response received:",{requestId:r,numHits:u.num_hits,resultCount:(null===(i=u.results)||void 0===i?void 0:i.length)||0,apiTime:"".concat(h,"ms"),results:null===(a=u.results)||void 0===a?void 0:a.map(e=>{var t,l,s,i;return{id:null===(t=e.extra_data)||void 0===t?void 0:t.uuid,title:null===(l=e.dataset_schema)||void 0===l?void 0:l.name,type:(null===(s=e.extra_data)||void 0===s?void 0:s.resource_type)||(null===(i=e.dataset_schema)||void 0===i?void 0:i["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd();let x=u.results||[];if(u.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:u.top_level_ids_seen_so_far.length,sample:u.top_level_ids_seen_so_far.slice(0,5),previousCount:eO.length}),eL(u.top_level_ids_seen_so_far),ti.current=u.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response"),void 0!==u.next_page_offset?(console.log("Received next_page_offset:",{offset:u.next_page_offset,previousOffset:ta.current}),eB(u.next_page_offset),ta.current=u.next_page_offset):console.log("No next_page_offset in response (using calculated offset)"),1===l){if(Y(x),ed(u.num_hits||0),ew)ea(50===x.length&&x.length<(u.num_hits||0));else{let e=x.length>0;ea(e),(!e||x.length<50)&&ed(Math.max(u.num_hits||0,x.length)),x.length>0&&x.length<50&&x.length<20&&(console.log("\uD83D\uDD04 Auto-loading next page from first page - insufficient results:",{gotResults:x.length,requestedResults:50,minThreshold:20,nextPage:2}),setTimeout(()=>{!en&&ei&&eu(2)},100))}}else if(Y(e=>{if(!ew&&x.length>0){let t;t=1===l?x.length:e.length+x.length,x.length<50&&t<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:x.length,requestedResults:50,currentTotal:t,minThreshold:20,nextPage:l+1}),setTimeout(()=>{!en&&ei&&eu(l+1)},100))}return[...e,...x]}),ew)ea(50===x.length);else{let e=x.length>0;ea(e),e||ed(Math.max(eo,G.length+x.filter(e=>!G.some(t=>{var l,s;return(null===(l=t.extra_data)||void 0===l?void 0:l.uuid)===(null===(s=e.extra_data)||void 0===s?void 0:s.uuid)})).length))}let m=Date.now();eW(m-s)}catch(e){console.error("Search failed:",e),ej(!0),eW(null),eP(null)}finally{es(!1),er(!1)}}let tj=e=>{let t=[],l=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_variables","num_sweeps"],s=1/0,i=-1/0;if(Object.entries(e).forEach(e=>{let[a,n]=e;if("age_lower"===a||"age_upper"===a||"age_min"===a||"age_max"===a){let e=n.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let l=e.maximum;"number"==typeof l&&isFinite(l)||(l=e.max),"number"==typeof t&&isFinite(t)&&(s=Math.min(s,t)),"number"==typeof l&&isFinite(l)&&(i=Math.max(i,l));return}if(l.includes(a)){let e,l;let s=n.statistics||{};"number"==typeof s.minimum&&isFinite(s.minimum)?e=s.minimum:"number"==typeof s.min&&isFinite(s.min)?e=s.min:(console.warn("Missing valid min value for ".concat(a,", using default")),e="sample_size"===a?0:"start_year"===a||"end_year"===a?1900:0),"number"==typeof s.maximum&&isFinite(s.maximum)?l=s.maximum:"number"==typeof s.max&&isFinite(s.max)?l=s.max:(console.warn("Missing valid max value for ".concat(a,", using default")),l="sample_size"===a?1e5:"start_year"===a||"end_year"===a?2024:"duration_years"===a?100:"num_variables"===a?1e4:"num_sweeps"===a?50:100),l<=e&&(l=e+1);let i=Array.from({length:101},(t,s)=>String(e+s/100*(l-e)));t.push({id:a,label:a.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:i})}else{let e=n.buckets||[];e.length>0&&t.push({id:a,label:a.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(s)&&isFinite(i)&&s<=i){i<=s&&(i=s+1);let e=Array.from({length:101},(e,t)=>String(s+t/100*(i-s)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},t_=(0,i.useCallback)(async e=>{var t,l,s,i,a;let n=null===(t=e.extra_data)||void 0===t?void 0:t.uuid;if(!n)return;let r=(null===(l=e.dataset_schema)||void 0===l?void 0:l.name)||(null===(s=e.extra_data)||void 0===s?void 0:s.name)||"Unnamed Study";K("LIKE:".concat(r," (").concat(n,")"));let o=(null===(i=e.dataset_schema)||void 0===i?void 0:i.description)||(null===(a=e.extra_data)||void 0===a?void 0:a.description);o?(X(o),tA(o)):(console.warn("No description available for study ".concat(r,", using name for similar search")),X(r),tA(r))},[]),tA=async e=>{es(!0),ej(!1);try{let t;let l={...B.selectedFilters};e0&&(l.resource_type=[e0]),Object.keys(l).forEach(e=>{Array.isArray(l[e])&&0===l[e].length&&delete l[e]});let s=e,i=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);i&&(t=i[2],s="LIKE:".concat(t));let a=tn(s),n=await (0,_.Hu)(s,l,ec,50,ew,a,t?[t]:ec>1?ti.current:void 0,ec>1?ta.current:void 0,void 0,eR);Y(n.results||[]),ed(n.num_hits||0)}catch(e){ej(!0)}finally{es(!1)}};return(0,s.jsx)(r.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,s.jsxs)(o.A,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,s.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:e1?(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,s.jsx)(r.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==e_?void 0:null===(e=e_.dataset_schema)||void 0===e?void 0:e.image)?(0,s.jsx)(f.default,{src:(null==e_?void 0:e_.dataset_schema).image,alt:(null==e_?void 0:null===(t=e_.dataset_schema)||void 0===t?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,l;let i=(null==e?void 0:null===(t=e.extra_data)||void 0===t?void 0:t.resource_type)||(null==e?void 0:null===(l=e.dataset_schema)||void 0===l?void 0:l["@type"]);return(null==i?void 0:i.includes("dataset"))?(0,s.jsx)(D.A,{size:48}):(null==i?void 0:i.includes("variable"))?(0,s.jsx)(z.A,{size:48}):(null==i?void 0:i.includes("study"))?(0,s.jsx)(I.A,{size:48}):(0,s.jsx)(R.A,{size:48})})(e_)}),(0,s.jsxs)(r.default,{children:[(0,s.jsx)(d.A,{variant:"h4",gutterBottom:!0,children:(null==e_?void 0:null===(l=e_.dataset_schema)||void 0===l?void 0:l.name)||(null==e_?void 0:null===(p=e_.extra_data)||void 0===p?void 0:p.name)||"Unnamed Study"}),(0,s.jsx)(d.A,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{fullWidth:!0,placeholder:"What are you searching for?",value:J,onChange:e=>{K(e.target.value)},InputProps:{endAdornment:(0,s.jsxs)(r.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[J!==Q&&(0,s.jsx)(d.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Typing..."}),(0,s.jsx)(f.default,{src:(0,V.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,s.jsx)(r.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,s.jsx)(N,{useSearch2:ew,onEndpointChange:tr,hybridWeight:eC,onHybridWeightChange:to,maxDistance:ez,onMaxDistanceChange:td})})]})}),(0,s.jsx)(b.A,{filtersData:Z,onSelectionChange:(e,t)=>{U({selectedFilters:{...B.selectedFilters,[e]:t}})},selectedFilters:B.selectedFilters}),!eb&&(0,s.jsxs)(r.default,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:[el?"Searching...":ei?G.length>eo?"".concat(G.length," results loaded (").concat(eo,"+ estimated)"):eo>0?"".concat(G.length," of ~").concat(eo," results loaded"):"".concat(G.length," results loaded"):"".concat(G.length," results found"),!el&&eM&&" (API: ".concat(eM,"ms"),!el&&eT&&eM&&", Total: ".concat(eT,"ms)")]}),eZ&&(0,s.jsx)(u.A,{variant:"outlined",size:"small",startIcon:eQ?(0,s.jsx)(k.A,{size:16,fill:"currentColor"}):(0,s.jsx)(k.A,{size:16}),onClick:tf,disabled:eJ||!J.trim()||el,sx:{ml:2,color:eQ?"success.main":"inherit",borderColor:eQ?"success.main":"inherit"},title:"Save this search",children:eJ?"Saving...":eQ?"Saved!":"Save Search"})]}),(0,s.jsxs)(r.default,{sx:{display:L?"block":"flex",width:"100%",flex:1,minHeight:0,overflow:"visible",position:"relative"},children:[(0,s.jsx)(r.default,{sx:{width:q?"100%":"50%",minWidth:L?"100%":"300px",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:el?(0,s.jsx)(d.A,{children:"Loading search results..."}):eb?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,s.jsx)(g.A,{sx:{fontSize:{xs:48,sm:64},color:"text.secondary",mb:2}}),(0,s.jsx)(d.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,s.jsx)(d.A,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,s.jsx)(u.A,{variant:"contained",sx:{mt:4},onClick:()=>{ej(!1),tb()},children:"Retry Connection"})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,s.jsx)(H.A,{dataLength:G.length,next:ty,hasMore:ei,loader:!Q&&(!B.selectedFilters||Object.values(B.selectedFilters).every(e=>0===e.length))?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",py:6,textAlign:"center"},children:[(0,s.jsx)(d.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Enter a search term or select some filters to begin"}),(0,s.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"Use the search bar above or apply filters to discover studies"})]}):(0,s.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,s.jsx)(E.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,s.jsx)(d.A,{children:"No more results to load."}),children:(0,s.jsx)(y,{results:G,resourceTypeFilter:e9,onSelectResult:tu,selectedResultId:null==eh?void 0:null===(v=eh.extra_data)||void 0===v?void 0:v.uuid,onFindSimilar:t_})})})})}),!L&&(G.length>0||eo>0)&&(0,s.jsxs)(r.default,{sx:{position:"absolute",top:0,right:0,width:ev?"calc(100% - 130px)":q?"0%":"50%",height:"100%",bgcolor:"background.paper",borderLeft:q&&!ev?"none":"1px solid",borderColor:"grey.200",display:"flex",flexDirection:"column",overflow:"visible",transition:"width 0.3s ease-in-out",cursor:eh?"pointer":"default",zIndex:ev?2:1,boxShadow:ev?"-4px 0 8px rgba(0, 0, 0, 0.1)":"none"},onClick:tx,children:[(0,s.jsx)(r.default,{sx:{position:"absolute",top:-16,left:-16,zIndex:1e3},children:(0,s.jsx)(h.A,{onClick:e=>{e.stopPropagation(),tm()},sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2,width:30,height:30},children:ev?(0,s.jsx)(W.A,{size:20}):(0,s.jsx)(T.A,{size:20})})}),eb?(0,s.jsxs)(r.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,s.jsx)(g.A,{sx:{fontSize:{xs:36,sm:48},color:"text.secondary",mb:2}}),(0,s.jsx)(d.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,s.jsx)(d.A,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):tp?(0,s.jsx)(r.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,s.jsx)(j.default,{study:tp,isDrawerView:!1})}):(0,s.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"Select a dataset to view details"})})]})]}),(0,s.jsxs)(x.Ay,{anchor:"right",open:L&&em,onClose:th,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,s.jsxs)(r.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,s.jsx)(h.A,{onClick:th,sx:{position:"absolute",top:8,right:8},children:(0,s.jsx)(m.A,{})}),(0,s.jsxs)(r.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(d.A,{variant:"h6",sx:{flex:1},children:eh&&(null===(M=eh.dataset_schema)||void 0===M?void 0:M.name)||"Study Details"}),eh&&(eh.dataset_schema&&eh.dataset_schema.image||eh.image)&&!ef&&(0,s.jsx)(r.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,s.jsx)(f.default,{src:eh.dataset_schema&&eh.dataset_schema.image||eh.image,alt:(null===(P=eh.dataset_schema)||void 0===P?void 0:P.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>ep(!0),unoptimized:!0})})]})]}),(0,s.jsx)(r.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:tp?(0,s.jsx)(j.default,{studyDataComplete:!1,study:tp,isDrawerView:!0}):(0,s.jsx)(r.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,s.jsx)(d.A,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]})})}function J(){return(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)(r.default,{sx:{p:4},children:(0,s.jsx)(d.A,{children:"Loading..."})}),children:(0,s.jsx)(U,{})})}},98245:(e,t,l)=>{l.d(t,{A:()=>C});var s=l(95155),i=l(68998),a=l(9561),n=l(47821),r=l(5565),o=l(1234),d=l(64517),c=l(9450),u=l(64364),h=l(52604),x=l(90675),m=l(12115),g=l(53452),f=l(78416),p=l(36417),v=l(27753),y=l(26214),b=l(22282),j=l(2743),_=l(6327),A=l(2599);function w(e){let{open:t,onClose:l,data:r,title:o="Debug Data"}=e,d=()=>{navigator.clipboard.writeText(JSON.stringify(r,null,2))};return(0,s.jsxs)(f.A,{open:t,onClose:l,maxWidth:"lg",fullWidth:!0,sx:{"& .MuiDialog-paper":{maxHeight:"90vh",height:"90vh"}},children:[(0,s.jsxs)(p.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,s.jsx)(a.A,{variant:"h6",component:"div",children:o}),(0,s.jsxs)(i.default,{children:[(0,s.jsx)(n.A,{onClick:d,size:"small",sx:{mr:1},title:"Copy JSON to clipboard",children:(0,s.jsx)(j.A,{fontSize:"small"})}),(0,s.jsx)(n.A,{onClick:l,size:"small",children:(0,s.jsx)(_.A,{fontSize:"small"})})]})]}),(0,s.jsx)(v.A,{dividers:!0,sx:{p:0,height:"100%"},children:t&&(0,s.jsx)(i.default,{sx:{height:"100%",overflow:"auto","& .w-json-view-container":{backgroundColor:"#fafafa",fontSize:"13px",fontFamily:'"SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace'}},children:(0,s.jsx)(A.Ay,{value:r,collapsed:2,displayObjectSize:!0,displayDataTypes:!0,enableClipboard:!0,style:{backgroundColor:"#fafafa",padding:"16px"}})})}),(0,s.jsxs)(y.A,{children:[(0,s.jsx)(b.A,{onClick:d,startIcon:(0,s.jsx)(j.A,{}),children:"Copy JSON"}),(0,s.jsx)(b.A,{onClick:l,variant:"contained",children:"Close"})]})]})}var S=l(3485);function C(e){var t,l,f,p,v,y,b,j,_,A,C,k,F,D,z,I,R,E,T,W,M,P,O;let{result:L,isSelected:q,onClick:B,onFindSimilar:N}=e,V=!!(L.ancestors&&L.ancestors.length>0),H=null===(l=L.extra_data)||void 0===l?void 0:null===(t=l.resource_type)||void 0===t?void 0:t.includes("variable"),U=null===(p=L.extra_data)||void 0===p?void 0:null===(f=p.resource_type)||void 0===f?void 0:f.includes("dataset"),[J,K]=(0,m.useState)(!1),Q=L,X=L;V&&(null===(v=L.ancestors)||void 0===v?void 0:v[0])&&(X=L.ancestors[0],Q=L);let G=(null==X?void 0:null===(y=X.extra_data)||void 0===y?void 0:y.resource_type)||X.dataset_schema&&X.dataset_schema["@type"]||"Unknown Resource Type",Y=(null===(b=X.dataset_schema)||void 0===b?void 0:b.name)||(null===(j=X.extra_data)||void 0===j?void 0:j.name)||"Unnamed Resource",Z=V&&U?(null===(_=Q.dataset_schema)||void 0===_?void 0:_.description)||(null===(A=Q.extra_data)||void 0===A?void 0:A.description)||"":(null===(C=X.dataset_schema)||void 0===C?void 0:C.description)||(null===(k=X.extra_data)||void 0===k?void 0:k.description)||"",$=((null===(F=X.dataset_schema)||void 0===F?void 0:F.keywords)||X.topics||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),ee=(null===(D=Q.dataset_schema)||void 0===D?void 0:D.number_of_variables)||(null===(I=Q.dataset_schema)||void 0===I?void 0:null===(z=I.variableMeasured)||void 0===z?void 0:z.length)||0,et=(null===(R=Q.variables_which_matched)||void 0===R?void 0:R.length)||0,el=(null===(E=Q.child_datasets)||void 0===E?void 0:E.length)||0,es=(null===(T=Q.dataset_schema)||void 0===T?void 0:T.includedInDataCatalog)&&Q.dataset_schema.includedInDataCatalog.length>0,ei=Z.length>200?"".concat(Z.substring(0,200),"..."):Z,ea=null,[en,er]=(0,m.useState)(!1);return(null===(W=X.dataset_schema)||void 0===W?void 0:W.image)&&!en?ea=X.dataset_schema.image:X.thumbnail&&!en&&(ea=X.thumbnail),(0,s.jsxs)(i.default,{onClick:B,sx:{cursor:"pointer",display:"flex",width:"100%",bgcolor:q?"rgba(25, 118, 210, 0.08)":"transparent",borderLeft:q?"3px solid":"3px solid transparent",borderRight:q?"3px solid":"3px solid transparent",borderColor:q?"primary.main":"transparent","&:hover":{bgcolor:q?"rgba(25, 118, 210, 0.12)":"rgba(0, 0, 0, 0.02)"}},children:[(0,s.jsxs)(i.default,{sx:{width:120,minHeight:"100%",py:2,flexShrink:1,display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",color:"grey.500",background:"transparent",position:"relative"},children:[ea&&!en?(0,s.jsx)(r.default,{src:ea,alt:Y,width:100,height:100,style:{objectFit:"contain"},onError:()=>er(!0),unoptimized:!0}):G.includes("dataset")?(0,s.jsx)(o.A,{size:48}):G.includes("variable")?(0,s.jsx)(d.A,{size:48}):G.includes("study")?(0,s.jsx)(c.A,{size:48}):(0,s.jsx)(u.A,{size:48}),V&&(0,s.jsxs)(s.Fragment,{children:[H&&(0,s.jsx)(i.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:"V"}),U&&(0,s.jsx)(i.default,{sx:{position:"absolute",top:0,right:0,bgcolor:"primary.main",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold"},children:(0,s.jsx)(o.A,{size:16})})]}),(0,s.jsx)(i.default,{sx:{mt:1,width:"100%",display:"flex",justifyContent:"center"},children:(0,s.jsxs)(g.A,{chipVariant:"secondary",size:"small",onClick:e=>{var t;e.stopPropagation(),(null===(t=Q.extra_data)||void 0===t?void 0:t.uuid)&&window.open("".concat((0,S.xC)(),"discover?like=").concat(Q.extra_data.uuid),"_blank")},sx:{cursor:"pointer",display:"flex",alignItems:"center",gap:.5},children:["Find Similar ",(0,s.jsx)(h.A,{size:14,style:{marginLeft:4}})]})})]}),(0,s.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",p:2,flex:1,background:"transparent"},children:[(0,s.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,s.jsx)(a.A,{variant:"h6",gutterBottom:!0,sx:{mb:.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2,flex:1,mr:1},children:Y}),(0,s.jsx)(n.A,{size:"small",onClick:e=>{e.stopPropagation(),K(!0)},sx:{opacity:.6,"&:hover":{opacity:1},color:"text.secondary"},children:(0,s.jsx)(x.A,{size:16})})]}),$.length>0&&(0,s.jsx)(a.A,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:$.slice(0,5).map((e,t)=>(0,s.jsxs)(i.default,{component:"span",children:[(0,s.jsx)(i.default,{component:"strong",sx:{fontSize:{xs:"0.75rem",sm:"0.85rem"}},children:e}),t<Math.min($.length,5)-1&&(0,s.jsx)(i.default,{component:"span",sx:{mx:.5},children:"â€¢"})]},"".concat(e,"-").concat(t)))}),(0,s.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.4,mb:1.5},children:ei}),(0,s.jsx)(i.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:"auto"},children:V&&H?(0,s.jsx)(g.A,{chipVariant:"primary",size:"small",children:(null===(M=Q.extra_data)||void 0===M?void 0:M.description)||(null===(P=Q.extra_data)||void 0===P?void 0:P.name)},null===(O=Q.extra_data)||void 0===O?void 0:O.uuid):(0,s.jsxs)(s.Fragment,{children:[ee>0&&(0,s.jsx)(g.A,{chipVariant:"primary",size:"small",children:et>0?"Matched by variable":"".concat(ee," Variables")}),es&&(0,s.jsx)(g.A,{chipVariant:"secondary",size:"small",children:"Data Available"}),el>0&&(0,s.jsxs)(g.A,{chipVariant:"secondary",size:"small",sx:{backgroundColor:"#444653",color:"white","&:hover":{backgroundColor:"#3a3d47"}},children:[el," Dataset",1!==el?"s":""]}),Q.hasFreeAccess&&(0,s.jsx)(g.A,{chipVariant:"secondary",size:"small",children:"Free Access"}),Q.hasCohortsAvailable&&(0,s.jsx)(g.A,{chipVariant:"secondary",size:"small",children:"Cohorts Available"})]})})]}),(0,s.jsx)(w,{open:J,onClose:()=>K(!1),data:Q,title:"Debug: ".concat(Y)})]})}},73179:(e,t,l)=>{l.d(t,{db:()=>r});var s=l(49904),i=l(14565),a=l(54615);let n=(0,s.Wp)({apiKey:"AIzaSyBQVkRjbTQD6BXCdo2JeiFfwyvGVT7bOXM",authDomain:"harmony-6bd51.firebaseapp.com",projectId:"harmony-6bd51",storageBucket:"harmony-6bd51.appspot.com",messagingSenderId:"914732561143",appId:"1:914732561143:web:b041f0c5e7fab57400d9f2",measurementId:"G-S79J6E39ZP"});(0,i.getAuth)(n);let r=(0,a.aU)(n)}}]);