"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[282,7234],{52078:(e,t,r)=>{r.d(t,{Wp:()=>o.Wp});var o=r(29820);(0,o.KO)("firebase","11.3.1","app")},65705:(e,t,r)=>{r.r(t),r.d(t,{AggregateField:()=>o.Wc,AggregateQuerySnapshot:()=>o.oN,Bytes:()=>o.Ix,CollectionReference:()=>o.YS,DocumentReference:()=>o.T1,DocumentSnapshot:()=>o.Wq,FieldPath:()=>o.uY,FieldValue:()=>o.S0,Firestore:()=>o._7,FirestoreError:()=>o.W6,GeoPoint:()=>o.Ci,Query:()=>o.XK,QueryCompositeFilterConstraint:()=>o.Li,QueryConstraint:()=>o.wx,QueryDocumentSnapshot:()=>o.YQ,QueryEndAtConstraint:()=>o.Gv,QueryFieldFilterConstraint:()=>o.Cq,QueryLimitConstraint:()=>o.xC,QueryOrderByConstraint:()=>o.jy,QuerySnapshot:()=>o.NJ,QueryStartAtConstraint:()=>o.$c,Timestamp:()=>o.Dc,Transaction:()=>o.ZX,VectorValue:()=>o.V7,WriteBatch:()=>o.GA,addDoc:()=>o.gS,aggregateFieldEqual:()=>o.gT,aggregateQuerySnapshotEqual:()=>o.O8,and:()=>o.Uo,arrayRemove:()=>o.C3,arrayUnion:()=>o.hq,average:()=>o.G8,collection:()=>o.rJ,collectionGroup:()=>o.Cs,connectFirestoreEmulator:()=>o.vN,count:()=>o.U9,deleteDoc:()=>o.kd,deleteField:()=>o.CL,doc:()=>o.H9,documentId:()=>o.Fs,endAt:()=>o.FD,endBefore:()=>o.rf,getAggregate:()=>o.CX,getCount:()=>o.ky,getDoc:()=>o.x7,getDocs:()=>o.GG,getFirestore:()=>o.aU,increment:()=>o.GV,initializeFirestore:()=>o._A,limit:()=>o.AB,limitToLast:()=>o.$1,or:()=>o.or,orderBy:()=>o.My,query:()=>o.P,queryEqual:()=>o.B,refEqual:()=>o.yx,runTransaction:()=>o.c4,serverTimestamp:()=>o.O5,setDoc:()=>o.BN,setLogLevel:()=>o.He,snapshotEqual:()=>o.lN,startAfter:()=>o.HM,startAt:()=>o.EO,sum:()=>o.cz,terminate:()=>o.MH,updateDoc:()=>o.mZ,vector:()=>o.i1,where:()=>o._M,writeBatch:()=>o.wP});var o=r(92311)},90916:(e,t,r)=>{r.d(t,{jz:()=>o});var o,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);var o=Array(16);if("string"==typeof t)for(var n=0;16>n;++n)o[n]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(n=0;16>n;++n)o[n]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],n=e.g[2];var i=e.g[3],a=t+(i^r&(n^i))+o[0]+0xd76aa478|0;a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+o[1]+0xe8c7b756|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+o[2]+0x242070db|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+o[3]+0xc1bdceee|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+o[4]+0xf57c0faf|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+o[5]+0x4787c62a|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+o[6]+0xa8304613|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+o[7]+0xfd469501|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+o[8]+0x698098d8|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+o[9]+0x8b44f7af|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+o[10]+0xffff5bb1|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+o[11]+0x895cd7be|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+o[12]+0x6b901122|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+o[13]+0xfd987193|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+o[14]+0xa679438e|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+o[15]+0x49b40821|0,r=n+(a<<22|a>>>10),a=t+(n^i&(r^n))+o[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+o[6]+0xc040b340|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+o[11]+0x265e5a51|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+o[0]+0xe9b6c7aa|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+o[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+o[10]+0x2441453|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+o[15]+0xd8a1e681|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+o[4]+0xe7d3fbc8|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+o[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+o[14]+0xc33707d6|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+o[3]+0xf4d50d87|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+o[8]+0x455a14ed|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+o[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+o[2]+0xfcefa3f8|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+o[7]+0x676f02d9|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+o[12]+0x8d2a4c8a|0,a=t+((r=n+(a<<20|a>>>12))^n^i)+o[5]+0xfffa3942|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+o[8]+0x8771f681|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+o[11]+0x6d9d6122|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+o[14]+0xfde5380c|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+o[1]+0xa4beea44|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+o[4]+0x4bdecfa9|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+o[7]+0xf6bb4b60|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+o[10]+0xbebfbc70|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+o[13]+0x289b7ec6|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+o[0]+0xeaa127fa|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+o[3]+0xd4ef3085|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+o[6]+0x4881d05|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+o[9]+0xd9d4d039|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+o[12]+0xe6db99e5|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+o[15]+0x1fa27cf8|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+o[2]+0xc4ac5665|0,r=n+(a<<23|a>>>9),a=t+(n^(r|~i))+o[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+o[7]+0x432aff97|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+o[14]+0xab9423a7|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+o[5]+0xfc93a039|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+o[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+o[3]+0x8f0ccc92|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+o[10]+0xffeff47d|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+o[1]+0x85845dd1|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+o[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+o[15]+0xfe2ce6e0|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+o[6]+0xa3014314|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+o[13]+0x4e0811a1|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+o[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+o[11]+0xbd3af235|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+o[2]+0x2ad7d2bb|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+o[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(n+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+n|0,e.g[3]=e.g[3]+i|0}function a(e,t){this.h=t;for(var r=[],o=!0,n=e.length-1;0<=n;n--){var i=0|e[n];o&&i==t||(r[n]=i,o=!1)}this.g=r}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,o){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[r].apply(e,n)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,o=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(o[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,o),i=0;break}}else for(;a<t;)if(o[i++]=e[a++],i==this.blockSize){n(this,o),i=0;break}}this.h=i,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var o=0;32>o;o+=8)e[r++]=this.g[t]>>>o&255;return e};var s,c={};function d(e){var t;return -128<=e&&128>e?(t=function(e){return new a([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(c,e)?c[e]:c[e]=t(e)):new a([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return m(l(-e));for(var t=[],r=1,o=0;e>=r;o++)t[o]=e/r|0,r*=0x100000000;return new a(t,0)}var h=d(0),u=d(1),f=d(0x1000000);function g(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return -1==e.h}function m(e){for(var t=e.g.length,r=[],o=0;o<t;o++)r[o]=~e.g[o];return new a(r,~e.h).add(u)}function y(e,t){return e.add(m(t))}function x(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new v(h,h);if(p(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(p(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var r=u,o=t;0>=o.l(e);)r=w(r),o=w(o);var n=A(r,1),i=A(o,1);for(o=A(o,2),r=A(r,2);!g(o);){var a=i.add(o);0>=a.l(e)&&(n=n.add(r),i=a),o=A(o,1),r=A(r,1)}return t=y(e,n.j(t)),new v(n,t)}for(n=h;0<=e.l(t);){for(o=48>=(o=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,o-48),a=(i=l(r)).j(t);p(a)||0<a.l(e);)r-=o,a=(i=l(r)).j(t);g(i)&&(i=u),n=n.add(i),e=y(e,a)}return new v(n,e)}function w(e){for(var t=e.g.length+1,r=[],o=0;o<t;o++)r[o]=e.i(o)<<1|e.i(o-1)>>>31;return new a(r,e.h)}function A(e,t){var r=t>>5;t%=32;for(var o=e.g.length-r,n=[],i=0;i<o;i++)n[i]=0<t?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new a(n,e.h)}(s=a.prototype).m=function(){if(p(this))return-m(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var o=this.i(r);e+=(0<=o?o:0x100000000+o)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(p(this))return"-"+m(this).toString(e);for(var t=l(Math.pow(e,6)),r=this,o="";;){var n=b(r,t).g,i=((0<(r=y(r,n.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(g(r=n))return i+o;for(;6>i.length;)i="0"+i;o=i+o}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return p(e=y(this,e))?-1:+!g(e)},s.abs=function(){return p(this)?m(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],o=0,n=0;n<=t;n++){var i=o+(65535&this.i(n))+(65535&e.i(n)),s=(i>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);o=s>>>16,i&=65535,s&=65535,r[n]=s<<16|i}return new a(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(g(this)||g(e))return h;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],o=0;o<2*t;o++)r[o]=0;for(o=0;o<this.g.length;o++)for(var n=0;n<e.g.length;n++){var i=this.i(o)>>>16,s=65535&this.i(o),c=e.i(n)>>>16,d=65535&e.i(n);r[2*o+2*n]+=s*d,x(r,2*o+2*n),r[2*o+2*n+1]+=i*d,x(r,2*o+2*n+1),r[2*o+2*n+1]+=s*c,x(r,2*o+2*n+1),r[2*o+2*n+2]+=i*c,x(r,2*o+2*n+2)}for(o=0;o<t;o++)r[o]=r[2*o+1]<<16|r[2*o];for(o=t;o<2*t;o++)r[o]=0;return new a(r,0)},s.A=function(e){return b(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],o=0;o<t;o++)r[o]=this.i(o)&e.i(o);return new a(r,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],o=0;o<t;o++)r[o]=this.i(o)|e.i(o);return new a(r,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],o=0;o<t;o++)r[o]=this.i(o)^e.i(o);return new a(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var o=l(Math.pow(r,8)),n=h,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),s=parseInt(t.substring(i,i+a),r);8>a?(a=l(Math.pow(r,a)),n=n.j(a).add(l(s))):n=(n=n.j(o)).add(l(s))}return n},o=i.Integer=a}).apply(void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},95465:(e,t,r)=>{r.r(t),r.d(t,{app:()=>a,auth:()=>s,db:()=>c});var o=r(52078),n=r(33885),i=r(65705);let a=(0,o.Wp)({apiKey:"AIzaSyBQVkRjbTQD6BXCdo2JeiFfwyvGVT7bOXM",authDomain:"harmony-6bd51.firebaseapp.com",projectId:"harmony-6bd51",storageBucket:"harmony-6bd51.appspot.com",messagingSenderId:"914732561143",appId:"1:914732561143:web:b041f0c5e7fab57400d9f2",measurementId:"G-S79J6E39ZP"}),s=(0,n.getAuth)(a),c=(0,i.getFirestore)(a)},99703:(e,t,r)=>{r.d(t,{$w:()=>s,DQ:()=>h,Id:()=>c,Pu:()=>l,cq:()=>d,isAdmin:()=>i});var o=r(65705),n=r(95465);let i=async e=>{if(!e)return console.log("\uD83D\uDD10 Admin check: No userId provided"),!1;console.log("\uD83D\uDD10 Admin check: Checking userId:",e);try{let t=(0,o.doc)(n.db,"users",e);console.log("\uD83D\uDD10 Admin check: Attempting to read document at users/".concat(e));let r=await (0,o.getDoc)(t);if(console.log("\uD83D\uDD10 Admin check: Document exists:",r.exists()),!r.exists())return console.log("\uD83D\uDD10 Admin check: Document does not exist - user is not admin"),!1;let i=r.data();console.log("\uD83D\uDD10 Admin check: Document data:",i),console.log("\uD83D\uDD10 Admin check: isAdmin value:",i.isAdmin);let a=!0===i.isAdmin;return console.log("\uD83D\uDD10 Admin check: Result:",a),a}catch(e){if(console.error("\uD83D\uDD10 Admin check: Error occurred:",e),console.error("\uD83D\uDD10 Admin check: Error code:",null==e?void 0:e.code),console.error("\uD83D\uDD10 Admin check: Error message:",null==e?void 0:e.message),(null==e?void 0:e.code)==="permission-denied")return console.log("\uD83D\uDD10 Admin check: Permission denied - user is not admin"),!1;return console.error("\uD83D\uDD10 Admin check: Unexpected error - returning false"),!1}},a=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,o.query)((0,o.collection)(n.db,"analytics_events"),(0,o.orderBy)("timestamp","desc"));return e.eventType&&(t=(0,o.query)(t,(0,o.where)("event_type","==",e.eventType))),e.startDate&&(t=(0,o.query)(t,(0,o.where)("timestamp",">=",o.Timestamp.fromDate(e.startDate)))),e.endDate&&(t=(0,o.query)(t,(0,o.where)("timestamp","<=",o.Timestamp.fromDate(e.endDate)))),t=e.limitCount?(0,o.query)(t,(0,o.limit)(e.limitCount)):(0,o.query)(t,(0,o.limit)(1e3)),(await (0,o.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Failed to fetch analytics events:",e),e}},s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{let t=new Date;t.setDate(t.getDate()-e);let r=(await a({eventType:"search",startDate:t})).filter(e=>"search"===e.event_type),o=r.length,n=r.map(e=>e.response_time_ms).filter(e=>"number"==typeof e),i=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,s=r.map(e=>e.num_results).filter(e=>"number"==typeof e),c=s.length>0?s.reduce((e,t)=>e+t,0)/s.length:0,d={},l={},h={};r.forEach(e=>{let t=e.search_term||"";if(t){d[t]=(d[t]||0)+1;let r=e.num_results;"number"==typeof r&&(l[t]||(l[t]=[]),l[t].push(r));let o=e.response_time_ms;"number"==typeof o&&(h[t]||(h[t]=[]),h[t].push(o))}});let u=Object.entries(d).map(e=>{let[t,r]=e,o=l[t]||[],n=o.length>0?Math.round(o.reduce((e,t)=>e+t,0)/o.length):0,i=h[t]||[],a=i.length>0?Math.round(i.reduce((e,t)=>e+t,0)/i.length):0;return{query:t,count:r,avgResults:n,avgResponseTime:a}}).sort((e,t)=>t.count-e.count).slice(0,10),f={};r.forEach(e=>{if(e.timestamp){let t=e.timestamp.toDate().toISOString().split("T")[0];f[t]=(f[t]||0)+1}});let g=Object.entries(f).map(e=>{let[t,r]=e;return{date:t,count:r}}).sort((e,t)=>e.date.localeCompare(t.date)),p={};r.forEach(e=>{let t=e.pagination_strategy||"unknown";p[t]=(p[t]||0)+1});let m=Object.entries(p).map(e=>{let[t,r]=e;return{strategy:t,count:r}}).sort((e,t)=>t.count-e.count),y={};r.forEach(e=>{let t=e.max_distance_mode||"unknown";y[t]=(y[t]||0)+1});let x=Object.entries(y).map(e=>{let[t,r]=e;return{strategy:t,count:r}}).sort((e,t)=>t.count-e.count),v={none:0,source:0,topics:0,study_design:0,sample_characteristics:0,instruments:0};return r.forEach(e=>{let t=e.filter_count||0;if(0===t)v.none++;else{let t=function(e){if(!e)return null;if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.warn("Failed to parse filters string:",e)}else if("object"==typeof e&&null!==e)return e;return null}(e.filters);if(!t)return void v.none++;void 0!==t.source&&v.source++,void 0!==t.keywords&&v.topics++,void 0!==t.study_design&&v.study_design++,void 0!==t.sample_characteristics&&v.sample_characteristics++,void 0!==t.instruments&&v.instruments++}}),{totalSearches:o,averageResponseTime:Math.round(i),averageResults:Math.round(c),topQueries:u,searchesByDay:g,paginationStrategyCounts:m,distanceStrategyCounts:x,filterUsage:v}}catch(e){throw console.error("Failed to get search analytics summary:",e),e}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,o.query)((0,o.collection)(n.db,"ratings"),(0,o.where)("source","==","discoverynext"),(0,o.orderBy)("created","desc"),(0,o.limit)(e));return(await (0,o.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null}))}catch(e){throw console.error("Failed to fetch discovery feedback:",e),e}},d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{let t=new Date;t.setDate(t.getDate()-e);let r=(0,o.query)((0,o.collection)(n.db,"ratings"),(0,o.orderBy)("created","desc")),i=(await (0,o.getDocs)(r)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null})).filter(e=>e.timestamp&&e.timestamp.toDate()>=t&&(!e.source||"discoverynext"!==e.source)&&"number"==typeof e.rating),a=i.map(e=>e.rating),s=a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0,c={};i.forEach(e=>{if(e.timestamp){let t=e.timestamp.toDate().toISOString().split("T")[0];c[t]||(c[t]=[]),"number"==typeof e.rating&&c[t].push(e.rating)}});let d=Object.entries(c).map(e=>{let[t,r]=e;return{date:t,avgRating:Math.round(r.reduce((e,t)=>e+t,0)/r.length*10)/10,count:r.length}}).sort((e,t)=>e.date.localeCompare(t.date));return{averageRating:Math.round(10*s)/10,totalRatings:i.length,ratingsByDay:d}}catch(e){throw console.error("Failed to fetch harmony rating summary:",e),e}},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,o.query)((0,o.collection)(n.db,"ratings"),(0,o.orderBy)("created","desc"),(0,o.limit)(e));return(await (0,o.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null})).filter(e=>(!e.source||"discoverynext"!==e.source)&&"number"==typeof e.rating)}catch(e){throw console.error("Failed to fetch harmony ratings:",e),e}},h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,o.query)((0,o.collection)(n.db,"mismatches"),(0,o.orderBy)("created","desc"),(0,o.limit)(e));return(await (0,o.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),created:e.data().created||null}))}catch(e){throw console.error("Failed to fetch mismatches:",e),e}}}}]);