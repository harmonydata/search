"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8204],{98204:(e,t,l)=>{l.r(t),l.d(t,{default:()=>eS});var a=l(95155),r=l(12115),n=l(33567),s=l(15712),i=l(94049),o=l(97322),c=l(25635),u=l(61023),d=l(1151),h=l(70690),g=l(13315),x=l(77073),m=l(15593),f=l(15239),p=l(80777),y=l(28544),v=l(99404);function b(e){let{results:t,resourceTypeFilter:l,onSelectResult:n,selectedResultId:s,onFindSimilar:o,onReportResult:u,collapsed:d=!1,hasActiveSearch:g=!1,loading:x=!1,onClearQuery:m,onClearFilters:f}=e,b=(0,r.useRef)(!1);(0,r.useEffect)(()=>{t.length>0&&(b.current=!0)},[t.length]);let j=l&&l.length>0?t.filter(e=>{var t,a;return(null==(t=e.extra_data)?void 0:t.resource_type)&&l.map(e=>e.trim().toLowerCase()).includes(null==(a=e.extra_data)?void 0:a.resource_type.trim().toLowerCase())}):t;(0,r.useEffect)(()=>{console.log("\uD83D\uDD0D SearchResults render:",{filteredResultsLength:j.length,resultsLength:t.length,loading:x,hasActiveSearch:g,resourceTypeFilter:l,willShowNoResults:!j.length&&!x,willReturnNull:!j.length&&x})},[j.length,t.length,x,g,l]);let _=g&&!b.current&&x,S=!j.length&&!x&&g,[A,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)(x);return((0,r.useEffect)(()=>{k(x)},[x]),(0,r.useEffect)(()=>{if(S){let e=setTimeout(()=>{w(!0)},C&&!x?0:100*!!_);return()=>clearTimeout(e)}w(!1)},[S,_,x,C]),j.length||x||!A)?!j.length&&x?(console.log("⏳ Returning null - loading with no results"),null):(0,a.jsx)(i.default,{children:(0,a.jsx)(p.A,{spacing:1.5,sx:{mb:4},children:j.map((e,t)=>{var l,r;let i=s===(null==(l=e.extra_data)?void 0:l.uuid);return(0,a.jsx)(y.A,{result:e,isSelected:i,onClick:()=>{n&&n(e)},onFindSimilar:o,onReportResult:u?()=>u(e,t):void 0},(null==(r=e.extra_data)?void 0:r.uuid)||"result-".concat(t))})})}):(console.log("\uD83D\uDEAB Showing 'No results' message - conditions:",{filteredResultsLength:j.length,loading:x,hasActiveSearch:g,isTransitionalState:_,hasEverHadResults:b.current}),l&&l.length,(0,a.jsx)(i.default,{sx:{textAlign:"center",py:8,maxWidth:600,mx:"auto"},children:g?(0,a.jsxs)(i.default,{children:[(0,a.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",mb:3},children:(0,a.jsx)(i.default,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(v.A,{size:64,style:{color:"#9e9e9e",opacity:.6}})})}),(0,a.jsx)(c.A,{variant:"h5",color:"text.primary",gutterBottom:!0,sx:{fontWeight:500},children:"No results found"}),(0,a.jsx)(c.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,sx:{mb:4},children:"There are no results for your combination of query and filters."}),(0,a.jsxs)(p.A,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",alignItems:"center",children:[m&&(0,a.jsx)(h.A,{variant:"outlined",onClick:m,sx:{textTransform:"none",minWidth:140,px:3,py:1},children:"Remove query"}),f&&(0,a.jsx)(h.A,{variant:"outlined",onClick:f,sx:{textTransform:"none",minWidth:140,px:3,py:1},children:"Remove filters"})]})]}):(0,a.jsxs)(i.default,{sx:{textAlign:"center",py:8,maxWidth:600,mx:"auto"},children:[(0,a.jsx)(c.A,{variant:"h5",color:"text.primary",gutterBottom:!0,children:"No Results"}),(0,a.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Enter a search term or apply filters to find studies."})]})}))}var j=l(88540),_=l(78977),S=l(78470),A=l(67895),w=l(88538),C=l(97212),k=l(93212);function D(e){let{onSubmitFeedback:t}=e,[l,n]=(0,r.useState)(null),[s,o]=(0,r.useState)(null),[g,m]=(0,r.useState)(""),[f,y]=(0,r.useState)(!1),v=()=>{n(null),o(null),m("")},b=async()=>{if(s){y(!0);try{await (null==t?void 0:t(s,g)),v()}catch(e){console.error("Error submitting feedback:",e)}finally{y(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.A,{title:"Give feedback",placement:"left",children:(0,a.jsx)(A.A,{color:"primary",size:"small",onClick:e=>{n(e.currentTarget)},sx:{position:"fixed",bottom:0,right:0,zIndex:1e3,boxShadow:3,borderRadius:"4px 0 0 0"},children:(0,a.jsx)(k.A,{})})}),(0,a.jsx)(w.Ay,{open:!!l,anchorEl:l,onClose:v,anchorOrigin:{vertical:"center",horizontal:"left"},transformOrigin:{vertical:"center",horizontal:"right"},sx:{"& .MuiPopover-paper":{borderRadius:2,boxShadow:3}},children:(0,a.jsxs)(i.default,{sx:{p:3,minWidth:300},children:[(0,a.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,a.jsx)(c.A,{variant:"h6",component:"h2",children:"Share your feedback"}),(0,a.jsx)(d.A,{size:"small",onClick:v,children:(0,a.jsx)(x.A,{})})]}),(0,a.jsxs)(p.A,{spacing:2,children:[(0,a.jsxs)(i.default,{children:[(0,a.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"How would you rate your experience?"}),(0,a.jsx)(C.A,{name:"feedback-rating",value:s,onChange:(e,t)=>{o(t)},size:"large"})]}),(0,a.jsx)(u.A,{multiline:!0,rows:3,placeholder:"Tell us what you think... (optional)",value:g,onChange:e=>m(e.target.value),variant:"outlined",size:"small",fullWidth:!0}),(0,a.jsxs)(i.default,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,a.jsx)(h.A,{size:"small",onClick:v,children:"Cancel"}),(0,a.jsx)(h.A,{variant:"contained",size:"small",onClick:b,disabled:!s||f,children:f?"Submitting...":"Submit"})]})]})]})})]})}var R=l(28548),E=l(90109);let I=["Find studies that contain variables related to psychosis in adolescence","Show me datasets related to domestic violence and also capture socioeconomic data","I'm interested in dementia in ethnic minorities","Risk factors of heart disease"];function W(e){let{title:t="What is your research question? Try searching in complete terms",subtitle:l,onExampleClick:r}=e;return(0,a.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",p:4,mb:4},children:[(0,a.jsx)(c.A,{variant:"h4",sx:{color:"text.primary",fontWeight:600,textAlign:"center",mb:4},children:t}),(0,a.jsx)(i.default,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",width:"100%",maxWidth:800,mb:4},children:I.map((e,t)=>(0,a.jsx)(R.A,{label:e,onClick:()=>{r&&r(e)},icon:(0,a.jsx)(E.A,{size:18}),sx:{width:"100%",justifyContent:"flex-start",height:"auto",py:1.5,px:2,backgroundColor:"#E3F2FD",color:"#1565C0",fontWeight:500,fontSize:"0.95rem",cursor:"pointer","&:hover":{backgroundColor:"#BBDEFB"},"& .MuiChip-icon":{color:"#1565C0",marginLeft:1}}},t))}),(0,a.jsx)(c.A,{variant:"body1",sx:{color:"text.secondary",textAlign:"center",maxWidth:800,lineHeight:1.6},children:"Harmony can understand your search term and will search for studies and datasets that contain related variables. You can also search using the filters or specific keywords or topics."})]})}var F=l(2778),T=l(52363),M=l(65036),z=l(52641),P=l(95436),O=l(55606),U=l(86973),B=l(9839),L=l(66591),q=l(56475),N=l(75656),H=l(75912);function Q(e){var t,l;let{open:n,onClose:s,onSubmit:o,reportedResult:g,searchContext:m}=e,[f,y]=(0,r.useState)(""),[v,b]=(0,r.useState)(""),[j,_]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),[w,C]=(0,r.useState)(g?m.resultIndex>=0?m.resultIndex:m.displayedResults.findIndex(e=>{var t,l;return(null==(t=e.extra_data)?void 0:t.uuid)===(null==(l=g.extra_data)?void 0:l.uuid)}):-1);(0,r.useEffect)(()=>{if(g){let e=m.displayedResults.findIndex(e=>{var t,l;return(null==(t=e.extra_data)?void 0:t.uuid)===(null==(l=g.extra_data)?void 0:l.uuid)});C(e>=0?e:m.resultIndex)}else m.resultIndex>=0&&C(m.resultIndex)},[g,m]);let k=w>=0&&w<m.displayedResults.length?m.displayedResults[w]:g,D=()=>{y(""),b(""),A(null),s()},R=async()=>{if(!f)return void A("Please select a reason");if(!k)return void A("No result selected for reporting");if(_(!0),A(null),!k)return void A("Please select a result to report");try{let e={reason:f,comment:v.trim(),reportedResult:k,searchContext:{...m,resultIndex:w}};await o(e),D()}catch(e){console.error("Error submitting search feedback:",e),A("Failed to submit feedback. Please try again.")}finally{_(!1)}};return(0,a.jsxs)(F.A,{open:n,onClose:D,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,a.jsx)(T.A,{children:(0,a.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(c.A,{variant:"h6",children:"Report Search Result Issue"}),(0,a.jsx)(d.A,{size:"small",onClick:D,children:(0,a.jsx)(x.A,{})})]})}),(0,a.jsx)(M.A,{children:(0,a.jsxs)(p.A,{spacing:3,sx:{mt:1},children:[!g&&m.displayedResults.length>0&&(0,a.jsxs)(z.A,{fullWidth:!0,children:[(0,a.jsx)(P.A,{children:"Select result to report"}),(0,a.jsx)(O.A,{value:w,onChange:e=>{C(e.target.value),A(null)},label:"Select result to report",children:m.displayedResults.map((e,t)=>{var l,r;return(0,a.jsx)(U.A,{value:t,children:(null==(l=e.dataset_schema)?void 0:l.name)||(null==(r=e.extra_data)?void 0:r.name)||"Result ".concat(t+1)},t)})})]}),k&&(0,a.jsxs)(i.default,{children:[(0,a.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Reporting issue with:"}),(0,a.jsx)(c.A,{variant:"body1",fontWeight:500,children:(null==(t=k.dataset_schema)?void 0:t.name)||(null==(l=k.extra_data)?void 0:l.name)||"Unknown result"})]}),(0,a.jsxs)(z.A,{component:"fieldset",children:[(0,a.jsx)(B.A,{component:"legend",children:"What's the issue?"}),(0,a.jsxs)(L.A,{value:f,onChange:e=>{y(e.target.value),A(null)},children:[(0,a.jsx)(q.A,{value:"too_high",control:(0,a.jsx)(N.A,{}),label:"Too high in results"}),(0,a.jsx)(q.A,{value:"too_low",control:(0,a.jsx)(N.A,{}),label:"Too low in results"}),(0,a.jsx)(q.A,{value:"inappropriate",control:(0,a.jsx)(N.A,{}),label:"Shouldn't be in results at all"}),(0,a.jsx)(q.A,{value:"something_else",control:(0,a.jsx)(N.A,{}),label:"Something else"})]})]}),(0,a.jsx)(u.A,{multiline:!0,rows:4,placeholder:"Additional comments (optional)",value:v,onChange:e=>b(e.target.value),variant:"outlined",fullWidth:!0}),S&&(0,a.jsx)(c.A,{variant:"body2",color:"error",children:S})]})}),(0,a.jsxs)(H.A,{sx:{px:3,pb:2},children:[(0,a.jsx)(h.A,{onClick:D,disabled:j,children:"Cancel"}),(0,a.jsx)(h.A,{variant:"contained",onClick:R,disabled:!f||j||!k,children:j?"Submitting...":"Submit"})]})]})}let G=null,J=async()=>{if(G)return G;console.log("\uD83D\uDD0D Loading Firebase modules dynamically for feedback");let[{collection:e,addDoc:t,serverTimestamp:a},{db:r}]=await Promise.all([Promise.all([l.e(2154),l.e(1398),l.e(282)]).then(l.bind(l,65705)),Promise.all([l.e(9895),l.e(2154),l.e(1398),l.e(1182),l.e(2780)]).then(l.bind(l,95465))]);return G={collection:e,addDoc:t,serverTimestamp:a,db:r}},K=async(e,t)=>{try{let{db:l,collection:a,addDoc:r,serverTimestamp:n}=await J(),s={uid:"anon",rating:e,comment:t||"",created:n(),source:"discoverynext"},i=await r(a(l,"ratings"),s);return console.log("Feedback submitted with ID: ",i.id),i}catch(e){throw console.error("Error submitting feedback:",e),e}},V=async e=>{try{let{db:t,collection:l,addDoc:a,serverTimestamp:r}=await J(),n={uid:"anon",discovery_search_feedback:!0,reason:e.reason,comment:e.comment||"",reportedResult:e.reportedResult,searchContext:e.searchContext,created:r(),source:"discoverynext"},s=await a(l(t,"ratings"),n);return console.log("Search feedback submitted with ID: ",s.id),s}catch(e){throw console.error("Error submitting search feedback:",e),e}};var Y=l(37609),X=l(13709),$=l(75183),Z=l(65380),ee=l(92114),et=l(12537),el=l(20063),ea=l(18844),er=l(47931),en=l(58956),es=l(5225),ei=l(92033),eo=l(51190),ec=l(63263),eu=l(30989),ed=l(90992),eh=l(9004);function eg(){let{searchSettings:e,updateSearchSettings:t}=(0,ee.S)(),[l,n]=(0,r.useState)(e.hybridWeight),s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{n(e.hybridWeight)},[e.hybridWeight]),(0,r.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]),(0,a.jsxs)(i.default,{sx:{mb:2},children:[(0,a.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Hybrid Weight: ",l.toFixed(2)]}),(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the balance between semantic and keyword search"}),(0,a.jsx)(i.default,{sx:{px:2,mt:2},children:(0,a.jsx)(eh.Ay,{value:l,onChange:(e,l)=>{n(l),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{t({hybridWeight:l})},300)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Keyword"},{value:.5,label:"Balanced"},{value:1,label:"Semantic"}]})})]})}var ex=l(3139),em=l(57883);function ef(){let{searchSettings:e,updateSearchSettings:t}=(0,ee.S)(),[l,n]=(0,r.useState)(e.maxDistance),s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{n(e.maxDistance)},[e.maxDistance]),(0,r.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]),(0,a.jsxs)(i.default,{sx:{mb:2},children:[(0,a.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Max Distance: ",l.toFixed(2)]}),(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Controls the maximum vector distance for semantic search results"}),(0,a.jsx)(i.default,{sx:{px:2,mt:2},children:(0,a.jsx)(eh.Ay,{value:l,onChange:(e,l)=>{n(l),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{t({maxDistance:l})},300)},min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"0"},{value:.4,label:"0.4"},{value:1,label:"1"}]})}),(0,a.jsxs)(i.default,{sx:{mt:2},children:[(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Distance Strategy:"}),(0,a.jsxs)(ex.A,{value:e.maxDistanceMode,exclusive:!0,onChange:(e,l)=>{null!==l&&t({maxDistanceMode:l})},"aria-label":"max distance mode",size:"small",fullWidth:!0,children:[(0,a.jsx)(em.A,{value:"max_distance","aria-label":"max distance",children:"Max Distance"}),(0,a.jsx)(em.A,{value:"min_score","aria-label":"min score",children:"Min Score"}),(0,a.jsx)(em.A,{value:"both","aria-label":"both",children:"Both"})]})]})]})}function ep(){let{searchSettings:e,updateSearchSettings:t}=(0,ee.S)(),[l,n]=(0,r.useState)(e.directMatchWeight),s=(0,r.useRef)(null),o="trust_estimate"===e.paginationStrategy;(0,r.useEffect)(()=>{n(e.directMatchWeight)},[e.directMatchWeight]),(0,r.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]);let u=l<=.5?4*l:16*l-6;return(0,a.jsxs)(i.default,{sx:{mb:2,opacity:o?.5:1},children:[(0,a.jsxs)(c.A,{variant:"body2",fontWeight:500,gutterBottom:!0,children:["Direct Match Weight: ",l.toFixed(2)," (API: ",u.toFixed(1),")"]}),(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:o?"Not available in Trust Estimate mode":"Controls preference between direct match and variable match results"}),(0,a.jsx)(i.default,{sx:{px:2,mt:2},children:(0,a.jsx)(eh.Ay,{value:l,onChange:(e,l)=>{n(l),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{t({directMatchWeight:l})},300)},disabled:o,min:0,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:e=>e.toFixed(2),marks:[{value:0,label:"Variable"},{value:.5,label:"0.5"},{value:1,label:"Direct"}]})})]})}function ey(){let{searchSettings:e,updateSearchSettings:t}=(0,ee.S)();return(0,a.jsxs)(i.default,{sx:{mb:2},children:[(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",gutterBottom:!0,display:"block",children:"Pagination Strategy:"}),(0,a.jsxs)(ex.A,{value:e.paginationStrategy,exclusive:!0,onChange:(e,l)=>{null!==l&&t({paginationStrategy:l})},"aria-label":"pagination strategy",size:"small",fullWidth:!0,children:[(0,a.jsx)(em.A,{value:"filter","aria-label":"filter",children:"Filter"}),(0,a.jsx)(em.A,{value:"offset","aria-label":"offset",children:"Offset"}),(0,a.jsx)(em.A,{value:"trust_estimate","aria-label":"trust estimate",children:"Trust Estimate"})]})]})}function ev(){let[e,t]=(0,r.useState)(null),l=(0,r.useRef)(null),n=!!e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)(h.A,{ref:l,variant:"contained",color:"secondary",onClick:()=>{t(l.current)},sx:{minWidth:0,width:40,height:40,borderRadius:"50%",p:0},children:n?(0,a.jsx)(ed.A,{}):(0,a.jsx)(eu.A,{})}),(0,a.jsx)(c.A,{sx:{color:"#191B22",fontWeight:500,whiteSpace:"nowrap"},children:"Advanced Search"})]}),(0,a.jsx)(w.Ay,{open:n,anchorEl:e,onClose:()=>{t(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{mt:1},PaperProps:{sx:{maxWidth:{xs:"100%",sm:400}}},children:(0,a.jsxs)(i.default,{sx:{p:3,minWidth:280},children:[(0,a.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Search Configuration"}),(0,a.jsx)(eg,{}),(0,a.jsx)(ef,{}),(0,a.jsx)(ey,{}),(0,a.jsx)(ep,{}),(0,a.jsx)(i.default,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,a.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[(0,a.jsx)("strong",{children:"Tip:"})," Adjust the hybrid weight to balance between keyword search (lower values) and semantic search (higher values). The default value of 0.5 provides a balanced approach."]})})]})})]})}var eb=l(51691),ej=l(11742);function e_(){var e,t,l,p,y,v,S;let A=(0,n.A)(),w=(0,s.A)(A.breakpoints.down("sm")),C=(0,s.A)(A.breakpoints.down("lg")),{searchSettings:k,updateQuery:R,updateSearchSettings:E}=(0,ee.S)(),[I,F]=(0,r.useState)([]),[T,M]=(0,r.useState)([]),[z,P]=(0,r.useState)(!1),[O,U]=(0,r.useState)(!0),[B,L]=(0,r.useState)(!1),[q,N]=(0,r.useState)(0),[H,G]=(0,r.useState)(!1),[J,eu]=(0,r.useState)(1),[ed,eh]=(0,r.useState)(null),[eg,ex]=(0,r.useState)(!1),[em,ef]=(0,r.useState)(!1),[ep,ey]=(0,r.useState)(!1),[e_,eS]=(0,r.useState)(!1),[eA,ew]=(0,r.useState)(null),[eC,ek]=(0,r.useState)(null),[eD,eR]=(0,r.useState)(null),[eE,eI]=(0,r.useState)([]),[eW,eF]=(0,r.useState)(void 0),[eT,eM]=(0,r.useState)(0),[ez,eP]=(0,r.useState)([]),[eO,eU]=(0,r.useState)(0),eB=(0,r.useRef)([]),eL=(0,r.useRef)(0),[eq,eN]=(0,r.useState)(!1),[eH,eQ]=(0,r.useState)(!1),[eG,eJ]=(0,r.useState)(!1),[eK,eV]=(0,r.useState)(null),[eY,eX]=(0,r.useState)(-1),[e$,eZ]=(0,r.useState)(!1),[e0,e1]=(0,r.useState)(""),{currentUser:e2}=(0,Z.A)(),e5=(0,el.useSearchParams)(),e3=e5.get("resource_type"),e4=e5.get("like");(0,el.useRouter)();let e8=(0,r.useRef)(e5.get("query")),e6=(0,r.useRef)(e5.getAll("topics")),e9=(0,r.useRef)(e5.getAll("instruments")),e7=(0,r.useRef)(e5.getAll("study_design")),te=e8.current,tt=e6.current,tl=e9.current,ta=e7.current,tr=(0,r.useMemo)(()=>e3?[e3]:[],[e3]),tn=(0,r.useRef)(k.debouncedQuery),ts=(0,r.useRef)(JSON.stringify(k.selectedFilters)),ti=(0,r.useRef)(k.useSearch2),to=(0,r.useRef)(k.hybridWeight),tc=(0,r.useRef)(k.maxDistance),tu=(0,r.useRef)(k.maxDistanceMode),td=(0,r.useRef)(k.directMatchWeight),th=(0,r.useRef)(k.paginationStrategy),tg=(0,r.useRef)(eE);(0,r.useRef)(!1);let tx=(0,r.useRef)([]),tm=(0,r.useRef)(void 0),tf=(0,r.useCallback)(e=>{eh(e),w?ex(!0):ey(!0)},[w]),tp=(0,r.useCallback)(e=>{console.log("Selected result:",e),tf(e)},[tf]),ty=(0,r.useCallback)(()=>{ex(!1)},[]),tv=(0,r.useCallback)(()=>{!w&&ed&&ey(!0)},[w,ed]),tb=(0,r.useCallback)(()=>{w||ey(e=>!e)},[w]);(0,r.useEffect)(()=>{!async function(){try{let e;console.log("Fetching initial aggregations..."),P(!0),eS(!1);let t=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)});try{let l=await Promise.race([fetch("".concat("https://harmonydataweaviate.azureedge.net","/discover/aggregate"),{method:"GET"}),t]);if(!l.ok)throw Error("Failed to fetch aggregate data");let a=await l.json();e=a.aggregations||a}catch(t){console.warn("Aggregate API call failed or timed out, falling back to default aggregations:",t);try{let t=await fetch("/default_aggregations.json");if(!t.ok)throw Error("Failed to load default aggregations");e=await t.json(),console.log("Using default aggregations from JSON file")}catch(e){throw console.error("Failed to load default aggregations:",e),t}}let l=Object.keys(e).filter(e=>"top_level_ancestor"!==e).reduce((t,l)=>(t[l]=e[l],t),{}),a=tR(l);M(a),console.log("Initial aggregations set:",a.length,"filters"),P(!1)}catch(e){console.error("Failed to fetch initial aggregations:",e),eS(!0),P(!1)}}()},[]),(0,r.useEffect)(()=>{I.length>0&&!ed?eh(I[0]):I.length>0&&ed?I.some(e=>{var t,l;return(null==(t=e.extra_data)?void 0:t.uuid)===(null==(l=ed.extra_data)?void 0:l.uuid)})||eh(I[0]):0===I.length&&eh(null)},[I,ed]),(0,r.useEffect)(()=>{ef(!1)},[ed]);let tj=(0,r.useCallback)(e=>{var t,l,a;let r=null==(l=e.extra_data)||null==(t=l.resource_type)?void 0:t.includes("variable"),n=Array.isArray(e.ancestors)&&e.ancestors.length>0;return r&&n&&(null==(a=e.ancestors)?void 0:a[0])||e},[]),t_=async()=>{e1("Save Search"),eZ(!0)},[tS,tA]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!ed)return void tA(null);tA(tj(ed))},[ed,tj]),(0,r.useEffect)(()=>{!async function(){if(k.similarUid)try{var e,t;P(!0);let l=await (0,$.w3)(k.similarUid,void 0,void 0,k.maxDistance,k.maxDistanceMode);ew(l);let a=(null==(e=l.dataset_schema)?void 0:e.description)||(null==(t=l.extra_data)?void 0:t.description);if(!a)throw Error("No description available for similar search");R(a);let r=tC(k.maxDistance,1),n=await (0,$.Hu)(a,{},1,500,k.useSearch2,k.hybridWeight,void 0,void 0,void 0,r,k.directMatchWeight,k.maxDistanceMode,k.paginationStrategy);F(n.results||[]),N(n.num_hits||0),G(n.is_result_count_lower_bound||!1)}catch(e){console.error("Failed to load similar studies:",e),eS(!0)}finally{P(!1)}}()},[k.similarUid,500,k.useSearch2,k.hybridWeight,R]),(0,r.useEffect)(()=>{var e,t;let l=k.debouncedQuery!==tn.current||JSON.stringify(k.selectedFilters)!==ts.current||k.useSearch2!==ti.current||k.hybridWeight!==to.current||k.maxDistance!==tc.current||k.maxDistanceMode!==tu.current||k.directMatchWeight!==td.current||k.paginationStrategy!==th.current,a=k.similarUid&&((null==eA||null==(e=eA.dataset_schema)?void 0:e.description)||(null==eA||null==(t=eA.extra_data)?void 0:t.description))||k.debouncedQuery;l&&(console.log("\uD83D\uDD0D Search parameters changed, clearing results and resetting to page 1"),console.log("⏳ Setting loading to true BEFORE clearing results"),P(!0),console.log("\uD83D\uDDD1️ Clearing results array"),F([]),k.paginationStrategy!==th.current&&console.log("Pagination strategy changed, resetting seen IDs"),eI([]),tx.current=[],eF(void 0),tm.current=void 0,"trust_estimate"!==k.paginationStrategy&&(eP([]),eB.current=[],eU(0),eL.current=0),1!==J&&eu(1),tk(a,1,{query:a,filters:k.selectedFilters,useSearch2:k.useSearch2,hybridWeight:k.hybridWeight,maxDistance:k.maxDistance,selectedCategory:k.selectedCategory,resourceType:k.resourceType,similarUid:k.similarUid}).finally(()=>{tn.current=k.debouncedQuery,ts.current=JSON.stringify(k.selectedFilters),ti.current=k.useSearch2,to.current=k.hybridWeight,tc.current=k.maxDistance,tu.current=k.maxDistanceMode,td.current=k.directMatchWeight,th.current=k.paginationStrategy,tg.current=eE}))},[k.debouncedQuery,k.selectedFilters,k.similarUid,eA,k.useSearch2,k.hybridWeight,k.maxDistance,k.maxDistanceMode,k.directMatchWeight,k.paginationStrategy]),(0,r.useEffect)(()=>{if(J>1){var e,t;if(console.log("\uD83D\uDCC4 Page changed to:",J,"- loading more results"),"trust_estimate"===k.paginationStrategy&&eB.current.length>0){console.log("Trust Estimate: Page change detected, doing batch lookup only");let e=eL.current,t=10*e,l=t+10,a=eB.current.slice(t,l);a.length>0?(L(!0),(0,$.GF)(a).then(t=>{console.log("Trust Estimate: Retrieved ".concat(t.length," results from batch lookup")),F(e=>[...e,...t]);let a=e+1;eU(a),eL.current=a,U(l<eB.current.length),L(!1)}).catch(e=>{console.error("Trust Estimate: Batch lookup failed:",e),L(!1),U(!1)})):(U(!1),L(!1));return}tk(k.similarUid&&((null==eA||null==(e=eA.dataset_schema)?void 0:e.description)||(null==eA||null==(t=eA.extra_data)?void 0:t.description))||k.debouncedQuery,J)}},[J,k.paginationStrategy]);let tw=(0,r.useCallback)(async()=>{if(console.log("\uD83D\uDD04 loadMore called:",{loadingMore:B,hasMoreResults:O,currentPage:J,resultsLength:I.length}),B||!O)return void console.log("\uD83D\uDD04 loadMore early return:",{loadingMore:B,hasMoreResults:O});let e=J+1;console.log("\uD83D\uDD04 loadMore proceeding to page:",e),eu(e)},[B,O,J]),tC=(e,t)=>e;async function tk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.debouncedQuery,t=arguments.length>1?arguments[1]:void 0;arguments.length>2&&arguments[2];let l=void 0!==t?t:J;1===l?(console.log("⏳ performSearch: Setting loading to true (page 1)"),P(!0)):(console.log("⏳ performSearch: Setting loadingMore to true (page > 1)"),L(!0)),eS(!1);let a=Date.now();1===l&&(U(!0),L(!1),eM(0),"trust_estimate"!==k.paginationStrategy&&(eP([]),eB.current=[],eU(0),eL.current=0));try{var r,n,s,i,o,c,u,d;let t,h={...k.selectedFilters};e3&&(h.resource_type=[e3]),Object.keys(h).forEach(e=>{Array.isArray(h[e])&&0===h[e].length&&delete h[e]});let g="search-".concat(Date.now());console.group("\uD83D\uDD0D Search Request: ".concat(g)),console.log("Search query:",e||"(empty)"),console.log("Filters:",h),console.log("Page:",l),console.log("Results per page:",500),console.log("Use Search2:",k.useSearch2),console.log("Similar UID (will be excluded):",k.similarUid||"None"),console.log("Top Level IDs Seen:",l>1?eE:"First page");let x=new Promise((e,t)=>{setTimeout(()=>t(Error("API request timed out")),6e4)}),m=Date.now();"filter"===k.paginationStrategy&&(l>1?t=tx.current:k.similarUid&&(t=[k.similarUid],console.log("Excluding original study from similar search:",k.similarUid)));let f=tC(k.maxDistance,l),p="offset"===k.paginationStrategy?(l-1)*500:0,y="trust_estimate"===k.paginationStrategy&&1===l?10:500,v=await Promise.race([(0,$.Hu)(e,h,l,y,k.useSearch2,k.hybridWeight,t,p,void 0,f,k.directMatchWeight,k.maxDistanceMode,k.paginationStrategy),x]),b=Date.now()-m;if(eR(b),console.log("Response received:",{requestId:g,numHits:v.num_hits,resultCount:(null==(r=v.results)?void 0:r.length)||0,apiTime:"".concat(b,"ms"),topLevelUuids:(null==(n=v.top_level_uuids)?void 0:n.length)||0,results:null==(s=v.results)?void 0:s.map(e=>{var t,l,a,r;return{id:null==(t=e.extra_data)?void 0:t.uuid,title:null==(l=e.dataset_schema)?void 0:l.name,type:(null==(a=e.extra_data)?void 0:a.resource_type)||(null==(r=e.dataset_schema)?void 0:r["@type"]),similarity:e.cosine_similarity}}),timestamp:new Date().toISOString()}),console.groupEnd(),console.log("Trust Estimate check:",{paginationStrategy:k.paginationStrategy,hasTopLevelUuids:!!v.top_level_uuids,topLevelUuidsCount:(null==(i=v.top_level_uuids)?void 0:i.length)||0,pageToUse:l}),"trust_estimate"===k.paginationStrategy){if(1===l&&(v.top_level_uuids&&v.top_level_uuids.length>0?(console.log("Trust Estimate: Received top_level_uuids:",{count:v.top_level_uuids.length,sample:v.top_level_uuids.slice(0,5)}),eP(v.top_level_uuids),eB.current=v.top_level_uuids,eU(0),eL.current=0):console.warn("Trust Estimate: No top_level_uuids in response, falling back to normal results")),eB.current.length>0){let e=eL.current,t=10*e,r=t+10,n=eB.current.slice(t,r);if(n.length>0){console.log("Trust Estimate: Looking up batch ".concat(e+1," (UUIDs ").concat(t,"-").concat(r-1,")"));let s=await (0,$.GF)(n);console.log("Trust Estimate: Retrieved ".concat(s.length," results from batch lookup")),1===l?(F(s),N(eB.current.length),G(!1)):F(e=>[...e,...s]);let i=e+1;eU(i),eL.current=i;let o=r<eB.current.length;U(o),1===l?P(!1):L(!1);let c=Date.now();ek(c-a);let u=1===l?s.length:I.length+s.length;console.log("Trust Estimate: Batch lookup complete",{batch:e+1,resultsInBatch:s.length,totalResults:u,hasMore:o});return}console.log("Trust Estimate: No more UUIDs to lookup"),U(!1),1===l?(P(!1),F([])):L(!1);return}console.log("Trust Estimate: No UUIDs available, using normal results")}let j=v.results||[];if("offset"===k.paginationStrategy){let e=new Set(tx.current),t=[],l=[...tx.current];j.forEach(a=>{var r;let n=null==(r=a.extra_data)?void 0:r.uuid;n&&!e.has(n)&&(t.push(a),e.add(n),l.push(n))}),console.log("Offset strategy: filtered duplicates",{originalCount:j.length,uniqueCount:t.length,duplicatesRemoved:j.length-t.length}),j=t,eI(l),tx.current=l}else v.top_level_ids_seen_so_far?(console.log("Received top_level_ids_seen_so_far:",{count:v.top_level_ids_seen_so_far.length,sample:v.top_level_ids_seen_so_far.slice(0,5),previousCount:eE.length}),eI(v.top_level_ids_seen_so_far),tx.current=v.top_level_ids_seen_so_far):console.log("No top_level_ids_seen_so_far in response");void 0!==v.next_page_offset&&(console.log("Received next_page_offset (tracked but not used):",{offset:v.next_page_offset,calculatedOffset:p}),eF(v.next_page_offset),tm.current=v.next_page_offset);let _=1===l&&0===p&&(!t||0===t.length);if(1===l)if(F(j),_&&(N(v.num_hits||0),G(v.is_result_count_lower_bound||!1)),k.useSearch2)U(500===j.length&&j.length<(v.num_hits||0));else{let a=v.num_hits||0,r=(v.results||[]).length,n="offset"===k.paginationStrategy&&0===j.length&&r>0;if(0===j.length||n){let a=p+500;console.log("\uD83D\uDD0D ".concat(n?"all duplicates":"empty"," results on page ").concat(l,", making ONE probe call at offset ").concat(a," with limit=10000"));try{let r=await (0,$.Hu)(e,h,1,1e4,k.useSearch2,k.hybridWeight,t,a,void 0,f,k.directMatchWeight,k.maxDistanceMode,k.paginationStrategy),n=r.results||[];if("offset"===k.paginationStrategy){let e=new Set(tx.current);n=(null==(o=r.results)?void 0:o.filter(t=>{var l;let a=null==(l=t.extra_data)?void 0:l.uuid;return a&&!e.has(a)}))||[]}n.length>0?(console.log("✅ Probe found ".concat(n.length," unique results, continuing pagination")),eM(0),U(!0),setTimeout(()=>{if(!B&&O){let e=l+1;console.log("\uD83D\uDD04 Auto-triggering page ".concat(e," after probe found results")),eu(e)}},100)):(console.log("\uD83D\uDED1 Probe returned ".concat((null==(c=r.results)?void 0:c.length)||0," results (").concat(n.length," unique) - stopping pagination")),U(!1),eM(0),N(p))}catch(e){console.error("Probe call failed:",e),U(!1),eM(0),N(p)}}else eM(0),U(!0),0!==q||_||(N(-1),G(!1));j.length>0&&j.length<500&&j.length<20&&(console.log("\uD83D\uDD04 Auto-loading next page from first page - got fewer results than threshold:",{gotResults:j.length,requestedResults:500,minThreshold:20,numHits:a,nextPage:2}),setTimeout(()=>{!B&&O?(console.log("\uD83D\uDD04 Actually triggering page 2 load"),eu(2)):console.log("\uD83D\uDD04 Skipping page 2 load - already loading more or no more results")},100))}else if(F(e=>{if(j.length>0){let t;t=1===l?j.length:e.length+j.length,j.length<500&&t<20&&(console.log("\uD83D\uDD04 Auto-loading next page - insufficient results:",{gotResults:j.length,requestedResults:500,currentTotal:t,minThreshold:20,nextPage:l+1}),setTimeout(()=>{!B&&O&&eu(l+1)},100))}return[...e,...j]}),k.useSearch2){let e=j.length>0;U(e)}else{v.num_hits,I.length,j.length;let a=(v.results||[]).length,r="offset"===k.paginationStrategy&&0===j.length&&a>0;if(0===j.length||r){let a=p+500;console.log("\uD83D\uDD0D ".concat(r?"all duplicates":"empty"," results on page ").concat(l,", making ONE probe call at offset ").concat(a," with limit=10000"));try{let r=await (0,$.Hu)(e,h,1,1e4,k.useSearch2,k.hybridWeight,t,a,void 0,f,k.directMatchWeight,k.maxDistanceMode,k.paginationStrategy),n=r.results||[];if("offset"===k.paginationStrategy){let e=new Set(tx.current);n=(null==(u=r.results)?void 0:u.filter(t=>{var l;let a=null==(l=t.extra_data)?void 0:l.uuid;return a&&!e.has(a)}))||[]}n.length>0?(console.log("✅ Probe found ".concat(n.length," unique results, continuing pagination")),eM(0),U(!0),setTimeout(()=>{if(!B&&O){let e=l+1;console.log("\uD83D\uDD04 Auto-triggering page ".concat(e," after probe found results")),eu(e)}},100)):(console.log("\uD83D\uDED1 Probe returned ".concat((null==(d=r.results)?void 0:d.length)||0," results (").concat(n.length," unique) - stopping pagination")),U(!1),eM(0),N(p))}catch(e){console.error("Probe call failed:",e),U(!1),eM(0),N(p)}}else eM(0),U(!0),0!==q||_||(N(-1),G(!1))}let S=Date.now();ek(S-a)}catch(e){console.error("Search failed:",e),eS(!0),ek(null),eR(null)}finally{P(!1),L(!1)}}let tD=async(e,t)=>{if(e)try{await K(e,t),console.log("Feedback submitted successfully")}catch(e){console.error("Failed to submit feedback:",e)}},tR=e=>{let t=[],l=["sample_size","age_lower","age_upper","start_year","end_year","duration_years","num_sweeps"],a=1/0,r=-1/0;if(Object.entries(e).forEach(e=>{let[n,s]=e;if("age_lower"===n||"age_upper"===n||"age_min"===n||"age_max"===n){let e=s.statistics||{},t=e.minimum;"number"==typeof t&&isFinite(t)||(t=e.min);let l=e.maximum;"number"==typeof l&&isFinite(l)||(l=e.max),"number"==typeof t&&isFinite(t)&&(a=Math.min(a,t)),"number"==typeof l&&isFinite(l)&&(r=Math.max(r,l));return}if(l.includes(n)){let e,l,a=s.statistics||{};"number"==typeof a.minimum&&isFinite(a.minimum)?e=a.minimum:"number"==typeof a.min&&isFinite(a.min)?e=a.min:(console.warn("Missing valid min value for ".concat(n,", using default")),"sample_size"===n?e=0:"start_year"===n||"end_year"===n?e=1900:e=0),"number"==typeof a.maximum&&isFinite(a.maximum)?l=a.maximum:"number"==typeof a.max&&isFinite(a.max)?l=a.max:(console.warn("Missing valid max value for ".concat(n,", using default")),l="sample_size"===n?1e5:"start_year"===n||"end_year"===n?2024:"duration_years"===n?100:"num_sweeps"===n?50:100),l<=e&&(l=e+1);let r=Array.from({length:101},(t,a)=>String(e+a/100*(l-e)));t.push({id:n,label:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"range",options:r})}else{let e=s.buckets||[];e.length>0&&t.push({id:n,label:n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),type:"multiselect",options:e.map(e=>e.key||"")})}}),isFinite(a)&&isFinite(r)&&a<=r){r<=a&&(r=a+1);let e=Array.from({length:101},(e,t)=>String(a+t/100*(r-a)));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}else{console.warn("Missing valid age range data, using defaults");let e=Array.from({length:101},(e,t)=>String(0+t/100*100));t.push({id:"age_range",label:"Age Range",type:"range",options:e})}return t},tE=(0,r.useCallback)(async e=>{var t,l,a,r,n;let s=null==(t=e.extra_data)?void 0:t.uuid;if(!s)return;let i=(null==(l=e.dataset_schema)?void 0:l.name)||(null==(a=e.extra_data)?void 0:a.name)||"Unnamed Study";R("LIKE:".concat(i," (").concat(s,")"));let o=(null==(r=e.dataset_schema)?void 0:r.description)||(null==(n=e.extra_data)?void 0:n.description);o?(R(o),tI(o)):(console.warn("No description available for study ".concat(i,", using name for similar search")),R(i),tI(i))},[]),tI=async e=>{P(!0),eS(!1);try{let t,l,a={...k.selectedFilters};e3&&(a.resource_type=[e3]),Object.keys(a).forEach(e=>{Array.isArray(a[e])&&0===a[e].length&&delete a[e]});let r=e,n=e.match(/^LIKE:(.*?)\s*\(([^)]+)\)$/);n&&(t=n[2],r="LIKE:".concat(t));let s=tC(k.maxDistance,J);"filter"===k.paginationStrategy&&(t?l=[t]:J>1&&(l=tx.current));let i="offset"===k.paginationStrategy?(J-1)*500:0,o=await (0,$.Hu)(r,a,J,500,k.useSearch2,k.hybridWeight,l,i,void 0,s,k.directMatchWeight,k.maxDistanceMode,k.paginationStrategy),c=o.results||[];if("offset"===k.paginationStrategy){let e=new Set(tx.current),t=[],l=[...tx.current];c.forEach(a=>{var r;let n=null==(r=a.extra_data)?void 0:r.uuid;n&&!e.has(n)&&(t.push(a),e.add(n),l.push(n))}),console.log("Offset strategy (loadMore): filtered duplicates",{originalCount:c.length,uniqueCount:t.length,duplicatesRemoved:c.length-t.length}),c=t,eI(l),tx.current=l}else o.top_level_ids_seen_so_far&&(eI(o.top_level_ids_seen_so_far),tx.current=o.top_level_ids_seen_so_far);F(c),0===q&&G(o.is_result_count_lower_bound||!1)}catch(e){eS(!0)}finally{P(!1)}};return(0,a.jsxs)(i.default,{sx:{height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,a.jsxs)(o.A,{maxWidth:"xl",sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",py:{xs:2,sm:3,md:4}},children:[(0,a.jsx)(i.default,{sx:{display:"flex",alignItems:"center",gap:3,mb:{xs:2,sm:3,md:4}},children:e4?(0,a.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",gap:3,width:"100%",p:3,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[(0,a.jsx)(i.default,{sx:{width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",color:"grey.500"},children:(null==eA||null==(e=eA.dataset_schema)?void 0:e.image)?(0,a.jsx)(f.default,{src:(null==eA?void 0:eA.dataset_schema).image,alt:(null==eA||null==(t=eA.dataset_schema)?void 0:t.name)||"Study",width:100,height:100,style:{objectFit:"contain"},unoptimized:!0}):(e=>{var t,l;let r=(null==e||null==(t=e.extra_data)?void 0:t.resource_type)||(null==e||null==(l=e.dataset_schema)?void 0:l["@type"]);return(null==r?void 0:r.includes("dataset"))?(0,a.jsx)(ea.A,{size:48}):(null==r?void 0:r.includes("variable"))?(0,a.jsx)(er.A,{size:48}):(null==r?void 0:r.includes("study"))?(0,a.jsx)(en.A,{size:48}):(0,a.jsx)(es.A,{size:48})})(eA)}),(0,a.jsxs)(i.default,{children:[(0,a.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:(null==eA||null==(l=eA.dataset_schema)?void 0:l.name)||(null==eA||null==(p=eA.extra_data)?void 0:p.name)||"Unnamed Study"}),(0,a.jsx)(c.A,{variant:"subtitle1",color:"text.secondary",children:"Similar Studies"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{fullWidth:!0,placeholder:"What are you searching for?",value:k.query,onChange:e=>{R(e.target.value)},InputProps:{endAdornment:(0,a.jsxs)(i.default,{sx:{mr:1,ml:-.5,display:"flex",alignItems:"center",gap:1},children:[k.query!==k.debouncedQuery&&(0,a.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Typing..."}),(0,a.jsx)(f.default,{src:(0,eb.xC)()+"icons/discover.svg",alt:"Search",width:20,height:20}),I.length>0&&(0,a.jsx)(d.A,{size:"small",onClick:e=>{e.stopPropagation(),eV(null),eX(-1),eJ(!0)},sx:{opacity:.7,"&:hover":{opacity:1},color:"text.secondary",p:.5},title:"Report search result issue",children:(0,a.jsx)(Y.A,{size:18})})]}),sx:{height:48,"& .MuiOutlinedInput-root":{borderRadius:24},"& .MuiOutlinedInput-notchedOutline":{borderColor:"grey.200"}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:24}}}),(0,a.jsx)(i.default,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,a.jsx)(ev,{})})]})}),(0,a.jsx)(j.A,{filtersData:T}),!e_&&!(!I.length&&!z&&""===k.query.trim()&&0===Object.keys(k.selectedFilters).length&&0===tr.length&&!te&&0===tt.length&&0===tl.length&&0===ta.length)&&(0,a.jsxs)(i.default,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[z?"Searching...":O?I.length>q?"".concat(I.length," results loaded (").concat(H?"more than ".concat(q):"".concat(q,"+")," estimated)"):q>0?"".concat(I.length," of ").concat(H?"more than ".concat(q):"~".concat(q)," results loaded"):"".concat(I.length," results loaded"):"".concat(I.length," results found"),!z&&eD&&" (API: ".concat(eD,"ms"),!z&&eC&&eD&&", Total: ".concat(eC,"ms)")]}),(0,a.jsx)(h.A,{variant:"outlined",size:"small",startIcon:(0,a.jsx)(et.A,{size:16}),onClick:t_,disabled:!k.query.trim()||z,sx:{ml:2},title:"Save this search",children:"Save Search"})]}),I.length||z||""!==k.query.trim()||0!==Object.keys(k.selectedFilters).length||0!==tr.length||te||0!==tt.length||0!==tl.length||0!==ta.length?(0,a.jsxs)(i.default,{sx:{display:w?"block":"flex",width:"100%",flex:1,minHeight:0,overflow:"visible",position:"relative"},children:[(0,a.jsx)(i.default,{sx:{width:C?"100%":"50%",minWidth:w?"100%":"300px",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:z?(0,a.jsx)(c.A,{children:"Loading search results..."}):e_?(0,a.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8,px:4,height:"100%"},children:[(0,a.jsx)(m.A,{sx:{fontSize:{xs:48,sm:64},color:"text.secondary",mb:2}}),(0,a.jsx)(c.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"The discovery API is currently offline"}),(0,a.jsx)(c.A,{color:"text.secondary",children:"Please try again soon. We apologize for the inconvenience."}),(0,a.jsx)(h.A,{variant:"contained",sx:{mt:4},onClick:()=>{eS(!1),tk()},children:"Retry Connection"})]}):(0,a.jsx)(i.default,{sx:{flex:1,overflowY:"auto",minHeight:0,display:"flex",flexDirection:"column"},id:"search-results-container",children:(0,a.jsx)(ej.A,{dataLength:I.length,next:tw,hasMore:O,loader:(0,a.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:(0,a.jsx)(ei.A,{size:24,className:"animate-spin",style:{color:"#1976d2"}})}),scrollableTarget:"search-results-container",endMessage:(0,a.jsx)(c.A,{children:"No more results to load."}),children:(0,a.jsx)(b,{results:I,resourceTypeFilter:tr,onSelectResult:tp,selectedResultId:null==ed||null==(y=ed.extra_data)?void 0:y.uuid,onFindSimilar:tE,onReportResult:(e,t)=>{eV(e),eX(t),eJ(!0)},hasActiveSearch:""!==k.query.trim()||Object.keys(k.selectedFilters).length>0||tr.length>0,loading:(()=>{let e=z||B;return console.log("\uD83D\uDD0D DiscoverPage passing to SearchResults:",{resultsLength:I.length,loading:z,loadingMore:B,loadingState:e,hasActiveSearch:""!==k.query.trim()||Object.keys(k.selectedFilters).length>0||tr.length>0,query:k.query,filtersCount:Object.keys(k.selectedFilters).length}),e})(),onClearQuery:()=>{R("")},onClearFilters:()=>{E({selectedFilters:{}})}})})})}),!w&&(I.length>0||q>0)&&(0,a.jsxs)(i.default,{sx:{position:"absolute",top:0,right:0,width:ep?"calc(100% - 130px)":C?"0%":"50%",height:"100%",bgcolor:"background.paper",borderLeft:C&&!ep?"none":"1px solid",borderColor:"grey.200",display:"flex",flexDirection:"column",overflow:"visible",transition:"width 0.3s ease-in-out",cursor:ed?"pointer":"default",zIndex:ep?2:1,boxShadow:ep?"-4px 0 8px rgba(0, 0, 0, 0.1)":"none"},onClick:tv,children:[(0,a.jsx)(i.default,{sx:{position:"absolute",top:-16,left:-16,zIndex:1e3},children:(0,a.jsx)(d.A,{onClick:e=>{e.stopPropagation(),tb()},sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2,width:30,height:30},children:ep?(0,a.jsx)(ec.A,{size:20}):(0,a.jsx)(eo.A,{size:20})})}),e_?(0,a.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%"},children:[(0,a.jsx)(m.A,{sx:{fontSize:{xs:36,sm:48},color:"text.secondary",mb:2}}),(0,a.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"API Offline"}),(0,a.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Study details unavailable"})]}):tS?(0,a.jsx)(i.default,{sx:{height:"100%",overflowY:"auto",minHeight:0},children:(0,a.jsx)(_.default,{study:tS,isDrawerView:!1})}):(0,a.jsx)(i.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,a.jsx)(c.A,{color:"text.secondary",children:"Select a dataset to view details"})})]})]}):(0,a.jsx)(i.default,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,a.jsx)(i.default,{sx:{width:"80%",maxWidth:1200},children:(0,a.jsx)(W,{onExampleClick:e=>{console.log("\uD83C\uDFAF Hero banner clicked, setting loading to true immediately"),P(!0),R(e)}})})}),(0,a.jsxs)(g.Ay,{anchor:"right",open:w&&eg,onClose:ty,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:"80%",md:"60%"},maxWidth:"600px",p:0,overflow:"hidden",display:"flex",flexDirection:"column"}},children:[(0,a.jsxs)(i.default,{sx:{position:"sticky",top:0,zIndex:10,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"grey.200",p:1},children:[(0,a.jsx)(d.A,{onClick:ty,sx:{position:"absolute",top:8,right:8},children:(0,a.jsx)(x.A,{})}),(0,a.jsxs)(i.default,{sx:{py:1,pl:1,pr:6,display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)(c.A,{variant:"h6",sx:{flex:1},children:ed&&(null==(v=ed.dataset_schema)?void 0:v.name)||"Study Details"}),ed&&(ed.dataset_schema&&ed.dataset_schema.image||ed.image)&&!em&&(0,a.jsx)(i.default,{sx:{width:50,height:50,position:"relative",borderRadius:"4px",overflow:"hidden",flexShrink:0},children:(0,a.jsx)(f.default,{src:ed.dataset_schema&&ed.dataset_schema.image||ed.image,alt:(null==(S=ed.dataset_schema)?void 0:S.name)||"Study image",fill:!0,style:{objectFit:"contain"},onError:()=>ef(!0),unoptimized:!0})})]})]}),(0,a.jsx)(i.default,{sx:{p:0,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:tS?(0,a.jsx)(_.default,{studyDataComplete:!1,study:tS,isDrawerView:!0}):(0,a.jsx)(i.default,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",p:2},children:(0,a.jsx)(c.A,{color:"text.secondary",children:"Select a dataset to view details"})})})]})]}),(0,a.jsx)(D,{onSubmitFeedback:tD}),(0,a.jsx)(Q,{open:eG,onClose:()=>{eJ(!1),eV(null),eX(-1)},onSubmit:async e=>{let t=eK||e.reportedResult,l=eY>=0?eY:e.searchContext.resultIndex,a=I.slice(0,l+1),r={reason:e.reason,comment:e.comment,reportedResult:t,searchContext:{searchSettings:k,displayedResults:a,resultIndex:l}};await V(r)},reportedResult:eK||void 0,searchContext:{searchSettings:k,displayedResults:I,resultIndex:eY>=0?eY:eK?I.findIndex(e=>{var t,l;return(null==(t=e.extra_data)?void 0:t.uuid)===(null==(l=eK.extra_data)?void 0:l.uuid)}):-1}}),(0,a.jsx)(X.A,{open:e$,onClose:()=>eZ(!1),featureName:e0})]})}function eS(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(i.default,{sx:{p:4},children:(0,a.jsx)(c.A,{children:"Loading..."})}),children:(0,a.jsx)(e_,{})})}}}]);