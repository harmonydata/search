(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9123],{83686:()=>{},32383:()=>{},65776:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var i=a(95155),l=a(64665),r=a(68998),o=a(9561),s=a(5565),n=a(3485),d=a(12115);function c(e){let{name:t,url:a,logo:c,inactive:u,compact:h}=e,[x,m]=(0,d.useState)(c),[v,p]=(0,d.useState)(!1);(0,d.useEffect)(()=>{console.log('Resolving logo for organization: "'.concat(t,'"'));try{let e=(0,n.sM)(t,c);console.log('Resolved logo for organization "'.concat(t,'":'),e),m(e),p(!1)}catch(e){console.error('Error resolving logo for organization "'.concat(t,'":'),e),m(void 0)}},[t,c]);let f=x&&x.length>0&&!v;return(0,i.jsxs)(l.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:h?"220px":"280px",height:h?"75px":"85px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:a?"pointer":"default",transition:"all 0.2s",opacity:u?.5:1,"&:hover":a?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{a&&window.open(a,"_blank","noopener,noreferrer")},children:[(0,i.jsx)(r.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,i.jsx)(o.A,{sx:{fontWeight:500,fontSize:h?"0.8rem":"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.9em",wordBreak:"break-word",paddingBottom:"1px"},children:t})}),f&&(0,i.jsx)(r.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,i.jsx)(s.default,{src:x,alt:t,width:h?40:50,height:h?40:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for organization "'.concat(t,'" from path: ').concat(x)),p(!0)},unoptimized:!0})})]})}},76596:(e,t,a)=>{"use strict";a.d(t,{default:()=>K});var i=a(95155),l=a(68998),r=a(96854),o=a(9561),s=a(47821),n=a(35256),d=a(5565),c=a(20687),u=a(52488),h=a(32645),x=a(12115),m=a(53452),v=a(64665),p=a(3485);function f(e){let{name:t,url:a,logo:r}=e,[s,n]=(0,x.useState)(r),[c,u]=(0,x.useState)(!1);(0,x.useEffect)(()=>{console.log('Resolving logo for data catalog: "'.concat(t,'"'));try{let e=(0,p.sM)(t,r);console.log('Resolved logo for data catalog "'.concat(t,'":'),e),n(e),u(!1)}catch(e){console.error('Error resolving logo for data catalog "'.concat(t,'":'),e),n(void 0)}},[t,r]);let h=s&&s.length>0&&!c;return(0,i.jsxs)(v.A,{elevation:0,sx:{display:"flex",borderRadius:"16px",overflow:"hidden",width:"280px",height:"80px",flexShrink:0,border:"1px solid",borderColor:"grey.200",cursor:a?"pointer":"default",transition:"all 0.2s","&:hover":a?{boxShadow:2,borderColor:"primary.main"}:{}},onClick:()=>{a&&window.open(a,"_blank","noopener,noreferrer")},children:[(0,i.jsx)(l.default,{sx:{flex:1,bgcolor:"rgba(0,0,0,0.03)",p:2,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,i.jsx)(o.A,{sx:{fontWeight:500,fontSize:"0.9rem",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"3.7em",wordBreak:"break-word"},children:t})}),h&&(0,i.jsx)(l.default,{sx:{width:"30%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",p:1,borderLeft:"1px solid",borderColor:"grey.200"},children:(0,i.jsx)(d.default,{src:s,alt:t,width:50,height:50,style:{objectFit:"contain"},onError:()=>{console.error('Error loading image for data catalog "'.concat(t,'" from path: ').concat(s)),u(!0)},unoptimized:!0})})]})}var g=a(65776),b=a(51857),y=a(67247),j=a(26536),_=a(50914),w=a(57165),A=a(53326),C=a(72926),k=a(66917),S=a(4918),z=a(41983),R=a(2091),D=a(60391),E=a(78416),W=a(36417),I=a(27753),O=a(10319),L=a(10358),M=a(64364),U=a(71569),N=a(689),q=a(48694),F=a(7660);function T(e){let{variables:t,studyName:a,downloadAnchorEl:r,onDownloadClick:o,onDownloadClose:n}=e,d=(0,x.useRef)(null),c=(0,x.useRef)(null),[u,h]=(0,x.useState)(!1);console.log("variables passed:",t),(0,x.useEffect)(()=>{if(customElements.get("harmony-export"))return;let e=document.createElement("script");return e.src="/app/js/harmony-export.js",e.async=!0,document.body.appendChild(e),()=>{document.body.contains(e)&&document.body.removeChild(e)}},[]);let m=[{field:"description",headerName:"Description / Code",flex:2,valueGetter:(e,t)=>(t.description||t.name)+(t.description&&t.name?" ("+t.name+")":""),sortable:!0},{field:"options",headerName:"Response Options",flex:1,valueGetter:(e,t)=>t.options&&Array.isArray(t.options)?t.options.join(" / "):"",sortable:!0}],v=t.filter(e=>e.name||e.description).map((e,t)=>({id:e.uuid||e.name||t,...e})),p=(0,j.b)();(0,x.useEffect)(()=>{let e=setTimeout(()=>{p.current&&h(!0)},200);return()=>clearTimeout(e)},[p]);let f=()=>{let e=p.current;if(!e||!u)return[];try{let t=e.getSelectedRows();return t?Array.from(t.values()):[]}catch(e){return console.warn("Failed to get selected items:",e),[]}},g=()=>f().length,b=()=>{let e=p.current;if(!e||!u)return!1;try{let t=e.getSelectedRows();return t&&"number"==typeof t.size&&t.size>0}catch(e){return!1}},y=(0,x.useCallback)(()=>{if(!d.current||!u)return;let e=f();if(d.current.innerHTML="",0===e.length)return;console.log("selectedItems:",e);let t=e.map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name})),i=document.createElement("harmony-export");i.size="32px",i.instrument_name="".concat(a||"Selected Variables"," from harmonydata.ac.uk/discover"),i.questions=t,d.current.appendChild(i)},[u,a]);(0,x.useEffect)(()=>{if(!u||!p.current)return;let e=p.current.subscribeEvent("rowSelectionChange",()=>{y()});return()=>{e()}},[u,y]);let E=()=>{null==n||n()},W=()=>{let e;let t=p.current;if(!t||!u)return[];try{e=t.getSelectedRows()}catch(t){e=null}return(e&&"number"==typeof e.size&&e.size>0&&e?Array.from(e.values()):(()=>{let e;try{e=t.getRowModels()}catch(t){e=null}return e?Array.from(e.values()):[]})()).map((e,t)=>({question_no:e.description?e.name:t,question_text:e.description||e.name,response_options:e.options&&Array.isArray(e.options)?e.options.join(" / "):""}))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.default,{sx:{height:"100%",minHeight:400},children:v.length>0&&(0,i.jsx)(_.z,{apiRef:p,paginationMode:"server",rows:v,columns:m,checkboxSelection:!0,sortModel:[{field:"score",sort:"desc"}],getRowClassName:e=>e.row.matched?"matched-row":"",sx:{background:"white",borderRadius:2,fontSize:14,height:"100%","& .matched-row":{backgroundColor:"#fffae4","&:hover":{backgroundColor:"#fff8d1"}}},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:[(0,i.jsx)(w.e,{expanded:!0,style:{width:"100%"},children:(0,i.jsx)(A.X,{placeholder:"Search within variables",style:{background:"white",borderRadius:192,fontSize:14,margin:15,width:"calc(100% - 15px)",height:"auto"}})}),(0,i.jsx)(C.A,{title:"Harmonise selected items",children:(0,i.jsx)(s.A,{size:"small",sx:{width:40,height:40},children:(0,i.jsx)(l.default,{ref:d,sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}})})}),(0,i.jsx)(C.A,{title:b()?"Download ".concat(g()," selected questions"):"Download all questions",children:(0,i.jsx)(s.A,{ref:c,size:"small",onClick:o,sx:{width:40,height:40},children:(0,i.jsx)(O.A,{size:30})})})]})}})}),(0,i.jsx)(k.Ay,{open:!!r,anchorEl:r,onClose:E,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,i.jsxs)(S.A,{sx:{width:200},children:[(0,i.jsxs)(z.Ay,{onClick:()=>{let e=new Blob([JSON.stringify(W(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="questions.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),E()},sx:{cursor:"pointer"},children:[(0,i.jsx)(R.A,{children:(0,i.jsx)(L.A,{size:20})}),(0,i.jsx)(D.A,{primary:"Download as JSON"})]}),(0,i.jsxs)(z.Ay,{onClick:()=>{let e=new Blob([[["Question Number","Question Text","Response Options"],...W().map(e=>[e.question_no,e.question_text,e.response_options])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="questions.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),E()},sx:{cursor:"pointer"},children:[(0,i.jsx)(R.A,{children:(0,i.jsx)(M.A,{size:20})}),(0,i.jsx)(D.A,{primary:"Download as CSV"})]}),(0,i.jsxs)(z.Ay,{onClick:()=>{let e=W(),t=F.Wp.json_to_sheet(e),a=F.Wp.book_new();F.Wp.book_append_sheet(a,t,"Questions");let i=new Blob([F.M9(a,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(i),r=document.createElement("a");r.href=l,r.download="questions.xlsx",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),E()},sx:{cursor:"pointer"},children:[(0,i.jsx)(R.A,{children:(0,i.jsx)(U.A,{size:20})}),(0,i.jsx)(D.A,{primary:"Download as Excel"})]})]})})]})}function B(e){let{variables:t,studyName:a}=e,[r,n]=(0,x.useState)(!1),d=(0,x.useRef)(null),[c,u]=(0,x.useState)(null),h=()=>{u(null),n(!1)},m=(0,i.jsx)(T,{variables:t,studyName:a,downloadAnchorEl:c,onDownloadClick:e=>{console.log("handleDownloadClick",e.currentTarget),u(d.current)},onDownloadClose:()=>{u(null)}});return r?(0,i.jsxs)(E.A,{ref:d,open:!0,onClose:h,maxWidth:"xl",fullWidth:!0,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh"}},children:[(0,i.jsxs)(W.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,i.jsxs)(o.A,{variant:"h6",children:["Variables - ",a||"Study"]}),(0,i.jsx)(s.A,{onClick:h,size:"small",sx:{color:"text.secondary"},children:(0,i.jsx)(N.A,{size:20})})]}),(0,i.jsx)(I.A,{sx:{p:0,overflow:"hidden"},children:(0,i.jsx)(l.default,{sx:{height:"100%","& .MuiDataGrid-root":{borderRadius:0,maxHeight:"none",height:"100%"}},children:m})})]}):(0,i.jsxs)(l.default,{ref:d,sx:{position:"relative"},children:[(0,i.jsx)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:1},children:(0,i.jsx)(C.A,{title:"Open in large view",children:(0,i.jsx)(s.A,{size:"small",onClick:()=>{u(null),n(!0)},children:(0,i.jsx)(q.A,{size:20})})})}),(0,i.jsx)(l.default,{sx:{"& .MuiDataGrid-root":{height:450,borderRadius:2}},children:m})]})}a(67699);var V=a(66656),P=a(48173),H=a.n(P);function G(e){let{datasets:t}=e,a=[{field:"title",headerName:"Dataset Name",flex:1,minWidth:300,renderCell:e=>{let t=e.value||"Untitled Dataset",a=e.row.slug,l=e.row.uuid;return a?(0,i.jsx)(V.A,{component:H(),href:"/items/".concat(a),underline:"hover",sx:{fontWeight:600,color:"primary.main"},children:t}):l?(0,i.jsx)(V.A,{component:H(),href:"/items/".concat(l),underline:"hover",sx:{fontWeight:600,color:"primary.main"},children:t}):(0,i.jsx)(o.A,{variant:"body2",sx:{fontWeight:600},children:t})}},{field:"numVariables",headerName:"Variables",width:120,renderCell:e=>{let t=e.value;return(0,i.jsx)(o.A,{variant:"body2",color:"text.secondary",children:t||"-"})}},{field:"temporalCoverage",headerName:"Time Coverage",width:150,renderCell:e=>{let t=e.value;return(0,i.jsx)(o.A,{variant:"body2",color:"text.secondary",children:t||"-"})}}],r=(0,x.useMemo)(()=>t.map((e,t)=>{var a,i,l,r,o,s,n,d,c;return{id:(null===(a=e.extra_data)||void 0===a?void 0:a.uuid)||t,title:(null===(i=e.dataset_schema)||void 0===i?void 0:i.name)||(null===(l=e.extra_data)||void 0===l?void 0:l.name)||"Untitled Dataset",slug:null===(r=e.extra_data)||void 0===r?void 0:r.slug,uuid:null===(o=e.extra_data)||void 0===o?void 0:o.uuid,numVariables:(null===(s=e.dataset_schema)||void 0===s?void 0:s.number_of_variables)||(null===(n=e.extra_data)||void 0===n?void 0:n.num_variables)||(null===(d=e.extra_data)||void 0===d?void 0:d.number_of_variables),temporalCoverage:null===(c=e.dataset_schema)||void 0===c?void 0:c.temporalCoverage}}),[t]);return(0,i.jsx)(l.default,{sx:{height:"100%",minHeight:200},children:(0,i.jsx)(_.z,{rows:r,columns:a,disableRowSelectionOnClick:!0,sortModel:[{field:"title",sort:"asc"}],sx:{background:"white",borderRadius:2,fontSize:14,height:"100%"},hideFooter:!0,pageSizeOptions:[20,50,100],showToolbar:!0,slots:{toolbar:()=>(0,i.jsx)(l.default,{sx:{display:"flex",alignItems:"center",gap:2,p:1,mr:2},children:(0,i.jsx)(w.e,{expanded:!0,style:{width:"100%"},children:(0,i.jsx)(A.X,{})})})}})})}var X=a(17146),Q=a(63612),J=a(42649),Y=a(76046);let K=(0,x.memo)(e=>{var t,v,p,j,_,w,A,C,k,S,z,R,D,E,W,I,O,L,M,U,N,q,F,T,V,P,H,K,Z,$,ee,et,ea,ei,el,er,eo,es,en,ed,ec,eu,eh,ex,em,ev,ep,ef,eg,eb,ey;let{study:ej,isDrawerView:e_=!1,studyDataComplete:ew=!1}=e,[eA,eC]=(0,x.useState)(!1),[ek,eS]=(0,x.useState)(!1),[ez,eR]=(0,x.useState)(!1),[eD,eE]=(0,x.useState)(!1),[eW,eI]=(0,x.useState)(!0),[eO,eL]=(0,x.useState)(!1),[eM,eU]=(0,x.useState)(!1),[eN,eq]=(0,x.useState)(null),[eF,eT]=(0,x.useState)(!1),[eB,eV]=(0,x.useState)({description:!0,details:!1,variables:!1,links:!1,childDatasets:!1}),[eP,eH]=(0,x.useState)(null),[eG,eX]=(0,x.useState)(!1),eQ=(0,x.useRef)(null),{currentUser:eJ}=(0,X.A)(),{searchSettings:eY,updateSearchSettings:eK}=(0,Q.S)(),eZ=(0,Y.useRouter)(),e$=(0,Y.usePathname)(),[e0,e1]=(0,x.useState)(!1);(0,x.useEffect)(()=>{e1(!0)},[]);let e2=eP||ej;(0,x.useEffect)(()=>{eH(null)},[null===(t=ej.extra_data)||void 0===t?void 0:t.uuid]);let e5=(e,t)=>{let a=eY.selectedFilters,i=a[e]||[],l=i.includes(t)?i:[...i,t];eK({selectedFilters:{...a,[e]:l}}),"/discover"!==e$&&eZ.push("/discover")},e6=(null===(v=e2.dataset_schema)||void 0===v?void 0:v.name)||(null===(p=e2.extra_data)||void 0===p?void 0:p.name)||"Untitled Dataset",e4=(null===(j=e2.dataset_schema)||void 0===j?void 0:j.description)||(null===(_=e2.extra_data)||void 0===_?void 0:_.description)||"",e3=(null===(w=e2.extra_data)||void 0===w?void 0:w.ai_summary)||null,e7=e3&&e3.trim().length>0,e9=eW&&e7?e3:e4,e8=(null===(A=e2.dataset_schema)||void 0===A?void 0:A.image)||e2.image||void 0,te=((null===(C=e2.dataset_schema)||void 0===C?void 0:C.keywords)||[]).filter(e=>"string"==typeof e&&!e.includes("<a title=")&&!e.startsWith("<")),tt=te.length>0,ta=((null===(k=e2.extra_data)||void 0===k?void 0:k.instruments)||[]).length>0,ti=(e2.variables_which_matched||[]).length>0||((null===(S=e2.dataset_schema)||void 0===S?void 0:S.variableMeasured)||[]).length>0||((null===(z=e2.dataset_schema)||void 0===z?void 0:z.number_of_variables)||0)>0,tl=[];if((null===(R=e2.dataset_schema)||void 0===R?void 0:R.identifier)&&Array.isArray(e2.dataset_schema.identifier)){let e=e2.dataset_schema.identifier.filter(e=>!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("10.")&&e.includes("/"))).map(e=>e.startsWith("10.")&&e.includes("/")?"https://doi.org/".concat(e):e);tl.push(...e)}(null===(D=e2.dataset_schema)||void 0===D?void 0:D.url)&&Array.isArray(e2.dataset_schema.url)&&tl.push(...e2.dataset_schema.url);let tr=tl.length>0;(0,x.useEffect)(()=>{eE(!1)},[null===(E=e2.dataset_schema)||void 0===E?void 0:E.name,null===(W=e2.extra_data)||void 0===W?void 0:W.name]),(0,x.useEffect)(()=>{eR(!1)},[null===(I=e2.dataset_schema)||void 0===I?void 0:I.name,null===(O=e2.extra_data)||void 0===O?void 0:O.name]),(0,x.useEffect)(()=>{eQ.current&&eQ.current.scrollTo({top:0,behavior:"smooth"})},[null===(L=e2.extra_data)||void 0===L?void 0:L.uuid]),(0,x.useEffect)(()=>{(async()=>{var e;if(eJ&&(null===(e=e2.extra_data)||void 0===e?void 0:e.uuid))try{let{collection:e,query:t,where:i,getDocs:l}=await Promise.all([a.e(2154),a.e(1972),a.e(7710)]).then(a.bind(a,54615)),{db:r}=await Promise.all([a.e(9895),a.e(2154),a.e(1972),a.e(7512),a.e(92)]).then(a.bind(a,73179)),o=t(e(r,"saved_resources"),i("uid","==",eJ.uid),i("uuid","==",e2.extra_data.uuid)),s=await l(o);if(s.empty)eL(!1),eq(null);else{let e=s.docs[0];eL(!0),eq(e.id)}}catch(e){console.error("Error checking if resource is saved:",e)}})()},[eJ,null===(M=e2.extra_data)||void 0===M?void 0:M.uuid]);let to=async()=>{var e,t,i,l,r,o,s,n,d,c,u,h,x,m,v;if(eJ&&(null===(e=e2.extra_data)||void 0===e?void 0:e.uuid)&&!eM){eU(!0);try{let{collection:e,addDoc:p,serverTimestamp:f,query:g,where:b,getDocs:y,deleteDoc:j,doc:_}=await Promise.all([a.e(2154),a.e(1972),a.e(7710)]).then(a.bind(a,54615)),{db:w}=await Promise.all([a.e(9895),a.e(2154),a.e(1972),a.e(7512),a.e(92)]).then(a.bind(a,73179));if(eO&&eN)await j(_(w,"saved_resources",eN)),eL(!1),eq(null);else{let a=(null===(t=e2.dataset_schema)||void 0===t?void 0:t.name)||(null===(i=e2.extra_data)||void 0===i?void 0:i.name)||"Untitled Dataset",g=(null===(l=e2.extra_data)||void 0===l?void 0:l.ai_summary)||(null===(r=e2.dataset_schema)||void 0===r?void 0:r.description)||(null===(o=e2.extra_data)||void 0===o?void 0:o.description)||"",b=(null===(s=e2.dataset_schema)||void 0===s?void 0:s.image)||e2.image||null,y=(null===(n=e2.extra_data)||void 0===n?void 0:n.ai_summary)||null,j={title:a,description:y||g,image:b||null,uuid:e2.extra_data.uuid,slug:e2.extra_data.slug||null,resourceType:e2.extra_data.resource_type||null,keywords:(null===(d=e2.dataset_schema)||void 0===d?void 0:d.keywords)||[],variablesCount:(null===(u=e2.dataset_schema)||void 0===u?void 0:null===(c=u.variableMeasured)||void 0===c?void 0:c.length)||(null===(h=e2.dataset_schema)||void 0===h?void 0:h.number_of_variables)||0,datasetsCount:(null===(x=e2.child_datasets)||void 0===x?void 0:x.length)||0,hasDataAvailable:!!(null===(v=e2.dataset_schema)||void 0===v?void 0:null===(m=v.includedInDataCatalog)||void 0===m?void 0:m.length),hasFreeAccess:e2.hasFreeAccess||!1,hasCohortsAvailable:e2.hasCohortsAvailable||!1,uid:eJ.uid,created:f()},_=await p(e(w,"saved_resources"),j);eL(!0),eq(_.id)}}catch(e){console.error("Error saving/unsaving resource:",e)}finally{eU(!1)}}};(0,x.useEffect)(()=>{var e;eI(!!((null===(e=e2.extra_data)||void 0===e?void 0:e.ai_summary)&&e2.extra_data.ai_summary.trim().length>0))},[null===(U=e2.dataset_schema)||void 0===U?void 0:U.name,null===(N=e2.extra_data)||void 0===N?void 0:N.name,null===(q=e2.extra_data)||void 0===q?void 0:q.ai_summary]),(0,x.useEffect)(()=>{var e;let t=!1;if(eH(null),!ew&&(null==e2?void 0:null===(e=e2.extra_data)||void 0===e?void 0:e.uuid))return eX(!0),(async()=>{try{let e=await (0,J.w3)(e2.extra_data.uuid,eY.query,eY.hybridWeight,eY.maxDistance);t||(eH(e),eX(!1))}catch(e){console.error("Failed to load enhanced study data:",e),t||eX(!1)}})(),()=>{t=!0}},[null==e2?void 0:null===(F=e2.extra_data)||void 0===F?void 0:F.uuid,ew,eY.query,eY.hybridWeight,eY.maxDistance]);let ts=e=>{eV(t=>({...t,[e]:!t[e]}))},tn=(0,x.useMemo)(()=>{var e;let t=e2.variables_which_matched||[],a=(null===(e=e2.dataset_schema)||void 0===e?void 0:e.variableMeasured)||[],i=new Map;return t.forEach(e=>{let t=e.name;t&&i.set(t,{...e,matched:!0})}),a.forEach(e=>{let t=e.name;!t||i.has(t)||i.set(t,e)}),Array.from(i.values())},[e2.variables_which_matched,null===(T=e2.dataset_schema)||void 0===T?void 0:T.variableMeasured]);return(0,i.jsxs)(l.default,{ref:eQ,sx:{p:3,width:"100%",height:"100%",overflowY:"auto",flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[eG&&(0,i.jsxs)(l.default,{sx:{position:"absolute",top:8,right:8,zIndex:10,display:"flex",alignItems:"center",gap:.5,p:.5,bgcolor:"background.paper",borderRadius:1,boxShadow:1,border:"1px solid",borderColor:"divider"},children:[(0,i.jsx)(r.A,{size:12}),(0,i.jsx)(o.A,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",sm:"0.7rem"}},children:"Loading..."})]}),e_&&eJ&&(0,i.jsx)(l.default,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,i.jsx)(s.A,{onClick:to,disabled:eM,sx:{color:eO?"primary.main":"text.secondary","&:hover":{color:eO?"primary.dark":"primary.main"}},title:eO?"Remove from saved":"Save to my resources",children:eM?(0,i.jsx)(r.A,{size:20}):(0,i.jsx)(c.A,{size:20,fill:eO?"currentColor":"none"})})}),!e_&&(0,i.jsxs)(l.default,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:2,mb:4},children:[(0,i.jsx)(l.default,{sx:{flex:1},children:(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"h4",gutterBottom:!0,sx:{flex:1,mr:1},children:e6}),eJ&&(0,i.jsx)(s.A,{onClick:to,disabled:eM,sx:{color:eO?"primary.main":"text.secondary","&:hover":{color:eO?"primary.dark":"primary.main"}},title:eO?"Remove from saved":"Save to my resources",children:eM?(0,i.jsx)(r.A,{size:20}):(0,i.jsx)(c.A,{size:20,fill:eO?"currentColor":"none"})})]})}),e8&&!eD&&(0,i.jsx)(l.default,{sx:{width:100,height:100,position:"relative",borderRadius:"8px",overflow:"hidden",flexShrink:0},children:(0,i.jsx)(d.default,{src:e8,alt:e6,fill:!0,style:{objectFit:"contain"},onError:()=>eE(!0),unoptimized:!0},e6)})]}),e9&&(0,i.jsxs)(l.default,{sx:{mb:4},children:[ez?(0,i.jsx)(b.A,{text:e9,paragraphProps:{variant:"body1",sx:{mb:2}},compact:!0}):(0,i.jsx)(o.A,{variant:"body1",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",mb:2},children:e9}),e7&&ez&&(0,i.jsx)(l.default,{sx:{mt:2,mb:1},children:(0,i.jsx)(o.A,{variant:"body2",color:"primary",sx:{cursor:"pointer",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>eI(!eW),children:eW?"Showing AI summary, click to see original":"Showing original, click to see AI summary"})}),e9.length>300&&(0,i.jsxs)(l.default,{onClick:()=>eR(!ez),sx:{display:"flex",alignItems:"center",color:"primary.main",cursor:"pointer",mt:1},children:[(0,i.jsx)(o.A,{variant:"body2",color:"primary",sx:{fontWeight:500,mr:1},children:ez?"Show Less":"Show More"}),ez?(0,i.jsx)(u.A,{size:16}):(0,i.jsx)(h.A,{size:16})]})]}),ti&&(0,i.jsxs)(l.default,{sx:{mb:4},children:[(0,i.jsx)(m.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eA?(0,i.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,i.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>eC(!eA),children:(null===(V=e2.variables_which_matched)||void 0===V?void 0:V.length)?"Related Variables (".concat(e2.variables_which_matched.length," / ").concat((null===($=e2.dataset_schema)||void 0===$?void 0:null===(Z=$.variableMeasured)||void 0===Z?void 0:Z.length)||(null===(ee=e2.dataset_schema)||void 0===ee?void 0:ee.number_of_variables)||0,")"):"Variables (".concat((null===(H=e2.dataset_schema)||void 0===H?void 0:null===(P=H.variableMeasured)||void 0===P?void 0:P.length)||(null===(K=e2.dataset_schema)||void 0===K?void 0:K.number_of_variables)||0,")")}),(0,i.jsx)(n.A,{in:eA,children:(0,i.jsx)(l.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,i.jsx)(B,{variables:tn,studyName:e6})})})]}),(0,i.jsxs)(l.default,{sx:{mb:4},children:[(0,i.jsx)(m.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eB.details?(0,i.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,i.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>ts("details"),children:"Details"}),(0,i.jsx)(n.A,{in:eB.details,children:(0,i.jsx)(l.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,i.jsxs)(l.default,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(null===(ea=ej.dataset_schema)||void 0===ea?void 0:null===(et=ea.publisher)||void 0===et?void 0:et[0])&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Publisher:"}),(0,i.jsx)(g.A,{name:ej.dataset_schema.publisher[0].name||"Unknown Publisher",url:null===(ei=ej.dataset_schema.publisher[0])||void 0===ei?void 0:ei.url,logo:null===(el=ej.dataset_schema.publisher[0])||void 0===el?void 0:el.logo})]}),((null===(er=ej.extra_data)||void 0===er?void 0:er.geographic_coverage)||(null===(eo=ej.extra_data)||void 0===eo?void 0:eo.country_codes))&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Geographic Coverage:"}),(0,i.jsx)(o.A,{children:ej.extra_data.geographic_coverage||(null===(es=ej.extra_data.country_codes)||void 0===es?void 0:es.join(", "))})]}),((null===(en=ej.dataset_schema)||void 0===en?void 0:en.temporalCoverage)||(null===(ed=ej.extra_data)||void 0===ed?void 0:ed.start_year)&&(null===(ec=ej.extra_data)||void 0===ec?void 0:ec.end_year))&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Temporal Coverage:"}),(0,i.jsx)(o.A,{children:(e=>{if(!e)return"Not specified";if(e.includes("..")){let[t,a]=e.split("..");return a?"".concat(t," - ").concat(a):"".concat(t," - Present (Ongoing)")}return e})((null===(eu=ej.dataset_schema)||void 0===eu?void 0:eu.temporalCoverage)||"".concat(ej.extra_data.start_year,"..").concat(ej.extra_data.end_year))})]}),(null===(eh=ej.extra_data)||void 0===eh?void 0:eh.sample_size)&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Sample Size:"}),(0,i.jsx)(o.A,{children:ej.extra_data.sample_size})]}),((null===(ex=ej.extra_data)||void 0===ex?void 0:ex.age_lower)||(null===(em=ej.extra_data)||void 0===em?void 0:em.age_upper))&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Age Coverage:"}),(0,i.jsx)(o.A,{children:ej.extra_data.age_lower&&ej.extra_data.age_upper?"".concat(ej.extra_data.age_lower," - ").concat(ej.extra_data.age_upper," years"):ej.extra_data.age_lower?"".concat(ej.extra_data.age_lower,"+ years"):"0 - ".concat(ej.extra_data.age_upper," years")})]}),(null===(ev=ej.extra_data)||void 0===ev?void 0:ev.resource_type)&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Resource Type:"}),(0,i.jsx)(o.A,{children:ej.extra_data.resource_type})]}),(null===(ep=ej.extra_data)||void 0===ep?void 0:ep.study_design)&&ej.extra_data.study_design.length>0&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(o.A,{variant:"subtitle2",children:"Study Design:"}),(0,i.jsx)(o.A,{children:ej.extra_data.study_design.join(", ")})]})]})})})]}),(null===(ef=ej.dataset_schema)||void 0===ef?void 0:ef.funder)&&ej.dataset_schema.funder.length>0&&(0,i.jsxs)(l.default,{sx:{mb:4,flexShrink:0},children:[(0,i.jsx)(o.A,{variant:"subtitle2",gutterBottom:!0,children:"Funders:"}),(0,i.jsx)(l.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:ej.dataset_schema.funder.map((e,t)=>(0,i.jsx)(g.A,{name:e.name||"Funding Organization",url:null==e?void 0:e.url,logo:null==e?void 0:e.logo},"".concat(e.name,"-").concat(t)))})]}),(null===(eg=ej.dataset_schema)||void 0===eg?void 0:eg.includedInDataCatalog)&&ej.dataset_schema.includedInDataCatalog.length>0&&(0,i.jsxs)(l.default,{sx:{mb:4,flexShrink:0},children:[(0,i.jsx)(o.A,{variant:"subtitle2",gutterBottom:!0,children:"Available in Data Catalogs:"}),(0,i.jsx)(l.default,{sx:{display:"flex",overflowX:"auto",gap:2,pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:3}},children:ej.dataset_schema.includedInDataCatalog.map((e,t)=>(0,i.jsx)(f,{name:e.name||"Data Catalog",url:e.url,logo:e.image},"".concat(e.name,"-").concat(t)))})]}),tt&&(0,i.jsxs)(l.default,{sx:{mb:4},children:[(0,i.jsx)(o.A,{variant:"subtitle2",gutterBottom:!0,children:"Topics:"}),(0,i.jsx)(l.default,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:te.map((e,t)=>(0,i.jsx)(m.A,{onClick:t=>{t.stopPropagation(),e0&&e5("keywords",e)},sx:{cursor:"pointer"},children:e},"topic-".concat(t)))})]}),tr&&(0,i.jsxs)(l.default,{sx:{mb:4,flexShrink:0},children:[(0,i.jsx)(m.A,{fullWidth:!0,chipVariant:"secondary",endIcon:ek?(0,i.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,i.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>eS(!ek),children:"Related Links & Papers"}),(0,i.jsx)(n.A,{in:ek,children:ek&&(0,i.jsx)(l.default,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,alignItems:"flex-start"},children:null==tl?void 0:tl.map((e,t)=>(0,i.jsx)(l.default,{sx:{flex:"1 1 350px",minWidth:300,maxWidth:500},children:(0,i.jsx)(y.A,{url:e})},"link-".concat(t)))})})]}),ta&&(0,i.jsxs)(l.default,{sx:{mb:2},children:[(0,i.jsxs)(m.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eF?(0,i.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,i.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto",mb:2},onClick:()=>eT(!eF),children:["Instruments (",((null===(eb=ej.extra_data)||void 0===eb?void 0:eb.instruments)||[]).length,")"]}),(0,i.jsx)(n.A,{in:eF,children:(0,i.jsx)(l.default,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:((null===(ey=ej.extra_data)||void 0===ey?void 0:ey.instruments)||[]).map((e,t)=>(0,i.jsx)(m.A,{onClick:t=>{t.stopPropagation(),e0&&e5("instruments",e)},sx:{cursor:"pointer"},children:e},"instrument-".concat(t)))})})]}),Array.isArray(ej.child_datasets)&&(ej.child_datasets||[]).length>0&&(0,i.jsxs)(l.default,{sx:{mb:4},children:[(0,i.jsxs)(m.A,{fullWidth:!0,chipVariant:"secondary",endIcon:eB.childDatasets?(0,i.jsx)(u.A,{size:16,style:{fill:"#004735",stroke:"none"}}):(0,i.jsx)(h.A,{size:16,style:{fill:"#004735",stroke:"none"}}),sx:{justifyContent:"space-between",py:2,height:"auto"},onClick:()=>ts("childDatasets"),children:["Related Datasets (",(ej.child_datasets||[]).length,")"]}),(0,i.jsx)(n.A,{in:eB.childDatasets,children:(0,i.jsx)(l.default,{sx:{p:2,bgcolor:"rgba(0, 0, 0, 0.02)",borderRadius:2,mb:2},children:(0,i.jsx)(G,{datasets:ej.child_datasets})})})]})]})})},67699:()=>{}}]);