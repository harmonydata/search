(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{21231:(e,t,a)=>{Promise.resolve().then(a.bind(a,32563))},32563:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(95155),n=a(12115),i=a(65380),s=a(99703),o=a(25635),l=a(94049),d=a(4474),c=a(22003),u=a(33077),h=a(29767),m=a(84578),g=a(2300),y=a(70690),x=a(3139),p=a(57883),f=a(53489),v=a(50077),A=a(20063),j=a(26991),w=a(21993),b=a(12235),S=a(69386),D=a(23508),F=a(98128),k=a(68425),R=a(47734),_=a(73697),C=a(16533);function N(){let{currentUser:e,loading:t}=(0,i.A)(),a=(0,A.useRouter)(),[N,I]=(0,n.useState)(!0),[B,T]=(0,n.useState)(!0),[q,O]=(0,n.useState)(null),[E,M]=(0,n.useState)([]),[Q,U]=(0,n.useState)(null),[z,P]=(0,n.useState)([]),[L,W]=(0,n.useState)([]),[G,K]=(0,n.useState)("discovery"),[H,J]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!t){if(!e)return void a.push("/");V()}},[e,t,a]);let V=async()=>{if(!(null==e?void 0:e.uid))return void a.push("/");try{if(!await (0,s.isAdmin)(e.uid))return void J("Access denied. Admin privileges required.");X()}catch(e){console.error("Failed to check admin status:",e),J("Failed to verify admin access. Please try again.")}},X=async()=>{try{I(!0),T(!0);let[e,t,a,r,n]=await Promise.all([(0,s.$w)(30),(0,s.Id)(100),(0,s.cq)(30),(0,s.Pu)(1e3),(0,s.DQ)(100)]);O(e),M(t),U(a),P(r),W(n)}catch(e){console.error("Failed to load admin data:",e),J("Failed to load admin data. Please try again.")}finally{I(!1),T(!1)}},$=(0,n.useMemo)(()=>E.map((e,t)=>{var a,r,n,i,s,o,l,d,c;let u=e.searchContext,h=e.reportedResult;return{id:e.id||t,type:e.discovery_search_feedback?"Search Quality":"General",reason:e.reason||"—",comment:e.comment||"—",searchQuery:(null==u?void 0:u.query)||"—",studyName:(null==h||null==(a=h.dataset_schema)?void 0:a.name)||(null==h||null==(r=h.extra_data)?void 0:r.name)||(null==u||null==(i=u.reportedResult)||null==(n=i.dataset_schema)?void 0:n.name)||(null==u||null==(o=u.reportedResult)||null==(s=o.extra_data)?void 0:s.name)||"—",studyUuid:(null==h||null==(l=h.extra_data)?void 0:l.uuid)||(null==u||null==(c=u.reportedResult)||null==(d=c.extra_data)?void 0:d.uuid)||"—",date:e.timestamp?e.timestamp.toDate?e.timestamp.toDate().toLocaleString():new Date(e.timestamp).toLocaleString():"—",rawData:e}}),[E]),Z=[{field:"type",headerName:"Type",width:130},{field:"reason",headerName:"Reason",width:200,flex:1},{field:"comment",headerName:"Comment",width:250,flex:1},{field:"searchQuery",headerName:"Search Query",width:200,flex:1},{field:"studyName",headerName:"Reported Study",width:250,flex:1},{field:"studyUuid",headerName:"Study UUID",width:300,renderCell:e=>{let t=e.value;return"—"===t?"—":(0,r.jsx)(o.A,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem",wordBreak:"break-all"},children:t})}},{field:"date",headerName:"Date",width:180}],Y=(0,n.useMemo)(()=>Q?Q.ratingsByDay.map((e,t)=>({id:t,date:e.date,avgRating:e.avgRating,count:e.count})):[],[Q]),ee=[{field:"date",headerName:"Date",width:150},{field:"avgRating",headerName:"Average Rating",width:150,renderCell:e=>(0,r.jsxs)(o.A,{variant:"body2",children:["⭐ ",e.value.toFixed(1),"/5"]})},{field:"count",headerName:"Number of Ratings",width:180}],et=(0,n.useMemo)(()=>q?q.topQueries.map((e,t)=>({id:t,query:e.query,searches:e.count,avgResults:e.avgResults,avgResponseTime:e.avgResponseTime})):[],[q]),ea=[{field:"query",headerName:"Query",flex:1,minWidth:200},{field:"searches",headerName:"Searches",width:120,align:"right",headerAlign:"right"},{field:"avgResults",headerName:"Avg Results",width:150,align:"right",headerAlign:"right",valueFormatter:e=>null!=e?e.toLocaleString():"0"},{field:"avgResponseTime",headerName:"Avg Response Time",width:180,align:"right",headerAlign:"right",valueFormatter:e=>null!=e?"".concat(e,"ms"):"—"}],er=(0,n.useMemo)(()=>L.map(e=>{let t=e.q1||{},a=e.q2||{},r=e.model_used||{},n="—";if(void 0!==e.match_reported)n=Math.round(100*e.match_reported*100)/100;else if(void 0!==a.instrument_index&&t.matches&&Array.isArray(t.matches)){let e=a.instrument_index;void 0!==t.matches[e]&&(n=Math.round(100*t.matches[e]*100)/100)}return{id:e.id,date:e.created?e.created.toDate?e.created.toDate().toLocaleString():new Date(e.created).toLocaleString():"—",framework:r.framework||"—",q1Question:t.question_text||"—",q2Question:a.question_text||"—",rating:n}}),[L]),en=[{field:"date",headerName:"Date",width:180},{field:"framework",headerName:"Framework",width:150},{field:"q1Question",headerName:"Q1 Question",width:400,flex:1},{field:"q2Question",headerName:"Q2 Question",width:400,flex:1},{field:"rating",headerName:"Rating (%)",width:120,align:"right",headerAlign:"right",renderCell:e=>{let t=e.value;return"—"===t||null==t?"—":(0,r.jsx)(o.A,{variant:"body2",sx:{fontWeight:500},children:"number"==typeof t?"".concat(t.toFixed(2),"%"):t})}}];return t||N?(0,r.jsx)(l.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,r.jsx)(d.A,{})}):H?(0,r.jsx)(l.default,{sx:{p:4},children:(0,r.jsx)(c.A,{severity:"error",children:H})}):(0,r.jsxs)(l.default,{sx:{p:4},children:[(0,r.jsx)(o.A,{variant:"h4",gutterBottom:!0,children:"Admin Dashboard"}),(0,r.jsxs)(o.A,{variant:"body2",color:"text.secondary",sx:{mb:4},children:["Logged in as: ",null==e?void 0:e.email]}),(0,r.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(h.A,{children:(0,r.jsxs)(m.A,{children:[(0,r.jsx)(o.A,{color:"text.secondary",gutterBottom:!0,children:"Total Searches (30 days)"}),(0,r.jsx)(o.A,{variant:"h4",children:(null==q?void 0:q.totalSearches.toLocaleString())||0})]})})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(h.A,{children:(0,r.jsxs)(m.A,{children:[(0,r.jsx)(o.A,{color:"text.secondary",gutterBottom:!0,children:"Avg Response Time"}),(0,r.jsxs)(o.A,{variant:"h4",children:[(null==q?void 0:q.averageResponseTime)||0,"ms"]})]})})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsx)(h.A,{children:(0,r.jsxs)(m.A,{children:[(0,r.jsx)(o.A,{color:"text.secondary",gutterBottom:!0,children:"Avg Results per Search"}),(0,r.jsx)(o.A,{variant:"h4",children:(null==q?void 0:q.averageResults)||0})]})})})]}),q&&(0,r.jsxs)(u.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(g.A,{sx:{p:3},children:[(0,r.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Pagination Strategy"}),(0,r.jsx)(l.default,{sx:{height:300,mt:2},children:(0,r.jsx)(j.u,{width:"100%",height:"100%",children:(0,r.jsxs)(w.r,{children:[(0,r.jsx)(b.F,{data:q.paginationStrategyCounts,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:a}=e;return"".concat(t,": ").concat((100*a).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"count",children:q.paginationStrategyCounts.map((e,t)=>(0,r.jsx)(S.f,{fill:["#2E5FFF","#90EE90","#FF6B6B","#FFD93D"][t%4]},"cell-".concat(t)))}),(0,r.jsx)(D.m,{formatter:(e,t,a)=>[a.payload.strategy,""]})]})})})]})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(g.A,{sx:{p:3},children:[(0,r.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Filter Usage"}),(0,r.jsx)(l.default,{sx:{height:300,mt:2},children:(0,r.jsx)(j.u,{width:"100%",height:"100%",children:(0,r.jsxs)(F.E,{data:[{name:"None",value:q.filterUsage.none},{name:"Source",value:q.filterUsage.source},{name:"Topics",value:q.filterUsage.topics},{name:"Study Design",value:q.filterUsage.study_design},{name:"Sample Characteristics",value:q.filterUsage.sample_characteristics},{name:"Instruments",value:q.filterUsage.instruments}],children:[(0,r.jsx)(k.d,{strokeDasharray:"3 3"}),(0,r.jsx)(R.W,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),(0,r.jsx)(_.h,{}),(0,r.jsx)(D.m,{}),(0,r.jsx)(C.y,{dataKey:"value",fill:"#90EE90"})]})})})]})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(g.A,{sx:{p:3},children:[(0,r.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Distance Strategy"}),(0,r.jsx)(l.default,{sx:{height:300,mt:2},children:(0,r.jsx)(j.u,{width:"100%",height:"100%",children:(0,r.jsxs)(w.r,{children:[(0,r.jsx)(b.F,{data:q.distanceStrategyCounts,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percent:a}=e;return"".concat(t,": ").concat((100*a).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"count",children:q.distanceStrategyCounts.map((e,t)=>(0,r.jsx)(S.f,{fill:["#FF6B6B","#FFD93D","#6BCF7F","#4D96FF"][t%4]},"cell-".concat(t)))}),(0,r.jsx)(D.m,{formatter:(e,t,a)=>[a.payload.strategy,""]})]})})})]})})]}),q&&q.topQueries.length>0&&(0,r.jsxs)(g.A,{sx:{p:3,mb:4,height:400},children:[(0,r.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Top Search Queries (30 days)"}),(0,r.jsx)(v.z,{rows:et,columns:ea,pageSizeOptions:[10,25,50],initialState:{pagination:{paginationModel:{pageSize:10}}},disableRowSelectionOnClick:!0,sx:{border:0}})]}),(0,r.jsxs)(g.A,{sx:{p:3},children:[(0,r.jsxs)(l.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,r.jsx)(o.A,{variant:"h6",children:"Feedback"}),(0,r.jsxs)(l.default,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,r.jsx)(y.A,{variant:"outlined",size:"small",startIcon:(0,r.jsx)(f.A,{size:16}),onClick:()=>{let e,t;"discovery"===G?(e=E,t="discovery-feedback-".concat(new Date().toISOString().split("T")[0],".json")):"harmony"===G?(e=z,t="harmony-ratings-".concat(new Date().toISOString().split("T")[0],".json")):(e=L,t="mismatches-".concat(new Date().toISOString().split("T")[0],".json"));let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)},children:"Export Data"}),(0,r.jsxs)(x.A,{value:G,exclusive:!0,onChange:(e,t)=>{null!==t&&K(t)},size:"small",children:[(0,r.jsx)(p.A,{value:"discovery",children:"Discovery"}),(0,r.jsx)(p.A,{value:"harmony",children:"Harmony"}),(0,r.jsx)(p.A,{value:"mismatches",children:"Mismatches"})]})]})]}),B?(0,r.jsx)(l.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,r.jsx)(d.A,{})}):"discovery"===G?(0,r.jsx)(r.Fragment,{children:0===E.length?(0,r.jsx)(o.A,{color:"text.secondary",children:"No discovery feedback yet."}):(0,r.jsx)(l.default,{sx:{height:600},children:(0,r.jsx)(v.z,{rows:$,columns:Z,pageSizeOptions:[10,25,50,100],initialState:{pagination:{paginationModel:{pageSize:25}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},disableRowSelectionOnClick:!0,sx:{border:0}})})}):"harmony"===G?(0,r.jsxs)(r.Fragment,{children:[Q&&(0,r.jsx)(l.default,{sx:{mb:3},children:(0,r.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,r.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(h.A,{children:(0,r.jsxs)(m.A,{children:[(0,r.jsx)(o.A,{color:"text.secondary",gutterBottom:!0,children:"Average Rating (30 days)"}),(0,r.jsxs)(o.A,{variant:"h4",children:["⭐ ",Q.averageRating.toFixed(1),"/5"]})]})})}),(0,r.jsx)(u.Ay,{item:!0,xs:12,md:6,children:(0,r.jsx)(h.A,{children:(0,r.jsxs)(m.A,{children:[(0,r.jsx)(o.A,{color:"text.secondary",gutterBottom:!0,children:"Total Ratings (30 days)"}),(0,r.jsx)(o.A,{variant:"h4",children:Q.totalRatings.toLocaleString()})]})})})]})}),0===Y.length?(0,r.jsx)(o.A,{color:"text.secondary",children:"No harmony ratings yet."}):(0,r.jsx)(l.default,{sx:{height:400},children:(0,r.jsx)(v.z,{rows:Y,columns:ee,pageSizeOptions:[10,25,50],initialState:{pagination:{paginationModel:{pageSize:25}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},disableRowSelectionOnClick:!0,sx:{border:0}})})]}):(0,r.jsx)(r.Fragment,{children:0===L.length?(0,r.jsx)(o.A,{color:"text.secondary",children:"No mismatches reported yet."}):(0,r.jsx)(l.default,{sx:{height:600},children:(0,r.jsx)(v.z,{rows:er,columns:en,pageSizeOptions:[10,25,50,100],initialState:{pagination:{paginationModel:{pageSize:25}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},disableRowSelectionOnClick:!0,sx:{border:0}})})})]})]})}},65380:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,AuthProvider:()=>d});var r=a(95155),n=a(12115);let i=null,s=async()=>{if(i)return i;console.log("\uD83D\uDD0D Loading Firebase modules dynamically");let[{auth:e},{GithubAuthProvider:t,TwitterAuthProvider:r,GoogleAuthProvider:n,signInWithPopup:s,signInWithEmailAndPassword:o,createUserWithEmailAndPassword:l,sendPasswordResetEmail:d,signOut:c,onAuthStateChanged:u}]=await Promise.all([Promise.all([a.e(9895),a.e(2154),a.e(9820),a.e(1182),a.e(2691)]).then(a.bind(a,68464)),Promise.all([a.e(9895),a.e(9820),a.e(1182)]).then(a.bind(a,33885))]);return i={auth:e,GithubAuthProvider:t,TwitterAuthProvider:r,GoogleAuthProvider:n,signInWithPopup:s,signInWithEmailAndPassword:o,createUserWithEmailAndPassword:l,sendPasswordResetEmail:d,signOut:c,onAuthStateChanged:u}},o=(0,n.createContext)({currentUser:null,isAdmin:!1,login:async()=>(console.warn("Auth not available on server"),null),signup:async()=>(console.warn("Auth not available on server"),null),logout:async()=>{console.warn("Auth not available on server")},resetPassword:async()=>{console.warn("Auth not available on server")},signInWithGoogle:async()=>(console.warn("Auth not available on server"),null),signInWithGitHub:async()=>(console.warn("Auth not available on server"),null),signInWithTwitter:async()=>(console.warn("Auth not available on server"),null),loading:!1});function l(){return(0,n.useContext)(o)}function d(e){let{children:t}=e,[i,l]=(0,n.useState)(null),[d,c]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!0),[m,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let{auth:e,onAuthStateChanged:t}=await s();if(!e){console.warn("Firebase auth not available"),h(!1);return}return g(!0),t(e,async e=>{if(console.log("\uD83D\uDD04 Auth state changed:",{hasUser:!!e,uid:null==e?void 0:e.uid,SSR:!1}),l(e),null==e?void 0:e.uid){console.log("\uD83D\uDD10 AuthContext: User logged in, checking admin status for UID:",e.uid);try{let{isAdmin:t}=await Promise.all([a.e(9895),a.e(2154),a.e(9820),a.e(1182),a.e(7234)]).then(a.bind(a,99703));console.log("\uD83D\uDD10 AuthContext: Admin check function loaded, calling...");let r=await t(e.uid);console.log("\uD83D\uDD10 AuthContext: Admin check completed, result:",r),c(r)}catch(e){console.error("\uD83D\uDD10 AuthContext: Failed to check admin status:",e),c(!1)}}else console.log("\uD83D\uDD10 AuthContext: No user, setting isAdmin to false"),c(!1);h(!1)})}catch(e){console.error("Failed to load Firebase modules:",e),h(!1)}})()},[]);let y={currentUser:i,isAdmin:d,...n.useMemo(()=>{let e=async e=>{let{auth:t,signInWithPopup:a}=await s();return a(t,e).then(e=>e.user).catch(t=>e.credentialFromError(t))};return{login:async(e,t)=>{let{auth:a,signInWithEmailAndPassword:r}=await s();return r(a,e,t)},signup:async(e,t)=>{let{auth:a,createUserWithEmailAndPassword:r}=await s();return r(a,e,t)},logout:async()=>{let{auth:e,signOut:t}=await s();return t(e)},resetPassword:async e=>{let{auth:t,sendPasswordResetEmail:a}=await s();return a(t,e)},signInWithGoogle:async()=>{let{GoogleAuthProvider:t}=await s();return e(new t)},signInWithGitHub:async()=>{let{GithubAuthProvider:t}=await s();return e(new t)},signInWithTwitter:async()=>{let{TwitterAuthProvider:t}=await s();return e(new t)}}},[]),loading:u};return(0,r.jsx)(o.Provider,{value:y,children:t})}},95465:(e,t,a)=>{"use strict";a.r(t),a.d(t,{app:()=>s,auth:()=>o,db:()=>l});var r=a(52078),n=a(33885),i=a(65705);let s=(0,r.Wp)({apiKey:"AIzaSyBQVkRjbTQD6BXCdo2JeiFfwyvGVT7bOXM",authDomain:"harmony-6bd51.firebaseapp.com",projectId:"harmony-6bd51",storageBucket:"harmony-6bd51.appspot.com",messagingSenderId:"914732561143",appId:"1:914732561143:web:b041f0c5e7fab57400d9f2",measurementId:"G-S79J6E39ZP"}),o=(0,n.getAuth)(s),l=(0,i.getFirestore)(s)},99703:(e,t,a)=>{"use strict";a.d(t,{$w:()=>o,DQ:()=>u,Id:()=>l,Pu:()=>c,cq:()=>d,isAdmin:()=>i});var r=a(65705),n=a(95465);let i=async e=>{if(!e)return console.log("\uD83D\uDD10 Admin check: No userId provided"),!1;console.log("\uD83D\uDD10 Admin check: Checking userId:",e);try{let t=(0,r.doc)(n.db,"users",e);console.log("\uD83D\uDD10 Admin check: Attempting to read document at users/".concat(e));let a=await (0,r.getDoc)(t);if(console.log("\uD83D\uDD10 Admin check: Document exists:",a.exists()),!a.exists())return console.log("\uD83D\uDD10 Admin check: Document does not exist - user is not admin"),!1;let i=a.data();console.log("\uD83D\uDD10 Admin check: Document data:",i),console.log("\uD83D\uDD10 Admin check: isAdmin value:",i.isAdmin);let s=!0===i.isAdmin;return console.log("\uD83D\uDD10 Admin check: Result:",s),s}catch(e){if(console.error("\uD83D\uDD10 Admin check: Error occurred:",e),console.error("\uD83D\uDD10 Admin check: Error code:",null==e?void 0:e.code),console.error("\uD83D\uDD10 Admin check: Error message:",null==e?void 0:e.message),(null==e?void 0:e.code)==="permission-denied")return console.log("\uD83D\uDD10 Admin check: Permission denied - user is not admin"),!1;return console.error("\uD83D\uDD10 Admin check: Unexpected error - returning false"),!1}},s=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,r.query)((0,r.collection)(n.db,"analytics_events"),(0,r.orderBy)("timestamp","desc"));return e.eventType&&(t=(0,r.query)(t,(0,r.where)("event_type","==",e.eventType))),e.startDate&&(t=(0,r.query)(t,(0,r.where)("timestamp",">=",r.Timestamp.fromDate(e.startDate)))),e.endDate&&(t=(0,r.query)(t,(0,r.where)("timestamp","<=",r.Timestamp.fromDate(e.endDate)))),t=e.limitCount?(0,r.query)(t,(0,r.limit)(e.limitCount)):(0,r.query)(t,(0,r.limit)(1e3)),(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Failed to fetch analytics events:",e),e}},o=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{let t=new Date;t.setDate(t.getDate()-e);let a=(await s({eventType:"search",startDate:t})).filter(e=>"search"===e.event_type),r=a.length,n=a.map(e=>e.response_time_ms).filter(e=>"number"==typeof e),i=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,o=a.map(e=>e.num_results).filter(e=>"number"==typeof e),l=o.length>0?o.reduce((e,t)=>e+t,0)/o.length:0,d={},c={},u={};a.forEach(e=>{let t=e.search_term||"";if(t){d[t]=(d[t]||0)+1;let a=e.num_results;"number"==typeof a&&(c[t]||(c[t]=[]),c[t].push(a));let r=e.response_time_ms;"number"==typeof r&&(u[t]||(u[t]=[]),u[t].push(r))}});let h=Object.entries(d).map(e=>{let[t,a]=e,r=c[t]||[],n=r.length>0?Math.round(r.reduce((e,t)=>e+t,0)/r.length):0,i=u[t]||[],s=i.length>0?Math.round(i.reduce((e,t)=>e+t,0)/i.length):0;return{query:t,count:a,avgResults:n,avgResponseTime:s}}).sort((e,t)=>t.count-e.count).slice(0,10),m={};a.forEach(e=>{if(e.timestamp){let t=e.timestamp.toDate().toISOString().split("T")[0];m[t]=(m[t]||0)+1}});let g=Object.entries(m).map(e=>{let[t,a]=e;return{date:t,count:a}}).sort((e,t)=>e.date.localeCompare(t.date)),y={};a.forEach(e=>{let t=e.pagination_strategy||"unknown";y[t]=(y[t]||0)+1});let x=Object.entries(y).map(e=>{let[t,a]=e;return{strategy:t,count:a}}).sort((e,t)=>t.count-e.count),p={};a.forEach(e=>{let t=e.max_distance_mode||"unknown";p[t]=(p[t]||0)+1});let f=Object.entries(p).map(e=>{let[t,a]=e;return{strategy:t,count:a}}).sort((e,t)=>t.count-e.count),v={none:0,source:0,topics:0,study_design:0,sample_characteristics:0,instruments:0};return a.forEach(e=>{let t=e.filter_count||0;if(0===t)v.none++;else{let t=function(e){if(!e)return null;if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.warn("Failed to parse filters string:",e)}else if("object"==typeof e&&null!==e)return e;return null}(e.filters);if(!t)return void v.none++;void 0!==t.source&&v.source++,void 0!==t.keywords&&v.topics++,void 0!==t.study_design&&v.study_design++,void 0!==t.sample_characteristics&&v.sample_characteristics++,void 0!==t.instruments&&v.instruments++}}),{totalSearches:r,averageResponseTime:Math.round(i),averageResults:Math.round(l),topQueries:h,searchesByDay:g,paginationStrategyCounts:x,distanceStrategyCounts:f,filterUsage:v}}catch(e){throw console.error("Failed to get search analytics summary:",e),e}},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,r.query)((0,r.collection)(n.db,"ratings"),(0,r.where)("source","==","discoverynext"),(0,r.orderBy)("created","desc"),(0,r.limit)(e));return(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null}))}catch(e){throw console.error("Failed to fetch discovery feedback:",e),e}},d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{let t=new Date;t.setDate(t.getDate()-e);let a=(0,r.query)((0,r.collection)(n.db,"ratings"),(0,r.orderBy)("created","desc")),i=(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null})).filter(e=>e.timestamp&&e.timestamp.toDate()>=t&&(!e.source||"discoverynext"!==e.source)&&"number"==typeof e.rating),s=i.map(e=>e.rating),o=s.length>0?s.reduce((e,t)=>e+t,0)/s.length:0,l={};i.forEach(e=>{if(e.timestamp){let t=e.timestamp.toDate().toISOString().split("T")[0];l[t]||(l[t]=[]),"number"==typeof e.rating&&l[t].push(e.rating)}});let d=Object.entries(l).map(e=>{let[t,a]=e;return{date:t,avgRating:Math.round(a.reduce((e,t)=>e+t,0)/a.length*10)/10,count:a.length}}).sort((e,t)=>e.date.localeCompare(t.date));return{averageRating:Math.round(10*o)/10,totalRatings:i.length,ratingsByDay:d}}catch(e){throw console.error("Failed to fetch harmony rating summary:",e),e}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,r.query)((0,r.collection)(n.db,"ratings"),(0,r.orderBy)("created","desc"),(0,r.limit)(e));return(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),timestamp:e.data().created||null})).filter(e=>(!e.source||"discoverynext"!==e.source)&&"number"==typeof e.rating)}catch(e){throw console.error("Failed to fetch harmony ratings:",e),e}},u=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,r.query)((0,r.collection)(n.db,"mismatches"),(0,r.orderBy)("created","desc"),(0,r.limit)(e));return(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data(),created:e.data().created||null}))}catch(e){throw console.error("Failed to fetch mismatches:",e),e}}}},e=>{e.O(0,[9895,2154,9692,4616,690,7213,9474,9820,7133,8548,1182,3423,4456,2695,77,3305,6018,5854,8441,1255,7358],()=>e(e.s=21231)),_N_E=e.O()}]);